<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libStorageMgmt: BlockMgmt.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>BlockMgmt.cpp</h1><a href="_block_mgmt_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* ex: set tabstop=4 expandtab: */</span>
<a name="l00002"></a>00002 <span class="comment">/*</span>
<a name="l00003"></a>00003 <span class="comment"> * Copyright (C) 2011-2013 Red Hat, Inc.</span>
<a name="l00004"></a>00004 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
<a name="l00005"></a>00005 <span class="comment"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="l00006"></a>00006 <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l00007"></a>00007 <span class="comment"> * version 2.1 of the License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00012"></a>00012 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00015"></a>00015 <span class="comment"> * License along with this library; If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> * Author: tasleson</span>
<a name="l00018"></a>00018 <span class="comment"> */</span>
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="_block_mgmt_8h.html">BlockMgmt.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a><a class="code" href="_block_mgmt_8cpp.html#ac9daeba4a9915264cbb407db5dfe039d">00023</a> <span class="keyword">template</span> &lt;<span class="keyword">class</span> Type&gt; <span class="keywordtype">void</span> <a class="code" href="_block_mgmt_8cpp.html#ac9daeba4a9915264cbb407db5dfe039d">getPropValue</a>(CIMInstance i, String key, Type &amp;value)
<a name="l00024"></a>00024 {
<a name="l00025"></a>00025     i.getProperty(i.findProperty(CIMName(key))).<a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>().get(value);
<a name="l00026"></a>00026 }
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00029"></a><a class="code" href="class_block_mgmt.html#a478d697737852758d18c960aab192a91">00029</a> <a class="code" href="class_block_mgmt.html#a478d697737852758d18c960aab192a91">BlockMgmt::BlockMgmt</a>(String host, Uint16 port, String smisNameSpace,
<a name="l00030"></a>00030                      String userName, String <a class="code" href="namespacenetapp.html#acef45431d77c887a9243c5481d0918c8">password</a> ):ns(smisNameSpace)
<a name="l00031"></a>00031 {
<a name="l00032"></a>00032     c.connect(host, port, userName, password);
<a name="l00033"></a>00033 }
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="class_block_mgmt.html#a177a25cd060c01a35de68b052d70cb84">00035</a> <a class="code" href="class_block_mgmt.html#a177a25cd060c01a35de68b052d70cb84">BlockMgmt::~BlockMgmt</a>()
<a name="l00036"></a>00036 {
<a name="l00037"></a>00037     c.disconnect();
<a name="l00038"></a>00038 }
<a name="l00039"></a>00039 
<a name="l00040"></a><a class="code" href="class_block_mgmt.html#ac76ef80aa8b4bf1a394c2452181e5918">00040</a> Array&lt;String&gt; <a class="code" href="class_block_mgmt.html#ac76ef80aa8b4bf1a394c2452181e5918">BlockMgmt::getStoragePools</a>()
<a name="l00041"></a>00041 {
<a name="l00042"></a>00042     <span class="keywordflow">return</span> instancePropertyNames(<span class="stringliteral">&quot;CIM_StoragePool&quot;</span>, <span class="stringliteral">&quot;ElementName&quot;</span>);
<a name="l00043"></a>00043 }
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="class_block_mgmt.html#aec03e6e3d1a61e7b4adfc739a9dac212">00045</a> Array&lt;String&gt; <a class="code" href="class_block_mgmt.html#aec03e6e3d1a61e7b4adfc739a9dac212">BlockMgmt::getInitiators</a>()
<a name="l00046"></a>00046 {
<a name="l00047"></a>00047     <span class="comment">//Note: If you want the storage array IQN go after CIM_SCSIProtocolEndpoint.Name</span>
<a name="l00048"></a>00048     <span class="keywordflow">return</span> instancePropertyNames(<span class="stringliteral">&quot;CIM_StorageHardwareID&quot;</span>, <span class="stringliteral">&quot;StorageID&quot;</span>);
<a name="l00049"></a>00049 }
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 CIMInstance BlockMgmt::getSPC( String initiator, String lun, <span class="keywordtype">bool</span> &amp;found )
<a name="l00052"></a>00052 {
<a name="l00053"></a>00053     CIMInstance rc;
<a name="l00054"></a>00054 
<a name="l00055"></a>00055     CIMInstance init = getClassInstance(<span class="stringliteral">&quot;CIM_StorageHardwareID&quot;</span>, <span class="stringliteral">&quot;StorageID&quot;</span>, initiator);
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     Array&lt;CIMObject&gt; auth_priviledge = c.associators(ns, init.getPath(), <span class="stringliteral">&quot;CIM_AuthorizedSubject&quot;</span>);
<a name="l00058"></a>00058 
<a name="l00059"></a>00059     <span class="keywordflow">for</span>( Uint32 i = 0; i &lt; auth_priviledge.size(); ++i ) {
<a name="l00060"></a>00060         Array&lt;CIMObject&gt; spc = c.associators(ns, auth_priviledge[i].getPath(), <span class="stringliteral">&quot;CIM_AuthorizedTarget&quot;</span>);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062         <span class="comment">//Make sure that we have associations for authorized targets and controllers.</span>
<a name="l00063"></a>00063         <span class="keywordflow">if</span>( spc.size() &gt; 0 ) {
<a name="l00064"></a>00064             Array&lt;CIMObject&gt; logicalDevice = c.associators(ns, spc[0].getPath(), <span class="stringliteral">&quot;CIM_ProtocolControllerForUnit&quot;</span>);
<a name="l00065"></a>00065 
<a name="l00066"></a>00066             <span class="keywordflow">if</span>( logicalDevice.size() &gt; 0 ) {
<a name="l00067"></a>00067                 CIMInstance volume = c.getInstance(ns, logicalDevice[0].getPath().toString());
<a name="l00068"></a>00068 
<a name="l00069"></a>00069                 String <a class="code" href="lsm__datatypes_8cpp.html#a2cc1fcbe95db9f01f0bc16e608508a1d">name</a>;
<a name="l00070"></a>00070                 <a class="code" href="_block_mgmt_8cpp.html#ac9daeba4a9915264cbb407db5dfe039d">getPropValue</a>(volume, <span class="stringliteral">&quot;ElementName&quot;</span>, name);
<a name="l00071"></a>00071 
<a name="l00072"></a>00072                 <span class="keywordflow">if</span>( name == lun ) {
<a name="l00073"></a>00073                     found = <span class="keyword">true</span>;
<a name="l00074"></a>00074                     <span class="keywordflow">return</span> (CIMInstance)spc[0];
<a name="l00075"></a>00075                 }
<a name="l00076"></a>00076             }
<a name="l00077"></a>00077         }
<a name="l00078"></a>00078     }
<a name="l00079"></a>00079     found = <span class="keyword">false</span>;
<a name="l00080"></a>00080     <span class="keywordflow">return</span> rc;
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="class_block_mgmt.html#a16572b5a331567b4efb9bd9610e38568">00083</a> <span class="keywordtype">void</span> <a class="code" href="class_block_mgmt.html#a16572b5a331567b4efb9bd9610e38568">BlockMgmt::mapLun</a>(String initiatorID, String lunName)
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085     Array&lt;CIMParamValue&gt; in;
<a name="l00086"></a>00086     Array&lt;CIMParamValue&gt; <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l00087"></a>00087     Array&lt;String&gt;lunNames;
<a name="l00088"></a>00088     Array&lt;String&gt;initPortIDs;
<a name="l00089"></a>00089     Array&lt;String&gt;deviceNumbers;
<a name="l00090"></a>00090     Array&lt;Uint16&gt;deviceAccess;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     CIMInstance lun = getClassInstance(<span class="stringliteral">&quot;CIM_StorageVolume&quot;</span>, <span class="stringliteral">&quot;ElementName&quot;</span>,
<a name="l00093"></a>00093                                        lunName);
<a name="l00094"></a>00094 
<a name="l00095"></a>00095     lunNames.append(getClassValue(lun, <span class="stringliteral">&quot;Name&quot;</span>));
<a name="l00096"></a>00096     initPortIDs.append(initiatorID);
<a name="l00097"></a>00097     deviceAccess.append(READ_WRITE);   <span class="comment">//Hard coded to Read Write</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     CIMInstance ccs = getClassInstance(<span class="stringliteral">&quot;CIM_ControllerConfigurationService&quot;</span>);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101     in.append(CIMParamValue(<span class="stringliteral">&quot;LUNames&quot;</span>, lunNames));
<a name="l00102"></a>00102     in.append(CIMParamValue(<span class="stringliteral">&quot;InitiatorPortIDs&quot;</span>, initPortIDs));
<a name="l00103"></a>00103     in.append(CIMParamValue(<span class="stringliteral">&quot;DeviceAccesses&quot;</span>, deviceAccess));
<a name="l00104"></a>00104 
<a name="l00105"></a>00105     evalInvoke(out, c.invokeMethod(ns, ccs.getPath(),
<a name="l00106"></a>00106                                    CIMName(<span class="stringliteral">&quot;ExposePaths&quot;</span>),
<a name="l00107"></a>00107                                    in, out));
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a><a class="code" href="class_block_mgmt.html#ac19a7451d6214e69abb1799877ed3905">00110</a> <span class="keywordtype">void</span> <a class="code" href="class_block_mgmt.html#ac19a7451d6214e69abb1799877ed3905">BlockMgmt::unmapLun</a>(String initiatorID, String lunName)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112     <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114     <span class="comment">//Need to find the SPC for the passed in initiator and volume (lun).</span>
<a name="l00115"></a>00115     CIMInstance spc = getSPC(initiatorID, lunName, found);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <span class="keywordflow">if</span>( found )  {
<a name="l00118"></a>00118         Array&lt;CIMParamValue&gt; in;
<a name="l00119"></a>00119         Array&lt;CIMParamValue&gt; <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121         <span class="comment">//Let delete the SPC</span>
<a name="l00122"></a>00122         CIMInstance ccs = getClassInstance(<span class="stringliteral">&quot;CIM_ControllerConfigurationService&quot;</span>);
<a name="l00123"></a>00123         in.append(CIMParamValue(<span class="stringliteral">&quot;ProtocolController&quot;</span>, spc.getPath()));
<a name="l00124"></a>00124         in.append(CIMParamValue(<span class="stringliteral">&quot;DeleteChildrenProtocolControllers&quot;</span>, <span class="keyword">true</span>));
<a name="l00125"></a>00125         in.append(CIMParamValue(<span class="stringliteral">&quot;DeleteUnits&quot;</span>, <span class="keyword">true</span>));
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         evalInvoke(out, c.invokeMethod(ns, ccs.getPath(),
<a name="l00128"></a>00128                                    CIMName(<span class="stringliteral">&quot;DeleteProtocolController&quot;</span>),
<a name="l00129"></a>00129                                    in, out));
<a name="l00130"></a>00130     } <span class="keywordflow">else</span> {
<a name="l00131"></a>00131         <span class="keywordflow">throw</span> Exception(<span class="stringliteral">&quot;No mapping found&quot;</span>);
<a name="l00132"></a>00132     }
<a name="l00133"></a>00133 }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 <span class="keywordtype">void</span> BlockMgmt::printDebug( <span class="keyword">const</span> CIMValue &amp;v )
<a name="l00136"></a>00136 {
<a name="l00137"></a>00137     String id;
<a name="l00138"></a>00138     String <a class="code" href="lsm__datatypes_8cpp.html#a2cc1fcbe95db9f01f0bc16e608508a1d">name</a>;
<a name="l00139"></a>00139     Uint64 <a class="code" href="lsm__datatypes_8cpp.html#a7fa3d3c523affa44498216536c3e89d3">blockSize</a>;
<a name="l00140"></a>00140     Uint64 <a class="code" href="lsm__datatypes_8cpp.html#a5f3b5cf272e877727009e36d834052d0">numberOfBlocks</a>;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     CIMInstance i = c.getInstance(ns, v.toString());
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <a class="code" href="_block_mgmt_8cpp.html#ac9daeba4a9915264cbb407db5dfe039d">getPropValue</a>(i, <span class="stringliteral">&quot;DeviceID&quot;</span>, <span class="keywordtype">id</span>);
<a name="l00145"></a>00145     <a class="code" href="_block_mgmt_8cpp.html#ac9daeba4a9915264cbb407db5dfe039d">getPropValue</a>(i, <span class="stringliteral">&quot;ElementName&quot;</span>, name);
<a name="l00146"></a>00146     <a class="code" href="_block_mgmt_8cpp.html#ac9daeba4a9915264cbb407db5dfe039d">getPropValue</a>(i, <span class="stringliteral">&quot;BlockSize&quot;</span>, blockSize);
<a name="l00147"></a>00147     <a class="code" href="_block_mgmt_8cpp.html#ac9daeba4a9915264cbb407db5dfe039d">getPropValue</a>(i, <span class="stringliteral">&quot;NumberOfBlocks&quot;</span>, numberOfBlocks);
<a name="l00148"></a>00148 
<a name="l00149"></a>00149     std::cout &lt;&lt; <span class="stringliteral">&quot;ID = &quot;</span> &lt;&lt; <span class="keywordtype">id</span> &lt;&lt; <span class="stringliteral">&quot; name = &quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot; blocksize = &quot;</span> &lt;&lt;
<a name="l00150"></a>00150         blockSize &lt;&lt; <span class="stringliteral">&quot; # of blocks = &quot;</span> &lt;&lt; numberOfBlocks &lt;&lt; std::endl;
<a name="l00151"></a>00151 }
<a name="l00152"></a>00152 
<a name="l00153"></a><a class="code" href="class_block_mgmt.html#a23bc9b08d1148bdf4b87e9ab24d329b3">00153</a> <span class="keywordtype">void</span> <a class="code" href="class_block_mgmt.html#a23bc9b08d1148bdf4b87e9ab24d329b3">BlockMgmt::createLun</a>( String storagePoolName, String name, Uint64 size)
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155     Array&lt;CIMParamValue&gt; in;
<a name="l00156"></a>00156     Array&lt;CIMParamValue&gt; <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158     CIMInstance scs = getClassInstance(<span class="stringliteral">&quot;CIM_StorageConfigurationService&quot;</span>);
<a name="l00159"></a>00159     CIMInstance storagePool = getClassInstance(<span class="stringliteral">&quot;CIM_StoragePool&quot;</span>, <span class="stringliteral">&quot;ElementName&quot;</span>,
<a name="l00160"></a>00160                               storagePoolName);
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     std::cout &lt;&lt; <span class="stringliteral">&quot;pool = &quot;</span> &lt;&lt; storagePool.getPath().toString() &lt;&lt; std::endl;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164     in.append(CIMParamValue(<span class="stringliteral">&quot;ElementName&quot;</span>, CIMValue(name)));
<a name="l00165"></a>00165     in.append(CIMParamValue(<span class="stringliteral">&quot;ElementType&quot;</span>, (Uint16)STORAGE_VOLUME));
<a name="l00166"></a>00166     in.append(CIMParamValue(<span class="stringliteral">&quot;InPool&quot;</span>, storagePool.getPath()));
<a name="l00167"></a>00167     in.append(CIMParamValue(<span class="stringliteral">&quot;Size&quot;</span>, CIMValue(size)));
<a name="l00168"></a>00168 
<a name="l00169"></a>00169     Uint32 <a class="code" href="namespacenetapp.html#a14268f4ce59d718e0395d95e88b37e29">result</a> = evalInvoke(out, c.invokeMethod(ns, scs.getPath(),
<a name="l00170"></a>00170                                    CIMName(<span class="stringliteral">&quot;CreateOrModifyElementFromStoragePool&quot;</span>),
<a name="l00171"></a>00171                                    in, out));
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     <span class="keywordflow">if</span>( result == 0 ) {
<a name="l00174"></a>00174         <span class="keywordflow">for</span> (Uint8 i = 0; i &lt; out.size(); i++) {
<a name="l00175"></a>00175             <span class="keywordflow">if</span>( out[i].getParameterName() == <span class="stringliteral">&quot;TheElement&quot;</span> ) {
<a name="l00176"></a>00176                 printDebug(out[i].<a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>());
<a name="l00177"></a>00177             }
<a name="l00178"></a>00178         }
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00182"></a><a class="code" href="class_block_mgmt.html#a330b9eaefefa552f123b878da1c04c1d">00182</a> <span class="keywordtype">void</span> <a class="code" href="class_block_mgmt.html#a330b9eaefefa552f123b878da1c04c1d">BlockMgmt::createInit</a>( String name, String <span class="keywordtype">id</span>, String type)
<a name="l00183"></a>00183 {
<a name="l00184"></a>00184     Array&lt;CIMParamValue&gt; in;
<a name="l00185"></a>00185     Array&lt;CIMParamValue&gt; <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     CIMInstance hardware = getClassInstance(<span class="stringliteral">&quot;CIM_StorageHardwareIDManagementService&quot;</span>);
<a name="l00188"></a>00188     in.append(CIMParamValue(<span class="stringliteral">&quot;ElementName&quot;</span>, String(name)));
<a name="l00189"></a>00189     in.append(CIMParamValue(<span class="stringliteral">&quot;StorageID&quot;</span>, (CIMValue(<span class="keywordtype">id</span>))));
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="keywordflow">if</span>( type == <span class="stringliteral">&quot;WWN&quot;</span> ) {
<a name="l00192"></a>00192         in.append(CIMParamValue(<span class="stringliteral">&quot;IDType&quot;</span>, (Uint16)2));
<a name="l00193"></a>00193     } <span class="keywordflow">else</span> {
<a name="l00194"></a>00194         in.append(CIMParamValue(<span class="stringliteral">&quot;IDType&quot;</span>, (Uint16)5));
<a name="l00195"></a>00195     }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     evalInvoke(out, c.invokeMethod(ns, hardware.getPath(),
<a name="l00198"></a>00198                                    CIMName(<span class="stringliteral">&quot;CreateStorageHardwareID&quot;</span>), in, out));
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a><a class="code" href="class_block_mgmt.html#a111a3a5e45b2e18a901da12a433cb784">00201</a> <span class="keywordtype">void</span> <a class="code" href="class_block_mgmt.html#a111a3a5e45b2e18a901da12a433cb784">BlockMgmt::deleteInit</a>( String <span class="keywordtype">id</span> )
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203     Array&lt;CIMParamValue&gt; in;
<a name="l00204"></a>00204     Array&lt;CIMParamValue&gt; <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     CIMInstance init = getClassInstance(<span class="stringliteral">&quot;CIM_StorageHardwareID&quot;</span>, <span class="stringliteral">&quot;StorageID&quot;</span>, <span class="keywordtype">id</span>);
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     CIMInstance hardware = getClassInstance(<span class="stringliteral">&quot;CIM_StorageHardwareIDManagementService&quot;</span>);
<a name="l00209"></a>00209     in.append(CIMParamValue(<span class="stringliteral">&quot;HardwareID&quot;</span>, init.getPath() ));
<a name="l00210"></a>00210 
<a name="l00211"></a>00211     evalInvoke(out, c.invokeMethod(ns, hardware.getPath(),
<a name="l00212"></a>00212                                    CIMName(<span class="stringliteral">&quot;DeleteStorageHardwareID&quot;</span>), in, out));
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a><a class="code" href="class_block_mgmt.html#ac6c597d3d5f65796902eadb9b03ae4f4">00215</a> <span class="keywordtype">void</span> <a class="code" href="class_block_mgmt.html#ac6c597d3d5f65796902eadb9b03ae4f4">BlockMgmt::createSnapShot</a>( String sourceLun, String destStoragePool,
<a name="l00216"></a>00216                                 String destName)
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218     Array&lt;CIMParamValue&gt; in;
<a name="l00219"></a>00219     Array&lt;CIMParamValue&gt; <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     CIMInstance rs = getClassInstance(<span class="stringliteral">&quot;CIM_ReplicationService&quot;</span>);
<a name="l00222"></a>00222     CIMInstance pool = getClassInstance(<span class="stringliteral">&quot;CIM_StoragePool&quot;</span>, <span class="stringliteral">&quot;ElementName&quot;</span>,
<a name="l00223"></a>00223                                         destStoragePool);
<a name="l00224"></a>00224     CIMInstance lun = getClassInstance(<span class="stringliteral">&quot;CIM_StorageVolume&quot;</span>, <span class="stringliteral">&quot;ElementName&quot;</span>,
<a name="l00225"></a>00225                                        sourceLun);
<a name="l00226"></a>00226 
<a name="l00227"></a>00227     in.append(CIMParamValue(<span class="stringliteral">&quot;ElementName&quot;</span>, CIMValue(destName)));
<a name="l00228"></a>00228     in.append(CIMParamValue(<span class="stringliteral">&quot;SyncType&quot;</span>, Uint16(SNAPSHOT)));
<a name="l00229"></a>00229     in.append(CIMParamValue(<span class="stringliteral">&quot;Mode&quot;</span>, Uint16(ASYNC)));
<a name="l00230"></a>00230     in.append(CIMParamValue(<span class="stringliteral">&quot;SourceElement&quot;</span>, lun.getPath()));
<a name="l00231"></a>00231     in.append(CIMParamValue(<span class="stringliteral">&quot;TargetPool&quot;</span>, pool.getPath()));
<a name="l00232"></a>00232 
<a name="l00233"></a>00233     evalInvoke(out, c.invokeMethod(ns, rs.getPath(),
<a name="l00234"></a>00234                                    CIMName(<span class="stringliteral">&quot;CreateElementReplica&quot;</span>), in, out));
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="class_block_mgmt.html#a348fe130d9aa2dba2f19e92dc2db343e">00237</a> <span class="keywordtype">void</span> <a class="code" href="class_block_mgmt.html#a348fe130d9aa2dba2f19e92dc2db343e">BlockMgmt::resizeLun</a>( String name, Uint64 size)
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239     Array&lt;CIMParamValue&gt; in;
<a name="l00240"></a>00240     Array&lt;CIMParamValue&gt; <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     CIMInstance scs = getClassInstance(<span class="stringliteral">&quot;CIM_StorageConfigurationService&quot;</span>);
<a name="l00243"></a>00243     CIMInstance lun = getClassInstance(<span class="stringliteral">&quot;CIM_StorageVolume&quot;</span>, <span class="stringliteral">&quot;ElementName&quot;</span>,
<a name="l00244"></a>00244                                        name);
<a name="l00245"></a>00245 
<a name="l00246"></a>00246     in.append(CIMParamValue(<span class="stringliteral">&quot;TheElement&quot;</span>, CIMValue(lun.getPath())));
<a name="l00247"></a>00247     in.append(CIMParamValue(<span class="stringliteral">&quot;Size&quot;</span>, CIMValue(size)));
<a name="l00248"></a>00248 
<a name="l00249"></a>00249     evalInvoke(out, c.invokeMethod(ns, scs.getPath(),
<a name="l00250"></a>00250                                    CIMName(<span class="stringliteral">&quot;CreateOrModifyElementFromStoragePool&quot;</span>), in, out));
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00253"></a><a class="code" href="class_block_mgmt.html#a269d58e6c664d224b70bd4d128a7061f">00253</a> <span class="keywordtype">void</span> <a class="code" href="class_block_mgmt.html#a269d58e6c664d224b70bd4d128a7061f">BlockMgmt::deleteLun</a>( String name )
<a name="l00254"></a>00254 {
<a name="l00255"></a>00255     Array&lt;CIMParamValue&gt; in;
<a name="l00256"></a>00256     Array&lt;CIMParamValue&gt; <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258     CIMInstance scs = getClassInstance(<span class="stringliteral">&quot;CIM_StorageConfigurationService&quot;</span>);
<a name="l00259"></a>00259     CIMInstance lun = getClassInstance(<span class="stringliteral">&quot;CIM_StorageVolume&quot;</span>, <span class="stringliteral">&quot;ElementName&quot;</span>, name);
<a name="l00260"></a>00260 
<a name="l00261"></a>00261     in.append(CIMParamValue(<span class="stringliteral">&quot;TheElement&quot;</span>, lun.getPath()));
<a name="l00262"></a>00262     evalInvoke(out, c.invokeMethod(ns,scs.getPath(),
<a name="l00263"></a>00263                                    CIMName(<span class="stringliteral">&quot;ReturnToStoragePool&quot;</span>), in, out));
<a name="l00264"></a>00264 }
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 Uint32 BlockMgmt::evalInvoke(Array&lt;CIMParamValue&gt; &amp;<a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>, CIMValue value,
<a name="l00267"></a>00267                            String jobKey)
<a name="l00268"></a>00268 {
<a name="l00269"></a>00269     Uint32 <a class="code" href="namespacenetapp.html#a14268f4ce59d718e0395d95e88b37e29">result</a> = 0;
<a name="l00270"></a>00270     value.get(result);
<a name="l00271"></a>00271     CIMValue job;
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     <span class="keywordflow">if</span>( result ) {
<a name="l00274"></a>00274         String params;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276         <span class="keywordflow">for</span> (Uint8 i = 0; i &lt; out.size(); i++) {
<a name="l00277"></a>00277             params = params + <span class="stringliteral">&quot; (key:value)(&quot;</span> + out[i].getParameterName() + <span class="stringliteral">&quot;:&quot;</span> +
<a name="l00278"></a>00278                      out[i].getValue().toString() + <span class="stringliteral">&quot;)&quot;</span>;
<a name="l00279"></a>00279 
<a name="l00280"></a>00280             <span class="keywordflow">if</span>( result == INVOKE_ASYNC ) {
<a name="l00281"></a>00281                 <span class="keywordflow">if</span>(out[i].getParameterName() == jobKey) {
<a name="l00282"></a>00282                     job = out[i].getValue();
<a name="l00283"></a>00283                 }
<a name="l00284"></a>00284             }
<a name="l00285"></a>00285         }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287         <span class="keywordflow">if</span>( result == INVOKE_ASYNC ) {
<a name="l00288"></a>00288             std::cout &lt;&lt; <span class="stringliteral">&quot;Params = &quot;</span> &lt;&lt; params;
<a name="l00289"></a>00289             processJob(job);
<a name="l00290"></a>00290         } <span class="keywordflow">else</span> {
<a name="l00291"></a>00291             <span class="keywordflow">throw</span> Exception(value.toString().append(params));
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <span class="keywordflow">return</span> result;
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298 <span class="keywordtype">void</span> BlockMgmt::printVol(<span class="keyword">const</span> CIMValue &amp;job)
<a name="l00299"></a>00299 {
<a name="l00300"></a>00300     CIMInstance j = c.getInstance(ns, job.toString());
<a name="l00301"></a>00301 
<a name="l00302"></a>00302     <span class="comment">/*Array&lt;CIMObject&gt; as = c.associators(ns, j.getPath(), NULL, NULL, &quot;&quot;, false, false, NULL);</span>
<a name="l00303"></a>00303 <span class="comment"></span>
<a name="l00304"></a>00304 <span class="comment">    for( Uint32 i = 0; i &lt; as.size(); ++i ) {</span>
<a name="l00305"></a>00305 <span class="comment"></span>
<a name="l00306"></a>00306 <span class="comment">    } */</span>
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 }
<a name="l00309"></a>00309 
<a name="l00310"></a><a class="code" href="class_block_mgmt.html#a14ea4b669840f0cb32442e511daa259d">00310</a> <span class="keywordtype">void</span> <a class="code" href="class_block_mgmt.html#a14ea4b669840f0cb32442e511daa259d">BlockMgmt::jobStatus</a>(String <span class="keywordtype">id</span>)
<a name="l00311"></a>00311 {
<a name="l00312"></a>00312     Array&lt;Uint16&gt; values;
<a name="l00313"></a>00313     CIMObject <a class="code" href="lsm__datatypes_8cpp.html#acbb41412818e89e6981dd22fbe4126ea">status</a> = c.getInstance(ns, <span class="keywordtype">id</span>);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     status.getProperty(status.findProperty(<span class="stringliteral">&quot;OperationalStatus&quot;</span>)).<a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>().get(values);
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     <span class="keywordflow">if</span>( values.size() ) {
<a name="l00318"></a>00318         std::cout &lt;&lt; <span class="stringliteral">&quot;Operational status: &quot;</span>;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320         <span class="keywordflow">for</span>( Uint32 i = 0; i &lt; values.size() ; ++i ) {
<a name="l00321"></a>00321             std::cout &lt;&lt; values[i] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00322"></a>00322         }
<a name="l00323"></a>00323         std::cout &lt;&lt; std::endl;
<a name="l00324"></a>00324     } <span class="keywordflow">else</span> {
<a name="l00325"></a>00325         std::cout &lt;&lt; <span class="stringliteral">&quot;Operational status is empty!&quot;</span> &lt;&lt; std::endl;
<a name="l00326"></a>00326     }
<a name="l00327"></a>00327 
<a name="l00328"></a>00328     std::cout   &lt;&lt; <span class="stringliteral">&quot;Percent complete= &quot;</span>
<a name="l00329"></a>00329                         &lt;&lt; status.getProperty(status.findProperty(<span class="stringliteral">&quot;PercentComplete&quot;</span>)).<a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>().toString()
<a name="l00330"></a>00330                         &lt;&lt; std::endl;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     std::cout   &lt;&lt; <span class="stringliteral">&quot;Job state= &quot;</span>
<a name="l00333"></a>00333                         &lt;&lt; status.getProperty(status.findProperty(<span class="stringliteral">&quot;JobState&quot;</span>)).<a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>().toString()
<a name="l00334"></a>00334                         &lt;&lt; std::endl;
<a name="l00335"></a>00335 }
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 <span class="keywordtype">bool</span> BlockMgmt::jobCompletedOk(String jobId)
<a name="l00338"></a>00338 {
<a name="l00339"></a>00339     Array&lt;Uint16&gt; values;
<a name="l00340"></a>00340     <span class="keywordtype">bool</span> rc = <span class="keyword">false</span>;
<a name="l00341"></a>00341 
<a name="l00342"></a>00342     CIMObject <a class="code" href="lsm__datatypes_8cpp.html#acbb41412818e89e6981dd22fbe4126ea">status</a> = c.getInstance(ns, jobId);
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     status.getProperty(status.findProperty(<span class="stringliteral">&quot;OperationalStatus&quot;</span>)).
<a name="l00345"></a>00345                         <a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>().get(values);
<a name="l00346"></a>00346 
<a name="l00347"></a>00347     <span class="keywordflow">if</span>( values.size() &gt; 0 ) {
<a name="l00348"></a>00348         <span class="keywordflow">if</span>( values.size() == 1 ) {
<a name="l00349"></a>00349             <span class="comment">//Based on the documentations on page 257 this should only</span>
<a name="l00350"></a>00350             <span class="comment">//occur when the job was stopped.</span>
<a name="l00351"></a>00351             std::cout &lt;&lt; <span class="stringliteral">&quot;Error: Operational status = &quot;</span> &lt;&lt; values[0] &lt;&lt; std::endl;
<a name="l00352"></a>00352         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( values.size() &gt; 1 ) {
<a name="l00353"></a>00353             <span class="keywordflow">if</span>( (values[0] == OK || values[1] == OK) &amp;&amp;
<a name="l00354"></a>00354                 (values[0] == COMPLETE || values[1] == COMPLETE)) {
<a name="l00355"></a>00355                 rc = <span class="keyword">true</span>;
<a name="l00356"></a>00356                 std::cout &lt;&lt; <span class="stringliteral">&quot;Success: Operational status = &quot;</span> &lt;&lt; values[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00357"></a>00357                                 &lt;&lt; values[1] &lt;&lt; std::endl;
<a name="l00358"></a>00358             } <span class="keywordflow">else</span> {
<a name="l00359"></a>00359                 std::cout &lt;&lt; <span class="stringliteral">&quot;Error: Operational status = &quot;</span> &lt;&lt; values[0] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>
<a name="l00360"></a>00360                                 &lt;&lt; values[1] &lt;&lt; std::endl;
<a name="l00361"></a>00361             }
<a name="l00362"></a>00362         }
<a name="l00363"></a>00363     } <span class="keywordflow">else</span> {
<a name="l00364"></a>00364         std::cout &lt;&lt; <span class="stringliteral">&quot;No operational status available!&quot;</span> &lt;&lt; std::endl;
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366     <span class="keywordflow">return</span> rc;
<a name="l00367"></a>00367 }
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 <span class="keywordtype">void</span> BlockMgmt::processJob(CIMValue &amp;job)
<a name="l00370"></a>00370 {
<a name="l00371"></a>00371     std::cout &lt;&lt; std::endl &lt;&lt; <span class="stringliteral">&quot;job started= &quot;</span> &lt;&lt; job.toString() &lt;&lt; std::endl;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     <span class="keywordflow">while</span>( <span class="keyword">true</span> ) {
<a name="l00374"></a>00374         Uint16 jobState;
<a name="l00375"></a>00375         Boolean autodelete = <span class="keyword">false</span>;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377         CIMObject status = c.getInstance(ns, job.toString());
<a name="l00378"></a>00378         status.getProperty(status.findProperty(<span class="stringliteral">&quot;JobState&quot;</span>)).
<a name="l00379"></a>00379                             <a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>().get(jobState);
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         <span class="keywordflow">switch</span>( jobState ) {
<a name="l00382"></a>00382             <span class="keywordflow">case</span>(JS_NEW):
<a name="l00383"></a>00383             <span class="keywordflow">case</span>(JS_STARTING):
<a name="l00384"></a>00384                 <span class="keywordflow">break</span>;
<a name="l00385"></a>00385             <span class="keywordflow">case</span>(JS_RUNNING):
<a name="l00386"></a>00386                 <span class="comment">//Dump percentage</span>
<a name="l00387"></a>00387                  std::cout  &lt;&lt; <span class="stringliteral">&quot;Percent complete= &quot;</span>
<a name="l00388"></a>00388                             &lt;&lt; status.getProperty(
<a name="l00389"></a>00389                                     status.findProperty(<span class="stringliteral">&quot;PercentComplete&quot;</span>)).
<a name="l00390"></a>00390                                     <a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>().toString()
<a name="l00391"></a>00391                             &lt;&lt; std::endl;
<a name="l00392"></a>00392                 <span class="keywordflow">break</span>;
<a name="l00393"></a>00393             <span class="keywordflow">case</span>(JS_COMPLETED):
<a name="l00394"></a>00394                 <span class="comment">//Check operational status.</span>
<a name="l00395"></a>00395                 std::cout &lt;&lt; <span class="stringliteral">&quot;Job is complete!&quot;</span> &lt;&lt; std::endl;
<a name="l00396"></a>00396 
<a name="l00397"></a>00397                 jobCompletedOk(job.toString());
<a name="l00398"></a>00398 
<a name="l00399"></a>00399                 status.getProperty(status.findProperty(<span class="stringliteral">&quot;DeleteOnCompletion&quot;</span>)).
<a name="l00400"></a>00400                                 <a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>().get(autodelete);
<a name="l00401"></a>00401 
<a name="l00402"></a>00402                 <span class="keywordflow">if</span>( !autodelete ) {
<a name="l00403"></a>00403                     <span class="comment">//We are done, delete job instance.</span>
<a name="l00404"></a>00404                     <span class="keywordflow">try</span> {
<a name="l00405"></a>00405                         c.deleteInstance(ns, job.toString());
<a name="l00406"></a>00406                         std::cout &lt;&lt; <span class="stringliteral">&quot;Deleted job!&quot;</span> &lt;&lt; std::endl;
<a name="l00407"></a>00407                     } <span class="keywordflow">catch</span> (Exception &amp;e) {
<a name="l00408"></a>00408                         std::cout   &lt;&lt; <span class="stringliteral">&quot;Warning: error when deleting job! &quot;</span>
<a name="l00409"></a>00409                                     &lt;&lt; e.getMessage() &lt;&lt; std::endl;
<a name="l00410"></a>00410                     }
<a name="l00411"></a>00411                 }
<a name="l00412"></a>00412                 <span class="keywordflow">return</span>;
<a name="l00413"></a>00413             <span class="keywordflow">default</span>:
<a name="l00414"></a>00414                 std::cout &lt;&lt; <span class="stringliteral">&quot;Unexpected job state &quot;</span> &lt;&lt; jobState &lt;&lt; std::endl;
<a name="l00415"></a>00415                 <span class="keywordflow">return</span>;
<a name="l00416"></a>00416                 <span class="keywordflow">break</span>;
<a name="l00417"></a>00417         }
<a name="l00418"></a>00418 
<a name="l00419"></a>00419         sleep(1);
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422     <span class="comment">/*</span>
<a name="l00423"></a>00423 <span class="comment">        status.getProperty(status.findProperty(&quot;OperationalStatus&quot;)).getValue().get(values);</span>
<a name="l00424"></a>00424 <span class="comment">        if( values.size() &gt; 0 ) {</span>
<a name="l00425"></a>00425 <span class="comment">            if( values.size() == 1 ) {</span>
<a name="l00426"></a>00426 <span class="comment">                //Based on the documentations on page 257 this should only</span>
<a name="l00427"></a>00427 <span class="comment">                //occur when the job was stopped.</span>
<a name="l00428"></a>00428 <span class="comment"></span>
<a name="l00429"></a>00429 <span class="comment"></span>
<a name="l00430"></a>00430 <span class="comment">            } else if( values.size() &gt; 1 ) {</span>
<a name="l00431"></a>00431 <span class="comment">                if( (values[0] == OK || values[1] == OK) &amp;&amp;</span>
<a name="l00432"></a>00432 <span class="comment">                    (values[0] == COMPLETE || values[0] == COMPLETE)) {</span>
<a name="l00433"></a>00433 <span class="comment"></span>
<a name="l00434"></a>00434 <span class="comment">                }</span>
<a name="l00435"></a>00435 <span class="comment">            }</span>
<a name="l00436"></a>00436 <span class="comment">        }</span>
<a name="l00437"></a>00437 <span class="comment"></span>
<a name="l00438"></a>00438 <span class="comment">        if( values[0] == OK || values[1] == OK ) {</span>
<a name="l00439"></a>00439 <span class="comment">            //Array of values may have 1 or 2 values according to mof</span>
<a name="l00440"></a>00440 <span class="comment">            if( values.size() == 2 ) {</span>
<a name="l00441"></a>00441 <span class="comment">                Boolean autodelete = false;</span>
<a name="l00442"></a>00442 <span class="comment">                status.getProperty(status.findProperty(&quot;DeleteOnCompletion&quot;)).getValue().get(autodelete);</span>
<a name="l00443"></a>00443 <span class="comment"></span>
<a name="l00444"></a>00444 <span class="comment">                if( !autodelete ) {</span>
<a name="l00445"></a>00445 <span class="comment">                    //We are done, delete job instance.</span>
<a name="l00446"></a>00446 <span class="comment">                    try {</span>
<a name="l00447"></a>00447 <span class="comment">                        c.deleteInstance(ns, job.toString());</span>
<a name="l00448"></a>00448 <span class="comment">                    } catch (Exception &amp;e) {</span>
<a name="l00449"></a>00449 <span class="comment">                        std::cout   &lt;&lt; &quot;Warning: error when deleting job! &quot;</span>
<a name="l00450"></a>00450 <span class="comment">                                    &lt;&lt; e.getMessage() &lt;&lt; std::endl;</span>
<a name="l00451"></a>00451 <span class="comment">                    }</span>
<a name="l00452"></a>00452 <span class="comment">                }</span>
<a name="l00453"></a>00453 <span class="comment"></span>
<a name="l00454"></a>00454 <span class="comment">                if( values[1] == COMPLETE) {</span>
<a name="l00455"></a>00455 <span class="comment">                    std::cout &lt;&lt; &quot;Job complete!&quot; &lt;&lt; std::endl;</span>
<a name="l00456"></a>00456 <span class="comment"></span>
<a name="l00457"></a>00457 <span class="comment"></span>
<a name="l00458"></a>00458 <span class="comment"></span>
<a name="l00459"></a>00459 <span class="comment"></span>
<a name="l00460"></a>00460 <span class="comment">                } else if ( values[1] == STOPPED) {</span>
<a name="l00461"></a>00461 <span class="comment">                    std::cout &lt;&lt; &quot;Job stopped!&quot; &lt;&lt; std::endl;</span>
<a name="l00462"></a>00462 <span class="comment">                } else if( values[1] == ERROR ) {</span>
<a name="l00463"></a>00463 <span class="comment">                    std::cout &lt;&lt; &quot;Job errored!&quot; &lt;&lt; std::endl;</span>
<a name="l00464"></a>00464 <span class="comment">                }</span>
<a name="l00465"></a>00465 <span class="comment">                return;</span>
<a name="l00466"></a>00466 <span class="comment">            }</span>
<a name="l00467"></a>00467 <span class="comment"></span>
<a name="l00468"></a>00468 <span class="comment">            std::cout   &lt;&lt; &quot;Percent complete= &quot;</span>
<a name="l00469"></a>00469 <span class="comment">                        &lt;&lt; status.getProperty(status.findProperty(&quot;PercentComplete&quot;)).getValue().toString()</span>
<a name="l00470"></a>00470 <span class="comment">                        &lt;&lt; std::endl;</span>
<a name="l00471"></a>00471 <span class="comment"></span>
<a name="l00472"></a>00472 <span class="comment">            sleep(1);</span>
<a name="l00473"></a>00473 <span class="comment">        } else {</span>
<a name="l00474"></a>00474 <span class="comment">            throw Exception(&quot;Job &quot; + job.toString() + &quot; encountered an error!&quot;);</span>
<a name="l00475"></a>00475 <span class="comment">        }</span>
<a name="l00476"></a>00476 <span class="comment">    }</span>
<a name="l00477"></a>00477 <span class="comment"></span>
<a name="l00478"></a>00478 <span class="comment">    */</span>
<a name="l00479"></a>00479 }
<a name="l00480"></a>00480 
<a name="l00481"></a><a class="code" href="class_block_mgmt.html#aabf78ccaa7618d2c4e3b76c4ebebe1c4">00481</a> Array&lt;String&gt; <a class="code" href="class_block_mgmt.html#aabf78ccaa7618d2c4e3b76c4ebebe1c4">BlockMgmt::getLuns</a>()
<a name="l00482"></a>00482 {
<a name="l00483"></a>00483     <span class="keywordflow">return</span> instancePropertyNames(<span class="stringliteral">&quot;CIM_StorageVolume&quot;</span>, <span class="stringliteral">&quot;ElementName&quot;</span>);
<a name="l00484"></a>00484 }
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 Array&lt;CIMInstance&gt;  BlockMgmt::storagePools()
<a name="l00487"></a>00487 {
<a name="l00488"></a>00488     <span class="keywordflow">return</span> c.enumerateInstances(ns, CIMName(<span class="stringliteral">&quot;CIM_StoragePool&quot;</span>));
<a name="l00489"></a>00489 }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 Array&lt;String&gt; BlockMgmt::instancePropertyNames( String className, String prop )
<a name="l00492"></a>00492 {
<a name="l00493"></a>00493     Array&lt;String&gt; names;
<a name="l00494"></a>00494 
<a name="l00495"></a>00495     Array&lt;CIMInstance&gt; instances = c.enumerateInstances(ns, CIMName(className));
<a name="l00496"></a>00496 
<a name="l00497"></a>00497     <span class="keywordflow">for</span>(Uint32 i = 0; i &lt; instances.size(); ++i) {
<a name="l00498"></a>00498         Uint32 propIndex = instances[i].findProperty(CIMName(prop));
<a name="l00499"></a>00499         names.append(instances[i].getProperty(propIndex).<a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>().toString());
<a name="l00500"></a>00500     }
<a name="l00501"></a>00501     <span class="keywordflow">return</span> names;
<a name="l00502"></a>00502 }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504 String BlockMgmt::getClassValue(CIMInstance &amp;instance, String propName)
<a name="l00505"></a>00505 {
<a name="l00506"></a>00506     <span class="keywordflow">return</span> instance.getProperty(instance.findProperty(propName)).<a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>().toString();
<a name="l00507"></a>00507 }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509 CIMInstance BlockMgmt::getClassInstance(String className)
<a name="l00510"></a>00510 {
<a name="l00511"></a>00511     Array&lt;CIMInstance&gt; cs = c.enumerateInstances(ns, CIMName(className));
<a name="l00512"></a>00512 
<a name="l00513"></a>00513     <span class="comment">//Could there be more than one?</span>
<a name="l00514"></a>00514     <span class="comment">//If there is, what would be a better thing to do, pick one?</span>
<a name="l00515"></a>00515     <span class="keywordflow">if</span>( cs.size() != 1 ) {
<a name="l00516"></a>00516         String instances;
<a name="l00517"></a>00517 
<a name="l00518"></a>00518         <span class="keywordflow">if</span>( cs.size() == 0 ) {
<a name="l00519"></a>00519             instances = <span class="stringliteral">&quot;none!&quot;</span>;
<a name="l00520"></a>00520         } <span class="keywordflow">else</span> {
<a name="l00521"></a>00521             instances.append(<span class="stringliteral">&quot;\n&quot;</span>);
<a name="l00522"></a>00522             <span class="keywordflow">for</span>(Uint32 i = 0; i &lt; cs.size(); ++i ) {
<a name="l00523"></a>00523                 instances.append( cs[i].getPath().toString() + String(<span class="stringliteral">&quot;\n&quot;</span>));
<a name="l00524"></a>00524             }
<a name="l00525"></a>00525         }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527         <span class="keywordflow">throw</span> Exception(<span class="stringliteral">&quot;Expecting one object instance of &quot;</span> + className +
<a name="l00528"></a>00528                         <span class="stringliteral">&quot;got &quot;</span> + instances);
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530     <span class="keywordflow">return</span> cs[0];
<a name="l00531"></a>00531 }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533 CIMInstance BlockMgmt::getClassInstance(String className, String propertyName,
<a name="l00534"></a>00534                                         String propertyValue )
<a name="l00535"></a>00535 {
<a name="l00536"></a>00536     Array&lt;CIMInstance&gt; cs = c.enumerateInstances(ns, CIMName(className));
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="keywordflow">for</span>( Uint32 i = 0; i &lt; cs.size(); ++i ) {
<a name="l00539"></a>00539         Uint32 index = cs[i].findProperty(propertyName);
<a name="l00540"></a>00540         <span class="keywordflow">if</span> ( cs[i].getProperty(index).<a class="code" href="namespace_l_s_m.html#a6bd876f7713c85459efe595cd6bf6d52">getValue</a>().toString() == propertyValue ) {
<a name="l00541"></a>00541             <span class="keywordflow">return</span> cs[i];
<a name="l00542"></a>00542         }
<a name="l00543"></a>00543     }
<a name="l00544"></a>00544     <span class="keywordflow">throw</span> Exception(<span class="stringliteral">&quot;Instance of class name: &quot;</span> + className + <span class="stringliteral">&quot; property=&quot;</span> +
<a name="l00545"></a>00545                     propertyName + <span class="stringliteral">&quot; value= &quot;</span> + propertyValue + <span class="stringliteral">&quot; not found.&quot;</span>);
<a name="l00546"></a>00546 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 9 Jul 2015 for libStorageMgmt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
