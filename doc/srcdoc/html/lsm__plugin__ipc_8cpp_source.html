<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libStorageMgmt: lsm_plugin_ipc.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>lsm_plugin_ipc.cpp</h1><a href="lsm__plugin__ipc_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2011-2014 Red Hat, Inc.</span>
<a name="l00003"></a>00003 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
<a name="l00004"></a>00004 <span class="comment"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="l00005"></a>00005 <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l00006"></a>00006 <span class="comment"> * version 2.1 of the License, or any later version.</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<a name="l00009"></a>00009 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00010"></a>00010 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00011"></a>00011 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00014"></a>00014 <span class="comment"> * License along with this library; If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * Author: tasleson</span>
<a name="l00017"></a>00017 <span class="comment"> */</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="lsm__plugin__ipc_8hpp.html">lsm_plugin_ipc.hpp</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="lsm__datatypes_8hpp.html">lsm_datatypes.hpp</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="lsm__ipc_8hpp.html">lsm_ipc.hpp</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="lsm__convert_8hpp.html">lsm_convert.hpp</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__systems_8h.html">libstoragemgmt/libstoragemgmt_systems.h</a>&quot;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__blockrange_8h.html">libstoragemgmt/libstoragemgmt_blockrange.h</a>&quot;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__disk_8h.html">libstoragemgmt/libstoragemgmt_disk.h</a>&quot;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__accessgroups_8h.html">libstoragemgmt/libstoragemgmt_accessgroups.h</a>&quot;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__fs_8h.html">libstoragemgmt/libstoragemgmt_fs.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__snapshot_8h.html">libstoragemgmt/libstoragemgmt_snapshot.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__nfsexport_8h.html">libstoragemgmt/libstoragemgmt_nfsexport.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__plug__interface_8h.html">libstoragemgmt/libstoragemgmt_plug_interface.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__targetport_8h.html">libstoragemgmt/libstoragemgmt_targetport.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__volumes_8h.html">libstoragemgmt/libstoragemgmt_volumes.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__pool_8h.html">libstoragemgmt/libstoragemgmt_pool.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;errno.h&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;libxml/uri.h&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="qparams_8h.html">util/qparams.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;syslog.h&gt;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="comment">//Forward decl.</span>
<a name="l00041"></a>00041 <span class="keyword">static</span> <span class="keywordtype">int</span> lsm_plugin_run(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> plug);
<a name="l00042"></a>00042 
<a name="l00048"></a>00048 <span class="keyword">static</span> std::string ss(<span class="keywordtype">char</span> *s)
<a name="l00049"></a>00049 {
<a name="l00050"></a>00050     <span class="keywordflow">if</span> (s) {
<a name="l00051"></a>00051         <span class="keywordflow">return</span> std::string(s);
<a name="l00052"></a>00052     }
<a name="l00053"></a>00053     <span class="keywordflow">return</span> std::string();
<a name="l00054"></a>00054 }
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a54bb886c4d73edf989140098357ea566">00056</a> <span class="keywordtype">void</span> *<a class="code" href="libstoragemgmt__plug__interface_8h.html#a62ac0b009281cd745f9acebfe6506318">lsm_data_type_copy</a>(<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180">lsm_data_type</a> t, <span class="keywordtype">void</span> *item)
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058     <span class="keywordtype">void</span> *rc = NULL;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060     <span class="keywordflow">if</span> (item) {
<a name="l00061"></a>00061         <span class="keywordflow">switch</span> (t) {
<a name="l00062"></a>00062         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180a00866114d2c615acc72d8aa36da2a9d7">LSM_DATA_TYPE_ACCESS_GROUP</a>):
<a name="l00063"></a>00063             rc = <a class="code" href="libstoragemgmt__accessgroups_8h.html#a86d4737c3ce743f1af1aa6fe954faee4">lsm_access_group_record_copy</a>((<a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> *) item);
<a name="l00064"></a>00064             <span class="keywordflow">break</span>;
<a name="l00065"></a>00065         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180a0bcf5191453a671e81c4f5216c2ad3e8">LSM_DATA_TYPE_BLOCK_RANGE</a>):
<a name="l00066"></a>00066             rc = <a class="code" href="libstoragemgmt__blockrange_8h.html#a48671c20af871ab30a641f79fd6d0b80">lsm_block_range_record_copy</a>((<a class="code" href="struct__lsm__block__range.html">lsm_block_range</a> *) item);
<a name="l00067"></a>00067             <span class="keywordflow">break</span>;
<a name="l00068"></a>00068         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180a5716d32435c33216ff623be07bda0654">LSM_DATA_TYPE_FS</a>):
<a name="l00069"></a>00069             rc = <a class="code" href="libstoragemgmt__fs_8h.html#a69c243d898585ada42b7fa6cd06cbf81">lsm_fs_record_copy</a>((<a class="code" href="struct__lsm__fs.html">lsm_fs</a> *) item);
<a name="l00070"></a>00070             <span class="keywordflow">break</span>;
<a name="l00071"></a>00071         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180ae26a656eb9c989d22e60c34d9398a2f3">LSM_DATA_TYPE_NFS_EXPORT</a>):
<a name="l00072"></a>00072             rc = <a class="code" href="libstoragemgmt__nfsexport_8h.html#a5bd8262aed37ad6e7b813501f533aeb8">lsm_nfs_export_record_copy</a>((<a class="code" href="struct__lsm__nfs__export.html">lsm_nfs_export</a> *) item);
<a name="l00073"></a>00073             <span class="keywordflow">break</span>;
<a name="l00074"></a>00074         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180a66d18da7f6aa5fef4f66bece56b6be6d">LSM_DATA_TYPE_POOL</a>):
<a name="l00075"></a>00075             rc = <a class="code" href="libstoragemgmt__pool_8h.html#ad921386c405f5bb13ad92328de5b09a9">lsm_pool_record_copy</a>((<a class="code" href="struct__lsm__pool.html">lsm_pool</a> *) item);
<a name="l00076"></a>00076             <span class="keywordflow">break</span>;
<a name="l00077"></a>00077         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180afb1cb69743a168de559e7579db457081">LSM_DATA_TYPE_SS</a>):
<a name="l00078"></a>00078             rc = <a class="code" href="libstoragemgmt__snapshot_8h.html#a6da33a32efaa370f176c41b2dc0b49c9">lsm_fs_ss_record_copy</a>((<a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> *) item);
<a name="l00079"></a>00079             <span class="keywordflow">break</span>;
<a name="l00080"></a>00080         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180a3b34356a1f70b5b9a8c65da4c7683d8d">LSM_DATA_TYPE_STRING_LIST</a>):
<a name="l00081"></a>00081             rc = <a class="code" href="libstoragemgmt__common_8h.html#a3b5a448f288238ce3f1514c41d110b7f">lsm_string_list_copy</a>((<a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> *) item);
<a name="l00082"></a>00082             <span class="keywordflow">break</span>;
<a name="l00083"></a>00083         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180a3bdc4d63c7afedfdae79c4201e6bf9d7">LSM_DATA_TYPE_SYSTEM</a>):
<a name="l00084"></a>00084             rc = <a class="code" href="libstoragemgmt__systems_8h.html#a2b145e07b892c49727c386a8cd11b945">lsm_system_record_copy</a>((<a class="code" href="struct__lsm__system.html">lsm_system</a> *) item);
<a name="l00085"></a>00085             <span class="keywordflow">break</span>;
<a name="l00086"></a>00086         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180aea08c45e3d63b66700900c08102a14c1">LSM_DATA_TYPE_VOLUME</a>):
<a name="l00087"></a>00087             rc = <a class="code" href="libstoragemgmt__volumes_8h.html#a1a323b3c687c8fc666e2be2b3d0d7b7a">lsm_volume_record_copy</a>((<a class="code" href="struct__lsm__volume.html">lsm_volume</a> *) item);
<a name="l00088"></a>00088             <span class="keywordflow">break</span>;
<a name="l00089"></a>00089         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180a92cbb0202bfa25eb97b74a1d12304bec">LSM_DATA_TYPE_DISK</a>):
<a name="l00090"></a>00090             rc = <a class="code" href="libstoragemgmt__disk_8h.html#a1a98cc1ee79118d1c52f49aee17ef13e">lsm_disk_record_copy</a>((<a class="code" href="struct__lsm__disk.html">lsm_disk</a> *) item);
<a name="l00091"></a>00091             <span class="keywordflow">break</span>;
<a name="l00092"></a>00092         <span class="keywordflow">default</span>:
<a name="l00093"></a>00093             <span class="keywordflow">break</span>;
<a name="l00094"></a>00094         }
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096     <span class="keywordflow">return</span> rc;
<a name="l00097"></a>00097 }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="keyword">static</span> <a class="code" href="class_value.html">Value</a> job_handle(<span class="keyword">const</span> <a class="code" href="class_value.html">Value</a> &amp; val, <span class="keywordtype">char</span> *job)
<a name="l00100"></a>00100 {
<a name="l00101"></a>00101     std::vector &lt; Value &gt; r;
<a name="l00102"></a>00102     r.push_back(<a class="code" href="class_value.html">Value</a>(job));
<a name="l00103"></a>00103     r.push_back(val);
<a name="l00104"></a>00104     <span class="keywordflow">return</span> <a class="code" href="class_value.html">Value</a>(r);
<a name="l00105"></a>00105 }
<a name="l00106"></a>00106 
<a name="l00107"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#aa020112d8ac2093de705c7bfac2cddfa">00107</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#ade9288e3817843531a90d85978678108">lsm_register_plugin_v1</a>(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> plug,
<a name="l00108"></a>00108                            <span class="keywordtype">void</span> *private_data,
<a name="l00109"></a>00109                            <span class="keyword">struct</span> <a class="code" href="structlsm__mgmt__ops__v1.html" title="Callback functions for management operations.">lsm_mgmt_ops_v1</a> *mgm_op,
<a name="l00110"></a>00110                            <span class="keyword">struct</span> <a class="code" href="structlsm__san__ops__v1.html" title="Block array oriented functions (callback functions) NOTE: This structure cannot change...">lsm_san_ops_v1</a> *san_op,
<a name="l00111"></a>00111                            <span class="keyword">struct</span> <a class="code" href="structlsm__fs__ops__v1.html" title="File system oriented functionality NOTE: This structure cannot change as we need...">lsm_fs_ops_v1</a> *fs_op,
<a name="l00112"></a>00112                            <span class="keyword">struct</span> <a class="code" href="structlsm__nas__ops__v1.html" title="NAS system oriented functionality call back functions NOTE: This structure cannot...">lsm_nas_ops_v1</a> *nas_op)
<a name="l00113"></a>00113 {
<a name="l00114"></a>00114     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00115"></a>00115 
<a name="l00116"></a>00116     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#a254f057abf7a742df0592f6645f99293">LSM_IS_PLUGIN</a>(plug)) {
<a name="l00117"></a>00117         plug-&gt;<a class="code" href="struct__lsm__plugin.html#ad517770dac2061381b2008850ff12e6c">private_data</a> = private_data;
<a name="l00118"></a>00118         plug-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a> = mgm_op;
<a name="l00119"></a>00119         plug-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> = san_op;
<a name="l00120"></a>00120         plug-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> = fs_op;
<a name="l00121"></a>00121         plug-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a> = nas_op;
<a name="l00122"></a>00122         rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124     <span class="keywordflow">return</span> rc;
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a01dbe3d73d404c13956f456e038cf4f9">00127</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#ac13f5bfd14cf00890aa738992326b67e">lsm_register_plugin_v1_2</a>(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> plug, <span class="keywordtype">void</span> *private_data,
<a name="l00128"></a>00128                              <span class="keyword">struct</span> <a class="code" href="structlsm__mgmt__ops__v1.html" title="Callback functions for management operations.">lsm_mgmt_ops_v1</a> *mgm_op,
<a name="l00129"></a>00129                              <span class="keyword">struct</span> <a class="code" href="structlsm__san__ops__v1.html" title="Block array oriented functions (callback functions) NOTE: This structure cannot change...">lsm_san_ops_v1</a> *san_op,
<a name="l00130"></a>00130                              <span class="keyword">struct</span> <a class="code" href="structlsm__fs__ops__v1.html" title="File system oriented functionality NOTE: This structure cannot change as we need...">lsm_fs_ops_v1</a> *fs_op,
<a name="l00131"></a>00131                              <span class="keyword">struct</span> <a class="code" href="structlsm__nas__ops__v1.html" title="NAS system oriented functionality call back functions NOTE: This structure cannot...">lsm_nas_ops_v1</a> *nas_op,
<a name="l00132"></a>00132                              <span class="keyword">struct</span> <a class="code" href="structlsm__ops__v1__2.html" title="Functions added in version 1.2 NOTE: This structure will change during the developement...">lsm_ops_v1_2</a> *ops_v1_2)
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__plug__interface_8h.html#ade9288e3817843531a90d85978678108">lsm_register_plugin_v1</a>(plug, private_data, mgm_op, san_op, fs_op,
<a name="l00135"></a>00135                                     nas_op);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137     <span class="keywordflow">if</span> (rc != <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l00138"></a>00138         <span class="keywordflow">return</span> rc;
<a name="l00139"></a>00139     }
<a name="l00140"></a>00140     plug-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a> = ops_v1_2;
<a name="l00141"></a>00141     <span class="keywordflow">return</span> rc;
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#ac311917c5f273ab1b12b9411fc1e5f63">00144</a> <span class="keywordtype">void</span> *<a class="code" href="libstoragemgmt__plug__interface_8h.html#a65d569cd42c1270c7fb199149353adbc">lsm_private_data_get</a>(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> plug)
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a254f057abf7a742df0592f6645f99293">LSM_IS_PLUGIN</a>(plug)) {
<a name="l00147"></a>00147         <span class="keywordflow">return</span> NULL;
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150     <span class="keywordflow">return</span> plug-&gt;<a class="code" href="struct__lsm__plugin.html#ad517770dac2061381b2008850ff12e6c">private_data</a>;
<a name="l00151"></a>00151 }
<a name="l00152"></a>00152 
<a name="l00153"></a>00153 <span class="keyword">static</span> <span class="keywordtype">void</span> lsm_plugin_free(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> <a class="code" href="lsm__datatypes_8cpp.html#a839528ec4ac9ec17126e8e2e1d46e9fe">p</a>, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00154"></a>00154 {
<a name="l00155"></a>00155     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#a254f057abf7a742df0592f6645f99293">LSM_IS_PLUGIN</a>(p)) {
<a name="l00156"></a>00156 
<a name="l00157"></a>00157         <span class="keyword">delete</span>(p-&gt;<a class="code" href="struct__lsm__plugin.html#a41f28900c0b010ae5d9c57f175d325fd">tp</a>);
<a name="l00158"></a>00158         p-&gt;<a class="code" href="struct__lsm__plugin.html#a41f28900c0b010ae5d9c57f175d325fd">tp</a> = NULL;
<a name="l00159"></a>00159 
<a name="l00160"></a>00160         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="struct__lsm__plugin.html#a97863c868f7174918530e383874db77a">unreg</a>) {
<a name="l00161"></a>00161             p-&gt;<a class="code" href="struct__lsm__plugin.html#a97863c868f7174918530e383874db77a">unreg</a>(p, flags);
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         free(p-&gt;<a class="code" href="struct__lsm__plugin.html#a3aad16fd4bea1b9717f232ea75ad6449">desc</a>);
<a name="l00165"></a>00165         p-&gt;<a class="code" href="struct__lsm__plugin.html#a3aad16fd4bea1b9717f232ea75ad6449">desc</a> = NULL;
<a name="l00166"></a>00166 
<a name="l00167"></a>00167         free(p-&gt;<a class="code" href="struct__lsm__plugin.html#a56abfaab87c46691c1ef3ad0df23e864">version</a>);
<a name="l00168"></a>00168         p-&gt;<a class="code" href="struct__lsm__plugin.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> = NULL;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170         <a class="code" href="libstoragemgmt__error_8h.html#a3d6c3302c51402dd037e182fe4c35500">lsm_error_free</a>(p-&gt;<a class="code" href="struct__lsm__plugin.html#a6b19330eec78c8072153b6d65c75e918">error</a>);
<a name="l00171"></a>00171         p-&gt;<a class="code" href="struct__lsm__plugin.html#a6b19330eec78c8072153b6d65c75e918">error</a> = NULL;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173         p-&gt;<a class="code" href="struct__lsm__plugin.html#a57f54349f4fd1cbbb52058812e146af2">magic</a> = <a class="code" href="lsm__datatypes_8hpp.html#a3ad48e262059c1c16d2581aa67af61d7">LSM_DEL_MAGIC</a>(<a class="code" href="lsm__datatypes_8hpp.html#aecd605e0dd72e3788792df7f898947c8">LSM_PLUGIN_MAGIC</a>);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         free(p);
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177 }
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 <span class="keyword">static</span> <a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> lsm_plugin_alloc(<a class="code" href="libstoragemgmt__plug__interface_8h.html#a13b9e5fd597169c4a265950820b69b30">lsm_plugin_register</a> reg,
<a name="l00180"></a>00180                                        <a class="code" href="libstoragemgmt__plug__interface_8h.html#a37286fe2654045b34c34310c5ac87a80">lsm_plugin_unregister</a> unreg,
<a name="l00181"></a>00181                                        <span class="keyword">const</span> <span class="keywordtype">char</span> *desc, <span class="keyword">const</span> <span class="keywordtype">char</span> *version)
<a name="l00182"></a>00182 {
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     <span class="keywordflow">if</span> (!reg || !unreg) {
<a name="l00185"></a>00185         <span class="keywordflow">return</span> NULL;
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> rc = (<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a>) calloc(1, <span class="keyword">sizeof</span>(<a class="code" href="struct__lsm__plugin.html">lsm_plugin</a>));
<a name="l00189"></a>00189     <span class="keywordflow">if</span> (rc) {
<a name="l00190"></a>00190         rc-&gt;<a class="code" href="struct__lsm__plugin.html#a57f54349f4fd1cbbb52058812e146af2">magic</a> = <a class="code" href="lsm__datatypes_8hpp.html#aecd605e0dd72e3788792df7f898947c8">LSM_PLUGIN_MAGIC</a>;
<a name="l00191"></a>00191         rc-&gt;<a class="code" href="struct__lsm__plugin.html#aac81c0d6c668ad849c7eca668be93e42">reg</a> = reg;
<a name="l00192"></a>00192         rc-&gt;<a class="code" href="struct__lsm__plugin.html#a97863c868f7174918530e383874db77a">unreg</a> = unreg;
<a name="l00193"></a>00193         rc-&gt;<a class="code" href="struct__lsm__plugin.html#a3aad16fd4bea1b9717f232ea75ad6449">desc</a> = strdup(desc);
<a name="l00194"></a>00194         rc-&gt;<a class="code" href="struct__lsm__plugin.html#a56abfaab87c46691c1ef3ad0df23e864">version</a> = strdup(version);
<a name="l00195"></a>00195 
<a name="l00196"></a>00196         <span class="keywordflow">if</span> (!rc-&gt;<a class="code" href="struct__lsm__plugin.html#a3aad16fd4bea1b9717f232ea75ad6449">desc</a> || !rc-&gt;<a class="code" href="struct__lsm__plugin.html#a56abfaab87c46691c1ef3ad0df23e864">version</a>) {
<a name="l00197"></a>00197             lsm_plugin_free(rc, <a class="code" href="libstoragemgmt__types_8h.html#a48a0f17f9f725b7d26292674ff26450f">LSM_CLIENT_FLAG_RSVD</a>);
<a name="l00198"></a>00198             rc = NULL;
<a name="l00199"></a>00199         }
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201     <span class="keywordflow">return</span> rc;
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 <span class="keyword">static</span> <span class="keywordtype">void</span> error_send(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <span class="keywordtype">int</span> error_code)
<a name="l00205"></a>00205 {
<a name="l00206"></a>00206     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a254f057abf7a742df0592f6645f99293">LSM_IS_PLUGIN</a>(p)) {
<a name="l00207"></a>00207         <span class="keywordflow">return</span>;
<a name="l00208"></a>00208     }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     <span class="keywordflow">if</span> (p-&gt;<a class="code" href="struct__lsm__plugin.html#a6b19330eec78c8072153b6d65c75e918">error</a>) {
<a name="l00211"></a>00211         <span class="keywordflow">if</span> (p-&gt;<a class="code" href="struct__lsm__plugin.html#a41f28900c0b010ae5d9c57f175d325fd">tp</a>) {
<a name="l00212"></a>00212             p-&gt;<a class="code" href="struct__lsm__plugin.html#a41f28900c0b010ae5d9c57f175d325fd">tp</a>-&gt;<a class="code" href="class_ipc.html#a5ae060754f08e3c14be2961fde55b1ae">errorSend</a>(p-&gt;<a class="code" href="struct__lsm__plugin.html#a6b19330eec78c8072153b6d65c75e918">error</a>-&gt;<a class="code" href="struct__lsm__error.html#aaa933d523c1913f7eb71e00ee3f5059a">code</a>, ss(p-&gt;<a class="code" href="struct__lsm__plugin.html#a6b19330eec78c8072153b6d65c75e918">error</a>-&gt;<a class="code" href="struct__lsm__error.html#a0b2e8c7f76df48129f994ecc46d5c66c">message</a>),
<a name="l00213"></a>00213                              ss(p-&gt;<a class="code" href="struct__lsm__plugin.html#a6b19330eec78c8072153b6d65c75e918">error</a>-&gt;<a class="code" href="struct__lsm__error.html#a9d0f2b98cf19c569f7b3851fbff05504">debug</a>));
<a name="l00214"></a>00214             <a class="code" href="libstoragemgmt__error_8h.html#a3d6c3302c51402dd037e182fe4c35500">lsm_error_free</a>(p-&gt;<a class="code" href="struct__lsm__plugin.html#a6b19330eec78c8072153b6d65c75e918">error</a>);
<a name="l00215"></a>00215             p-&gt;<a class="code" href="struct__lsm__plugin.html#a6b19330eec78c8072153b6d65c75e918">error</a> = NULL;
<a name="l00216"></a>00216         }
<a name="l00217"></a>00217     } <span class="keywordflow">else</span> {
<a name="l00218"></a>00218         p-&gt;<a class="code" href="struct__lsm__plugin.html#a41f28900c0b010ae5d9c57f175d325fd">tp</a>-&gt;<a class="code" href="class_ipc.html#a5ae060754f08e3c14be2961fde55b1ae">errorSend</a>(error_code, <span class="stringliteral">&quot;Plugin didn&apos;t provide error message&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220 }
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="keyword">static</span> <span class="keywordtype">int</span> get_search_params(<a class="code" href="class_value.html">Value</a> &amp; params, <span class="keywordtype">char</span> **k, <span class="keywordtype">char</span> **v)
<a name="l00223"></a>00223 {
<a name="l00224"></a>00224     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00225"></a>00225     <a class="code" href="class_value.html">Value</a> key = params[<span class="stringliteral">&quot;search_key&quot;</span>];
<a name="l00226"></a>00226     <a class="code" href="class_value.html">Value</a> val = params[<span class="stringliteral">&quot;search_value&quot;</span>];
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == key.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00229"></a>00229         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == val.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00230"></a>00230             *k = strdup(key.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>());
<a name="l00231"></a>00231             *v = strdup(val.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>());
<a name="l00232"></a>00232 
<a name="l00233"></a>00233             <span class="keywordflow">if</span> (*k == NULL || *v == NULL) {
<a name="l00234"></a>00234                 free(*k);
<a name="l00235"></a>00235                 *k = NULL;
<a name="l00236"></a>00236                 free(*v);
<a name="l00237"></a>00237                 *v = NULL;
<a name="l00238"></a>00238                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00239"></a>00239             }
<a name="l00240"></a>00240         } <span class="keywordflow">else</span> {
<a name="l00241"></a>00241             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00242"></a>00242         }
<a name="l00243"></a>00243     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> != key.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00244"></a>00244         rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247     <span class="keywordflow">return</span> rc;
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00256"></a>00256 <span class="keyword">static</span> <span class="keywordtype">bool</span> get_num(<span class="keywordtype">char</span> *sn, <span class="keywordtype">int</span> &amp;num)
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258     errno = 0;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260     num = strtol(sn, NULL, 10);
<a name="l00261"></a>00261     <span class="keywordflow">if</span> (!errno) {
<a name="l00262"></a>00262         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00263"></a>00263     }
<a name="l00264"></a>00264     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#af398e313912c1af69ef5512a4b2db641">00267</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#a2b8cdbe677133aaa5c9480a891ca8bec">lsm_plugin_init_v1</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[], <a class="code" href="libstoragemgmt__plug__interface_8h.html#a13b9e5fd597169c4a265950820b69b30">lsm_plugin_register</a> reg,
<a name="l00268"></a>00268                        <a class="code" href="libstoragemgmt__plug__interface_8h.html#a37286fe2654045b34c34310c5ac87a80">lsm_plugin_unregister</a> unreg,
<a name="l00269"></a>00269                        <span class="keyword">const</span> <span class="keywordtype">char</span> *desc, <span class="keyword">const</span> <span class="keywordtype">char</span> *version)
<a name="l00270"></a>00270 {
<a name="l00271"></a>00271     <span class="keywordtype">int</span> rc = 1;
<a name="l00272"></a>00272     <a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> plug = NULL;
<a name="l00273"></a>00273 
<a name="l00274"></a>00274     <span class="keywordflow">if</span> (NULL == desc || NULL == version) {
<a name="l00275"></a>00275         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278     <span class="keywordtype">int</span> sd = 0;
<a name="l00279"></a>00279     <span class="keywordflow">if</span> (argc == 2 &amp;&amp; get_num(argv[1], sd)) {
<a name="l00280"></a>00280         plug = lsm_plugin_alloc(reg, unreg, desc, version);
<a name="l00281"></a>00281         <span class="keywordflow">if</span> (plug) {
<a name="l00282"></a>00282             plug-&gt;<a class="code" href="struct__lsm__plugin.html#a41f28900c0b010ae5d9c57f175d325fd">tp</a> = <span class="keyword">new</span> <a class="code" href="class_ipc.html">Ipc</a>(sd);
<a name="l00283"></a>00283             <span class="keywordflow">if</span> (plug-&gt;<a class="code" href="struct__lsm__plugin.html#a41f28900c0b010ae5d9c57f175d325fd">tp</a>) {
<a name="l00284"></a>00284                 rc = lsm_plugin_run(plug);
<a name="l00285"></a>00285             } <span class="keywordflow">else</span> {
<a name="l00286"></a>00286                 lsm_plugin_free(plug, <a class="code" href="libstoragemgmt__types_8h.html#a48a0f17f9f725b7d26292674ff26450f">LSM_CLIENT_FLAG_RSVD</a>);
<a name="l00287"></a>00287                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00288"></a>00288             }
<a name="l00289"></a>00289         } <span class="keywordflow">else</span> {
<a name="l00290"></a>00290             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292     } <span class="keywordflow">else</span> {
<a name="l00293"></a>00293         <span class="comment">//Process command line arguments or display help text.</span>
<a name="l00294"></a>00294         rc = 2;
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="keywordflow">return</span> rc;
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00300"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#aa533fc6b4c47aa32b410ad6394e3103a">00300</a> <span class="keyword">typedef</span> int (*<a class="code" href="lsm__plugin__ipc_8cpp.html#aa533fc6b4c47aa32b410ad6394e3103a">handler</a>) (<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_unregister(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00303"></a>00303 {
<a name="l00304"></a>00304     <span class="comment">/* This is handled in the event loop */</span>
<a name="l00305"></a>00305     <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00306"></a>00306 }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_register(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00311"></a>00311     std::string uri_string;
<a name="l00312"></a>00312     std::string <a class="code" href="namespacenetapp.html#acef45431d77c887a9243c5481d0918c8">password</a>;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#aac81c0d6c668ad849c7eca668be93e42">reg</a>) {
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <a class="code" href="class_value.html">Value</a> uri_v = params[<span class="stringliteral">&quot;uri&quot;</span>];
<a name="l00317"></a>00317         <a class="code" href="class_value.html">Value</a> passwd_v = params[<span class="stringliteral">&quot;password&quot;</span>];
<a name="l00318"></a>00318         <a class="code" href="class_value.html">Value</a> tmo_v = params[<span class="stringliteral">&quot;timeout&quot;</span>];
<a name="l00319"></a>00319 
<a name="l00320"></a>00320         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == uri_v.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l00321"></a>00321             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == passwd_v.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l00322"></a>00322              <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == passwd_v.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l00323"></a>00323             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == tmo_v.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00324"></a>00324             <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags = <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params);
<a name="l00325"></a>00325 
<a name="l00326"></a>00326             uri_string = uri_v.<a class="code" href="class_value.html#a680be1c3db1144149b5177a48dd76bdb">asString</a>();
<a name="l00327"></a>00327 
<a name="l00328"></a>00328             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == params[<span class="stringliteral">&quot;password&quot;</span>].valueType()) {
<a name="l00329"></a>00329                 password = params[<span class="stringliteral">&quot;password&quot;</span>].<a class="code" href="class_value.html#a680be1c3db1144149b5177a48dd76bdb">asString</a>();
<a name="l00330"></a>00330             }
<a name="l00331"></a>00331             <span class="comment">//Let the plug-in initialize itself.</span>
<a name="l00332"></a>00332             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#aac81c0d6c668ad849c7eca668be93e42">reg</a>(p, uri_string.c_str(), password.c_str(),
<a name="l00333"></a>00333                         tmo_v.<a class="code" href="class_value.html#a0da01b4c189ff90cfd35a78ddca99e40">asUint32_t</a>(), flags);
<a name="l00334"></a>00334         } <span class="keywordflow">else</span> {
<a name="l00335"></a>00335             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00336"></a>00336         }
<a name="l00337"></a>00337     } <span class="keywordflow">else</span> {
<a name="l00338"></a>00338         rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340     <span class="keywordflow">return</span> rc;
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a>00343 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_set_time_out(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00344"></a>00344                                <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00345"></a>00345 {
<a name="l00346"></a>00346     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#a82a0ae4a155052d7366f59624eef6b23">tmo_set</a>) {
<a name="l00347"></a>00347         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == params[<span class="stringliteral">&quot;ms&quot;</span>].valueType() &amp;&amp;
<a name="l00348"></a>00348             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00349"></a>00349             <span class="keywordflow">return</span> p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#a82a0ae4a155052d7366f59624eef6b23">tmo_set</a>(p, params[<span class="stringliteral">&quot;ms&quot;</span>].asUint32_t(),
<a name="l00350"></a>00350                                         <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00351"></a>00351         } <span class="keywordflow">else</span> {
<a name="l00352"></a>00352             <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00353"></a>00353         }
<a name="l00354"></a>00354     }
<a name="l00355"></a>00355     <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_get_time_out(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00359"></a>00359                                <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00360"></a>00360 {
<a name="l00361"></a>00361     uint32_t tmo = 0;
<a name="l00362"></a>00362     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00363"></a>00363 
<a name="l00364"></a>00364     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#a0e10ce0e274dd2ed0dc95893f286a161">tmo_get</a>) {
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00367"></a>00367             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#a0e10ce0e274dd2ed0dc95893f286a161">tmo_get</a>(p, &amp;tmo, <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00368"></a>00368             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00369"></a>00369                 response = <a class="code" href="class_value.html">Value</a>(tmo);
<a name="l00370"></a>00370             }
<a name="l00371"></a>00371         } <span class="keywordflow">else</span> {
<a name="l00372"></a>00372             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00373"></a>00373         }
<a name="l00374"></a>00374     }
<a name="l00375"></a>00375     <span class="keywordflow">return</span> rc;
<a name="l00376"></a>00376 }
<a name="l00377"></a>00377 
<a name="l00378"></a>00378 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_job_status(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00379"></a>00379 {
<a name="l00380"></a>00380     std::string job_id;
<a name="l00381"></a>00381     <a class="code" href="libstoragemgmt__types_8h.html#aaf3b5727fec5929181c7bd87214c0b53">lsm_job_status</a> <a class="code" href="lsm__datatypes_8cpp.html#acbb41412818e89e6981dd22fbe4126ea">status</a>;
<a name="l00382"></a>00382     uint8_t percent;
<a name="l00383"></a>00383     <a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180">lsm_data_type</a> t = <a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180a764017fa41fb1d8b9e5cdb9429f69f48">LSM_DATA_TYPE_UNKNOWN</a>;
<a name="l00384"></a>00384     <span class="keywordtype">void</span> *value = NULL;
<a name="l00385"></a>00385     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#acf12487003d3c0b3ef4cfa4917f958ce">job_status</a>) {
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> != params[<span class="stringliteral">&quot;job_id&quot;</span>].valueType() &amp;&amp;
<a name="l00390"></a>00390             !<a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00391"></a>00391             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00392"></a>00392         } <span class="keywordflow">else</span> {
<a name="l00393"></a>00393 
<a name="l00394"></a>00394             job_id = params[<span class="stringliteral">&quot;job_id&quot;</span>].<a class="code" href="class_value.html#a680be1c3db1144149b5177a48dd76bdb">asString</a>();
<a name="l00395"></a>00395 
<a name="l00396"></a>00396             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#acf12487003d3c0b3ef4cfa4917f958ce">job_status</a>(p, job_id.c_str(), &amp;status,
<a name="l00397"></a>00397                                          &amp;percent, &amp;t, &amp;value,
<a name="l00398"></a>00398                                          <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00399"></a>00399 
<a name="l00400"></a>00400             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00401"></a>00401                 std::vector &lt; Value &gt; <a class="code" href="namespacenetapp.html#a14268f4ce59d718e0395d95e88b37e29">result</a>;
<a name="l00402"></a>00402 
<a name="l00403"></a>00403                 result.push_back(<a class="code" href="class_value.html">Value</a>((int32_t) status));
<a name="l00404"></a>00404                 result.push_back(<a class="code" href="class_value.html">Value</a>(percent));
<a name="l00405"></a>00405 
<a name="l00406"></a>00406                 <span class="keywordflow">if</span> (NULL == value) {
<a name="l00407"></a>00407                     result.push_back(<a class="code" href="class_value.html">Value</a>());
<a name="l00408"></a>00408                 } <span class="keywordflow">else</span> {
<a name="l00409"></a>00409                     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180aea08c45e3d63b66700900c08102a14c1">LSM_DATA_TYPE_VOLUME</a> == t &amp;&amp;
<a name="l00410"></a>00410                         <a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>((<a class="code" href="struct__lsm__volume.html">lsm_volume</a> *) value)) {
<a name="l00411"></a>00411                         result.push_back(<a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>((<a class="code" href="struct__lsm__volume.html">lsm_volume</a> *) value));
<a name="l00412"></a>00412                         <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>((<a class="code" href="struct__lsm__volume.html">lsm_volume</a> *) value);
<a name="l00413"></a>00413                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180a5716d32435c33216ff623be07bda0654">LSM_DATA_TYPE_FS</a> == t &amp;&amp;
<a name="l00414"></a>00414                                <a class="code" href="lsm__datatypes_8hpp.html#ac6c84aca55b5121f0771751d73195d34">LSM_IS_FS</a>((<a class="code" href="struct__lsm__fs.html">lsm_fs</a> *) value)) {
<a name="l00415"></a>00415                         result.push_back(<a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>((<a class="code" href="struct__lsm__fs.html">lsm_fs</a> *) value));
<a name="l00416"></a>00416                         <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>((<a class="code" href="struct__lsm__fs.html">lsm_fs</a> *) value);
<a name="l00417"></a>00417                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180afb1cb69743a168de559e7579db457081">LSM_DATA_TYPE_SS</a> == t &amp;&amp;
<a name="l00418"></a>00418                                <a class="code" href="lsm__datatypes_8hpp.html#a37dae4d4d2db3247d87103986edcff3c">LSM_IS_SS</a>((<a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> *) value)) {
<a name="l00419"></a>00419                         result.push_back(<a class="code" href="lsm__convert_8cpp.html#ac8379996cc9809a020beb41156e400e0">ss_to_value</a>((<a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> *) value));
<a name="l00420"></a>00420                         <a class="code" href="libstoragemgmt__snapshot_8h.html#a1bb48837b2b2c5f1754d81f88f7fe50b">lsm_fs_ss_record_free</a>((<a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> *) value);
<a name="l00421"></a>00421                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__plug__interface_8h.html#a9d3ae67238efab2a7ad2bb056faf5180a66d18da7f6aa5fef4f66bece56b6be6d">LSM_DATA_TYPE_POOL</a> == t &amp;&amp;
<a name="l00422"></a>00422                                <a class="code" href="lsm__datatypes_8hpp.html#a6c1a7b0350eee43615b3a0c58cac3c77">LSM_IS_POOL</a>((<a class="code" href="struct__lsm__pool.html">lsm_pool</a> *) value)) {
<a name="l00423"></a>00423                         result.push_back(<a class="code" href="lsm__convert_8cpp.html#af80b3591fe77244b1ed101e3d01af195">pool_to_value</a>((<a class="code" href="struct__lsm__pool.html">lsm_pool</a> *) value));
<a name="l00424"></a>00424                         <a class="code" href="libstoragemgmt__pool_8h.html#a44d50c6c387a0269fc494e94a831064b">lsm_pool_record_free</a>((<a class="code" href="struct__lsm__pool.html">lsm_pool</a> *) value);
<a name="l00425"></a>00425                     } <span class="keywordflow">else</span> {
<a name="l00426"></a>00426                         rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>;
<a name="l00427"></a>00427                     }
<a name="l00428"></a>00428                 }
<a name="l00429"></a>00429                 response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l00430"></a>00430             }
<a name="l00431"></a>00431         }
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433     <span class="keywordflow">return</span> rc;
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_plugin_info(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00437"></a>00437                               <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00438"></a>00438 {
<a name="l00439"></a>00439     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00440"></a>00440     <span class="keywordflow">if</span> (p) {
<a name="l00441"></a>00441         std::vector &lt; Value &gt; result;
<a name="l00442"></a>00442         result.push_back(<a class="code" href="class_value.html">Value</a>(p-&gt;<a class="code" href="struct__lsm__plugin.html#a3aad16fd4bea1b9717f232ea75ad6449">desc</a>));
<a name="l00443"></a>00443         result.push_back(<a class="code" href="class_value.html">Value</a>(p-&gt;<a class="code" href="struct__lsm__plugin.html#a56abfaab87c46691c1ef3ad0df23e864">version</a>));
<a name="l00444"></a>00444         response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l00445"></a>00445         rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00446"></a>00446     }
<a name="l00447"></a>00447     <span class="keywordflow">return</span> rc;
<a name="l00448"></a>00448 }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_job_free(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00451"></a>00451 {
<a name="l00452"></a>00452     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00453"></a>00453     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#a4c53749afc2b64611150798fa298ab5c">job_free</a>) {
<a name="l00454"></a>00454         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == params[<span class="stringliteral">&quot;job_id&quot;</span>].valueType() &amp;&amp;
<a name="l00455"></a>00455             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00456"></a>00456             std::string job_num = params[<span class="stringliteral">&quot;job_id&quot;</span>].<a class="code" href="class_value.html#a680be1c3db1144149b5177a48dd76bdb">asString</a>();
<a name="l00457"></a>00457             <span class="keywordtype">char</span> *j = (<span class="keywordtype">char</span> *) job_num.c_str();
<a name="l00458"></a>00458             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#a4c53749afc2b64611150798fa298ab5c">job_free</a>(p, j, <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00459"></a>00459         } <span class="keywordflow">else</span> {
<a name="l00460"></a>00460             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00461"></a>00461         }
<a name="l00462"></a>00462     }
<a name="l00463"></a>00463     <span class="keywordflow">return</span> rc;
<a name="l00464"></a>00464 }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_system_list(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00467"></a>00467                               <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00468"></a>00468 {
<a name="l00469"></a>00469     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#a5e96ebc2d6689bd0284b737442ef5dbf">system_list</a>) {
<a name="l00472"></a>00472         <a class="code" href="struct__lsm__system.html">lsm_system</a> **systems;
<a name="l00473"></a>00473         uint32_t count = 0;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475         <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00476"></a>00476 
<a name="l00477"></a>00477             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#a5e96ebc2d6689bd0284b737442ef5dbf">system_list</a>(p, &amp;systems, &amp;count,
<a name="l00478"></a>00478                                           <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00479"></a>00479             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00480"></a>00480                 std::vector &lt; Value &gt; result;
<a name="l00481"></a>00481                 result.reserve(count);
<a name="l00482"></a>00482 
<a name="l00483"></a>00483                 <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {
<a name="l00484"></a>00484                     result.push_back(<a class="code" href="lsm__convert_8cpp.html#a64192028f7e1cd9ba79969062d17d3ea">system_to_value</a>(systems[i]));
<a name="l00485"></a>00485                 }
<a name="l00486"></a>00486 
<a name="l00487"></a>00487                 <a class="code" href="libstoragemgmt__systems_8h.html#a2786ad1aed30783303c15003c18f3c89">lsm_system_record_array_free</a>(systems, count);
<a name="l00488"></a>00488                 systems = NULL;
<a name="l00489"></a>00489                 response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l00490"></a>00490             }
<a name="l00491"></a>00491         } <span class="keywordflow">else</span> {
<a name="l00492"></a>00492             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00493"></a>00493         }
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495     <span class="keywordflow">return</span> rc;
<a name="l00496"></a>00496 }
<a name="l00497"></a>00497 
<a name="l00498"></a>00498 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_pools(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00501"></a>00501     <span class="keywordtype">char</span> *key = NULL;
<a name="l00502"></a>00502     <span class="keywordtype">char</span> *val = NULL;
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#adcebeed3977715198f28580e2ddc675e">pool_list</a>) {
<a name="l00505"></a>00505         <a class="code" href="struct__lsm__pool.html">lsm_pool</a> **pools = NULL;
<a name="l00506"></a>00506         uint32_t count = 0;
<a name="l00507"></a>00507 
<a name="l00508"></a>00508         <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params) &amp;&amp;
<a name="l00509"></a>00509             ((rc = get_search_params(params, &amp;key, &amp;val)) == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>)) {
<a name="l00510"></a>00510             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#adcebeed3977715198f28580e2ddc675e">pool_list</a>(p, key, val, &amp;pools, &amp;count,
<a name="l00511"></a>00511                                         <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00512"></a>00512             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00513"></a>00513                 std::vector &lt; Value &gt; result;
<a name="l00514"></a>00514                 result.reserve(count);
<a name="l00515"></a>00515 
<a name="l00516"></a>00516                 <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {
<a name="l00517"></a>00517                     result.push_back(<a class="code" href="lsm__convert_8cpp.html#af80b3591fe77244b1ed101e3d01af195">pool_to_value</a>(pools[i]));
<a name="l00518"></a>00518                 }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520                 <a class="code" href="libstoragemgmt__pool_8h.html#a62fb44ace12507bcff9786d4bf94ea6d">lsm_pool_record_array_free</a>(pools, count);
<a name="l00521"></a>00521                 pools = NULL;
<a name="l00522"></a>00522                 response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l00523"></a>00523             }
<a name="l00524"></a>00524             free(key);
<a name="l00525"></a>00525             free(val);
<a name="l00526"></a>00526         } <span class="keywordflow">else</span> {
<a name="l00527"></a>00527             <span class="keywordflow">if</span> (rc == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>) {
<a name="l00528"></a>00528                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00529"></a>00529             }
<a name="l00530"></a>00530         }
<a name="l00531"></a>00531     }
<a name="l00532"></a>00532     <span class="keywordflow">return</span> rc;
<a name="l00533"></a>00533 }
<a name="l00534"></a>00534 
<a name="l00535"></a>00535 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_target_ports(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00536"></a>00536                                <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00537"></a>00537 {
<a name="l00538"></a>00538     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00539"></a>00539     <span class="keywordtype">char</span> *key = NULL;
<a name="l00540"></a>00540     <span class="keywordtype">char</span> *val = NULL;
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a6692a90c16754a699cf1678c0721e3da">target_port_list</a>) {
<a name="l00543"></a>00543         lsm_target_port **target_ports = NULL;
<a name="l00544"></a>00544         uint32_t count = 0;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546         <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params) &amp;&amp;
<a name="l00547"></a>00547             ((rc = get_search_params(params, &amp;key, &amp;val)) == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>)) {
<a name="l00548"></a>00548             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a6692a90c16754a699cf1678c0721e3da">target_port_list</a>(p, key, val, &amp;target_ports,
<a name="l00549"></a>00549                                               &amp;count,
<a name="l00550"></a>00550                                               <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00551"></a>00551             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00552"></a>00552                 std::vector &lt; Value &gt; result;
<a name="l00553"></a>00553                 result.reserve(count);
<a name="l00554"></a>00554 
<a name="l00555"></a>00555                 <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {
<a name="l00556"></a>00556                     result.push_back(<a class="code" href="lsm__convert_8cpp.html#acd3168d0063036adb4d348a83fdf91ae">target_port_to_value</a>(target_ports[i]));
<a name="l00557"></a>00557                 }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559                 <a class="code" href="libstoragemgmt__targetport_8h.html#a01ae45fe7fa4a104af8278daf36b605a">lsm_target_port_record_array_free</a>(target_ports, count);
<a name="l00560"></a>00560                 target_ports = NULL;
<a name="l00561"></a>00561                 response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l00562"></a>00562             }
<a name="l00563"></a>00563             free(key);
<a name="l00564"></a>00564             free(val);
<a name="l00565"></a>00565         } <span class="keywordflow">else</span> {
<a name="l00566"></a>00566             <span class="keywordflow">if</span> (rc == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>) {
<a name="l00567"></a>00567                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00568"></a>00568             }
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571     <span class="keywordflow">return</span> rc;
<a name="l00572"></a>00572 }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 <span class="keyword">static</span> <span class="keywordtype">int</span> capabilities(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00575"></a>00575 {
<a name="l00576"></a>00576     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00577"></a>00577 
<a name="l00578"></a>00578     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#ae65e5c99e873863398c991924e86ddb1">capablities</a>) {
<a name="l00579"></a>00579         <a class="code" href="struct__lsm__storage__capabilities.html">lsm_storage_capabilities</a> *c = NULL;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581         <a class="code" href="class_value.html">Value</a> v_s = params[<span class="stringliteral">&quot;system&quot;</span>];
<a name="l00582"></a>00582 
<a name="l00583"></a>00583         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a53f5d3ea6301a0d96925730bb5837b03">IS_CLASS_SYSTEM</a>(v_s) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00584"></a>00584             <a class="code" href="struct__lsm__system.html">lsm_system</a> *sys = <a class="code" href="lsm__convert_8cpp.html#a49198461198770e8dbd90cf6b950c121">value_to_system</a>(v_s);
<a name="l00585"></a>00585 
<a name="l00586"></a>00586             <span class="keywordflow">if</span> (sys) {
<a name="l00587"></a>00587                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#afdf751314cc7227901dacfeb7ad90606">mgmt_ops</a>-&gt;<a class="code" href="structlsm__mgmt__ops__v1.html#ae65e5c99e873863398c991924e86ddb1">capablities</a>(p, sys, &amp;c,
<a name="l00588"></a>00588                                               <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00589"></a>00589                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00590"></a>00590                     response = <a class="code" href="lsm__convert_8cpp.html#ad2a19637be28627243da17ac6f4b5343">capabilities_to_value</a>(c);
<a name="l00591"></a>00591                     <a class="code" href="libstoragemgmt__capabilities_8h.html#a821ada9a21d74838506d9d657be9cf7a">lsm_capability_record_free</a>(c);
<a name="l00592"></a>00592                     c = NULL;
<a name="l00593"></a>00593                 }
<a name="l00594"></a>00594                 <a class="code" href="libstoragemgmt__systems_8h.html#ab3ab47a044dec61344929ff9f27f9dfa">lsm_system_record_free</a>(sys);
<a name="l00595"></a>00595             } <span class="keywordflow">else</span> {
<a name="l00596"></a>00596                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00597"></a>00597             }
<a name="l00598"></a>00598         } <span class="keywordflow">else</span> {
<a name="l00599"></a>00599             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00600"></a>00600         }
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602     <span class="keywordflow">return</span> rc;
<a name="l00603"></a>00603 }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605 <span class="keyword">static</span> <span class="keywordtype">void</span> get_volumes(<span class="keywordtype">int</span> rc, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> ** vols, uint32_t count,
<a name="l00606"></a>00606                         <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00607"></a>00607 {
<a name="l00608"></a>00608     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00609"></a>00609         std::vector &lt; Value &gt; result;
<a name="l00610"></a>00610         result.reserve(count);
<a name="l00611"></a>00611 
<a name="l00612"></a>00612         <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {
<a name="l00613"></a>00613             result.push_back(<a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(vols[i]));
<a name="l00614"></a>00614         }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616         <a class="code" href="libstoragemgmt__volumes_8h.html#a5e6b658933de208b14ba9a8121ba7e0c">lsm_volume_record_array_free</a>(vols, count);
<a name="l00617"></a>00617         vols = NULL;
<a name="l00618"></a>00618         response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l00619"></a>00619     }
<a name="l00620"></a>00620 }
<a name="l00621"></a>00621 
<a name="l00622"></a>00622 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volumes(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00623"></a>00623 {
<a name="l00624"></a>00624     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00625"></a>00625     <span class="keywordtype">char</span> *key = NULL;
<a name="l00626"></a>00626     <span class="keywordtype">char</span> *val = NULL;
<a name="l00627"></a>00627 
<a name="l00628"></a>00628 
<a name="l00629"></a>00629     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#aa3ab43092439220eb7f99ab7f4815690">vol_get</a>) {
<a name="l00630"></a>00630         <a class="code" href="struct__lsm__volume.html">lsm_volume</a> **vols = NULL;
<a name="l00631"></a>00631         uint32_t count = 0;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633         <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params) &amp;&amp;
<a name="l00634"></a>00634             (rc = get_search_params(params, &amp;key, &amp;val)) == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l00635"></a>00635             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#aa3ab43092439220eb7f99ab7f4815690">vol_get</a>(p, key, val, &amp;vols, &amp;count,
<a name="l00636"></a>00636                                      <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00637"></a>00637 
<a name="l00638"></a>00638             get_volumes(rc, vols, count, response);
<a name="l00639"></a>00639             free(key);
<a name="l00640"></a>00640             free(val);
<a name="l00641"></a>00641         } <span class="keywordflow">else</span> {
<a name="l00642"></a>00642             <span class="keywordflow">if</span> (rc == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>) {
<a name="l00643"></a>00643                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00644"></a>00644             }
<a name="l00645"></a>00645         }
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647     <span class="keywordflow">return</span> rc;
<a name="l00648"></a>00648 }
<a name="l00649"></a>00649 
<a name="l00650"></a>00650 <span class="keyword">static</span> <span class="keywordtype">void</span> get_disks(<span class="keywordtype">int</span> rc, <a class="code" href="struct__lsm__disk.html">lsm_disk</a> ** disks, uint32_t count,
<a name="l00651"></a>00651                       <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00652"></a>00652 {
<a name="l00653"></a>00653     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00654"></a>00654         std::vector &lt; Value &gt; result;
<a name="l00655"></a>00655         result.reserve(count);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657         <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {
<a name="l00658"></a>00658             result.push_back(<a class="code" href="lsm__convert_8cpp.html#a1e5e136b7a224a1be8f10e31ab8d9656">disk_to_value</a>(disks[i]));
<a name="l00659"></a>00659         }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661         <a class="code" href="libstoragemgmt__disk_8h.html#a1d047a3ddb2981c3994c48a793d25084">lsm_disk_record_array_free</a>(disks, count);
<a name="l00662"></a>00662         disks = NULL;
<a name="l00663"></a>00663         response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665 }
<a name="l00666"></a>00666 
<a name="l00667"></a>00667 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_disks(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00668"></a>00668 {
<a name="l00669"></a>00669     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00670"></a>00670     <span class="keywordtype">char</span> *key = NULL;
<a name="l00671"></a>00671     <span class="keywordtype">char</span> *val = NULL;
<a name="l00672"></a>00672 
<a name="l00673"></a>00673     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a76cb370e2ff7b22bb72f7305bcc43c75">disk_get</a>) {
<a name="l00674"></a>00674         <a class="code" href="struct__lsm__disk.html">lsm_disk</a> **disks = NULL;
<a name="l00675"></a>00675         uint32_t count = 0;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677         <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params) &amp;&amp;
<a name="l00678"></a>00678             (rc = get_search_params(params, &amp;key, &amp;val)) == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l00679"></a>00679             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a76cb370e2ff7b22bb72f7305bcc43c75">disk_get</a>(p, key, val, &amp;disks, &amp;count,
<a name="l00680"></a>00680                                       <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00681"></a>00681             get_disks(rc, disks, count, response);
<a name="l00682"></a>00682             free(key);
<a name="l00683"></a>00683             free(val);
<a name="l00684"></a>00684         } <span class="keywordflow">else</span> {
<a name="l00685"></a>00685             <span class="keywordflow">if</span> (rc == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>) {
<a name="l00686"></a>00686                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00687"></a>00687             }
<a name="l00688"></a>00688         }
<a name="l00689"></a>00689     }
<a name="l00690"></a>00690     <span class="keywordflow">return</span> rc;
<a name="l00691"></a>00691 }
<a name="l00692"></a>00692 
<a name="l00693"></a>00693 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volume_create(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00694"></a>00694                                 <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00695"></a>00695 {
<a name="l00696"></a>00696     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00697"></a>00697     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a6b48dba34395dcaa2fa5cbb5d446e8ed">vol_create</a>) {
<a name="l00698"></a>00698 
<a name="l00699"></a>00699         <a class="code" href="class_value.html">Value</a> v_p = params[<span class="stringliteral">&quot;pool&quot;</span>];
<a name="l00700"></a>00700         <a class="code" href="class_value.html">Value</a> v_name = params[<span class="stringliteral">&quot;volume_name&quot;</span>];
<a name="l00701"></a>00701         <a class="code" href="class_value.html">Value</a> v_size = params[<span class="stringliteral">&quot;size_bytes&quot;</span>];
<a name="l00702"></a>00702         <a class="code" href="class_value.html">Value</a> v_prov = params[<span class="stringliteral">&quot;provisioning&quot;</span>];
<a name="l00703"></a>00703 
<a name="l00704"></a>00704         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#afc5f34019a300fa0568bbea7c7a55dd7">IS_CLASS_POOL</a>(v_p) &amp;&amp;
<a name="l00705"></a>00705             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_name.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l00706"></a>00706             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_size.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l00707"></a>00707             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_prov.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l00708"></a>00708             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00709"></a>00709 
<a name="l00710"></a>00710             <a class="code" href="struct__lsm__pool.html">lsm_pool</a> *pool = <a class="code" href="lsm__convert_8cpp.html#a23825482fa20087834eed9d5e737fd2c">value_to_pool</a>(v_p);
<a name="l00711"></a>00711             <span class="keywordflow">if</span> (pool) {
<a name="l00712"></a>00712                 <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *vol = NULL;
<a name="l00713"></a>00713                 <span class="keywordtype">char</span> *job = NULL;
<a name="l00714"></a>00714                 <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__datatypes_8cpp.html#a2cc1fcbe95db9f01f0bc16e608508a1d">name</a> = v_name.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l00715"></a>00715                 uint64_t size = v_size.<a class="code" href="class_value.html#a6328e2190360933473e89e8a1b1d6d0f">asUint64_t</a>();
<a name="l00716"></a>00716                 <a class="code" href="libstoragemgmt__types_8h.html#a7df5745e43868cc250c3e2046ffb7ff4">lsm_volume_provision_type</a> pro =
<a name="l00717"></a>00717                     (<a class="code" href="libstoragemgmt__types_8h.html#a7df5745e43868cc250c3e2046ffb7ff4">lsm_volume_provision_type</a>) v_prov.<a class="code" href="class_value.html#a60b8f99167e23a6bcee87578fe59b099">asInt32_t</a>();
<a name="l00718"></a>00718 
<a name="l00719"></a>00719                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a6b48dba34395dcaa2fa5cbb5d446e8ed">vol_create</a>(p, pool, name, size, pro, &amp;vol,
<a name="l00720"></a>00720                                             &amp;job, <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00721"></a>00721 
<a name="l00722"></a>00722                 <a class="code" href="class_value.html">Value</a> v = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(vol);
<a name="l00723"></a>00723                 response = job_handle(v, job);
<a name="l00724"></a>00724 
<a name="l00725"></a>00725                 <span class="comment">//Free dynamic data.</span>
<a name="l00726"></a>00726                 <a class="code" href="libstoragemgmt__pool_8h.html#a44d50c6c387a0269fc494e94a831064b">lsm_pool_record_free</a>(pool);
<a name="l00727"></a>00727                 <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(vol);
<a name="l00728"></a>00728                 free(job);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730             } <span class="keywordflow">else</span> {
<a name="l00731"></a>00731                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00732"></a>00732             }
<a name="l00733"></a>00733 
<a name="l00734"></a>00734         } <span class="keywordflow">else</span> {
<a name="l00735"></a>00735             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00736"></a>00736         }
<a name="l00737"></a>00737     }
<a name="l00738"></a>00738     <span class="keywordflow">return</span> rc;
<a name="l00739"></a>00739 }
<a name="l00740"></a>00740 
<a name="l00741"></a>00741 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volume_resize(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00742"></a>00742                                 <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00743"></a>00743 {
<a name="l00744"></a>00744     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00745"></a>00745     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ac0b138d6d967d91bf287e9d2792f3d12">vol_resize</a>) {
<a name="l00746"></a>00746         <a class="code" href="class_value.html">Value</a> v_vol = params[<span class="stringliteral">&quot;volume&quot;</span>];
<a name="l00747"></a>00747         <a class="code" href="class_value.html">Value</a> v_size = params[<span class="stringliteral">&quot;new_size_bytes&quot;</span>];
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol) &amp;&amp;
<a name="l00750"></a>00750             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_size.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l00751"></a>00751             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00752"></a>00752 
<a name="l00753"></a>00753             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *vol = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol);
<a name="l00754"></a>00754             <span class="keywordflow">if</span> (vol) {
<a name="l00755"></a>00755                 <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *resized_vol = NULL;
<a name="l00756"></a>00756                 uint64_t size = v_size.<a class="code" href="class_value.html#a6328e2190360933473e89e8a1b1d6d0f">asUint64_t</a>();
<a name="l00757"></a>00757                 <span class="keywordtype">char</span> *job = NULL;
<a name="l00758"></a>00758 
<a name="l00759"></a>00759                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ac0b138d6d967d91bf287e9d2792f3d12">vol_resize</a>(p, vol, size, &amp;resized_vol,
<a name="l00760"></a>00760                                             &amp;job, <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00761"></a>00761 
<a name="l00762"></a>00762                 <a class="code" href="class_value.html">Value</a> v = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(resized_vol);
<a name="l00763"></a>00763                 response = job_handle(v, job);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765                 <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(vol);
<a name="l00766"></a>00766                 <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(resized_vol);
<a name="l00767"></a>00767                 free(job);
<a name="l00768"></a>00768 
<a name="l00769"></a>00769             } <span class="keywordflow">else</span> {
<a name="l00770"></a>00770                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00771"></a>00771             }
<a name="l00772"></a>00772 
<a name="l00773"></a>00773         } <span class="keywordflow">else</span> {
<a name="l00774"></a>00774             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00775"></a>00775         }
<a name="l00776"></a>00776     }
<a name="l00777"></a>00777     <span class="keywordflow">return</span> rc;
<a name="l00778"></a>00778 }
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volume_replicate(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00781"></a>00781                                    <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00782"></a>00782 {
<a name="l00783"></a>00783     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a7f0a92a6b41661870d6a5caa005e601b">vol_replicate</a>) {
<a name="l00786"></a>00786 
<a name="l00787"></a>00787         <a class="code" href="class_value.html">Value</a> v_pool = params[<span class="stringliteral">&quot;pool&quot;</span>];
<a name="l00788"></a>00788         <a class="code" href="class_value.html">Value</a> v_vol_src = params[<span class="stringliteral">&quot;volume_src&quot;</span>];
<a name="l00789"></a>00789         <a class="code" href="class_value.html">Value</a> v_rep = params[<span class="stringliteral">&quot;rep_type&quot;</span>];
<a name="l00790"></a>00790         <a class="code" href="class_value.html">Value</a> v_name = params[<span class="stringliteral">&quot;name&quot;</span>];
<a name="l00791"></a>00791 
<a name="l00792"></a>00792         <span class="keywordflow">if</span> (((<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == v_pool.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l00793"></a>00793               <a class="code" href="lsm__convert_8hpp.html#afc5f34019a300fa0568bbea7c7a55dd7">IS_CLASS_POOL</a>(v_pool)) ||
<a name="l00794"></a>00794              <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_pool.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l00795"></a>00795             <a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol_src) &amp;&amp;
<a name="l00796"></a>00796             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_rep.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l00797"></a>00797             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_name.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l00798"></a>00798             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00799"></a>00799 
<a name="l00800"></a>00800             <a class="code" href="struct__lsm__pool.html">lsm_pool</a> *pool = (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_pool.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>())? NULL :
<a name="l00801"></a>00801                 <a class="code" href="lsm__convert_8cpp.html#a23825482fa20087834eed9d5e737fd2c">value_to_pool</a>(v_pool);
<a name="l00802"></a>00802             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *vol = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol_src);
<a name="l00803"></a>00803             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *newVolume = NULL;
<a name="l00804"></a>00804             <a class="code" href="libstoragemgmt__types_8h.html#a18ffef5fae2ce2f8fee7b2444b3119fd">lsm_replication_type</a> rep = (<a class="code" href="libstoragemgmt__types_8h.html#a18ffef5fae2ce2f8fee7b2444b3119fd">lsm_replication_type</a>) v_rep.<a class="code" href="class_value.html#a60b8f99167e23a6bcee87578fe59b099">asInt32_t</a>();
<a name="l00805"></a>00805             <span class="keyword">const</span> <span class="keywordtype">char</span> *name = v_name.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l00806"></a>00806             <span class="keywordtype">char</span> *job = NULL;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808             <span class="keywordflow">if</span> (vol &amp;&amp;
<a name="l00809"></a>00809                 (pool || (!pool &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_pool.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()))) {
<a name="l00810"></a>00810                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a7f0a92a6b41661870d6a5caa005e601b">vol_replicate</a>(p, pool, rep, vol, name,
<a name="l00811"></a>00811                                                &amp;newVolume, &amp;job,
<a name="l00812"></a>00812                                                <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00813"></a>00813 
<a name="l00814"></a>00814                 <a class="code" href="class_value.html">Value</a> v = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(newVolume);
<a name="l00815"></a>00815                 response = job_handle(v, job);
<a name="l00816"></a>00816 
<a name="l00817"></a>00817                 <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(newVolume);
<a name="l00818"></a>00818                 free(job);
<a name="l00819"></a>00819             } <span class="keywordflow">else</span> {
<a name="l00820"></a>00820                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00821"></a>00821             }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823             <a class="code" href="libstoragemgmt__pool_8h.html#a44d50c6c387a0269fc494e94a831064b">lsm_pool_record_free</a>(pool);
<a name="l00824"></a>00824             <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(vol);
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         } <span class="keywordflow">else</span> {
<a name="l00827"></a>00827             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00828"></a>00828         }
<a name="l00829"></a>00829     }
<a name="l00830"></a>00830     <span class="keywordflow">return</span> rc;
<a name="l00831"></a>00831 }
<a name="l00832"></a>00832 
<a name="l00833"></a>00833 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volume_replicate_range_block_size(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p,
<a name="l00834"></a>00834                                                     <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00835"></a>00835                                                     <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00836"></a>00836 {
<a name="l00837"></a>00837     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00838"></a>00838     uint32_t block_size = 0;
<a name="l00839"></a>00839 
<a name="l00840"></a>00840     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a5d11c37db08b5433e432264aa24caf1f">vol_rep_range_bs</a>) {
<a name="l00841"></a>00841         <a class="code" href="class_value.html">Value</a> v_s = params[<span class="stringliteral">&quot;system&quot;</span>];
<a name="l00842"></a>00842 
<a name="l00843"></a>00843         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a53f5d3ea6301a0d96925730bb5837b03">IS_CLASS_SYSTEM</a>(v_s) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00844"></a>00844             <a class="code" href="struct__lsm__system.html">lsm_system</a> *sys = <a class="code" href="lsm__convert_8cpp.html#a49198461198770e8dbd90cf6b950c121">value_to_system</a>(v_s);
<a name="l00845"></a>00845 
<a name="l00846"></a>00846             <span class="keywordflow">if</span> (sys) {
<a name="l00847"></a>00847                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a5d11c37db08b5433e432264aa24caf1f">vol_rep_range_bs</a>(p, sys, &amp;block_size,
<a name="l00848"></a>00848                                                   <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00849"></a>00849 
<a name="l00850"></a>00850                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00851"></a>00851                     response = <a class="code" href="class_value.html">Value</a>(block_size);
<a name="l00852"></a>00852                 }
<a name="l00853"></a>00853 
<a name="l00854"></a>00854                 <a class="code" href="libstoragemgmt__systems_8h.html#ab3ab47a044dec61344929ff9f27f9dfa">lsm_system_record_free</a>(sys);
<a name="l00855"></a>00855             } <span class="keywordflow">else</span> {
<a name="l00856"></a>00856                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00857"></a>00857             }
<a name="l00858"></a>00858         } <span class="keywordflow">else</span> {
<a name="l00859"></a>00859             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00860"></a>00860         }
<a name="l00861"></a>00861     }
<a name="l00862"></a>00862     <span class="keywordflow">return</span> rc;
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a>00865 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volume_replicate_range(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00866"></a>00866                                          <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00867"></a>00867 {
<a name="l00868"></a>00868     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00869"></a>00869     uint32_t range_count = 0;
<a name="l00870"></a>00870     <span class="keywordtype">char</span> *job = NULL;
<a name="l00871"></a>00871     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ab87b94cf98b13ac032808a3727ccc474">vol_rep_range</a>) {
<a name="l00872"></a>00872         <a class="code" href="class_value.html">Value</a> v_rep = params[<span class="stringliteral">&quot;rep_type&quot;</span>];
<a name="l00873"></a>00873         <a class="code" href="class_value.html">Value</a> v_vol_src = params[<span class="stringliteral">&quot;volume_src&quot;</span>];
<a name="l00874"></a>00874         <a class="code" href="class_value.html">Value</a> v_vol_dest = params[<span class="stringliteral">&quot;volume_dest&quot;</span>];
<a name="l00875"></a>00875         <a class="code" href="class_value.html">Value</a> v_ranges = params[<span class="stringliteral">&quot;ranges&quot;</span>];
<a name="l00876"></a>00876 
<a name="l00877"></a>00877         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_rep.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l00878"></a>00878             <a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol_src) &amp;&amp;
<a name="l00879"></a>00879             <a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol_dest) &amp;&amp;
<a name="l00880"></a>00880             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == v_ranges.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l00881"></a>00881             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00882"></a>00882 
<a name="l00883"></a>00883             <a class="code" href="libstoragemgmt__types_8h.html#a18ffef5fae2ce2f8fee7b2444b3119fd">lsm_replication_type</a> repType = (<a class="code" href="libstoragemgmt__types_8h.html#a18ffef5fae2ce2f8fee7b2444b3119fd">lsm_replication_type</a>)
<a name="l00884"></a>00884                 v_rep.<a class="code" href="class_value.html#a60b8f99167e23a6bcee87578fe59b099">asInt32_t</a>();
<a name="l00885"></a>00885             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *source = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol_src);
<a name="l00886"></a>00886             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *<a class="code" href="namespacenetapp.html#a66d4da94e0e4f717ff3e7f23c53f7c2d">dest</a> = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol_dest);
<a name="l00887"></a>00887             <a class="code" href="struct__lsm__block__range.html">lsm_block_range</a> **ranges = <a class="code" href="lsm__convert_8cpp.html#a51a29cecee9f41acf8278106802a9c00">value_to_block_range_list</a>(v_ranges,
<a name="l00888"></a>00888                                                                  &amp;range_count);
<a name="l00889"></a>00889 
<a name="l00890"></a>00890             <span class="keywordflow">if</span> (source &amp;&amp; dest &amp;&amp; ranges) {
<a name="l00891"></a>00891 
<a name="l00892"></a>00892                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ab87b94cf98b13ac032808a3727ccc474">vol_rep_range</a>(p, repType, source, dest,
<a name="l00893"></a>00893                                                ranges, range_count, &amp;job,
<a name="l00894"></a>00894                                                <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00895"></a>00895 
<a name="l00896"></a>00896                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l00897"></a>00897                     response = <a class="code" href="class_value.html">Value</a>(job);
<a name="l00898"></a>00898                     free(job);
<a name="l00899"></a>00899                     job = NULL;
<a name="l00900"></a>00900                 }
<a name="l00901"></a>00901 
<a name="l00902"></a>00902             } <span class="keywordflow">else</span> {
<a name="l00903"></a>00903                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00904"></a>00904             }
<a name="l00905"></a>00905 
<a name="l00906"></a>00906             <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(source);
<a name="l00907"></a>00907             <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(dest);
<a name="l00908"></a>00908             <a class="code" href="libstoragemgmt__blockrange_8h.html#ad2b483b9743937c1e1aa7cbca6dac496">lsm_block_range_record_array_free</a>(ranges, range_count);
<a name="l00909"></a>00909 
<a name="l00910"></a>00910         } <span class="keywordflow">else</span> {
<a name="l00911"></a>00911             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00912"></a>00912         }
<a name="l00913"></a>00913     }
<a name="l00914"></a>00914     <span class="keywordflow">return</span> rc;
<a name="l00915"></a>00915 }
<a name="l00916"></a>00916 
<a name="l00917"></a>00917 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volume_delete(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00918"></a>00918                                 <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00919"></a>00919 {
<a name="l00920"></a>00920     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00921"></a>00921     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ab8770b4546b1ea3734020cd022fecda7">vol_delete</a>) {
<a name="l00922"></a>00922         <a class="code" href="class_value.html">Value</a> v_vol = params[<span class="stringliteral">&quot;volume&quot;</span>];
<a name="l00923"></a>00923 
<a name="l00924"></a>00924         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00925"></a>00925             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *vol = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol);
<a name="l00926"></a>00926 
<a name="l00927"></a>00927             <span class="keywordflow">if</span> (vol) {
<a name="l00928"></a>00928                 <span class="keywordtype">char</span> *job = NULL;
<a name="l00929"></a>00929 
<a name="l00930"></a>00930                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ab8770b4546b1ea3734020cd022fecda7">vol_delete</a>(p, vol, &amp;job,
<a name="l00931"></a>00931                                             <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00932"></a>00932 
<a name="l00933"></a>00933                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l00934"></a>00934                     response = <a class="code" href="class_value.html">Value</a>(job);
<a name="l00935"></a>00935                 }
<a name="l00936"></a>00936 
<a name="l00937"></a>00937                 <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(vol);
<a name="l00938"></a>00938                 free(job);
<a name="l00939"></a>00939             } <span class="keywordflow">else</span> {
<a name="l00940"></a>00940                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00941"></a>00941             }
<a name="l00942"></a>00942 
<a name="l00943"></a>00943         } <span class="keywordflow">else</span> {
<a name="l00944"></a>00944             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00945"></a>00945         }
<a name="l00946"></a>00946     }
<a name="l00947"></a>00947     <span class="keywordflow">return</span> rc;
<a name="l00948"></a>00948 }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_vol_enable_disable(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00951"></a>00951                                      <a class="code" href="class_value.html">Value</a> &amp; response, <span class="keywordtype">int</span> online)
<a name="l00952"></a>00952 {
<a name="l00953"></a>00953     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00954"></a>00954 
<a name="l00955"></a>00955     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp;
<a name="l00956"></a>00956         ((online) ? p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a6ae2ebc1d02cf9a99001f224938bbe3b">vol_enable</a> : p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ae90f901edd2c0f433ac0f1550129db81">vol_disable</a>)) {
<a name="l00957"></a>00957 
<a name="l00958"></a>00958         <a class="code" href="class_value.html">Value</a> v_vol = params[<span class="stringliteral">&quot;volume&quot;</span>];
<a name="l00959"></a>00959 
<a name="l00960"></a>00960         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l00961"></a>00961             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *vol = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol);
<a name="l00962"></a>00962             <span class="keywordflow">if</span> (vol) {
<a name="l00963"></a>00963                 <span class="keywordflow">if</span> (online) {
<a name="l00964"></a>00964                     rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a6ae2ebc1d02cf9a99001f224938bbe3b">vol_enable</a>(p, vol,
<a name="l00965"></a>00965                                                 <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00966"></a>00966                 } <span class="keywordflow">else</span> {
<a name="l00967"></a>00967                     rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ae90f901edd2c0f433ac0f1550129db81">vol_disable</a>(p, vol,
<a name="l00968"></a>00968                                                  <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l00969"></a>00969                 }
<a name="l00970"></a>00970 
<a name="l00971"></a>00971                 <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(vol);
<a name="l00972"></a>00972             } <span class="keywordflow">else</span> {
<a name="l00973"></a>00973                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00974"></a>00974             }
<a name="l00975"></a>00975         } <span class="keywordflow">else</span> {
<a name="l00976"></a>00976             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l00977"></a>00977         }
<a name="l00978"></a>00978     }
<a name="l00979"></a>00979     <span class="keywordflow">return</span> rc;
<a name="l00980"></a>00980 }
<a name="l00981"></a>00981 
<a name="l00982"></a>00982 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volume_enable(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00983"></a>00983                                 <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00984"></a>00984 {
<a name="l00985"></a>00985     <span class="keywordflow">return</span> handle_vol_enable_disable(p, params, response, 1);
<a name="l00986"></a>00986 }
<a name="l00987"></a>00987 
<a name="l00988"></a>00988 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volume_disable(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00989"></a>00989                                  <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00990"></a>00990 {
<a name="l00991"></a>00991     <span class="keywordflow">return</span> handle_vol_enable_disable(p, params, response, 0);
<a name="l00992"></a>00992 }
<a name="l00993"></a>00993 
<a name="l00994"></a>00994 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volume_raid_info(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l00995"></a>00995                                    <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l00996"></a>00996 {
<a name="l00997"></a>00997     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l00998"></a>00998     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a>-&gt;<a class="code" href="structlsm__ops__v1__2.html#a18065d83e140af6fef428ad6811df035">vol_raid_info</a>) {
<a name="l00999"></a>00999         <a class="code" href="class_value.html">Value</a> v_vol = params[<span class="stringliteral">&quot;volume&quot;</span>];
<a name="l01000"></a>01000 
<a name="l01001"></a>01001         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01002"></a>01002             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *vol = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol);
<a name="l01003"></a>01003             std::vector &lt; Value &gt; result;
<a name="l01004"></a>01004 
<a name="l01005"></a>01005             <span class="keywordflow">if</span> (vol) {
<a name="l01006"></a>01006                 <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545">lsm_volume_raid_type</a> raid_type;
<a name="l01007"></a>01007                 uint32_t strip_size;
<a name="l01008"></a>01008                 uint32_t disk_count;
<a name="l01009"></a>01009                 uint32_t min_io_size;
<a name="l01010"></a>01010                 uint32_t opt_io_size;
<a name="l01011"></a>01011 
<a name="l01012"></a>01012                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a>-&gt;<a class="code" href="structlsm__ops__v1__2.html#a18065d83e140af6fef428ad6811df035">vol_raid_info</a>(p, vol, &amp;raid_type,
<a name="l01013"></a>01013                                                 &amp;strip_size, &amp;disk_count,
<a name="l01014"></a>01014                                                 &amp;min_io_size, &amp;opt_io_size,
<a name="l01015"></a>01015                                                 <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01016"></a>01016 
<a name="l01017"></a>01017                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01018"></a>01018                     result.push_back(<a class="code" href="class_value.html">Value</a>((int32_t) raid_type));
<a name="l01019"></a>01019                     result.push_back(<a class="code" href="class_value.html">Value</a>(strip_size));
<a name="l01020"></a>01020                     result.push_back(<a class="code" href="class_value.html">Value</a>(disk_count));
<a name="l01021"></a>01021                     result.push_back(<a class="code" href="class_value.html">Value</a>(min_io_size));
<a name="l01022"></a>01022                     result.push_back(<a class="code" href="class_value.html">Value</a>(opt_io_size));
<a name="l01023"></a>01023                     response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l01024"></a>01024                 }
<a name="l01025"></a>01025 
<a name="l01026"></a>01026                 <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(vol);
<a name="l01027"></a>01027             } <span class="keywordflow">else</span> {
<a name="l01028"></a>01028                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01029"></a>01029             }
<a name="l01030"></a>01030 
<a name="l01031"></a>01031         } <span class="keywordflow">else</span> {
<a name="l01032"></a>01032             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01033"></a>01033         }
<a name="l01034"></a>01034     }
<a name="l01035"></a>01035     <span class="keywordflow">return</span> rc;
<a name="l01036"></a>01036 }
<a name="l01037"></a>01037 
<a name="l01038"></a>01038 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_pool_member_info(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l01039"></a>01039                                    <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01040"></a>01040 {
<a name="l01041"></a>01041     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01042"></a>01042     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a>-&gt;<a class="code" href="structlsm__ops__v1__2.html#a00f982e157494b943e38454575400dce">pool_member_info</a>) {
<a name="l01043"></a>01043         <a class="code" href="class_value.html">Value</a> v_pool = params[<span class="stringliteral">&quot;pool&quot;</span>];
<a name="l01044"></a>01044 
<a name="l01045"></a>01045         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#afc5f34019a300fa0568bbea7c7a55dd7">IS_CLASS_POOL</a>(v_pool) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01046"></a>01046             <a class="code" href="struct__lsm__pool.html">lsm_pool</a> *pool = <a class="code" href="lsm__convert_8cpp.html#a23825482fa20087834eed9d5e737fd2c">value_to_pool</a>(v_pool);
<a name="l01047"></a>01047             std::vector &lt; Value &gt; result;
<a name="l01048"></a>01048 
<a name="l01049"></a>01049             <span class="keywordflow">if</span> (pool) {
<a name="l01050"></a>01050                 <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545">lsm_volume_raid_type</a> raid_type = <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545a789c462e49c9559180f1fcf87a7d2908">LSM_VOLUME_RAID_TYPE_UNKNOWN</a>;
<a name="l01051"></a>01051                 <a class="code" href="libstoragemgmt__types_8h.html#a0c8a15a19746091962bf98c1c6d85f5c">lsm_pool_member_type</a> member_type = <a class="code" href="libstoragemgmt__types_8h.html#a0c8a15a19746091962bf98c1c6d85f5ca1c81e0d8f074ead97aa3b74f4e96fcdf">LSM_POOL_MEMBER_TYPE_UNKNOWN</a>;
<a name="l01052"></a>01052                 <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> *member_ids = NULL;
<a name="l01053"></a>01053 
<a name="l01054"></a>01054                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a>-&gt;<a class="code" href="structlsm__ops__v1__2.html#a00f982e157494b943e38454575400dce">pool_member_info</a>(p, pool, &amp;raid_type,
<a name="l01055"></a>01055                                                    &amp;member_type,
<a name="l01056"></a>01056                                                    &amp;member_ids,
<a name="l01057"></a>01057                                                    <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01058"></a>01058 
<a name="l01059"></a>01059                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01060"></a>01060                     result.push_back(<a class="code" href="class_value.html">Value</a>((int32_t) raid_type));
<a name="l01061"></a>01061                     result.push_back(<a class="code" href="class_value.html">Value</a>((int32_t) member_type));
<a name="l01062"></a>01062                     result.push_back(<a class="code" href="lsm__convert_8cpp.html#ab12e4a58efa188d9b9ccbad5bf4a60a9">string_list_to_value</a>(member_ids));
<a name="l01063"></a>01063                     <span class="keywordflow">if</span> (member_ids != NULL) {
<a name="l01064"></a>01064                         <a class="code" href="libstoragemgmt__common_8h.html#a0042977fcc59a5907892dcd5e907b891">lsm_string_list_free</a>(member_ids);
<a name="l01065"></a>01065                     }
<a name="l01066"></a>01066                     response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l01067"></a>01067                 }
<a name="l01068"></a>01068 
<a name="l01069"></a>01069                 <a class="code" href="libstoragemgmt__pool_8h.html#a44d50c6c387a0269fc494e94a831064b">lsm_pool_record_free</a>(pool);
<a name="l01070"></a>01070             } <span class="keywordflow">else</span> {
<a name="l01071"></a>01071                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01072"></a>01072             }
<a name="l01073"></a>01073 
<a name="l01074"></a>01074         } <span class="keywordflow">else</span> {
<a name="l01075"></a>01075             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01076"></a>01076         }
<a name="l01077"></a>01077     }
<a name="l01078"></a>01078     <span class="keywordflow">return</span> rc;
<a name="l01079"></a>01079 }
<a name="l01080"></a>01080 
<a name="l01081"></a>01081 <span class="keyword">static</span> <span class="keywordtype">int</span> ag_list(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01082"></a>01082 {
<a name="l01083"></a>01083     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01084"></a>01084     <span class="keywordtype">char</span> *key = NULL;
<a name="l01085"></a>01085     <span class="keywordtype">char</span> *val = NULL;
<a name="l01086"></a>01086 
<a name="l01087"></a>01087     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ac38e6af356d81c2fd4191417b323372a">ag_list</a>) {
<a name="l01088"></a>01088 
<a name="l01089"></a>01089         <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params) &amp;&amp;
<a name="l01090"></a>01090             (rc = get_search_params(params, &amp;key, &amp;val)) == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l01091"></a>01091             <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> **groups = NULL;
<a name="l01092"></a>01092             uint32_t count;
<a name="l01093"></a>01093 
<a name="l01094"></a>01094             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ac38e6af356d81c2fd4191417b323372a">ag_list</a>(p, key, val, &amp;groups, &amp;count,
<a name="l01095"></a>01095                                      <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01096"></a>01096             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01097"></a>01097                 response = <a class="code" href="lsm__convert_8cpp.html#affbc99b918ae6c5931c2be4ebd6db766">access_group_list_to_value</a>(groups, count);
<a name="l01098"></a>01098 
<a name="l01099"></a>01099                 <span class="comment">/* Free the memory */</span>
<a name="l01100"></a>01100                 <a class="code" href="libstoragemgmt__accessgroups_8h.html#ad593cb660a6fc96fd90b70d9eb3bcb7d">lsm_access_group_record_array_free</a>(groups, count);
<a name="l01101"></a>01101             }
<a name="l01102"></a>01102             free(key);
<a name="l01103"></a>01103             free(val);
<a name="l01104"></a>01104         } <span class="keywordflow">else</span> {
<a name="l01105"></a>01105             <span class="keywordflow">if</span> (rc == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>) {
<a name="l01106"></a>01106                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01107"></a>01107             }
<a name="l01108"></a>01108         }
<a name="l01109"></a>01109     }
<a name="l01110"></a>01110     <span class="keywordflow">return</span> rc;
<a name="l01111"></a>01111 }
<a name="l01112"></a>01112 
<a name="l01113"></a>01113 <span class="keyword">static</span> <span class="keywordtype">int</span> ag_create(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01114"></a>01114 {
<a name="l01115"></a>01115     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01116"></a>01116 
<a name="l01117"></a>01117     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#aa01fe1ef5cfbb323ffa84819960f82ac">ag_create</a>) {
<a name="l01118"></a>01118         <a class="code" href="class_value.html">Value</a> v_name = params[<span class="stringliteral">&quot;name&quot;</span>];
<a name="l01119"></a>01119         <a class="code" href="class_value.html">Value</a> v_init_id = params[<span class="stringliteral">&quot;init_id&quot;</span>];
<a name="l01120"></a>01120         <a class="code" href="class_value.html">Value</a> v_init_type = params[<span class="stringliteral">&quot;init_type&quot;</span>];
<a name="l01121"></a>01121         <a class="code" href="class_value.html">Value</a> v_system = params[<span class="stringliteral">&quot;system&quot;</span>];
<a name="l01122"></a>01122 
<a name="l01123"></a>01123         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_name.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01124"></a>01124             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_init_id.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01125"></a>01125             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_init_type.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01126"></a>01126             <a class="code" href="lsm__convert_8hpp.html#a53f5d3ea6301a0d96925730bb5837b03">IS_CLASS_SYSTEM</a>(v_system) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01127"></a>01127 
<a name="l01128"></a>01128             <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> *ag = NULL;
<a name="l01129"></a>01129             <a class="code" href="struct__lsm__system.html">lsm_system</a> *system = <a class="code" href="lsm__convert_8cpp.html#a49198461198770e8dbd90cf6b950c121">value_to_system</a>(v_system);
<a name="l01130"></a>01130 
<a name="l01131"></a>01131             <span class="keywordflow">if</span> (system) {
<a name="l01132"></a>01132                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#aa01fe1ef5cfbb323ffa84819960f82ac">ag_create</a>(p,
<a name="l01133"></a>01133                                            v_name.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>(),
<a name="l01134"></a>01134                                            v_init_id.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>(),
<a name="l01135"></a>01135                                            (<a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842db">lsm_access_group_init_type</a>)
<a name="l01136"></a>01136                                            v_init_type.<a class="code" href="class_value.html#a60b8f99167e23a6bcee87578fe59b099">asInt32_t</a>(), system,
<a name="l01137"></a>01137                                            &amp;ag, <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01138"></a>01138                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01139"></a>01139                     response = <a class="code" href="lsm__convert_8cpp.html#afa1785eed2f2c143e36f29c212a0857e">access_group_to_value</a>(ag);
<a name="l01140"></a>01140                     <a class="code" href="lsm__plugin__ipc_8cpp.html#a7348be40f25136d7717c7154e1ea0eef">lsm_access_group_record_free</a>(ag);
<a name="l01141"></a>01141                 }
<a name="l01142"></a>01142 
<a name="l01143"></a>01143                 <a class="code" href="libstoragemgmt__systems_8h.html#ab3ab47a044dec61344929ff9f27f9dfa">lsm_system_record_free</a>(system);
<a name="l01144"></a>01144                 system = NULL;
<a name="l01145"></a>01145             }
<a name="l01146"></a>01146         } <span class="keywordflow">else</span> {
<a name="l01147"></a>01147             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01148"></a>01148         }
<a name="l01149"></a>01149     }
<a name="l01150"></a>01150     <span class="keywordflow">return</span> rc;
<a name="l01151"></a>01151 }
<a name="l01152"></a>01152 
<a name="l01153"></a>01153 <span class="keyword">static</span> <span class="keywordtype">int</span> ag_delete(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01154"></a>01154 {
<a name="l01155"></a>01155     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01156"></a>01156 
<a name="l01157"></a>01157     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#abfa11921df3a23da4400abce6601bb84">ag_delete</a>) {
<a name="l01158"></a>01158         <a class="code" href="class_value.html">Value</a> v_access_group = params[<span class="stringliteral">&quot;access_group&quot;</span>];
<a name="l01159"></a>01159 
<a name="l01160"></a>01160         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#aa9fc413c83b846b890d173ca3eafe80c">IS_CLASS_ACCESS_GROUP</a>(v_access_group) &amp;&amp;
<a name="l01161"></a>01161             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01162"></a>01162 
<a name="l01163"></a>01163             <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> *ag = <a class="code" href="lsm__convert_8cpp.html#a7977d143a5d88f560ff2b14f37819bb2">value_to_access_group</a>(v_access_group);
<a name="l01164"></a>01164 
<a name="l01165"></a>01165             <span class="keywordflow">if</span> (ag) {
<a name="l01166"></a>01166                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#abfa11921df3a23da4400abce6601bb84">ag_delete</a>(p, ag, <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01167"></a>01167                 <a class="code" href="lsm__plugin__ipc_8cpp.html#a7348be40f25136d7717c7154e1ea0eef">lsm_access_group_record_free</a>(ag);
<a name="l01168"></a>01168             } <span class="keywordflow">else</span> {
<a name="l01169"></a>01169                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01170"></a>01170             }
<a name="l01171"></a>01171 
<a name="l01172"></a>01172         } <span class="keywordflow">else</span> {
<a name="l01173"></a>01173             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01174"></a>01174         }
<a name="l01175"></a>01175     }
<a name="l01176"></a>01176     <span class="keywordflow">return</span> rc;
<a name="l01177"></a>01177 }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179 <span class="keyword">static</span> <span class="keywordtype">int</span> ag_initiator_add(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01180"></a>01180 {
<a name="l01181"></a>01181     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01182"></a>01182 
<a name="l01183"></a>01183     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a4e587f5dc032de6bec3cebd7fb6e197b">ag_add_initiator</a>) {
<a name="l01184"></a>01184 
<a name="l01185"></a>01185         <a class="code" href="class_value.html">Value</a> v_group = params[<span class="stringliteral">&quot;access_group&quot;</span>];
<a name="l01186"></a>01186         <a class="code" href="class_value.html">Value</a> v_init_id = params[<span class="stringliteral">&quot;init_id&quot;</span>];
<a name="l01187"></a>01187         <a class="code" href="class_value.html">Value</a> v_init_type = params[<span class="stringliteral">&quot;init_type&quot;</span>];
<a name="l01188"></a>01188 
<a name="l01189"></a>01189 
<a name="l01190"></a>01190         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#aa9fc413c83b846b890d173ca3eafe80c">IS_CLASS_ACCESS_GROUP</a>(v_group) &amp;&amp;
<a name="l01191"></a>01191             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_init_id.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01192"></a>01192             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_init_type.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01193"></a>01193             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01194"></a>01194 
<a name="l01195"></a>01195             <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> *ag = <a class="code" href="lsm__convert_8cpp.html#a7977d143a5d88f560ff2b14f37819bb2">value_to_access_group</a>(v_group);
<a name="l01196"></a>01196             <span class="keywordflow">if</span> (ag) {
<a name="l01197"></a>01197                 <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> *updated_access_group = NULL;
<a name="l01198"></a>01198                 <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = v_init_id.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l01199"></a>01199                 <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842db">lsm_access_group_init_type</a> id_type =
<a name="l01200"></a>01200                     (<a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842db">lsm_access_group_init_type</a>) v_init_type.<a class="code" href="class_value.html#a60b8f99167e23a6bcee87578fe59b099">asInt32_t</a>();
<a name="l01201"></a>01201 
<a name="l01202"></a>01202                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a4e587f5dc032de6bec3cebd7fb6e197b">ag_add_initiator</a>(p, ag, <span class="keywordtype">id</span>, id_type,
<a name="l01203"></a>01203                                                   &amp;updated_access_group,
<a name="l01204"></a>01204                                                   <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01205"></a>01205 
<a name="l01206"></a>01206                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01207"></a>01207                     response = <a class="code" href="lsm__convert_8cpp.html#afa1785eed2f2c143e36f29c212a0857e">access_group_to_value</a>(updated_access_group);
<a name="l01208"></a>01208                     <a class="code" href="lsm__plugin__ipc_8cpp.html#a7348be40f25136d7717c7154e1ea0eef">lsm_access_group_record_free</a>(updated_access_group);
<a name="l01209"></a>01209                 }
<a name="l01210"></a>01210 
<a name="l01211"></a>01211                 <a class="code" href="lsm__plugin__ipc_8cpp.html#a7348be40f25136d7717c7154e1ea0eef">lsm_access_group_record_free</a>(ag);
<a name="l01212"></a>01212             } <span class="keywordflow">else</span> {
<a name="l01213"></a>01213                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01214"></a>01214             }
<a name="l01215"></a>01215 
<a name="l01216"></a>01216         } <span class="keywordflow">else</span> {
<a name="l01217"></a>01217             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01218"></a>01218         }
<a name="l01219"></a>01219     }
<a name="l01220"></a>01220 
<a name="l01221"></a>01221     <span class="keywordflow">return</span> rc;
<a name="l01222"></a>01222 }
<a name="l01223"></a>01223 
<a name="l01224"></a>01224 <span class="keyword">static</span> <span class="keywordtype">int</span> ag_initiator_del(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01225"></a>01225 {
<a name="l01226"></a>01226     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01227"></a>01227 
<a name="l01228"></a>01228     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ac828b46f01d038c5ea30635ab6a598a5">ag_del_initiator</a>) {
<a name="l01229"></a>01229 
<a name="l01230"></a>01230         <a class="code" href="class_value.html">Value</a> v_group = params[<span class="stringliteral">&quot;access_group&quot;</span>];
<a name="l01231"></a>01231         <a class="code" href="class_value.html">Value</a> v_init_id = params[<span class="stringliteral">&quot;init_id&quot;</span>];
<a name="l01232"></a>01232         <a class="code" href="class_value.html">Value</a> v_init_type = params[<span class="stringliteral">&quot;init_type&quot;</span>];
<a name="l01233"></a>01233 
<a name="l01234"></a>01234         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#aa9fc413c83b846b890d173ca3eafe80c">IS_CLASS_ACCESS_GROUP</a>(v_group) &amp;&amp;
<a name="l01235"></a>01235             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_init_id.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01236"></a>01236             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_init_type.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01237"></a>01237             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01238"></a>01238 
<a name="l01239"></a>01239             <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> *ag = <a class="code" href="lsm__convert_8cpp.html#a7977d143a5d88f560ff2b14f37819bb2">value_to_access_group</a>(v_group);
<a name="l01240"></a>01240 
<a name="l01241"></a>01241             <span class="keywordflow">if</span> (ag) {
<a name="l01242"></a>01242                 <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> *updated_access_group = NULL;
<a name="l01243"></a>01243                 <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span> = v_init_id.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l01244"></a>01244                 <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842db">lsm_access_group_init_type</a> id_type =
<a name="l01245"></a>01245                     (<a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842db">lsm_access_group_init_type</a>) v_init_type.<a class="code" href="class_value.html#a60b8f99167e23a6bcee87578fe59b099">asInt32_t</a>();
<a name="l01246"></a>01246                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ac828b46f01d038c5ea30635ab6a598a5">ag_del_initiator</a>(p, ag, <span class="keywordtype">id</span>, id_type,
<a name="l01247"></a>01247                                                   &amp;updated_access_group,
<a name="l01248"></a>01248                                                   <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01249"></a>01249 
<a name="l01250"></a>01250                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01251"></a>01251                     response = <a class="code" href="lsm__convert_8cpp.html#afa1785eed2f2c143e36f29c212a0857e">access_group_to_value</a>(updated_access_group);
<a name="l01252"></a>01252                     <a class="code" href="lsm__plugin__ipc_8cpp.html#a7348be40f25136d7717c7154e1ea0eef">lsm_access_group_record_free</a>(updated_access_group);
<a name="l01253"></a>01253                 }
<a name="l01254"></a>01254 
<a name="l01255"></a>01255                 <a class="code" href="lsm__plugin__ipc_8cpp.html#a7348be40f25136d7717c7154e1ea0eef">lsm_access_group_record_free</a>(ag);
<a name="l01256"></a>01256             } <span class="keywordflow">else</span> {
<a name="l01257"></a>01257                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01258"></a>01258             }
<a name="l01259"></a>01259 
<a name="l01260"></a>01260         } <span class="keywordflow">else</span> {
<a name="l01261"></a>01261             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01262"></a>01262         }
<a name="l01263"></a>01263     }
<a name="l01264"></a>01264     <span class="keywordflow">return</span> rc;
<a name="l01265"></a>01265 }
<a name="l01266"></a>01266 
<a name="l01267"></a>01267 <span class="keyword">static</span> <span class="keywordtype">int</span> volume_mask(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01268"></a>01268 {
<a name="l01269"></a>01269     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01270"></a>01270 
<a name="l01271"></a>01271     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a98851c68a59958e49370717afad38b0a">ag_grant</a>) {
<a name="l01272"></a>01272 
<a name="l01273"></a>01273         <a class="code" href="class_value.html">Value</a> v_group = params[<span class="stringliteral">&quot;access_group&quot;</span>];
<a name="l01274"></a>01274         <a class="code" href="class_value.html">Value</a> v_vol = params[<span class="stringliteral">&quot;volume&quot;</span>];
<a name="l01275"></a>01275 
<a name="l01276"></a>01276         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#aa9fc413c83b846b890d173ca3eafe80c">IS_CLASS_ACCESS_GROUP</a>(v_group) &amp;&amp;
<a name="l01277"></a>01277             <a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01278"></a>01278 
<a name="l01279"></a>01279             <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> *ag = <a class="code" href="lsm__convert_8cpp.html#a7977d143a5d88f560ff2b14f37819bb2">value_to_access_group</a>(v_group);
<a name="l01280"></a>01280             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *vol = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol);
<a name="l01281"></a>01281 
<a name="l01282"></a>01282             <span class="keywordflow">if</span> (ag &amp;&amp; vol) {
<a name="l01283"></a>01283                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a98851c68a59958e49370717afad38b0a">ag_grant</a>(p, ag, vol,
<a name="l01284"></a>01284                                           <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01285"></a>01285             } <span class="keywordflow">else</span> {
<a name="l01286"></a>01286                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01287"></a>01287             }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289             <a class="code" href="lsm__plugin__ipc_8cpp.html#a7348be40f25136d7717c7154e1ea0eef">lsm_access_group_record_free</a>(ag);
<a name="l01290"></a>01290             <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(vol);
<a name="l01291"></a>01291 
<a name="l01292"></a>01292         } <span class="keywordflow">else</span> {
<a name="l01293"></a>01293             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01294"></a>01294         }
<a name="l01295"></a>01295     }
<a name="l01296"></a>01296 
<a name="l01297"></a>01297     <span class="keywordflow">return</span> rc;
<a name="l01298"></a>01298 }
<a name="l01299"></a>01299 
<a name="l01300"></a>01300 <span class="keyword">static</span> <span class="keywordtype">int</span> volume_unmask(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01301"></a>01301 {
<a name="l01302"></a>01302     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01303"></a>01303 
<a name="l01304"></a>01304     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a1575c350432b03cf0025a439f3125df8">ag_revoke</a>) {
<a name="l01305"></a>01305 
<a name="l01306"></a>01306         <a class="code" href="class_value.html">Value</a> v_group = params[<span class="stringliteral">&quot;access_group&quot;</span>];
<a name="l01307"></a>01307         <a class="code" href="class_value.html">Value</a> v_vol = params[<span class="stringliteral">&quot;volume&quot;</span>];
<a name="l01308"></a>01308 
<a name="l01309"></a>01309         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#aa9fc413c83b846b890d173ca3eafe80c">IS_CLASS_ACCESS_GROUP</a>(v_group) &amp;&amp;
<a name="l01310"></a>01310             <a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01311"></a>01311 
<a name="l01312"></a>01312             <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> *ag = <a class="code" href="lsm__convert_8cpp.html#a7977d143a5d88f560ff2b14f37819bb2">value_to_access_group</a>(v_group);
<a name="l01313"></a>01313             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *vol = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol);
<a name="l01314"></a>01314 
<a name="l01315"></a>01315             <span class="keywordflow">if</span> (ag &amp;&amp; vol) {
<a name="l01316"></a>01316                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a1575c350432b03cf0025a439f3125df8">ag_revoke</a>(p, ag, vol,
<a name="l01317"></a>01317                                            <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01318"></a>01318             } <span class="keywordflow">else</span> {
<a name="l01319"></a>01319                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01320"></a>01320             }
<a name="l01321"></a>01321 
<a name="l01322"></a>01322             <a class="code" href="lsm__plugin__ipc_8cpp.html#a7348be40f25136d7717c7154e1ea0eef">lsm_access_group_record_free</a>(ag);
<a name="l01323"></a>01323             <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(vol);
<a name="l01324"></a>01324 
<a name="l01325"></a>01325         } <span class="keywordflow">else</span> {
<a name="l01326"></a>01326             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01327"></a>01327         }
<a name="l01328"></a>01328     }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330     <span class="keywordflow">return</span> rc;
<a name="l01331"></a>01331 }
<a name="l01332"></a>01332 
<a name="l01333"></a>01333 <span class="keyword">static</span> <span class="keywordtype">int</span> vol_accessible_by_ag(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l01334"></a>01334                                 <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01335"></a>01335 {
<a name="l01336"></a>01336     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01337"></a>01337 
<a name="l01338"></a>01338     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a82d1442a90546f275feeeda876c2f879">vol_accessible_by_ag</a>) {
<a name="l01339"></a>01339         <a class="code" href="class_value.html">Value</a> v_access_group = params[<span class="stringliteral">&quot;access_group&quot;</span>];
<a name="l01340"></a>01340 
<a name="l01341"></a>01341         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#aa9fc413c83b846b890d173ca3eafe80c">IS_CLASS_ACCESS_GROUP</a>(v_access_group) &amp;&amp;
<a name="l01342"></a>01342             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01343"></a>01343             <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> *ag = <a class="code" href="lsm__convert_8cpp.html#a7977d143a5d88f560ff2b14f37819bb2">value_to_access_group</a>(v_access_group);
<a name="l01344"></a>01344 
<a name="l01345"></a>01345             <span class="keywordflow">if</span> (ag) {
<a name="l01346"></a>01346                 <a class="code" href="struct__lsm__volume.html">lsm_volume</a> **vols = NULL;
<a name="l01347"></a>01347                 uint32_t count = 0;
<a name="l01348"></a>01348 
<a name="l01349"></a>01349                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a82d1442a90546f275feeeda876c2f879">vol_accessible_by_ag</a>(p, ag, &amp;vols, &amp;count,
<a name="l01350"></a>01350                                                       <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>
<a name="l01351"></a>01351                                                       (params));
<a name="l01352"></a>01352 
<a name="l01353"></a>01353                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01354"></a>01354                     std::vector &lt; Value &gt; result;
<a name="l01355"></a>01355                     result.reserve(count);
<a name="l01356"></a>01356 
<a name="l01357"></a>01357                     <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {
<a name="l01358"></a>01358                         result.push_back(<a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(vols[i]));
<a name="l01359"></a>01359                     }
<a name="l01360"></a>01360                     response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l01361"></a>01361                 }
<a name="l01362"></a>01362 
<a name="l01363"></a>01363                 <a class="code" href="lsm__plugin__ipc_8cpp.html#a7348be40f25136d7717c7154e1ea0eef">lsm_access_group_record_free</a>(ag);
<a name="l01364"></a>01364                 <a class="code" href="libstoragemgmt__volumes_8h.html#a5e6b658933de208b14ba9a8121ba7e0c">lsm_volume_record_array_free</a>(vols, count);
<a name="l01365"></a>01365                 vols = NULL;
<a name="l01366"></a>01366             } <span class="keywordflow">else</span> {
<a name="l01367"></a>01367                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01368"></a>01368             }
<a name="l01369"></a>01369 
<a name="l01370"></a>01370         } <span class="keywordflow">else</span> {
<a name="l01371"></a>01371             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01372"></a>01372         }
<a name="l01373"></a>01373     }
<a name="l01374"></a>01374     <span class="keywordflow">return</span> rc;
<a name="l01375"></a>01375 }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377 <span class="keyword">static</span> <span class="keywordtype">int</span> ag_granted_to_volume(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l01378"></a>01378                                 <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01379"></a>01379 {
<a name="l01380"></a>01380     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01381"></a>01381 
<a name="l01382"></a>01382     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a54a2ce24d0f11f8b2fbdda0807c89e7b">ag_granted_to_vol</a>) {
<a name="l01383"></a>01383 
<a name="l01384"></a>01384         <a class="code" href="class_value.html">Value</a> v_vol = params[<span class="stringliteral">&quot;volume&quot;</span>];
<a name="l01385"></a>01385 
<a name="l01386"></a>01386         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01387"></a>01387             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *volume = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol);
<a name="l01388"></a>01388 
<a name="l01389"></a>01389             <span class="keywordflow">if</span> (volume) {
<a name="l01390"></a>01390                 <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> **groups = NULL;
<a name="l01391"></a>01391                 uint32_t count = 0;
<a name="l01392"></a>01392 
<a name="l01393"></a>01393                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a54a2ce24d0f11f8b2fbdda0807c89e7b">ag_granted_to_vol</a>(p, volume, &amp;groups,
<a name="l01394"></a>01394                                                    &amp;count,
<a name="l01395"></a>01395                                                    <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01396"></a>01396 
<a name="l01397"></a>01397                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01398"></a>01398                     std::vector &lt; Value &gt; result;
<a name="l01399"></a>01399                     result.reserve(count);
<a name="l01400"></a>01400 
<a name="l01401"></a>01401                     <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {
<a name="l01402"></a>01402                         result.push_back(<a class="code" href="lsm__convert_8cpp.html#afa1785eed2f2c143e36f29c212a0857e">access_group_to_value</a>(groups[i]));
<a name="l01403"></a>01403                     }
<a name="l01404"></a>01404                     response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l01405"></a>01405                 }
<a name="l01406"></a>01406 
<a name="l01407"></a>01407                 <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(volume);
<a name="l01408"></a>01408                 <a class="code" href="libstoragemgmt__accessgroups_8h.html#ad593cb660a6fc96fd90b70d9eb3bcb7d">lsm_access_group_record_array_free</a>(groups, count);
<a name="l01409"></a>01409                 groups = NULL;
<a name="l01410"></a>01410             } <span class="keywordflow">else</span> {
<a name="l01411"></a>01411                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01412"></a>01412             }
<a name="l01413"></a>01413         } <span class="keywordflow">else</span> {
<a name="l01414"></a>01414             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01415"></a>01415         }
<a name="l01416"></a>01416     }
<a name="l01417"></a>01417     <span class="keywordflow">return</span> rc;
<a name="l01418"></a>01418 }
<a name="l01419"></a>01419 
<a name="l01420"></a>01420 <span class="keyword">static</span> <span class="keywordtype">int</span> volume_dependency(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01421"></a>01421 {
<a name="l01422"></a>01422     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01423"></a>01423 
<a name="l01424"></a>01424     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ac933d9eca23031d6ee2304306788ba45">vol_child_depends</a>) {
<a name="l01425"></a>01425 
<a name="l01426"></a>01426         <a class="code" href="class_value.html">Value</a> v_vol = params[<span class="stringliteral">&quot;volume&quot;</span>];
<a name="l01427"></a>01427 
<a name="l01428"></a>01428         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01429"></a>01429             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *volume = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol);
<a name="l01430"></a>01430 
<a name="l01431"></a>01431             <span class="keywordflow">if</span> (volume) {
<a name="l01432"></a>01432                 uint8_t yes;
<a name="l01433"></a>01433 
<a name="l01434"></a>01434                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#ac933d9eca23031d6ee2304306788ba45">vol_child_depends</a>(p, volume, &amp;yes,
<a name="l01435"></a>01435                                                    <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01436"></a>01436 
<a name="l01437"></a>01437                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01438"></a>01438                     response = <a class="code" href="class_value.html">Value</a>((<span class="keywordtype">bool</span>) (yes));
<a name="l01439"></a>01439                 }
<a name="l01440"></a>01440 
<a name="l01441"></a>01441                 <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(volume);
<a name="l01442"></a>01442             } <span class="keywordflow">else</span> {
<a name="l01443"></a>01443                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01444"></a>01444             }
<a name="l01445"></a>01445 
<a name="l01446"></a>01446         } <span class="keywordflow">else</span> {
<a name="l01447"></a>01447             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01448"></a>01448         }
<a name="l01449"></a>01449     }
<a name="l01450"></a>01450 
<a name="l01451"></a>01451     <span class="keywordflow">return</span> rc;
<a name="l01452"></a>01452 }
<a name="l01453"></a>01453 
<a name="l01454"></a>01454 <span class="keyword">static</span> <span class="keywordtype">int</span> volume_dependency_rm(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l01455"></a>01455                                 <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01456"></a>01456 {
<a name="l01457"></a>01457     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01458"></a>01458 
<a name="l01459"></a>01459     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a38ea3885d99b0c37d1c2dff116b11993">vol_child_depends_rm</a>) {
<a name="l01460"></a>01460 
<a name="l01461"></a>01461         <a class="code" href="class_value.html">Value</a> v_vol = params[<span class="stringliteral">&quot;volume&quot;</span>];
<a name="l01462"></a>01462 
<a name="l01463"></a>01463         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a88245382c0717c9402429d524b773ebb">IS_CLASS_VOLUME</a>(v_vol) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01464"></a>01464             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *volume = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(v_vol);
<a name="l01465"></a>01465 
<a name="l01466"></a>01466             <span class="keywordflow">if</span> (volume) {
<a name="l01467"></a>01467 
<a name="l01468"></a>01468                 <span class="keywordtype">char</span> *job = NULL;
<a name="l01469"></a>01469 
<a name="l01470"></a>01470                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#a38ea3885d99b0c37d1c2dff116b11993">vol_child_depends_rm</a>(p, volume, &amp;job,
<a name="l01471"></a>01471                                                       <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>
<a name="l01472"></a>01472                                                       (params));
<a name="l01473"></a>01473 
<a name="l01474"></a>01474                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l01475"></a>01475                     response = <a class="code" href="class_value.html">Value</a>(job);
<a name="l01476"></a>01476                     free(job);
<a name="l01477"></a>01477                 }
<a name="l01478"></a>01478                 <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(volume);
<a name="l01479"></a>01479 
<a name="l01480"></a>01480             } <span class="keywordflow">else</span> {
<a name="l01481"></a>01481                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01482"></a>01482             }
<a name="l01483"></a>01483 
<a name="l01484"></a>01484         } <span class="keywordflow">else</span> {
<a name="l01485"></a>01485             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01486"></a>01486         }
<a name="l01487"></a>01487     }
<a name="l01488"></a>01488     <span class="keywordflow">return</span> rc;
<a name="l01489"></a>01489 }
<a name="l01490"></a>01490 
<a name="l01491"></a>01491 <span class="keyword">static</span> <span class="keywordtype">int</span> fs(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01492"></a>01492 {
<a name="l01493"></a>01493     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01494"></a>01494     <span class="keywordtype">char</span> *key = NULL;
<a name="l01495"></a>01495     <span class="keywordtype">char</span> *val = NULL;
<a name="l01496"></a>01496 
<a name="l01497"></a>01497     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a67eb63138899364bf58926aeb16e7d13">fs_list</a>) {
<a name="l01498"></a>01498         <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params) &amp;&amp;
<a name="l01499"></a>01499             ((rc = get_search_params(params, &amp;key, &amp;val)) == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>)) {
<a name="l01500"></a>01500 
<a name="l01501"></a>01501             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> **fs = NULL;
<a name="l01502"></a>01502             uint32_t count = 0;
<a name="l01503"></a>01503 
<a name="l01504"></a>01504             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a67eb63138899364bf58926aeb16e7d13">fs_list</a>(p, key, val, &amp;fs, &amp;count,
<a name="l01505"></a>01505                                     <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01506"></a>01506 
<a name="l01507"></a>01507             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01508"></a>01508                 std::vector &lt; Value &gt; result;
<a name="l01509"></a>01509                 result.reserve(count);
<a name="l01510"></a>01510 
<a name="l01511"></a>01511                 <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {
<a name="l01512"></a>01512                     result.push_back(<a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(fs[i]));
<a name="l01513"></a>01513                 }
<a name="l01514"></a>01514 
<a name="l01515"></a>01515                 response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l01516"></a>01516                 <a class="code" href="libstoragemgmt__fs_8h.html#a19848dbe7cffdacbcb837c4309650ce4">lsm_fs_record_array_free</a>(fs, count);
<a name="l01517"></a>01517                 fs = NULL;
<a name="l01518"></a>01518             }
<a name="l01519"></a>01519             free(key);
<a name="l01520"></a>01520             free(val);
<a name="l01521"></a>01521         } <span class="keywordflow">else</span> {
<a name="l01522"></a>01522             <span class="keywordflow">if</span> (rc == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>) {
<a name="l01523"></a>01523                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01524"></a>01524             }
<a name="l01525"></a>01525         }
<a name="l01526"></a>01526     }
<a name="l01527"></a>01527     <span class="keywordflow">return</span> rc;
<a name="l01528"></a>01528 }
<a name="l01529"></a>01529 
<a name="l01530"></a>01530 <span class="keyword">static</span> <span class="keywordtype">int</span> fs_create(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01531"></a>01531 {
<a name="l01532"></a>01532     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01533"></a>01533 
<a name="l01534"></a>01534     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a71a81dc1e41f102d727e32055b8fdb87">fs_create</a>) {
<a name="l01535"></a>01535 
<a name="l01536"></a>01536         <a class="code" href="class_value.html">Value</a> v_pool = params[<span class="stringliteral">&quot;pool&quot;</span>];
<a name="l01537"></a>01537         <a class="code" href="class_value.html">Value</a> v_name = params[<span class="stringliteral">&quot;name&quot;</span>];
<a name="l01538"></a>01538         <a class="code" href="class_value.html">Value</a> v_size = params[<span class="stringliteral">&quot;size_bytes&quot;</span>];
<a name="l01539"></a>01539 
<a name="l01540"></a>01540         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#afc5f34019a300fa0568bbea7c7a55dd7">IS_CLASS_POOL</a>(v_pool) &amp;&amp;
<a name="l01541"></a>01541             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_name.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01542"></a>01542             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_size.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01543"></a>01543             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01544"></a>01544 
<a name="l01545"></a>01545             <a class="code" href="struct__lsm__pool.html">lsm_pool</a> *pool = <a class="code" href="lsm__convert_8cpp.html#a23825482fa20087834eed9d5e737fd2c">value_to_pool</a>(v_pool);
<a name="l01546"></a>01546 
<a name="l01547"></a>01547             <span class="keywordflow">if</span> (pool) {
<a name="l01548"></a>01548                 <span class="keyword">const</span> <span class="keywordtype">char</span> *name = params[<span class="stringliteral">&quot;name&quot;</span>].<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l01549"></a>01549                 uint64_t size_bytes = params[<span class="stringliteral">&quot;size_bytes&quot;</span>].<a class="code" href="class_value.html#a6328e2190360933473e89e8a1b1d6d0f">asUint64_t</a>();
<a name="l01550"></a>01550                 <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *fs = NULL;
<a name="l01551"></a>01551                 <span class="keywordtype">char</span> *job = NULL;
<a name="l01552"></a>01552 
<a name="l01553"></a>01553                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a71a81dc1e41f102d727e32055b8fdb87">fs_create</a>(p, pool, name, size_bytes, &amp;fs,
<a name="l01554"></a>01554                                           &amp;job, <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01555"></a>01555 
<a name="l01556"></a>01556                 std::vector &lt; Value &gt; r;
<a name="l01557"></a>01557 
<a name="l01558"></a>01558                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01559"></a>01559                     r.push_back(<a class="code" href="class_value.html">Value</a>());
<a name="l01560"></a>01560                     r.push_back(<a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(fs));
<a name="l01561"></a>01561                     response = <a class="code" href="class_value.html">Value</a>(r);
<a name="l01562"></a>01562                     <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(fs);
<a name="l01563"></a>01563                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l01564"></a>01564                     r.push_back(<a class="code" href="class_value.html">Value</a>(job));
<a name="l01565"></a>01565                     r.push_back(<a class="code" href="class_value.html">Value</a>());
<a name="l01566"></a>01566                     response = <a class="code" href="class_value.html">Value</a>(r);
<a name="l01567"></a>01567                     free(job);
<a name="l01568"></a>01568                 }
<a name="l01569"></a>01569                 <a class="code" href="libstoragemgmt__pool_8h.html#a44d50c6c387a0269fc494e94a831064b">lsm_pool_record_free</a>(pool);
<a name="l01570"></a>01570 
<a name="l01571"></a>01571             } <span class="keywordflow">else</span> {
<a name="l01572"></a>01572                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01573"></a>01573             }
<a name="l01574"></a>01574 
<a name="l01575"></a>01575         } <span class="keywordflow">else</span> {
<a name="l01576"></a>01576             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01577"></a>01577         }
<a name="l01578"></a>01578     }
<a name="l01579"></a>01579     <span class="keywordflow">return</span> rc;
<a name="l01580"></a>01580 }
<a name="l01581"></a>01581 
<a name="l01582"></a>01582 <span class="keyword">static</span> <span class="keywordtype">int</span> fs_delete(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01583"></a>01583 {
<a name="l01584"></a>01584     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01585"></a>01585 
<a name="l01586"></a>01586     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a890fde032f354e5c80e9bffbcf9b97b1">fs_delete</a>) {
<a name="l01587"></a>01587 
<a name="l01588"></a>01588         <a class="code" href="class_value.html">Value</a> v_fs = params[<span class="stringliteral">&quot;fs&quot;</span>];
<a name="l01589"></a>01589 
<a name="l01590"></a>01590         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a440e5a305bc48a7201b558144f7ef81c">IS_CLASS_FILE_SYSTEM</a>(v_fs) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01591"></a>01591 
<a name="l01592"></a>01592             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *fs = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(v_fs);
<a name="l01593"></a>01593 
<a name="l01594"></a>01594             <span class="keywordflow">if</span> (fs) {
<a name="l01595"></a>01595                 <span class="keywordtype">char</span> *job = NULL;
<a name="l01596"></a>01596 
<a name="l01597"></a>01597                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a890fde032f354e5c80e9bffbcf9b97b1">fs_delete</a>(p, fs, &amp;job,
<a name="l01598"></a>01598                                           <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01599"></a>01599 
<a name="l01600"></a>01600                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l01601"></a>01601                     response = <a class="code" href="class_value.html">Value</a>(job);
<a name="l01602"></a>01602                     free(job);
<a name="l01603"></a>01603                 }
<a name="l01604"></a>01604                 <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(fs);
<a name="l01605"></a>01605             } <span class="keywordflow">else</span> {
<a name="l01606"></a>01606                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01607"></a>01607             }
<a name="l01608"></a>01608 
<a name="l01609"></a>01609         } <span class="keywordflow">else</span> {
<a name="l01610"></a>01610             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01611"></a>01611         }
<a name="l01612"></a>01612     }
<a name="l01613"></a>01613     <span class="keywordflow">return</span> rc;
<a name="l01614"></a>01614 }
<a name="l01615"></a>01615 
<a name="l01616"></a>01616 <span class="keyword">static</span> <span class="keywordtype">int</span> fs_resize(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01617"></a>01617 {
<a name="l01618"></a>01618     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01619"></a>01619 
<a name="l01620"></a>01620     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#aaf535c5aed8d65b5264184dcd55ee586">fs_resize</a>) {
<a name="l01621"></a>01621 
<a name="l01622"></a>01622         <a class="code" href="class_value.html">Value</a> v_fs = params[<span class="stringliteral">&quot;fs&quot;</span>];
<a name="l01623"></a>01623         <a class="code" href="class_value.html">Value</a> v_size = params[<span class="stringliteral">&quot;new_size_bytes&quot;</span>];
<a name="l01624"></a>01624 
<a name="l01625"></a>01625         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a440e5a305bc48a7201b558144f7ef81c">IS_CLASS_FILE_SYSTEM</a>(v_fs) &amp;&amp;
<a name="l01626"></a>01626             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_size.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01627"></a>01627             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01628"></a>01628 
<a name="l01629"></a>01629             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *fs = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(v_fs);
<a name="l01630"></a>01630 
<a name="l01631"></a>01631             <span class="keywordflow">if</span> (fs) {
<a name="l01632"></a>01632                 uint64_t size_bytes = v_size.<a class="code" href="class_value.html#a6328e2190360933473e89e8a1b1d6d0f">asUint64_t</a>();
<a name="l01633"></a>01633                 <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *rfs = NULL;
<a name="l01634"></a>01634                 <span class="keywordtype">char</span> *job = NULL;
<a name="l01635"></a>01635 
<a name="l01636"></a>01636                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#aaf535c5aed8d65b5264184dcd55ee586">fs_resize</a>(p, fs, size_bytes, &amp;rfs, &amp;job,
<a name="l01637"></a>01637                                           <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01638"></a>01638 
<a name="l01639"></a>01639                 std::vector &lt; Value &gt; r;
<a name="l01640"></a>01640 
<a name="l01641"></a>01641                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01642"></a>01642                     r.push_back(<a class="code" href="class_value.html">Value</a>());
<a name="l01643"></a>01643                     r.push_back(<a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(rfs));
<a name="l01644"></a>01644                     response = <a class="code" href="class_value.html">Value</a>(r);
<a name="l01645"></a>01645                     <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(rfs);
<a name="l01646"></a>01646                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l01647"></a>01647                     r.push_back(<a class="code" href="class_value.html">Value</a>(job));
<a name="l01648"></a>01648                     r.push_back(<a class="code" href="class_value.html">Value</a>());
<a name="l01649"></a>01649                     response = <a class="code" href="class_value.html">Value</a>(r);
<a name="l01650"></a>01650                     free(job);
<a name="l01651"></a>01651                 }
<a name="l01652"></a>01652                 <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(fs);
<a name="l01653"></a>01653             } <span class="keywordflow">else</span> {
<a name="l01654"></a>01654                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01655"></a>01655             }
<a name="l01656"></a>01656 
<a name="l01657"></a>01657         } <span class="keywordflow">else</span> {
<a name="l01658"></a>01658             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01659"></a>01659         }
<a name="l01660"></a>01660     }
<a name="l01661"></a>01661     <span class="keywordflow">return</span> rc;
<a name="l01662"></a>01662 }
<a name="l01663"></a>01663 
<a name="l01664"></a>01664 <span class="keyword">static</span> <span class="keywordtype">int</span> fs_clone(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01665"></a>01665 {
<a name="l01666"></a>01666     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01667"></a>01667 
<a name="l01668"></a>01668     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#abcb3b3870e3b9c139e2b96f478b98410">fs_clone</a>) {
<a name="l01669"></a>01669 
<a name="l01670"></a>01670         <a class="code" href="class_value.html">Value</a> v_src_fs = params[<span class="stringliteral">&quot;src_fs&quot;</span>];
<a name="l01671"></a>01671         <a class="code" href="class_value.html">Value</a> v_name = params[<span class="stringliteral">&quot;dest_fs_name&quot;</span>];
<a name="l01672"></a>01672         <a class="code" href="class_value.html">Value</a> v_ss = params[<span class="stringliteral">&quot;snapshot&quot;</span>];    <span class="comment">/* This is optional */</span>
<a name="l01673"></a>01673 
<a name="l01674"></a>01674         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a440e5a305bc48a7201b558144f7ef81c">IS_CLASS_FILE_SYSTEM</a>(v_src_fs) &amp;&amp;
<a name="l01675"></a>01675             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_name.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01676"></a>01676             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_ss.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l01677"></a>01677              <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == v_ss.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l01678"></a>01678             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01679"></a>01679 
<a name="l01680"></a>01680             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *clonedFs = NULL;
<a name="l01681"></a>01681             <span class="keywordtype">char</span> *job = NULL;
<a name="l01682"></a>01682             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *fs = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(v_src_fs);
<a name="l01683"></a>01683             <span class="keyword">const</span> <span class="keywordtype">char</span> *name = v_name.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l01684"></a>01684             <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> *ss = (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_ss.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>())?
<a name="l01685"></a>01685                 NULL : <a class="code" href="lsm__convert_8cpp.html#a6018acc6f5e2ae46dfa37a94f17b347b">value_to_ss</a>(v_ss);
<a name="l01686"></a>01686 
<a name="l01687"></a>01687             <span class="keywordflow">if</span> (fs &amp;&amp;
<a name="l01688"></a>01688                 ((ss &amp;&amp; v_ss.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() == <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a>) ||
<a name="l01689"></a>01689                  (!ss &amp;&amp; v_ss.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() == <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a>))) {
<a name="l01690"></a>01690 
<a name="l01691"></a>01691                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#abcb3b3870e3b9c139e2b96f478b98410">fs_clone</a>(p, fs, name, &amp;clonedFs, ss, &amp;job,
<a name="l01692"></a>01692                                          <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01693"></a>01693 
<a name="l01694"></a>01694                 std::vector &lt; Value &gt; r;
<a name="l01695"></a>01695                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01696"></a>01696                     r.push_back(<a class="code" href="class_value.html">Value</a>());
<a name="l01697"></a>01697                     r.push_back(<a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(clonedFs));
<a name="l01698"></a>01698                     response = <a class="code" href="class_value.html">Value</a>(r);
<a name="l01699"></a>01699                     <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(clonedFs);
<a name="l01700"></a>01700                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l01701"></a>01701                     r.push_back(<a class="code" href="class_value.html">Value</a>(job));
<a name="l01702"></a>01702                     r.push_back(<a class="code" href="class_value.html">Value</a>());
<a name="l01703"></a>01703                     response = <a class="code" href="class_value.html">Value</a>(r);
<a name="l01704"></a>01704                     free(job);
<a name="l01705"></a>01705                 }
<a name="l01706"></a>01706 
<a name="l01707"></a>01707             } <span class="keywordflow">else</span> {
<a name="l01708"></a>01708                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01709"></a>01709             }
<a name="l01710"></a>01710 
<a name="l01711"></a>01711             <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(fs);
<a name="l01712"></a>01712             <a class="code" href="libstoragemgmt__snapshot_8h.html#a1bb48837b2b2c5f1754d81f88f7fe50b">lsm_fs_ss_record_free</a>(ss);
<a name="l01713"></a>01713 
<a name="l01714"></a>01714         } <span class="keywordflow">else</span> {
<a name="l01715"></a>01715             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01716"></a>01716         }
<a name="l01717"></a>01717     }
<a name="l01718"></a>01718     <span class="keywordflow">return</span> rc;
<a name="l01719"></a>01719 }
<a name="l01720"></a>01720 
<a name="l01721"></a>01721 <span class="keyword">static</span> <span class="keywordtype">int</span> fs_file_clone(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01722"></a>01722 {
<a name="l01723"></a>01723     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l01724"></a>01724 
<a name="l01725"></a>01725     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a107caff52fc835f7e1c93ef45316c2cc">fs_file_clone</a>) {
<a name="l01726"></a>01726 
<a name="l01727"></a>01727         <a class="code" href="class_value.html">Value</a> v_fs = params[<span class="stringliteral">&quot;fs&quot;</span>];
<a name="l01728"></a>01728         <a class="code" href="class_value.html">Value</a> v_src_name = params[<span class="stringliteral">&quot;src_file_name&quot;</span>];
<a name="l01729"></a>01729         <a class="code" href="class_value.html">Value</a> v_dest_name = params[<span class="stringliteral">&quot;dest_file_name&quot;</span>];
<a name="l01730"></a>01730         <a class="code" href="class_value.html">Value</a> v_ss = params[<span class="stringliteral">&quot;snapshot&quot;</span>];    <span class="comment">/* This is optional */</span>
<a name="l01731"></a>01731 
<a name="l01732"></a>01732         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a440e5a305bc48a7201b558144f7ef81c">IS_CLASS_FILE_SYSTEM</a>(v_fs) &amp;&amp;
<a name="l01733"></a>01733             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_src_name.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01734"></a>01734             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_dest_name.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01735"></a>01735             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_ss.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l01736"></a>01736              <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == v_ss.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l01737"></a>01737             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01738"></a>01738 
<a name="l01739"></a>01739 
<a name="l01740"></a>01740             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *fs = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(v_fs);
<a name="l01741"></a>01741             <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> *ss = (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_ss.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>())?
<a name="l01742"></a>01742                 NULL : <a class="code" href="lsm__convert_8cpp.html#a6018acc6f5e2ae46dfa37a94f17b347b">value_to_ss</a>(v_ss);
<a name="l01743"></a>01743 
<a name="l01744"></a>01744             <span class="keywordflow">if</span> (fs &amp;&amp;
<a name="l01745"></a>01745                 ((ss &amp;&amp; v_ss.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() == <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a>) ||
<a name="l01746"></a>01746                  (!ss &amp;&amp; v_ss.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() == <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a>))) {
<a name="l01747"></a>01747 
<a name="l01748"></a>01748                 <span class="keyword">const</span> <span class="keywordtype">char</span> *src = v_src_name.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l01749"></a>01749                 <span class="keyword">const</span> <span class="keywordtype">char</span> *dest = v_dest_name.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l01750"></a>01750 
<a name="l01751"></a>01751                 <span class="keywordtype">char</span> *job = NULL;
<a name="l01752"></a>01752 
<a name="l01753"></a>01753                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a107caff52fc835f7e1c93ef45316c2cc">fs_file_clone</a>(p, fs, src, dest, ss, &amp;job,
<a name="l01754"></a>01754                                               <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01755"></a>01755 
<a name="l01756"></a>01756                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l01757"></a>01757                     response = <a class="code" href="class_value.html">Value</a>(job);
<a name="l01758"></a>01758                     free(job);
<a name="l01759"></a>01759                 }
<a name="l01760"></a>01760 
<a name="l01761"></a>01761             } <span class="keywordflow">else</span> {
<a name="l01762"></a>01762                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01763"></a>01763             }
<a name="l01764"></a>01764 
<a name="l01765"></a>01765             <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(fs);
<a name="l01766"></a>01766             <a class="code" href="libstoragemgmt__snapshot_8h.html#a1bb48837b2b2c5f1754d81f88f7fe50b">lsm_fs_ss_record_free</a>(ss);
<a name="l01767"></a>01767 
<a name="l01768"></a>01768         } <span class="keywordflow">else</span> {
<a name="l01769"></a>01769             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01770"></a>01770         }
<a name="l01771"></a>01771     }
<a name="l01772"></a>01772     <span class="keywordflow">return</span> rc;
<a name="l01773"></a>01773 }
<a name="l01774"></a>01774 
<a name="l01775"></a>01775 <span class="keyword">static</span> <span class="keywordtype">int</span> fs_child_dependency(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l01776"></a>01776                                <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01777"></a>01777 {
<a name="l01778"></a>01778     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01779"></a>01779     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a4c691f6bb884489360eeb4c11a8651c7">fs_child_dependency</a>) {
<a name="l01780"></a>01780 
<a name="l01781"></a>01781         <a class="code" href="class_value.html">Value</a> v_fs = params[<span class="stringliteral">&quot;fs&quot;</span>];
<a name="l01782"></a>01782         <a class="code" href="class_value.html">Value</a> v_files = params[<span class="stringliteral">&quot;files&quot;</span>];
<a name="l01783"></a>01783 
<a name="l01784"></a>01784         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a440e5a305bc48a7201b558144f7ef81c">IS_CLASS_FILE_SYSTEM</a>(v_fs) &amp;&amp;
<a name="l01785"></a>01785             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l01786"></a>01786              <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l01787"></a>01787             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01788"></a>01788 
<a name="l01789"></a>01789             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *fs = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(v_fs);
<a name="l01790"></a>01790             <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> *files =
<a name="l01791"></a>01791                 (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> ==
<a name="l01792"></a>01792                  v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>())? NULL : <a class="code" href="lsm__convert_8cpp.html#ab5eeee745fbaa40daddfa60c77567d18">value_to_string_list</a>(v_files);
<a name="l01793"></a>01793 
<a name="l01794"></a>01794             <span class="keywordflow">if</span> (fs &amp;&amp; (files ||
<a name="l01795"></a>01795                        (!files &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()))) {
<a name="l01796"></a>01796                 uint8_t yes = 0;
<a name="l01797"></a>01797 
<a name="l01798"></a>01798                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a4c691f6bb884489360eeb4c11a8651c7">fs_child_dependency</a>(p, fs, files, &amp;yes);
<a name="l01799"></a>01799 
<a name="l01800"></a>01800                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01801"></a>01801                     response = <a class="code" href="class_value.html">Value</a>((<span class="keywordtype">bool</span>) yes);
<a name="l01802"></a>01802                 }
<a name="l01803"></a>01803             } <span class="keywordflow">else</span> {
<a name="l01804"></a>01804                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01805"></a>01805             }
<a name="l01806"></a>01806 
<a name="l01807"></a>01807             <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(fs);
<a name="l01808"></a>01808             <a class="code" href="libstoragemgmt__common_8h.html#a0042977fcc59a5907892dcd5e907b891">lsm_string_list_free</a>(files);
<a name="l01809"></a>01809 
<a name="l01810"></a>01810         } <span class="keywordflow">else</span> {
<a name="l01811"></a>01811             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01812"></a>01812         }
<a name="l01813"></a>01813     }
<a name="l01814"></a>01814     <span class="keywordflow">return</span> rc;
<a name="l01815"></a>01815 }
<a name="l01816"></a>01816 
<a name="l01817"></a>01817 <span class="keyword">static</span> <span class="keywordtype">int</span> fs_child_dependency_rm(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l01818"></a>01818                                   <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01819"></a>01819 {
<a name="l01820"></a>01820     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01821"></a>01821     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a7c7b336eab618876b4d920324da0e7c6">fs_child_dependency_rm</a>) {
<a name="l01822"></a>01822 
<a name="l01823"></a>01823         <a class="code" href="class_value.html">Value</a> v_fs = params[<span class="stringliteral">&quot;fs&quot;</span>];
<a name="l01824"></a>01824         <a class="code" href="class_value.html">Value</a> v_files = params[<span class="stringliteral">&quot;files&quot;</span>];
<a name="l01825"></a>01825 
<a name="l01826"></a>01826         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a440e5a305bc48a7201b558144f7ef81c">IS_CLASS_FILE_SYSTEM</a>(v_fs) &amp;&amp;
<a name="l01827"></a>01827             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l01828"></a>01828              <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l01829"></a>01829             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01830"></a>01830 
<a name="l01831"></a>01831             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *fs = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(v_fs);
<a name="l01832"></a>01832             <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> *files =
<a name="l01833"></a>01833                 (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> ==
<a name="l01834"></a>01834                  v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>())? NULL : <a class="code" href="lsm__convert_8cpp.html#ab5eeee745fbaa40daddfa60c77567d18">value_to_string_list</a>(v_files);
<a name="l01835"></a>01835 
<a name="l01836"></a>01836             <span class="keywordflow">if</span> (fs &amp;&amp;
<a name="l01837"></a>01837                 (files || (!files &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()))) {
<a name="l01838"></a>01838                 <span class="keywordtype">char</span> *job = NULL;
<a name="l01839"></a>01839 
<a name="l01840"></a>01840                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a7c7b336eab618876b4d920324da0e7c6">fs_child_dependency_rm</a>(p, fs, files, &amp;job,
<a name="l01841"></a>01841                                                        <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>
<a name="l01842"></a>01842                                                        (params));
<a name="l01843"></a>01843 
<a name="l01844"></a>01844                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l01845"></a>01845                     response = <a class="code" href="class_value.html">Value</a>(job);
<a name="l01846"></a>01846                     free(job);
<a name="l01847"></a>01847                 }
<a name="l01848"></a>01848             } <span class="keywordflow">else</span> {
<a name="l01849"></a>01849                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01850"></a>01850             }
<a name="l01851"></a>01851 
<a name="l01852"></a>01852             <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(fs);
<a name="l01853"></a>01853             <a class="code" href="libstoragemgmt__common_8h.html#a0042977fcc59a5907892dcd5e907b891">lsm_string_list_free</a>(files);
<a name="l01854"></a>01854         } <span class="keywordflow">else</span> {
<a name="l01855"></a>01855             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01856"></a>01856         }
<a name="l01857"></a>01857     }
<a name="l01858"></a>01858     <span class="keywordflow">return</span> rc;
<a name="l01859"></a>01859 }
<a name="l01860"></a>01860 
<a name="l01861"></a>01861 <span class="keyword">static</span> <span class="keywordtype">int</span> ss_list(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01862"></a>01862 {
<a name="l01863"></a>01863     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01864"></a>01864     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a3821fc4642a8c7502878c109f14dd1d6">fs_ss_list</a>) {
<a name="l01865"></a>01865 
<a name="l01866"></a>01866         <a class="code" href="class_value.html">Value</a> v_fs = params[<span class="stringliteral">&quot;fs&quot;</span>];
<a name="l01867"></a>01867 
<a name="l01868"></a>01868         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a440e5a305bc48a7201b558144f7ef81c">IS_CLASS_FILE_SYSTEM</a>(v_fs) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01869"></a>01869 
<a name="l01870"></a>01870             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *fs = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(v_fs);
<a name="l01871"></a>01871 
<a name="l01872"></a>01872             <span class="keywordflow">if</span> (fs) {
<a name="l01873"></a>01873                 <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> **ss = NULL;
<a name="l01874"></a>01874                 uint32_t count = 0;
<a name="l01875"></a>01875 
<a name="l01876"></a>01876                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a3821fc4642a8c7502878c109f14dd1d6">fs_ss_list</a>(p, fs, &amp;ss, &amp;count,
<a name="l01877"></a>01877                                            <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01878"></a>01878 
<a name="l01879"></a>01879                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01880"></a>01880                     std::vector &lt; Value &gt; result;
<a name="l01881"></a>01881                     result.reserve(count);
<a name="l01882"></a>01882 
<a name="l01883"></a>01883                     <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {
<a name="l01884"></a>01884                         result.push_back(<a class="code" href="lsm__convert_8cpp.html#ac8379996cc9809a020beb41156e400e0">ss_to_value</a>(ss[i]));
<a name="l01885"></a>01885                     }
<a name="l01886"></a>01886                     response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l01887"></a>01887 
<a name="l01888"></a>01888                     <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(fs);
<a name="l01889"></a>01889                     fs = NULL;
<a name="l01890"></a>01890                     <a class="code" href="libstoragemgmt__snapshot_8h.html#acf3fd024c11e28186c1843aaf8f1b49e">lsm_fs_ss_record_array_free</a>(ss, count);
<a name="l01891"></a>01891                     ss = NULL;
<a name="l01892"></a>01892                 }
<a name="l01893"></a>01893             }
<a name="l01894"></a>01894 
<a name="l01895"></a>01895         } <span class="keywordflow">else</span> {
<a name="l01896"></a>01896             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01897"></a>01897         }
<a name="l01898"></a>01898     }
<a name="l01899"></a>01899     <span class="keywordflow">return</span> rc;
<a name="l01900"></a>01900 }
<a name="l01901"></a>01901 
<a name="l01902"></a>01902 <span class="keyword">static</span> <span class="keywordtype">int</span> ss_create(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01903"></a>01903 {
<a name="l01904"></a>01904     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01905"></a>01905     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a3d51977be6b22f928a740872d5a6f0a8">fs_ss_create</a>) {
<a name="l01906"></a>01906 
<a name="l01907"></a>01907         <a class="code" href="class_value.html">Value</a> v_fs = params[<span class="stringliteral">&quot;fs&quot;</span>];
<a name="l01908"></a>01908         <a class="code" href="class_value.html">Value</a> v_ss_name = params[<span class="stringliteral">&quot;snapshot_name&quot;</span>];
<a name="l01909"></a>01909 
<a name="l01910"></a>01910         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a440e5a305bc48a7201b558144f7ef81c">IS_CLASS_FILE_SYSTEM</a>(v_fs) &amp;&amp;
<a name="l01911"></a>01911             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_ss_name.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l01912"></a>01912             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01913"></a>01913             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *fs = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(v_fs);
<a name="l01914"></a>01914 
<a name="l01915"></a>01915             <span class="keywordflow">if</span> (fs) {
<a name="l01916"></a>01916                 <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> *ss = NULL;
<a name="l01917"></a>01917                 <span class="keywordtype">char</span> *job = NULL;
<a name="l01918"></a>01918 
<a name="l01919"></a>01919                 <span class="keyword">const</span> <span class="keywordtype">char</span> *name = v_ss_name.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l01920"></a>01920 
<a name="l01921"></a>01921                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a3d51977be6b22f928a740872d5a6f0a8">fs_ss_create</a>(p, fs, name, &amp;ss, &amp;job,
<a name="l01922"></a>01922                                              <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01923"></a>01923 
<a name="l01924"></a>01924                 std::vector &lt; Value &gt; r;
<a name="l01925"></a>01925                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01926"></a>01926                     r.push_back(<a class="code" href="class_value.html">Value</a>());
<a name="l01927"></a>01927                     r.push_back(<a class="code" href="lsm__convert_8cpp.html#ac8379996cc9809a020beb41156e400e0">ss_to_value</a>(ss));
<a name="l01928"></a>01928                     response = <a class="code" href="class_value.html">Value</a>(r);
<a name="l01929"></a>01929                     <a class="code" href="libstoragemgmt__snapshot_8h.html#a1bb48837b2b2c5f1754d81f88f7fe50b">lsm_fs_ss_record_free</a>(ss);
<a name="l01930"></a>01930                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l01931"></a>01931                     r.push_back(<a class="code" href="class_value.html">Value</a>(job));
<a name="l01932"></a>01932                     r.push_back(<a class="code" href="class_value.html">Value</a>());
<a name="l01933"></a>01933                     response = <a class="code" href="class_value.html">Value</a>(r);
<a name="l01934"></a>01934                     free(job);
<a name="l01935"></a>01935                 }
<a name="l01936"></a>01936 
<a name="l01937"></a>01937             } <span class="keywordflow">else</span> {
<a name="l01938"></a>01938                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01939"></a>01939             }
<a name="l01940"></a>01940 
<a name="l01941"></a>01941             <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(fs);
<a name="l01942"></a>01942 
<a name="l01943"></a>01943         } <span class="keywordflow">else</span> {
<a name="l01944"></a>01944             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01945"></a>01945         }
<a name="l01946"></a>01946     }
<a name="l01947"></a>01947     <span class="keywordflow">return</span> rc;
<a name="l01948"></a>01948 }
<a name="l01949"></a>01949 
<a name="l01950"></a>01950 <span class="keyword">static</span> <span class="keywordtype">int</span> ss_delete(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01951"></a>01951 {
<a name="l01952"></a>01952     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01953"></a>01953     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a3b3ca5c99de99ac938171a4071683a5d">fs_ss_delete</a>) {
<a name="l01954"></a>01954 
<a name="l01955"></a>01955         <a class="code" href="class_value.html">Value</a> v_fs = params[<span class="stringliteral">&quot;fs&quot;</span>];
<a name="l01956"></a>01956         <a class="code" href="class_value.html">Value</a> v_ss = params[<span class="stringliteral">&quot;snapshot&quot;</span>];
<a name="l01957"></a>01957 
<a name="l01958"></a>01958         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a440e5a305bc48a7201b558144f7ef81c">IS_CLASS_FILE_SYSTEM</a>(v_fs) &amp;&amp;
<a name="l01959"></a>01959             <a class="code" href="lsm__convert_8hpp.html#a69c350c0c68f212e42a711e648dc5f62">IS_CLASS_FS_SNAPSHOT</a>(v_ss) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l01960"></a>01960 
<a name="l01961"></a>01961             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *fs = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(v_fs);
<a name="l01962"></a>01962             <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> *ss = <a class="code" href="lsm__convert_8cpp.html#a6018acc6f5e2ae46dfa37a94f17b347b">value_to_ss</a>(v_ss);
<a name="l01963"></a>01963 
<a name="l01964"></a>01964             <span class="keywordflow">if</span> (fs &amp;&amp; ss) {
<a name="l01965"></a>01965                 <span class="keywordtype">char</span> *job = NULL;
<a name="l01966"></a>01966                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#a3b3ca5c99de99ac938171a4071683a5d">fs_ss_delete</a>(p, fs, ss, &amp;job,
<a name="l01967"></a>01967                                              <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l01968"></a>01968 
<a name="l01969"></a>01969                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l01970"></a>01970                     response = <a class="code" href="class_value.html">Value</a>(job);
<a name="l01971"></a>01971                     free(job);
<a name="l01972"></a>01972                 }
<a name="l01973"></a>01973             } <span class="keywordflow">else</span> {
<a name="l01974"></a>01974                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01975"></a>01975             }
<a name="l01976"></a>01976 
<a name="l01977"></a>01977             <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(fs);
<a name="l01978"></a>01978             <a class="code" href="libstoragemgmt__snapshot_8h.html#a1bb48837b2b2c5f1754d81f88f7fe50b">lsm_fs_ss_record_free</a>(ss);
<a name="l01979"></a>01979         } <span class="keywordflow">else</span> {
<a name="l01980"></a>01980             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l01981"></a>01981         }
<a name="l01982"></a>01982     }
<a name="l01983"></a>01983     <span class="keywordflow">return</span> rc;
<a name="l01984"></a>01984 }
<a name="l01985"></a>01985 
<a name="l01986"></a>01986 <span class="keyword">static</span> <span class="keywordtype">int</span> ss_restore(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l01987"></a>01987 {
<a name="l01988"></a>01988     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l01989"></a>01989     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#ac2bdfa959b814b9365427c89e04a22bc">fs_ss_restore</a>) {
<a name="l01990"></a>01990 
<a name="l01991"></a>01991         <a class="code" href="class_value.html">Value</a> v_fs = params[<span class="stringliteral">&quot;fs&quot;</span>];
<a name="l01992"></a>01992         <a class="code" href="class_value.html">Value</a> v_ss = params[<span class="stringliteral">&quot;snapshot&quot;</span>];
<a name="l01993"></a>01993         <a class="code" href="class_value.html">Value</a> v_files = params[<span class="stringliteral">&quot;files&quot;</span>];
<a name="l01994"></a>01994         <a class="code" href="class_value.html">Value</a> v_restore_files = params[<span class="stringliteral">&quot;restore_files&quot;</span>];
<a name="l01995"></a>01995         <a class="code" href="class_value.html">Value</a> v_all_files = params[<span class="stringliteral">&quot;all_files&quot;</span>];
<a name="l01996"></a>01996 
<a name="l01997"></a>01997         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a440e5a305bc48a7201b558144f7ef81c">IS_CLASS_FILE_SYSTEM</a>(v_fs) &amp;&amp;
<a name="l01998"></a>01998             <a class="code" href="lsm__convert_8hpp.html#a69c350c0c68f212e42a711e648dc5f62">IS_CLASS_FS_SNAPSHOT</a>(v_ss) &amp;&amp;
<a name="l01999"></a>01999             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l02000"></a>02000              <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l02001"></a>02001             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == v_restore_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l02002"></a>02002              <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_restore_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l02003"></a>02003             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a051aecdee02004abf05cfbe6f6b4780c">Value::boolean_t</a> == v_all_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02004"></a>02004             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l02005"></a>02005 
<a name="l02006"></a>02006             <span class="keywordtype">char</span> *job = NULL;
<a name="l02007"></a>02007             <a class="code" href="struct__lsm__fs.html">lsm_fs</a> *fs = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(v_fs);
<a name="l02008"></a>02008             <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> *ss = <a class="code" href="lsm__convert_8cpp.html#a6018acc6f5e2ae46dfa37a94f17b347b">value_to_ss</a>(v_ss);
<a name="l02009"></a>02009             <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> *files =
<a name="l02010"></a>02010                 (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> ==
<a name="l02011"></a>02011                  v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>())? NULL : <a class="code" href="lsm__convert_8cpp.html#ab5eeee745fbaa40daddfa60c77567d18">value_to_string_list</a>(v_files);
<a name="l02012"></a>02012             <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> *restore_files =
<a name="l02013"></a>02013                 (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> ==
<a name="l02014"></a>02014                  v_restore_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>())? NULL :
<a name="l02015"></a>02015                 <a class="code" href="lsm__convert_8cpp.html#ab5eeee745fbaa40daddfa60c77567d18">value_to_string_list</a>(v_restore_files);
<a name="l02016"></a>02016             <span class="keywordtype">int</span> all_files = (v_all_files.<a class="code" href="class_value.html#ac7d0a554ac8a2056d07ece69c01520f3">asBool</a>())? 1 : 0;
<a name="l02017"></a>02017 
<a name="l02018"></a>02018             <span class="keywordflow">if</span> (fs &amp;&amp; ss &amp;&amp;
<a name="l02019"></a>02019                 (files || (!files &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()))
<a name="l02020"></a>02020                 &amp;&amp; (restore_files
<a name="l02021"></a>02021                     || (!restore_files
<a name="l02022"></a>02022                         &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a201232df89f089d76fa8b6bf351c8d6d">Value::null_t</a> == v_restore_files.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()))) {
<a name="l02023"></a>02023                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae242a83455161517f6c86ed5d0134af4">fs_ops</a>-&gt;<a class="code" href="structlsm__fs__ops__v1.html#ac2bdfa959b814b9365427c89e04a22bc">fs_ss_restore</a>(p, fs, ss, files,
<a name="l02024"></a>02024                                               restore_files, all_files,
<a name="l02025"></a>02025                                               &amp;job, <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l02026"></a>02026 
<a name="l02027"></a>02027                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l02028"></a>02028                     response = <a class="code" href="class_value.html">Value</a>(job);
<a name="l02029"></a>02029                     free(job);
<a name="l02030"></a>02030                 }
<a name="l02031"></a>02031             } <span class="keywordflow">else</span> {
<a name="l02032"></a>02032                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l02033"></a>02033             }
<a name="l02034"></a>02034 
<a name="l02035"></a>02035             <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>(fs);
<a name="l02036"></a>02036             <a class="code" href="libstoragemgmt__snapshot_8h.html#a1bb48837b2b2c5f1754d81f88f7fe50b">lsm_fs_ss_record_free</a>(ss);
<a name="l02037"></a>02037             <a class="code" href="libstoragemgmt__common_8h.html#a0042977fcc59a5907892dcd5e907b891">lsm_string_list_free</a>(files);
<a name="l02038"></a>02038             <a class="code" href="libstoragemgmt__common_8h.html#a0042977fcc59a5907892dcd5e907b891">lsm_string_list_free</a>(restore_files);
<a name="l02039"></a>02039         } <span class="keywordflow">else</span> {
<a name="l02040"></a>02040             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l02041"></a>02041         }
<a name="l02042"></a>02042     }
<a name="l02043"></a>02043     <span class="keywordflow">return</span> rc;
<a name="l02044"></a>02044 }
<a name="l02045"></a>02045 
<a name="l02046"></a>02046 <span class="keyword">static</span> <span class="keywordtype">int</span> export_auth(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l02047"></a>02047 {
<a name="l02048"></a>02048     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l02049"></a>02049     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a>-&gt;<a class="code" href="structlsm__nas__ops__v1.html#a4bd7865c9736f1c922be9a4121d43648">nfs_auth_types</a>) {
<a name="l02050"></a>02050         <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> *types = NULL;
<a name="l02051"></a>02051 
<a name="l02052"></a>02052         <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l02053"></a>02053 
<a name="l02054"></a>02054             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a>-&gt;<a class="code" href="structlsm__nas__ops__v1.html#a4bd7865c9736f1c922be9a4121d43648">nfs_auth_types</a>(p, &amp;types,
<a name="l02055"></a>02055                                             <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l02056"></a>02056             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l02057"></a>02057                 response = <a class="code" href="lsm__convert_8cpp.html#ab12e4a58efa188d9b9ccbad5bf4a60a9">string_list_to_value</a>(types);
<a name="l02058"></a>02058                 <a class="code" href="libstoragemgmt__common_8h.html#a0042977fcc59a5907892dcd5e907b891">lsm_string_list_free</a>(types);
<a name="l02059"></a>02059             }
<a name="l02060"></a>02060         } <span class="keywordflow">else</span> {
<a name="l02061"></a>02061             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l02062"></a>02062         }
<a name="l02063"></a>02063 
<a name="l02064"></a>02064     }
<a name="l02065"></a>02065     <span class="keywordflow">return</span> rc;
<a name="l02066"></a>02066 }
<a name="l02067"></a>02067 
<a name="l02068"></a>02068 <span class="keyword">static</span> <span class="keywordtype">int</span> exports(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l02069"></a>02069 {
<a name="l02070"></a>02070     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l02071"></a>02071     <span class="keywordtype">char</span> *key = NULL;
<a name="l02072"></a>02072     <span class="keywordtype">char</span> *val = NULL;
<a name="l02073"></a>02073 
<a name="l02074"></a>02074     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a>-&gt;<a class="code" href="structlsm__nas__ops__v1.html#a702a9522e3bfc087765b53ca8ea3ff4f">nfs_list</a>) {
<a name="l02075"></a>02075         <a class="code" href="struct__lsm__nfs__export.html">lsm_nfs_export</a> **exports = NULL;
<a name="l02076"></a>02076         uint32_t count = 0;
<a name="l02077"></a>02077 
<a name="l02078"></a>02078         <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params) &amp;&amp;
<a name="l02079"></a>02079             (rc = get_search_params(params, &amp;key, &amp;val)) == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l02080"></a>02080             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a>-&gt;<a class="code" href="structlsm__nas__ops__v1.html#a702a9522e3bfc087765b53ca8ea3ff4f">nfs_list</a>(p, key, val, &amp;exports, &amp;count,
<a name="l02081"></a>02081                                       <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l02082"></a>02082 
<a name="l02083"></a>02083             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l02084"></a>02084                 std::vector &lt; Value &gt; result;
<a name="l02085"></a>02085                 result.reserve(count);
<a name="l02086"></a>02086 
<a name="l02087"></a>02087                 <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {
<a name="l02088"></a>02088                     result.push_back(<a class="code" href="lsm__convert_8cpp.html#aecf21606b00030de94f75103d312cba0">nfs_export_to_value</a>(exports[i]));
<a name="l02089"></a>02089                 }
<a name="l02090"></a>02090                 response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l02091"></a>02091 
<a name="l02092"></a>02092                 <a class="code" href="libstoragemgmt__nfsexport_8h.html#aa63b403191b76a3abc42f11383551c29">lsm_nfs_export_record_array_free</a>(exports, count);
<a name="l02093"></a>02093                 exports = NULL;
<a name="l02094"></a>02094                 count = 0;
<a name="l02095"></a>02095             }
<a name="l02096"></a>02096             free(key);
<a name="l02097"></a>02097             free(val);
<a name="l02098"></a>02098         } <span class="keywordflow">else</span> {
<a name="l02099"></a>02099             <span class="keywordflow">if</span> (rc == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>) {
<a name="l02100"></a>02100                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l02101"></a>02101             }
<a name="l02102"></a>02102         }
<a name="l02103"></a>02103     }
<a name="l02104"></a>02104 
<a name="l02105"></a>02105     <span class="keywordflow">return</span> rc;
<a name="l02106"></a>02106 }
<a name="l02107"></a>02107 
<a name="l02108"></a>02108 <span class="keyword">static</span> int64_t get_uid_gid(<a class="code" href="class_value.html">Value</a> &amp; <span class="keywordtype">id</span>)
<a name="l02109"></a>02109 {
<a name="l02110"></a>02110     <span class="keywordflow">if</span> (Value::null_t == <span class="keywordtype">id</span>.valueType()) {
<a name="l02111"></a>02111         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__nfsexport_8h.html#a5c0d5805ff921320c70556f90e6729bc">ANON_UID_GID_NA</a>;
<a name="l02112"></a>02112     } <span class="keywordflow">else</span> {
<a name="l02113"></a>02113         <span class="keywordflow">return</span> <span class="keywordtype">id</span>.asInt64_t();
<a name="l02114"></a>02114     }
<a name="l02115"></a>02115 }
<a name="l02116"></a>02116 
<a name="l02117"></a>02117 <span class="keyword">static</span> <span class="keywordtype">int</span> export_fs(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l02118"></a>02118 {
<a name="l02119"></a>02119     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l02120"></a>02120 
<a name="l02121"></a>02121     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a>-&gt;<a class="code" href="structlsm__nas__ops__v1.html#a9be843be87505235e97d8de4b93ae65a">nfs_export</a>) {
<a name="l02122"></a>02122 
<a name="l02123"></a>02123         <a class="code" href="class_value.html">Value</a> v_fs_id = params[<span class="stringliteral">&quot;fs_id&quot;</span>];
<a name="l02124"></a>02124         <a class="code" href="class_value.html">Value</a> v_export_path = params[<span class="stringliteral">&quot;export_path&quot;</span>];
<a name="l02125"></a>02125         <a class="code" href="class_value.html">Value</a> v_root_list = params[<span class="stringliteral">&quot;root_list&quot;</span>];
<a name="l02126"></a>02126         <a class="code" href="class_value.html">Value</a> v_rw_list = params[<span class="stringliteral">&quot;rw_list&quot;</span>];
<a name="l02127"></a>02127         <a class="code" href="class_value.html">Value</a> v_ro_list = params[<span class="stringliteral">&quot;ro_list&quot;</span>];
<a name="l02128"></a>02128         <a class="code" href="class_value.html">Value</a> v_auth_type = params[<span class="stringliteral">&quot;auth_type&quot;</span>];
<a name="l02129"></a>02129         <a class="code" href="class_value.html">Value</a> v_options = params[<span class="stringliteral">&quot;options&quot;</span>];
<a name="l02130"></a>02130         <a class="code" href="class_value.html">Value</a> v_anon_uid = params[<span class="stringliteral">&quot;anon_uid&quot;</span>];
<a name="l02131"></a>02131         <a class="code" href="class_value.html">Value</a> v_anon_gid = params[<span class="stringliteral">&quot;anon_gid&quot;</span>];
<a name="l02132"></a>02132 
<a name="l02133"></a>02133         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_fs_id.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02134"></a>02134             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_export_path.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l02135"></a>02135              Value::null_t == v_export_path.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l02136"></a>02136             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == v_root_list.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02137"></a>02137             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == v_rw_list.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02138"></a>02138             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == v_ro_list.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02139"></a>02139             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_auth_type.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l02140"></a>02140              Value::null_t == v_auth_type.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l02141"></a>02141             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_options.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l02142"></a>02142              Value::null_t == v_options.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l02143"></a>02143             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_anon_uid.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02144"></a>02144             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_anon_gid.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02145"></a>02145             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l02146"></a>02146 
<a name="l02147"></a>02147             <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> *root_list = <a class="code" href="lsm__convert_8cpp.html#ab5eeee745fbaa40daddfa60c77567d18">value_to_string_list</a>(v_root_list);
<a name="l02148"></a>02148             <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> *rw_list = <a class="code" href="lsm__convert_8cpp.html#ab5eeee745fbaa40daddfa60c77567d18">value_to_string_list</a>(v_rw_list);
<a name="l02149"></a>02149             <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> *ro_list = <a class="code" href="lsm__convert_8cpp.html#ab5eeee745fbaa40daddfa60c77567d18">value_to_string_list</a>(v_ro_list);
<a name="l02150"></a>02150 
<a name="l02151"></a>02151             <span class="keywordflow">if</span> (root_list &amp;&amp; rw_list &amp;&amp; ro_list) {
<a name="l02152"></a>02152                 <span class="keyword">const</span> <span class="keywordtype">char</span> *fs_id = v_fs_id.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l02153"></a>02153                 <span class="keyword">const</span> <span class="keywordtype">char</span> *export_path = v_export_path.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l02154"></a>02154                 <span class="keyword">const</span> <span class="keywordtype">char</span> *auth_type = v_auth_type.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l02155"></a>02155                 <span class="keyword">const</span> <span class="keywordtype">char</span> *options = v_options.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l02156"></a>02156                 <a class="code" href="struct__lsm__nfs__export.html">lsm_nfs_export</a> *exported = NULL;
<a name="l02157"></a>02157 
<a name="l02158"></a>02158                 int64_t anon_uid = get_uid_gid(v_anon_uid);
<a name="l02159"></a>02159                 int64_t anon_gid = get_uid_gid(v_anon_gid);
<a name="l02160"></a>02160 
<a name="l02161"></a>02161                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a>-&gt;<a class="code" href="structlsm__nas__ops__v1.html#a9be843be87505235e97d8de4b93ae65a">nfs_export</a>(p, fs_id, export_path,
<a name="l02162"></a>02162                                             root_list, rw_list, ro_list,
<a name="l02163"></a>02163                                             anon_uid, anon_gid, auth_type,
<a name="l02164"></a>02164                                             options, &amp;exported,
<a name="l02165"></a>02165                                             <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l02166"></a>02166                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l02167"></a>02167                     response = <a class="code" href="lsm__convert_8cpp.html#aecf21606b00030de94f75103d312cba0">nfs_export_to_value</a>(exported);
<a name="l02168"></a>02168                     <a class="code" href="libstoragemgmt__nfsexport_8h.html#a59027d6d02d4e8e7352f514805ae7f58">lsm_nfs_export_record_free</a>(exported);
<a name="l02169"></a>02169                 }
<a name="l02170"></a>02170 
<a name="l02171"></a>02171             } <span class="keywordflow">else</span> {
<a name="l02172"></a>02172                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l02173"></a>02173             }
<a name="l02174"></a>02174 
<a name="l02175"></a>02175             <a class="code" href="libstoragemgmt__common_8h.html#a0042977fcc59a5907892dcd5e907b891">lsm_string_list_free</a>(root_list);
<a name="l02176"></a>02176             <a class="code" href="libstoragemgmt__common_8h.html#a0042977fcc59a5907892dcd5e907b891">lsm_string_list_free</a>(rw_list);
<a name="l02177"></a>02177             <a class="code" href="libstoragemgmt__common_8h.html#a0042977fcc59a5907892dcd5e907b891">lsm_string_list_free</a>(ro_list);
<a name="l02178"></a>02178 
<a name="l02179"></a>02179         } <span class="keywordflow">else</span> {
<a name="l02180"></a>02180             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l02181"></a>02181         }
<a name="l02182"></a>02182     }
<a name="l02183"></a>02183     <span class="keywordflow">return</span> rc;
<a name="l02184"></a>02184 }
<a name="l02185"></a>02185 
<a name="l02186"></a>02186 <span class="keyword">static</span> <span class="keywordtype">int</span> export_remove(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l02187"></a>02187 {
<a name="l02188"></a>02188     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l02189"></a>02189 
<a name="l02190"></a>02190     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a>-&gt;<a class="code" href="structlsm__nas__ops__v1.html#a63b4ac7672cc459dc440da55b53ac20e">nfs_export_remove</a>) {
<a name="l02191"></a>02191         <a class="code" href="class_value.html">Value</a> v_export = params[<span class="stringliteral">&quot;export&quot;</span>];
<a name="l02192"></a>02192 
<a name="l02193"></a>02193         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a3b444ae727bdab82dc980f06d881a6e5">IS_CLASS_FS_EXPORT</a>(v_export) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l02194"></a>02194             <a class="code" href="struct__lsm__nfs__export.html">lsm_nfs_export</a> *exp = <a class="code" href="lsm__convert_8cpp.html#aa230aa3280cfdd3ddb65372710954a3f">value_to_nfs_export</a>(v_export);
<a name="l02195"></a>02195 
<a name="l02196"></a>02196             <span class="keywordflow">if</span> (exp) {
<a name="l02197"></a>02197                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ae20071bcfb75bb2acb4d3f776489eb87">nas_ops</a>-&gt;<a class="code" href="structlsm__nas__ops__v1.html#a63b4ac7672cc459dc440da55b53ac20e">nfs_export_remove</a>(p, exp,
<a name="l02198"></a>02198                                                    <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l02199"></a>02199                 <a class="code" href="libstoragemgmt__nfsexport_8h.html#a59027d6d02d4e8e7352f514805ae7f58">lsm_nfs_export_record_free</a>(exp);
<a name="l02200"></a>02200                 exp = NULL;
<a name="l02201"></a>02201             } <span class="keywordflow">else</span> {
<a name="l02202"></a>02202                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l02203"></a>02203             }
<a name="l02204"></a>02204         } <span class="keywordflow">else</span> {
<a name="l02205"></a>02205             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l02206"></a>02206         }
<a name="l02207"></a>02207     }
<a name="l02208"></a>02208     <span class="keywordflow">return</span> rc;
<a name="l02209"></a>02209 }
<a name="l02210"></a>02210 
<a name="l02211"></a>02211 <span class="keyword">static</span> <span class="keywordtype">int</span> iscsi_chap(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l02212"></a>02212 {
<a name="l02213"></a>02213     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l02214"></a>02214 
<a name="l02215"></a>02215     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#aca6e90882d605038e2afa32c3cbd59c2">iscsi_chap_auth</a>) {
<a name="l02216"></a>02216         <a class="code" href="class_value.html">Value</a> v_init = params[<span class="stringliteral">&quot;init_id&quot;</span>];
<a name="l02217"></a>02217         <a class="code" href="class_value.html">Value</a> v_in_user = params[<span class="stringliteral">&quot;in_user&quot;</span>];
<a name="l02218"></a>02218         <a class="code" href="class_value.html">Value</a> v_in_password = params[<span class="stringliteral">&quot;in_password&quot;</span>];
<a name="l02219"></a>02219         <a class="code" href="class_value.html">Value</a> v_out_user = params[<span class="stringliteral">&quot;out_user&quot;</span>];
<a name="l02220"></a>02220         <a class="code" href="class_value.html">Value</a> v_out_password = params[<span class="stringliteral">&quot;out_password&quot;</span>];
<a name="l02221"></a>02221 
<a name="l02222"></a>02222         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_init.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02223"></a>02223             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_in_user.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l02224"></a>02224              Value::null_t == v_in_user.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l02225"></a>02225             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_in_password.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l02226"></a>02226              Value::null_t == v_in_password.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l02227"></a>02227             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_out_user.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l02228"></a>02228              Value::null_t == v_out_user.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l02229"></a>02229             (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_out_password.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() ||
<a name="l02230"></a>02230              Value::null_t == v_out_password.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) &amp;&amp;
<a name="l02231"></a>02231             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l02232"></a>02232 
<a name="l02233"></a>02233             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#a45abece8adee28ab3161386e49e593f0">san_ops</a>-&gt;<a class="code" href="structlsm__san__ops__v1.html#aca6e90882d605038e2afa32c3cbd59c2">iscsi_chap_auth</a>(p, v_init.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>(),
<a name="l02234"></a>02234                                              v_in_user.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>(),
<a name="l02235"></a>02235                                              v_in_password.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>(),
<a name="l02236"></a>02236                                              v_out_user.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>(),
<a name="l02237"></a>02237                                              v_out_password.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>(),
<a name="l02238"></a>02238                                              <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l02239"></a>02239 
<a name="l02240"></a>02240         } <span class="keywordflow">else</span> {
<a name="l02241"></a>02241             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l02242"></a>02242         }
<a name="l02243"></a>02243     }
<a name="l02244"></a>02244     <span class="keywordflow">return</span> rc;
<a name="l02245"></a>02245 }
<a name="l02246"></a>02246 
<a name="l02247"></a>02247 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volume_raid_create_cap_get(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p,
<a name="l02248"></a>02248                                              <a class="code" href="class_value.html">Value</a> &amp; params, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l02249"></a>02249 {
<a name="l02250"></a>02250     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l02251"></a>02251     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a>-&gt;<a class="code" href="structlsm__ops__v1__2.html#aac72b293579e08becdc74c7e4ff87d7c">vol_create_raid_cap_get</a>) {
<a name="l02252"></a>02252         <a class="code" href="class_value.html">Value</a> v_system = params[<span class="stringliteral">&quot;system&quot;</span>];
<a name="l02253"></a>02253 
<a name="l02254"></a>02254         <span class="keywordflow">if</span> (<a class="code" href="lsm__convert_8hpp.html#a53f5d3ea6301a0d96925730bb5837b03">IS_CLASS_SYSTEM</a>(v_system) &amp;&amp; <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l02255"></a>02255 
<a name="l02256"></a>02256             uint32_t *supported_raid_types = NULL;
<a name="l02257"></a>02257             uint32_t supported_raid_type_count = 0;
<a name="l02258"></a>02258 
<a name="l02259"></a>02259             uint32_t *supported_strip_sizes = NULL;
<a name="l02260"></a>02260             uint32_t supported_strip_size_count = 0;
<a name="l02261"></a>02261 
<a name="l02262"></a>02262             <a class="code" href="struct__lsm__system.html">lsm_system</a> *sys = <a class="code" href="lsm__convert_8cpp.html#a49198461198770e8dbd90cf6b950c121">value_to_system</a>(v_system);
<a name="l02263"></a>02263 
<a name="l02264"></a>02264             <span class="keywordflow">if</span> (sys) {
<a name="l02265"></a>02265 
<a name="l02266"></a>02266                 rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a>-&gt;<a class="code" href="structlsm__ops__v1__2.html#aac72b293579e08becdc74c7e4ff87d7c">vol_create_raid_cap_get</a>
<a name="l02267"></a>02267                     (p, sys, &amp;supported_raid_types, &amp;supported_raid_type_count,
<a name="l02268"></a>02268                      &amp;supported_strip_sizes, &amp;supported_strip_size_count,
<a name="l02269"></a>02269                      <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a> (params));
<a name="l02270"></a>02270 
<a name="l02271"></a>02271                 <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l02272"></a>02272                     std::vector &lt; Value &gt; result;
<a name="l02273"></a>02273                     result.push_back(<a class="code" href="lsm__convert_8cpp.html#a87a3bbc131dd293e1d8bf61b31cde137">uint32_array_to_value</a>
<a name="l02274"></a>02274                                      (supported_raid_types,
<a name="l02275"></a>02275                                       supported_raid_type_count));
<a name="l02276"></a>02276                     result.push_back(<a class="code" href="lsm__convert_8cpp.html#a87a3bbc131dd293e1d8bf61b31cde137">uint32_array_to_value</a>
<a name="l02277"></a>02277                                      (supported_strip_sizes,
<a name="l02278"></a>02278                                       supported_strip_size_count));
<a name="l02279"></a>02279                     response = <a class="code" href="class_value.html">Value</a>(result);
<a name="l02280"></a>02280                     free(supported_raid_types);
<a name="l02281"></a>02281                     free(supported_strip_sizes);
<a name="l02282"></a>02282                 }
<a name="l02283"></a>02283             } <span class="keywordflow">else</span> {
<a name="l02284"></a>02284                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l02285"></a>02285             }
<a name="l02286"></a>02286 
<a name="l02287"></a>02287             <a class="code" href="libstoragemgmt__systems_8h.html#ab3ab47a044dec61344929ff9f27f9dfa">lsm_system_record_free</a>(sys);
<a name="l02288"></a>02288 
<a name="l02289"></a>02289         } <span class="keywordflow">else</span> {
<a name="l02290"></a>02290             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l02291"></a>02291         }
<a name="l02292"></a>02292     }
<a name="l02293"></a>02293     <span class="keywordflow">return</span> rc;
<a name="l02294"></a>02294 }
<a name="l02295"></a>02295 
<a name="l02296"></a>02296 <span class="keyword">static</span> <span class="keywordtype">int</span> handle_volume_raid_create(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <a class="code" href="class_value.html">Value</a> &amp; params,
<a name="l02297"></a>02297                                      <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l02298"></a>02298 {
<a name="l02299"></a>02299     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l02300"></a>02300     <span class="keywordflow">if</span> (p &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a> &amp;&amp; p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a>-&gt;<a class="code" href="structlsm__ops__v1__2.html#a3df3db09037d1cd9381b993a2585fbd9">vol_create_raid</a>) {
<a name="l02301"></a>02301         <a class="code" href="class_value.html">Value</a> v_name = params[<span class="stringliteral">&quot;name&quot;</span>];
<a name="l02302"></a>02302         <a class="code" href="class_value.html">Value</a> v_raid_type = params[<span class="stringliteral">&quot;raid_type&quot;</span>];
<a name="l02303"></a>02303         <a class="code" href="class_value.html">Value</a> v_strip_size = params[<span class="stringliteral">&quot;strip_size&quot;</span>];
<a name="l02304"></a>02304         <a class="code" href="class_value.html">Value</a> v_disks = params[<span class="stringliteral">&quot;disks&quot;</span>];
<a name="l02305"></a>02305 
<a name="l02306"></a>02306         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == v_name.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02307"></a>02307             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_raid_type.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02308"></a>02308             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == v_strip_size.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02309"></a>02309             <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == v_disks.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>() &amp;&amp;
<a name="l02310"></a>02310             <a class="code" href="lsm__datatypes_8hpp.html#aa019d5be41e2943898d7229f376c99fb">LSM_FLAG_EXPECTED_TYPE</a>(params)) {
<a name="l02311"></a>02311 
<a name="l02312"></a>02312             <a class="code" href="struct__lsm__disk.html">lsm_disk</a> **disks = NULL;
<a name="l02313"></a>02313             uint32_t disk_count = 0;
<a name="l02314"></a>02314             rc = <a class="code" href="lsm__convert_8cpp.html#a6d7cb1ca7482f3ff52ed1ff6dcd335b4">value_array_to_disks</a>(v_disks, &amp;disks, &amp;disk_count);
<a name="l02315"></a>02315             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l02316"></a>02316                 <a class="code" href="libstoragemgmt__disk_8h.html#a1d047a3ddb2981c3994c48a793d25084">lsm_disk_record_array_free</a>(disks, disk_count);
<a name="l02317"></a>02317                 <span class="keywordflow">return</span> rc;
<a name="l02318"></a>02318             }
<a name="l02319"></a>02319 
<a name="l02320"></a>02320             <span class="keyword">const</span> <span class="keywordtype">char</span> *name = v_name.<a class="code" href="class_value.html#a0886eb191cb3d5f35daef2e5f1dca079">asC_str</a>();
<a name="l02321"></a>02321             <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545">lsm_volume_raid_type</a> raid_type =
<a name="l02322"></a>02322                 (<a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545">lsm_volume_raid_type</a>) v_raid_type.<a class="code" href="class_value.html#a60b8f99167e23a6bcee87578fe59b099">asInt32_t</a>();
<a name="l02323"></a>02323             uint32_t strip_size = v_strip_size.<a class="code" href="class_value.html#a0da01b4c189ff90cfd35a78ddca99e40">asUint32_t</a>();
<a name="l02324"></a>02324 
<a name="l02325"></a>02325             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> *new_vol = NULL;
<a name="l02326"></a>02326 
<a name="l02327"></a>02327             rc = p-&gt;<a class="code" href="struct__lsm__plugin.html#ac15ed1d9477dfa49cc4e91d54f0f1ba3">ops_v1_2</a>-&gt;<a class="code" href="structlsm__ops__v1__2.html#a3df3db09037d1cd9381b993a2585fbd9">vol_create_raid</a>(p, name, raid_type, disks,
<a name="l02328"></a>02328                                               disk_count, strip_size,
<a name="l02329"></a>02329                                               &amp;new_vol,
<a name="l02330"></a>02330                                               <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(params));
<a name="l02331"></a>02331 
<a name="l02332"></a>02332             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l02333"></a>02333                 response = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(new_vol);
<a name="l02334"></a>02334                 <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>(new_vol);
<a name="l02335"></a>02335             }
<a name="l02336"></a>02336 
<a name="l02337"></a>02337             <a class="code" href="libstoragemgmt__disk_8h.html#a1d047a3ddb2981c3994c48a793d25084">lsm_disk_record_array_free</a>(disks, disk_count);
<a name="l02338"></a>02338 
<a name="l02339"></a>02339         } <span class="keywordflow">else</span> {
<a name="l02340"></a>02340             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ae996fa8d7a268f64d674898ceed63402">LSM_ERR_TRANSPORT_INVALID_ARG</a>;
<a name="l02341"></a>02341         }
<a name="l02342"></a>02342     }
<a name="l02343"></a>02343     <span class="keywordflow">return</span> rc;
<a name="l02344"></a>02344 }
<a name="l02345"></a>02345 
<a name="l02349"></a>02349 <span class="keyword">static</span> std::map &lt; std::string, handler &gt; dispatch =
<a name="l02350"></a>02350     <a class="code" href="classstatic__map.html">static_map &lt; std::string, handler &gt;</a> (<span class="stringliteral">&quot;access_group_initiator_add&quot;</span>,
<a name="l02351"></a>02351                                          ag_initiator_add)
<a name="l02352"></a>02352     (<span class="stringliteral">&quot;access_group_create&quot;</span>, ag_create)
<a name="l02353"></a>02353     (<span class="stringliteral">&quot;access_group_delete&quot;</span>, ag_delete)
<a name="l02354"></a>02354     (<span class="stringliteral">&quot;access_group_initiator_delete&quot;</span>, ag_initiator_del)
<a name="l02355"></a>02355     (<span class="stringliteral">&quot;volume_mask&quot;</span>, volume_mask)
<a name="l02356"></a>02356     (<span class="stringliteral">&quot;access_groups&quot;</span>, ag_list)
<a name="l02357"></a>02357     (<span class="stringliteral">&quot;volume_unmask&quot;</span>, volume_unmask)
<a name="l02358"></a>02358     (<span class="stringliteral">&quot;access_groups_granted_to_volume&quot;</span>, ag_granted_to_volume)
<a name="l02359"></a>02359     (<span class="stringliteral">&quot;capabilities&quot;</span>, capabilities)
<a name="l02360"></a>02360     (<span class="stringliteral">&quot;disks&quot;</span>, handle_disks)
<a name="l02361"></a>02361     (<span class="stringliteral">&quot;export_auth&quot;</span>, export_auth)
<a name="l02362"></a>02362     (<span class="stringliteral">&quot;export_fs&quot;</span>, export_fs)
<a name="l02363"></a>02363     (<span class="stringliteral">&quot;export_remove&quot;</span>, export_remove)
<a name="l02364"></a>02364     (<span class="stringliteral">&quot;exports&quot;</span>, exports)
<a name="l02365"></a>02365     (<span class="stringliteral">&quot;fs_file_clone&quot;</span>, fs_file_clone)
<a name="l02366"></a>02366     (<span class="stringliteral">&quot;fs_child_dependency&quot;</span>, fs_child_dependency)
<a name="l02367"></a>02367     (<span class="stringliteral">&quot;fs_child_dependency_rm&quot;</span>, fs_child_dependency_rm)
<a name="l02368"></a>02368     (<span class="stringliteral">&quot;fs_clone&quot;</span>, fs_clone)
<a name="l02369"></a>02369     (<span class="stringliteral">&quot;fs_create&quot;</span>, fs_create)
<a name="l02370"></a>02370     (<span class="stringliteral">&quot;fs_delete&quot;</span>, fs_delete)
<a name="l02371"></a>02371     (<span class="stringliteral">&quot;fs&quot;</span>, fs)
<a name="l02372"></a>02372     (<span class="stringliteral">&quot;fs_resize&quot;</span>, fs_resize)
<a name="l02373"></a>02373     (<span class="stringliteral">&quot;fs_snapshot_create&quot;</span>, ss_create)
<a name="l02374"></a>02374     (<span class="stringliteral">&quot;fs_snapshot_delete&quot;</span>, ss_delete)
<a name="l02375"></a>02375     (<span class="stringliteral">&quot;fs_snapshot_restore&quot;</span>, ss_restore)
<a name="l02376"></a>02376     (<span class="stringliteral">&quot;fs_snapshots&quot;</span>, ss_list)
<a name="l02377"></a>02377     (<span class="stringliteral">&quot;time_out_get&quot;</span>, handle_get_time_out)
<a name="l02378"></a>02378     (<span class="stringliteral">&quot;iscsi_chap_auth&quot;</span>, iscsi_chap)
<a name="l02379"></a>02379     (<span class="stringliteral">&quot;job_free&quot;</span>, handle_job_free)
<a name="l02380"></a>02380     (<span class="stringliteral">&quot;job_status&quot;</span>, handle_job_status)
<a name="l02381"></a>02381     (<span class="stringliteral">&quot;plugin_info&quot;</span>, handle_plugin_info)
<a name="l02382"></a>02382     (<span class="stringliteral">&quot;pools&quot;</span>, handle_pools)
<a name="l02383"></a>02383     (<span class="stringliteral">&quot;target_ports&quot;</span>, handle_target_ports)
<a name="l02384"></a>02384     (<span class="stringliteral">&quot;time_out_set&quot;</span>, handle_set_time_out)
<a name="l02385"></a>02385     (<span class="stringliteral">&quot;plugin_unregister&quot;</span>, handle_unregister)
<a name="l02386"></a>02386     (<span class="stringliteral">&quot;plugin_register&quot;</span>, handle_register)
<a name="l02387"></a>02387     (<span class="stringliteral">&quot;systems&quot;</span>, handle_system_list)
<a name="l02388"></a>02388     (<span class="stringliteral">&quot;volume_child_dependency_rm&quot;</span>, volume_dependency_rm)
<a name="l02389"></a>02389     (<span class="stringliteral">&quot;volume_child_dependency&quot;</span>, volume_dependency)
<a name="l02390"></a>02390     (<span class="stringliteral">&quot;volume_create&quot;</span>, handle_volume_create)
<a name="l02391"></a>02391     (<span class="stringliteral">&quot;volume_delete&quot;</span>, handle_volume_delete)
<a name="l02392"></a>02392     (<span class="stringliteral">&quot;volume_disable&quot;</span>, handle_volume_disable)
<a name="l02393"></a>02393     (<span class="stringliteral">&quot;volume_enable&quot;</span>, handle_volume_enable)
<a name="l02394"></a>02394     (<span class="stringliteral">&quot;volume_replicate&quot;</span>, handle_volume_replicate)
<a name="l02395"></a>02395     (<span class="stringliteral">&quot;volume_replicate_range_block_size&quot;</span>,
<a name="l02396"></a>02396      handle_volume_replicate_range_block_size)
<a name="l02397"></a>02397     (<span class="stringliteral">&quot;volume_replicate_range&quot;</span>, handle_volume_replicate_range)
<a name="l02398"></a>02398     (<span class="stringliteral">&quot;volume_resize&quot;</span>, handle_volume_resize)
<a name="l02399"></a>02399     (<span class="stringliteral">&quot;volumes_accessible_by_access_group&quot;</span>, vol_accessible_by_ag)
<a name="l02400"></a>02400     (<span class="stringliteral">&quot;volumes&quot;</span>, handle_volumes)
<a name="l02401"></a>02401     (<span class="stringliteral">&quot;volume_raid_info&quot;</span>, handle_volume_raid_info)
<a name="l02402"></a>02402     (<span class="stringliteral">&quot;pool_member_info&quot;</span>, handle_pool_member_info)
<a name="l02403"></a>02403     (<span class="stringliteral">&quot;volume_raid_create&quot;</span>, handle_volume_raid_create)
<a name="l02404"></a>02404     (<span class="stringliteral">&quot;volume_raid_create_cap_get&quot;</span>, handle_volume_raid_create_cap_get);
<a name="l02405"></a>02405 
<a name="l02406"></a>02406 <span class="keyword">static</span> <span class="keywordtype">int</span> process_request(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p, <span class="keyword">const</span> std::string &amp; method,
<a name="l02407"></a>02407                            <a class="code" href="class_value.html">Value</a> &amp; request, <a class="code" href="class_value.html">Value</a> &amp; response)
<a name="l02408"></a>02408 {
<a name="l02409"></a>02409     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ac64627333f5366a9782886af7ec8ab28">LSM_ERR_LIB_BUG</a>;
<a name="l02410"></a>02410 
<a name="l02411"></a>02411     response = <a class="code" href="class_value.html">Value</a>();         <span class="comment">//Default response will be null</span>
<a name="l02412"></a>02412 
<a name="l02413"></a>02413     <span class="keywordflow">if</span> (dispatch.find(method) != dispatch.end()) {
<a name="l02414"></a>02414         rc = (dispatch[method]) (p, request[<span class="stringliteral">&quot;params&quot;</span>], response);
<a name="l02415"></a>02415     } <span class="keywordflow">else</span> {
<a name="l02416"></a>02416         rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8c61fe7217f54a9ab78fcdca83e88cee">LSM_ERR_NO_SUPPORT</a>;
<a name="l02417"></a>02417     }
<a name="l02418"></a>02418 
<a name="l02419"></a>02419     <span class="keywordflow">return</span> rc;
<a name="l02420"></a>02420 }
<a name="l02421"></a>02421 
<a name="l02422"></a>02422 <span class="keyword">static</span> <span class="keywordtype">int</span> lsm_plugin_run(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> p)
<a name="l02423"></a>02423 {
<a name="l02424"></a>02424     <span class="keywordtype">int</span> rc = 0;
<a name="l02425"></a>02425     <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags = 0;
<a name="l02426"></a>02426 
<a name="l02427"></a>02427     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#a254f057abf7a742df0592f6645f99293">LSM_IS_PLUGIN</a>(p)) {
<a name="l02428"></a>02428         <span class="keywordflow">while</span> (<span class="keyword">true</span>) {
<a name="l02429"></a>02429             <span class="keywordflow">try</span> {
<a name="l02430"></a>02430 
<a name="l02431"></a>02431                 <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a254f057abf7a742df0592f6645f99293">LSM_IS_PLUGIN</a>(p)) {
<a name="l02432"></a>02432                     syslog(LOG_USER | LOG_NOTICE, <span class="stringliteral">&quot;Someone stepped on &quot;</span>
<a name="l02433"></a>02433                            <span class="stringliteral">&quot;plugin pointer, exiting!&quot;</span>);
<a name="l02434"></a>02434                     <span class="keywordflow">break</span>;
<a name="l02435"></a>02435                 }
<a name="l02436"></a>02436 
<a name="l02437"></a>02437                 <a class="code" href="class_value.html">Value</a> req = p-&gt;<a class="code" href="struct__lsm__plugin.html#a41f28900c0b010ae5d9c57f175d325fd">tp</a>-&gt;<a class="code" href="class_ipc.html#af905004bbfc395c5da469329adce1894">readRequest</a>();
<a name="l02438"></a>02438                 <a class="code" href="class_value.html">Value</a> resp;
<a name="l02439"></a>02439 
<a name="l02440"></a>02440                 <span class="keywordflow">if</span> (req.<a class="code" href="class_value.html#af52b8920b052519c6cbc9a07969682cb">isValidRequest</a>()) {
<a name="l02441"></a>02441                     std::string method = req[<span class="stringliteral">&quot;method&quot;</span>].<a class="code" href="class_value.html#a680be1c3db1144149b5177a48dd76bdb">asString</a>();
<a name="l02442"></a>02442                     rc = process_request(p, method, req, resp);
<a name="l02443"></a>02443 
<a name="l02444"></a>02444                     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc || <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a> == rc) {
<a name="l02445"></a>02445                         p-&gt;<a class="code" href="struct__lsm__plugin.html#a41f28900c0b010ae5d9c57f175d325fd">tp</a>-&gt;<a class="code" href="class_ipc.html#acbe97fc53a2d4e35414dad75e522e1b8">responseSend</a>(resp);
<a name="l02446"></a>02446                     } <span class="keywordflow">else</span> {
<a name="l02447"></a>02447                         error_send(p, rc);
<a name="l02448"></a>02448                     }
<a name="l02449"></a>02449 
<a name="l02450"></a>02450                     <span class="keywordflow">if</span> (method == <span class="stringliteral">&quot;plugin_unregister&quot;</span>) {
<a name="l02451"></a>02451                         flags = <a class="code" href="lsm__datatypes_8hpp.html#a8560c825de063b3056edfc4b1e4f33c2">LSM_FLAG_GET_VALUE</a>(req[<span class="stringliteral">&quot;params&quot;</span>]);
<a name="l02452"></a>02452                         <span class="keywordflow">break</span>;
<a name="l02453"></a>02453                     }
<a name="l02454"></a>02454                 } <span class="keywordflow">else</span> {
<a name="l02455"></a>02455                     syslog(LOG_USER | LOG_NOTICE, <span class="stringliteral">&quot;Invalid request&quot;</span>);
<a name="l02456"></a>02456                     <span class="keywordflow">break</span>;
<a name="l02457"></a>02457                 }
<a name="l02458"></a>02458             }
<a name="l02459"></a>02459             <span class="keywordflow">catch</span>(<a class="code" href="class_e_o_f_exception.html">EOFException</a> &amp; eof) {
<a name="l02460"></a>02460                 <span class="keywordflow">break</span>;
<a name="l02461"></a>02461             }
<a name="l02462"></a>02462             <span class="keywordflow">catch</span>(<a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l02463"></a>02463                 syslog(LOG_USER | LOG_NOTICE, <span class="stringliteral">&quot;Plug-in exception: %s&quot;</span>,
<a name="l02464"></a>02464                        ve.what());
<a name="l02465"></a>02465                 rc = 1;
<a name="l02466"></a>02466                 <span class="keywordflow">break</span>;
<a name="l02467"></a>02467             }
<a name="l02468"></a>02468             <span class="keywordflow">catch</span>(<a class="code" href="class_lsm_exception.html">LsmException</a> &amp; le) {
<a name="l02469"></a>02469                 syslog(LOG_USER | LOG_NOTICE, <span class="stringliteral">&quot;Plug-in exception: %s&quot;</span>,
<a name="l02470"></a>02470                        le.what());
<a name="l02471"></a>02471                 rc = 2;
<a name="l02472"></a>02472                 <span class="keywordflow">break</span>;
<a name="l02473"></a>02473             }
<a name="l02474"></a>02474             <span class="keywordflow">catch</span>( ...) {
<a name="l02475"></a>02475                 syslog(LOG_USER | LOG_NOTICE, <span class="stringliteral">&quot;Plug-in un-handled exception&quot;</span>);
<a name="l02476"></a>02476                 rc = 3;
<a name="l02477"></a>02477                 <span class="keywordflow">break</span>;
<a name="l02478"></a>02478             }
<a name="l02479"></a>02479         }
<a name="l02480"></a>02480         lsm_plugin_free(p, flags);
<a name="l02481"></a>02481         p = NULL;
<a name="l02482"></a>02482     } <span class="keywordflow">else</span> {
<a name="l02483"></a>02483         rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02484"></a>02484     }
<a name="l02485"></a>02485 
<a name="l02486"></a>02486     <span class="keywordflow">return</span> rc;
<a name="l02487"></a>02487 }
<a name="l02488"></a>02488 
<a name="l02489"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#ad8e887f4139033aa65affbd3df513607">02489</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#a97aedfb84dc4d8c6d7e24fb9821e0cf6">lsm_log_error_basic</a>(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> plug, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2">lsm_error_number</a> code,
<a name="l02490"></a>02490                         <span class="keyword">const</span> <span class="keywordtype">char</span> *msg)
<a name="l02491"></a>02491 {
<a name="l02492"></a>02492     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a254f057abf7a742df0592f6645f99293">LSM_IS_PLUGIN</a>(plug)) {
<a name="l02493"></a>02493         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02494"></a>02494     }
<a name="l02495"></a>02495 
<a name="l02496"></a>02496     <a class="code" href="struct__lsm__error.html">lsm_error_ptr</a> e = <a class="code" href="libstoragemgmt__plug__interface_8h.html#a4bc9037a17167791d99deb45d9df1f92">LSM_ERROR_CREATE_PLUGIN_MSG</a>(code, msg);
<a name="l02497"></a>02497     <span class="keywordflow">if</span> (e) {
<a name="l02498"></a>02498         <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__plug__interface_8h.html#a95b9c4cab0fbb4fbb475623f3e164117">lsm_plugin_error_log</a>(plug, e);
<a name="l02499"></a>02499 
<a name="l02500"></a>02500         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l02501"></a>02501             syslog(LOG_USER | LOG_NOTICE,
<a name="l02502"></a>02502                    <span class="stringliteral">&quot;Plug-in error %d while reporting an error, code= %d, &quot;</span>
<a name="l02503"></a>02503                    <span class="stringliteral">&quot;msg= %s&quot;</span>,
<a name="l02504"></a>02504                    rc, code, msg);
<a name="l02505"></a>02505         }
<a name="l02506"></a>02506     }
<a name="l02507"></a>02507     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) code;
<a name="l02508"></a>02508 }
<a name="l02509"></a>02509 
<a name="l02510"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a97efd312800fa221c380b03232530ed9">02510</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#a95b9c4cab0fbb4fbb475623f3e164117">lsm_plugin_error_log</a>(<a class="code" href="struct__lsm__plugin.html">lsm_plugin_ptr</a> plug, <a class="code" href="struct__lsm__error.html">lsm_error_ptr</a> <a class="code" href="client__example_8c.html#a02a815e32ecbf068b8dc5ecefd89e296">error</a>)
<a name="l02511"></a>02511 {
<a name="l02512"></a>02512     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a254f057abf7a742df0592f6645f99293">LSM_IS_PLUGIN</a>(plug) || !<a class="code" href="lsm__datatypes_8hpp.html#a1b3fcc46128c7eb654e18d3f70cf9af5">LSM_IS_ERROR</a>(error)) {
<a name="l02513"></a>02513         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02514"></a>02514     }
<a name="l02515"></a>02515 
<a name="l02516"></a>02516     <span class="keywordflow">if</span> (plug-&gt;<a class="code" href="struct__lsm__plugin.html#a6b19330eec78c8072153b6d65c75e918">error</a>) {
<a name="l02517"></a>02517         <a class="code" href="libstoragemgmt__error_8h.html#a3d6c3302c51402dd037e182fe4c35500">lsm_error_free</a>(plug-&gt;<a class="code" href="struct__lsm__plugin.html#a6b19330eec78c8072153b6d65c75e918">error</a>);
<a name="l02518"></a>02518     }
<a name="l02519"></a>02519 
<a name="l02520"></a>02520     plug-&gt;<a class="code" href="struct__lsm__plugin.html#a6b19330eec78c8072153b6d65c75e918">error</a> = error;
<a name="l02521"></a>02521 
<a name="l02522"></a>02522     <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l02523"></a>02523 }
<a name="l02524"></a>02524 
<a name="l02525"></a>02525 
<a name="l02526"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#aa3a8de84bdd891ebbfdce863a234ae9e">02526</a> <span class="preprocessor">#define STR_D(c, s) \</span>
<a name="l02527"></a>02527 <span class="preprocessor">do { \</span>
<a name="l02528"></a>02528 <span class="preprocessor">    if(s) { \</span>
<a name="l02529"></a>02529 <span class="preprocessor">        (c) = strdup(s); \</span>
<a name="l02530"></a>02530 <span class="preprocessor">        if( !c ) {\</span>
<a name="l02531"></a>02531 <span class="preprocessor">            rc = LSM_ERR_NO_MEMORY; \</span>
<a name="l02532"></a>02532 <span class="preprocessor">            goto bail; \</span>
<a name="l02533"></a>02533 <span class="preprocessor">        } \</span>
<a name="l02534"></a>02534 <span class="preprocessor">    } \</span>
<a name="l02535"></a>02535 <span class="preprocessor">} while(0)\</span>
<a name="l02536"></a>02536 <span class="preprocessor"></span>
<a name="l02537"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a112a54c1b1f950f403b1612073480fc7">02537</a> <span class="preprocessor"></span><span class="keywordtype">int</span> <a class="code" href="libstoragemgmt__common_8h.html#ab04cda042281ce40ed7467a8d358d126">LSM_DLL_EXPORT</a> <a class="code" href="libstoragemgmt__plug__interface_8h.html#a112a54c1b1f950f403b1612073480fc7">lsm_uri_parse</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *uri, <span class="keywordtype">char</span> **scheme,
<a name="l02538"></a>02538                                  <span class="keywordtype">char</span> **<a class="code" href="namespacenetapp.html#a04664bb49f18d7de603c0be9d5ddde45">user</a>, <span class="keywordtype">char</span> **server, <span class="keywordtype">int</span> *port,
<a name="l02539"></a>02539                                  <span class="keywordtype">char</span> **path, <a class="code" href="struct__lsm__hash.html">lsm_hash</a> ** query_params)
<a name="l02540"></a>02540 {
<a name="l02541"></a>02541     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02542"></a>02542     xmlURIPtr u = NULL;
<a name="l02543"></a>02543 
<a name="l02544"></a>02544     <span class="keywordflow">if</span> (uri &amp;&amp; strlen(uri) &gt; 0) {
<a name="l02545"></a>02545         *scheme = NULL;
<a name="l02546"></a>02546         *user = NULL;
<a name="l02547"></a>02547         *server = NULL;
<a name="l02548"></a>02548         *port = -1;
<a name="l02549"></a>02549         *path = NULL;
<a name="l02550"></a>02550         *query_params = NULL;
<a name="l02551"></a>02551 
<a name="l02552"></a>02552         u = xmlParseURI(uri);
<a name="l02553"></a>02553         <span class="keywordflow">if</span> (u) {
<a name="l02554"></a>02554             <a class="code" href="lsm__plugin__ipc_8cpp.html#aa3a8de84bdd891ebbfdce863a234ae9e">STR_D</a>(*scheme, u-&gt;scheme);
<a name="l02555"></a>02555             <a class="code" href="lsm__plugin__ipc_8cpp.html#aa3a8de84bdd891ebbfdce863a234ae9e">STR_D</a>(*user, u-&gt;user);
<a name="l02556"></a>02556             <a class="code" href="lsm__plugin__ipc_8cpp.html#aa3a8de84bdd891ebbfdce863a234ae9e">STR_D</a>(*server, u-&gt;server);
<a name="l02557"></a>02557             <a class="code" href="lsm__plugin__ipc_8cpp.html#aa3a8de84bdd891ebbfdce863a234ae9e">STR_D</a>(*path, u-&gt;path);
<a name="l02558"></a>02558             *port = u-&gt;port;
<a name="l02559"></a>02559 
<a name="l02560"></a>02560             *query_params = <a class="code" href="libstoragemgmt__hash_8h.html#ad25d30e2f2a64713dbca46d0e767d1f7">lsm_hash_alloc</a>();
<a name="l02561"></a>02561             <span class="keywordflow">if</span> (*query_params) {
<a name="l02562"></a>02562                 <span class="keywordtype">int</span> i;
<a name="l02563"></a>02563                 <span class="keyword">struct </span><a class="code" href="structqparam__set.html">qparam_set</a> *qp = NULL;
<a name="l02564"></a>02564                 qp = <a class="code" href="qparams_8c.html#aa6d6f6f014147603fb1755b2e50be728">qparam_query_parse</a>(u-&gt;query_raw);
<a name="l02565"></a>02565 
<a name="l02566"></a>02566                 <span class="keywordflow">if</span> (qp) {
<a name="l02567"></a>02567                     <span class="keywordflow">for</span> (i = 0; i &lt; qp-&gt;<a class="code" href="structqparam__set.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>; ++i) {
<a name="l02568"></a>02568                         rc = <a class="code" href="libstoragemgmt__hash_8h.html#ad918d3e6744c60b703e3ef663baaaef4">lsm_hash_string_set</a>(*query_params,
<a name="l02569"></a>02569                                                  qp-&gt;<a class="code" href="structqparam__set.html#a47b5d757cafc323010cb649292cbd504">p</a>[i].<a class="code" href="structqparam.html#a5ac083a645d964373f022d03df4849c8">name</a>, qp-&gt;<a class="code" href="structqparam__set.html#a47b5d757cafc323010cb649292cbd504">p</a>[i].<a class="code" href="structqparam.html#a4e9aec275e566b978a3ccb4e043d8c61">value</a>);
<a name="l02570"></a>02570                         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l02571"></a>02571                             <a class="code" href="qparams_8c.html#ad1b3f26087ac0f81b14c856123a58e17">free_qparam_set</a>(qp);
<a name="l02572"></a>02572                             <span class="keywordflow">goto</span> bail;
<a name="l02573"></a>02573                         }
<a name="l02574"></a>02574                     }
<a name="l02575"></a>02575                     <a class="code" href="qparams_8c.html#ad1b3f26087ac0f81b14c856123a58e17">free_qparam_set</a>(qp);
<a name="l02576"></a>02576                 }
<a name="l02577"></a>02577             } <span class="keywordflow">else</span> {
<a name="l02578"></a>02578                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l02579"></a>02579                 <span class="keywordflow">goto</span> bail;
<a name="l02580"></a>02580             }
<a name="l02581"></a>02581 
<a name="l02582"></a>02582             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l02583"></a>02583         }
<a name="l02584"></a>02584 
<a name="l02585"></a>02585       bail:
<a name="l02586"></a>02586         <span class="keywordflow">if</span> (rc != <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l02587"></a>02587             free(*scheme);
<a name="l02588"></a>02588             *scheme = NULL;
<a name="l02589"></a>02589             free(*user);
<a name="l02590"></a>02590             *user = NULL;
<a name="l02591"></a>02591             free(*server);
<a name="l02592"></a>02592             *server = NULL;
<a name="l02593"></a>02593             *port = -1;
<a name="l02594"></a>02594             free(*path);
<a name="l02595"></a>02595             *path = NULL;
<a name="l02596"></a>02596             <a class="code" href="libstoragemgmt__hash_8h.html#adc4e0193e94864a23672b46fbf8760d8">lsm_hash_free</a>(*query_params);
<a name="l02597"></a>02597             *query_params = NULL;
<a name="l02598"></a>02598         }
<a name="l02599"></a>02599 
<a name="l02600"></a>02600         <span class="keywordflow">if</span> (u) {
<a name="l02601"></a>02601             xmlFreeURI(u);
<a name="l02602"></a>02602             u = NULL;
<a name="l02603"></a>02603         }
<a name="l02604"></a>02604     }
<a name="l02605"></a>02605     <span class="keywordflow">return</span> rc;
<a name="l02606"></a>02606 }
<a name="l02607"></a>02607 
<a name="l02608"></a>02608 
<a name="l02609"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a74eb3951784c5b2ef59649b85eb2c586">02609</a> <span class="keyword">typedef</span> int (*<a class="code" href="lsm__plugin__ipc_8cpp.html#a74eb3951784c5b2ef59649b85eb2c586">array_cmp</a>) (<span class="keywordtype">void</span> *item, <span class="keywordtype">void</span> *cmp_data);
<a name="l02610"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a563da287f1c77c4681b218442e66a022">02610</a> <span class="keyword">typedef</span> void (*<a class="code" href="lsm__plugin__ipc_8cpp.html#a563da287f1c77c4681b218442e66a022">free_item</a>) (<span class="keywordtype">void</span> *item);
<a name="l02611"></a>02611 
<a name="l02612"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">02612</a> <span class="preprocessor">#define CMP_FUNCTION(name, method, method_type) \</span>
<a name="l02613"></a>02613 <span class="preprocessor">static int name(void *i, void *d)               \</span>
<a name="l02614"></a>02614 <span class="preprocessor">{                                               \</span>
<a name="l02615"></a>02615 <span class="preprocessor">    method_type *v = (method_type *)i;          \</span>
<a name="l02616"></a>02616 <span class="preprocessor">    char *val = (char *)d;                      \</span>
<a name="l02617"></a>02617 <span class="preprocessor">                                                \</span>
<a name="l02618"></a>02618 <span class="preprocessor">    if( strcmp(method(v), val) == 0 ) {         \</span>
<a name="l02619"></a>02619 <span class="preprocessor">        return 1;                               \</span>
<a name="l02620"></a>02620 <span class="preprocessor">    }                                           \</span>
<a name="l02621"></a>02621 <span class="preprocessor">    return 0;                                   \</span>
<a name="l02622"></a>02622 <span class="preprocessor">}                                               \</span>
<a name="l02623"></a>02623 <span class="preprocessor"></span>
<a name="l02624"></a>02624 <span class="preprocessor"></span>
<a name="l02625"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a677e089afd79b3c5a2df473c122463d4">02625</a> <span class="preprocessor">#define CMP_FREE_FUNCTION(name, method, method_type) \</span>
<a name="l02626"></a>02626 <span class="preprocessor">static void name(void *i)       \</span>
<a name="l02627"></a>02627 <span class="preprocessor">{                               \</span>
<a name="l02628"></a>02628 <span class="preprocessor">    method((method_type *)i);   \</span>
<a name="l02629"></a>02629 <span class="preprocessor">}                               \</span>
<a name="l02630"></a>02630 <span class="preprocessor"></span>
<a name="l02631"></a>02631 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> filter(<span class="keywordtype">void</span> *a[], <span class="keywordtype">size_t</span> size, <a class="code" href="lsm__plugin__ipc_8cpp.html#a74eb3951784c5b2ef59649b85eb2c586">array_cmp</a> cmp, <span class="keywordtype">void</span> *cmp_data,
<a name="l02632"></a>02632                   <a class="code" href="lsm__plugin__ipc_8cpp.html#a563da287f1c77c4681b218442e66a022">free_item</a> fo)
<a name="l02633"></a>02633 {
<a name="l02634"></a>02634     <span class="keywordtype">int</span> remaining = 0;
<a name="l02635"></a>02635     <span class="keywordtype">size_t</span> i = 0;
<a name="l02636"></a>02636 
<a name="l02637"></a>02637     <span class="keywordflow">for</span> (i = 0; i &lt; size; ++i) {
<a name="l02638"></a>02638         <span class="keywordflow">if</span> (cmp(a[i], cmp_data)) {
<a name="l02639"></a>02639             memmove(&amp;a[remaining], &amp;a[i], <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> *));
<a name="l02640"></a>02640             remaining += 1;
<a name="l02641"></a>02641         } <span class="keywordflow">else</span> {
<a name="l02642"></a>02642             fo(a[i]);
<a name="l02643"></a>02643             a[i] = NULL;
<a name="l02644"></a>02644         }
<a name="l02645"></a>02645     }
<a name="l02646"></a>02646     <span class="keywordflow">return</span> remaining;
<a name="l02647"></a>02647 }
<a name="l02648"></a>02648 
<a name="l02649"></a>02649 <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(volume_compare_id, <a class="code" href="libstoragemgmt__volumes_8h.html#ac6a8898130acf307810f2f0587dde156">lsm_volume_id_get</a>, <a class="code" href="struct__lsm__volume.html">lsm_volume</a>)
<a name="l02650"></a>02650     <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(volume_compare_system, <a class="code" href="libstoragemgmt__volumes_8h.html#ac623ae2e30c9d677601fbf234615d6cf">lsm_volume_system_id_get</a>, <a class="code" href="struct__lsm__volume.html">lsm_volume</a>)
<a name="l02651"></a>02651     <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(volume_compare_pool, <a class="code" href="libstoragemgmt__volumes_8h.html#ac71f2dfc92368a03c25390a140af5636">lsm_volume_pool_id_get</a>, <a class="code" href="struct__lsm__volume.html">lsm_volume</a>)
<a name="l02652"></a>02652 <a class="code" href="lsm__plugin__ipc_8cpp.html#a677e089afd79b3c5a2df473c122463d4">CMP_FREE_FUNCTION</a>(volume_free, <a class="code" href="libstoragemgmt__volumes_8h.html#a62a718dbb14c43eb0b4c3498ad5bb4e2">lsm_volume_record_free</a>, <a class="code" href="struct__lsm__volume.html">lsm_volume</a>)
<a name="l02653"></a>02653 
<a name="l02654"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a8e7953f5cda8402b98b662c07bcdcfe1">02654</a> <span class="keywordtype">void</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#a52f87943c52b562534c3aa3edc0a606e">lsm_plug_volume_search_filter</a>(const <span class="keywordtype">char</span> *search_key,
<a name="l02655"></a>02655                                    const <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>,
<a name="l02656"></a>02656                                    <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * vols[], uint32_t * count)
<a name="l02657"></a>02657 {
<a name="l02658"></a>02658     <a class="code" href="lsm__plugin__ipc_8cpp.html#a74eb3951784c5b2ef59649b85eb2c586">array_cmp</a> cmp = NULL;
<a name="l02659"></a>02659 
<a name="l02660"></a>02660     <span class="keywordflow">if</span> (search_key) {
<a name="l02661"></a>02661 
<a name="l02662"></a>02662         <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;id&quot;</span>, search_key)) {
<a name="l02663"></a>02663             cmp = volume_compare_id;
<a name="l02664"></a>02664         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;system_id&quot;</span>, search_key)) {
<a name="l02665"></a>02665             cmp = volume_compare_system;
<a name="l02666"></a>02666         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;pool_id&quot;</span>, search_key)) {
<a name="l02667"></a>02667             cmp = volume_compare_pool;
<a name="l02668"></a>02668         }
<a name="l02669"></a>02669 
<a name="l02670"></a>02670         <span class="keywordflow">if</span> (cmp) {
<a name="l02671"></a>02671             *count =
<a name="l02672"></a>02672                 filter((<span class="keywordtype">void</span> **) vols, *count, cmp, (<span class="keywordtype">void</span> *) search_value,
<a name="l02673"></a>02673                        volume_free);
<a name="l02674"></a>02674         }
<a name="l02675"></a>02675     }
<a name="l02676"></a>02676 }
<a name="l02677"></a>02677 
<a name="l02678"></a>02678 <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(pool_compare_id, <a class="code" href="libstoragemgmt__pool_8h.html#ab06058eb1efe413a14d018c0668c3b65">lsm_pool_id_get</a>, <a class="code" href="struct__lsm__pool.html">lsm_pool</a>)
<a name="l02679"></a>02679     <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(pool_compare_system, <a class="code" href="libstoragemgmt__pool_8h.html#a89f21345cb45ddda249b0c3060a38e66">lsm_pool_system_id_get</a>, <a class="code" href="struct__lsm__pool.html">lsm_pool</a>)
<a name="l02680"></a>02680 <a class="code" href="lsm__plugin__ipc_8cpp.html#a677e089afd79b3c5a2df473c122463d4">CMP_FREE_FUNCTION</a>(pool_free, <a class="code" href="libstoragemgmt__pool_8h.html#a44d50c6c387a0269fc494e94a831064b">lsm_pool_record_free</a>, <a class="code" href="struct__lsm__pool.html">lsm_pool</a>);
<a name="l02681"></a>02681 
<a name="l02682"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a8ed974ff8dc2b6397d04b69ac4429960">02682</a> <span class="keywordtype">void</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#a12ce2406e27efba84f95256d0245c7c8">lsm_plug_pool_search_filter</a>(const <span class="keywordtype">char</span> *search_key,
<a name="l02683"></a>02683                                  const <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>,
<a name="l02684"></a>02684                                  lsm_pool * pools[], uint32_t * count)
<a name="l02685"></a>02685 {
<a name="l02686"></a>02686     <a class="code" href="lsm__plugin__ipc_8cpp.html#a74eb3951784c5b2ef59649b85eb2c586">array_cmp</a> cmp = NULL;
<a name="l02687"></a>02687 
<a name="l02688"></a>02688     <span class="keywordflow">if</span> (search_key) {
<a name="l02689"></a>02689 
<a name="l02690"></a>02690         <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;id&quot;</span>, search_key)) {
<a name="l02691"></a>02691             cmp = pool_compare_id;
<a name="l02692"></a>02692         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;system_id&quot;</span>, search_key)) {
<a name="l02693"></a>02693             cmp = pool_compare_system;
<a name="l02694"></a>02694         }
<a name="l02695"></a>02695 
<a name="l02696"></a>02696         <span class="keywordflow">if</span> (cmp) {
<a name="l02697"></a>02697             *count =
<a name="l02698"></a>02698                 filter((<span class="keywordtype">void</span> **) pools, *count, cmp, (<span class="keywordtype">void</span> *) search_value,
<a name="l02699"></a>02699                        pool_free);
<a name="l02700"></a>02700         }
<a name="l02701"></a>02701     }
<a name="l02702"></a>02702 }
<a name="l02703"></a>02703 
<a name="l02704"></a>02704 <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(disk_compare_id, <a class="code" href="libstoragemgmt__disk_8h.html#a58d5c03a47314215785d6346999b0f24">lsm_disk_id_get</a>, <a class="code" href="struct__lsm__disk.html">lsm_disk</a>)
<a name="l02705"></a>02705     <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(disk_compare_system, <a class="code" href="libstoragemgmt__disk_8h.html#a689d40aa8055659514f9e1db503a8ba6">lsm_disk_system_id_get</a>, <a class="code" href="struct__lsm__disk.html">lsm_disk</a>)
<a name="l02706"></a>02706 <a class="code" href="lsm__plugin__ipc_8cpp.html#a677e089afd79b3c5a2df473c122463d4">CMP_FREE_FUNCTION</a>(disk_free, <a class="code" href="libstoragemgmt__disk_8h.html#aa6d1092072d92281bb83bcb20143244d">lsm_disk_record_free</a>, <a class="code" href="struct__lsm__disk.html">lsm_disk</a>)
<a name="l02707"></a>02707 
<a name="l02708"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#adcd3c60b086d0fcf6597cb65fcc3ff29">02708</a> <span class="keywordtype">void</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#a293a394d88b5b7db099ec535747e45db">lsm_plug_disk_search_filter</a>(const <span class="keywordtype">char</span> *search_key,
<a name="l02709"></a>02709                                  const <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>,
<a name="l02710"></a>02710                                  <a class="code" href="struct__lsm__disk.html">lsm_disk</a> * disks[], uint32_t * count)
<a name="l02711"></a>02711 {
<a name="l02712"></a>02712     <a class="code" href="lsm__plugin__ipc_8cpp.html#a74eb3951784c5b2ef59649b85eb2c586">array_cmp</a> cmp = NULL;
<a name="l02713"></a>02713 
<a name="l02714"></a>02714     <span class="keywordflow">if</span> (search_key) {
<a name="l02715"></a>02715 
<a name="l02716"></a>02716         <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;id&quot;</span>, search_key)) {
<a name="l02717"></a>02717             cmp = disk_compare_id;
<a name="l02718"></a>02718         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;system_id&quot;</span>, search_key)) {
<a name="l02719"></a>02719             cmp = disk_compare_system;
<a name="l02720"></a>02720         }
<a name="l02721"></a>02721 
<a name="l02722"></a>02722         <span class="keywordflow">if</span> (cmp) {
<a name="l02723"></a>02723             *count =
<a name="l02724"></a>02724                 filter((<span class="keywordtype">void</span> **) disks, *count, cmp, (<span class="keywordtype">void</span> *) search_value,
<a name="l02725"></a>02725                        disk_free);
<a name="l02726"></a>02726         }
<a name="l02727"></a>02727     }
<a name="l02728"></a>02728 }
<a name="l02729"></a>02729 
<a name="l02730"></a>02730 <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(access_group_compare_id, <a class="code" href="libstoragemgmt__accessgroups_8h.html#a9a9b76b7f589c7242b341d18543c7840">lsm_access_group_id_get</a>, <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a>)
<a name="l02731"></a>02731     <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(access_group_compare_system, <a class="code" href="libstoragemgmt__accessgroups_8h.html#a991f6e0215a4381a46620780ebffc8fa">lsm_access_group_system_id_get</a>,
<a name="l02732"></a>02732              <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a>)
<a name="l02733"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a7348be40f25136d7717c7154e1ea0eef">02733</a> <a class="code" href="lsm__plugin__ipc_8cpp.html#a677e089afd79b3c5a2df473c122463d4">CMP_FREE_FUNCTION</a>(access_group_free, <a class="code" href="lsm__plugin__ipc_8cpp.html#a7348be40f25136d7717c7154e1ea0eef">lsm_access_group_record_free</a>,
<a name="l02734"></a>02734                   <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a>);
<a name="l02735"></a>02735 
<a name="l02736"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#afeda0c232923c3998090322e1f56ab7b">02736</a> <span class="keywordtype">void</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#a8eb19739b2a63df6743a3b3036b3e84e">lsm_plug_access_group_search_filter</a>(const <span class="keywordtype">char</span> *search_key,
<a name="l02737"></a>02737                                          const <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>,
<a name="l02738"></a>02738                                          lsm_access_group * ag[],
<a name="l02739"></a>02739                                          uint32_t * count)
<a name="l02740"></a>02740 {
<a name="l02741"></a>02741     <a class="code" href="lsm__plugin__ipc_8cpp.html#a74eb3951784c5b2ef59649b85eb2c586">array_cmp</a> cmp = NULL;
<a name="l02742"></a>02742 
<a name="l02743"></a>02743     <span class="keywordflow">if</span> (search_key) {
<a name="l02744"></a>02744 
<a name="l02745"></a>02745         <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;id&quot;</span>, search_key)) {
<a name="l02746"></a>02746             cmp = access_group_compare_id;
<a name="l02747"></a>02747         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;system_id&quot;</span>, search_key)) {
<a name="l02748"></a>02748             cmp = access_group_compare_system;
<a name="l02749"></a>02749         }
<a name="l02750"></a>02750 
<a name="l02751"></a>02751         <span class="keywordflow">if</span> (cmp) {
<a name="l02752"></a>02752             *count =
<a name="l02753"></a>02753                 filter((<span class="keywordtype">void</span> **) ag, *count, cmp, (<span class="keywordtype">void</span> *) search_value,
<a name="l02754"></a>02754                        access_group_free);
<a name="l02755"></a>02755         }
<a name="l02756"></a>02756     }
<a name="l02757"></a>02757 }
<a name="l02758"></a>02758 
<a name="l02759"></a>02759 <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(fs_compare_id, <a class="code" href="libstoragemgmt__fs_8h.html#ad851fd6f6acf61a82ff37f0fab576b32">lsm_fs_id_get</a>, <a class="code" href="struct__lsm__fs.html">lsm_fs</a>)
<a name="l02760"></a>02760     <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(fs_compare_system, <a class="code" href="libstoragemgmt__fs_8h.html#aae4387ac9c9c28f97f86d7a731dc6ae9">lsm_fs_system_id_get</a>, <a class="code" href="struct__lsm__fs.html">lsm_fs</a>)
<a name="l02761"></a>02761 <a class="code" href="lsm__plugin__ipc_8cpp.html#a677e089afd79b3c5a2df473c122463d4">CMP_FREE_FUNCTION</a>(fs_free, <a class="code" href="libstoragemgmt__fs_8h.html#a2ce1b4f4ea1791c0847dd42dbd32d7aa">lsm_fs_record_free</a>, <a class="code" href="struct__lsm__fs.html">lsm_fs</a>);
<a name="l02762"></a>02762 
<a name="l02763"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a058cf4e8de8d53c6f21457930c4ae7d7">02763</a> <span class="keywordtype">void</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#a04efeedb9fc0cce9df51f686273aaf31">lsm_plug_fs_search_filter</a>(const <span class="keywordtype">char</span> *search_key,
<a name="l02764"></a>02764                                const <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>,
<a name="l02765"></a>02765                                lsm_fs * fs[], uint32_t * count)
<a name="l02766"></a>02766 {
<a name="l02767"></a>02767     <a class="code" href="lsm__plugin__ipc_8cpp.html#a74eb3951784c5b2ef59649b85eb2c586">array_cmp</a> cmp = NULL;
<a name="l02768"></a>02768 
<a name="l02769"></a>02769     <span class="keywordflow">if</span> (search_key) {
<a name="l02770"></a>02770 
<a name="l02771"></a>02771         <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;id&quot;</span>, search_key)) {
<a name="l02772"></a>02772             cmp = fs_compare_id;
<a name="l02773"></a>02773         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;system_id&quot;</span>, search_key)) {
<a name="l02774"></a>02774             cmp = fs_compare_system;
<a name="l02775"></a>02775         }
<a name="l02776"></a>02776 
<a name="l02777"></a>02777         <span class="keywordflow">if</span> (cmp) {
<a name="l02778"></a>02778             *count =
<a name="l02779"></a>02779                 filter((<span class="keywordtype">void</span> **) fs, *count, cmp, (<span class="keywordtype">void</span> *) search_value,
<a name="l02780"></a>02780                        fs_free);
<a name="l02781"></a>02781         }
<a name="l02782"></a>02782     }
<a name="l02783"></a>02783 }
<a name="l02784"></a>02784 
<a name="l02785"></a>02785 <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(nfs_compare_id, <a class="code" href="libstoragemgmt__nfsexport_8h.html#aefa9ba6e7f84d66b04eb48350be2ea89">lsm_nfs_export_id_get</a>, <a class="code" href="struct__lsm__nfs__export.html">lsm_nfs_export</a>)
<a name="l02786"></a>02786     <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(nfs_compare_fs_id, <a class="code" href="libstoragemgmt__nfsexport_8h.html#aea5e1db84c1e14f4679d5c45fecb1a29">lsm_nfs_export_fs_id_get</a>, <a class="code" href="struct__lsm__nfs__export.html">lsm_nfs_export</a>)
<a name="l02787"></a>02787 <a class="code" href="lsm__plugin__ipc_8cpp.html#a677e089afd79b3c5a2df473c122463d4">CMP_FREE_FUNCTION</a>(nfs_free, <a class="code" href="libstoragemgmt__nfsexport_8h.html#a59027d6d02d4e8e7352f514805ae7f58">lsm_nfs_export_record_free</a>, <a class="code" href="struct__lsm__nfs__export.html">lsm_nfs_export</a>)
<a name="l02788"></a>02788 
<a name="l02789"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a380b806136517d7771fc8cd076e51b34">02789</a> <span class="keywordtype">void</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#ab551da48655d6afaa6537d196b24512a">lsm_plug_nfs_export_search_filter</a>(const <span class="keywordtype">char</span> *search_key,
<a name="l02790"></a>02790                                        const <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>,
<a name="l02791"></a>02791                                        <a class="code" href="struct__lsm__nfs__export.html">lsm_nfs_export</a> * exports[],
<a name="l02792"></a>02792                                        uint32_t * count)
<a name="l02793"></a>02793 {
<a name="l02794"></a>02794     <a class="code" href="lsm__plugin__ipc_8cpp.html#a74eb3951784c5b2ef59649b85eb2c586">array_cmp</a> cmp = NULL;
<a name="l02795"></a>02795 
<a name="l02796"></a>02796     <span class="keywordflow">if</span> (search_key) {
<a name="l02797"></a>02797 
<a name="l02798"></a>02798         <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;id&quot;</span>, search_key)) {
<a name="l02799"></a>02799             cmp = nfs_compare_id;
<a name="l02800"></a>02800         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;fs_id&quot;</span>, search_key)) {
<a name="l02801"></a>02801             cmp = nfs_compare_fs_id;
<a name="l02802"></a>02802         }
<a name="l02803"></a>02803 
<a name="l02804"></a>02804         <span class="keywordflow">if</span> (cmp) {
<a name="l02805"></a>02805             *count =
<a name="l02806"></a>02806                 filter((<span class="keywordtype">void</span> **) exports, *count, cmp,
<a name="l02807"></a>02807                        (<span class="keywordtype">void</span> *) search_value, nfs_free);
<a name="l02808"></a>02808         }
<a name="l02809"></a>02809     }
<a name="l02810"></a>02810 }
<a name="l02811"></a>02811 
<a name="l02812"></a>02812 <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(tp_compare_id, <a class="code" href="libstoragemgmt__targetport_8h.html#a0166659b27d526e0f10d81725760bbc7">lsm_target_port_id_get</a>, lsm_target_port)
<a name="l02813"></a>02813     <a class="code" href="lsm__plugin__ipc_8cpp.html#aeb54f89af8d7abdf4d91a495f23e2d2f">CMP_FUNCTION</a>(tp_compare_system_id, <a class="code" href="libstoragemgmt__targetport_8h.html#acc485dae2804fdb1c7652625b50d829f">lsm_target_port_system_id_get</a>,
<a name="l02814"></a>02814              lsm_target_port)
<a name="l02815"></a>02815 <a class="code" href="lsm__plugin__ipc_8cpp.html#a677e089afd79b3c5a2df473c122463d4">CMP_FREE_FUNCTION</a>(tp_free, <a class="code" href="libstoragemgmt__targetport_8h.html#aa34c4622f7875b0a5b03fb159d5d52cd">lsm_target_port_record_free</a>, lsm_target_port)
<a name="l02816"></a>02816 
<a name="l02817"></a>02817 <span class="keywordtype">void</span> <a class="code" href="libstoragemgmt__plug__interface_8h.html#a7472d8d73765a6aa8cfd13fdb4a4cb46">lsm_plug_target_port_search_filter</a>(const <span class="keywordtype">char</span> *search_key,
<a name="l02818"></a><a class="code" href="lsm__plugin__ipc_8cpp.html#a70a32bd2be98dd0919402d512789b467">02818</a>                                         const <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>,
<a name="l02819"></a>02819                                         lsm_target_port * <a class="code" href="lsm__plugin__ipc_8cpp.html#a70a32bd2be98dd0919402d512789b467">tp</a>[],
<a name="l02820"></a>02820                                         uint32_t * count)
<a name="l02821"></a>02821 {
<a name="l02822"></a>02822     <a class="code" href="lsm__plugin__ipc_8cpp.html#a74eb3951784c5b2ef59649b85eb2c586">array_cmp</a> cmp = NULL;
<a name="l02823"></a>02823 
<a name="l02824"></a>02824     <span class="keywordflow">if</span> (search_key) {
<a name="l02825"></a>02825 
<a name="l02826"></a>02826         <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;id&quot;</span>, search_key)) {
<a name="l02827"></a>02827             cmp = tp_compare_id;
<a name="l02828"></a>02828         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 == strcmp(<span class="stringliteral">&quot;system_id&quot;</span>, search_key)) {
<a name="l02829"></a>02829             cmp = tp_compare_system_id;
<a name="l02830"></a>02830         }
<a name="l02831"></a>02831 
<a name="l02832"></a>02832         <span class="keywordflow">if</span> (cmp) {
<a name="l02833"></a>02833             *count =
<a name="l02834"></a>02834                 filter((<span class="keywordtype">void</span> **) tp, *count, cmp, (<span class="keywordtype">void</span> *) search_value,
<a name="l02835"></a>02835                        tp_free);
<a name="l02836"></a>02836         }
<a name="l02837"></a>02837     }
<a name="l02838"></a>02838 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 9 Jul 2015 for libStorageMgmt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
