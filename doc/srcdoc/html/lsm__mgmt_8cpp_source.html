<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libStorageMgmt: lsm_mgmt.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>lsm_mgmt.cpp</h1><a href="lsm__mgmt_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2011-2014 Red Hat, Inc.</span>
<a name="l00003"></a>00003 <span class="comment"> * This library is free software; you can redistribute it and/or</span>
<a name="l00004"></a>00004 <span class="comment"> * modify it under the terms of the GNU Lesser General Public</span>
<a name="l00005"></a>00005 <span class="comment"> * License as published by the Free Software Foundation; either</span>
<a name="l00006"></a>00006 <span class="comment"> * version 2.1 of the License, or any later version.</span>
<a name="l00007"></a>00007 <span class="comment"> *</span>
<a name="l00008"></a>00008 <span class="comment"> * This library is distributed in the hope that it will be useful,</span>
<a name="l00009"></a>00009 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00010"></a>00010 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00011"></a>00011 <span class="comment"> * Lesser General Public License for more details.</span>
<a name="l00012"></a>00012 <span class="comment"> *</span>
<a name="l00013"></a>00013 <span class="comment"> * You should have received a copy of the GNU Lesser General Public</span>
<a name="l00014"></a>00014 <span class="comment"> * License along with this library; If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00015"></a>00015 <span class="comment"> *</span>
<a name="l00016"></a>00016 <span class="comment"> * Author: tasleson</span>
<a name="l00017"></a>00017 <span class="comment"> */</span>
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt_8h.html">libstoragemgmt/libstoragemgmt.h</a>&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__error_8h.html">libstoragemgmt/libstoragemgmt_error.h</a>&quot;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__plug__interface_8h.html">libstoragemgmt/libstoragemgmt_plug_interface.h</a>&quot;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &quot;<a class="code" href="libstoragemgmt__types_8h.html">libstoragemgmt/libstoragemgmt_types.h</a>&quot;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;dirent.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;libxml/uri.h&gt;</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="lsm__datatypes_8hpp.html">lsm_datatypes.hpp</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="lsm__convert_8hpp.html">lsm_convert.hpp</a>&quot;</span>
<a name="l00030"></a>00030 
<a name="l00031"></a><a class="code" href="lsm__mgmt_8cpp.html#ae537fef967d9fbfad304aec7b2b85948">00031</a> <span class="preprocessor">#define COUNT_OF(x) \</span>
<a name="l00032"></a>00032 <span class="preprocessor">    ((sizeof(x)/sizeof(0[x])) / ((size_t)(!(sizeof(x) % sizeof(0[x])))))</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>
<a name="l00034"></a>00034 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> POOL_SEARCH_KEYS[] = { <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;system_id&quot;</span> };
<a name="l00035"></a>00035 
<a name="l00036"></a><a class="code" href="lsm__mgmt_8cpp.html#a0155a3043c0fc858c25b542a22844540">00036</a> <span class="preprocessor">#define POOL_SEARCH_KEYS_COUNT COUNT_OF(POOL_SEARCH_KEYS)</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span>
<a name="l00038"></a>00038 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> VOLUME_SEARCH_KEYS[] =
<a name="l00039"></a>00039     { <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;system_id&quot;</span>, <span class="stringliteral">&quot;pool_id&quot;</span> };
<a name="l00040"></a><a class="code" href="lsm__mgmt_8cpp.html#a964dd8ecdb1014f89ea3342fc868935d">00040</a> <span class="preprocessor">#define VOLUME_SEARCH_KEYS_COUNT COUNT_OF(VOLUME_SEARCH_KEYS)</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> DISK_SEARCH_KEYS[] = { <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;system_id&quot;</span> };
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="lsm__mgmt_8cpp.html#a32a3f09012bc592dfacf549049876712">00044</a> <span class="preprocessor">#define DISK_SEARCH_KEYS_COUNT COUNT_OF(DISK_SEARCH_KEYS)</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> FS_SEARCH_KEYS[] = { <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;system_id&quot;</span>, <span class="stringliteral">&quot;pool_id&quot;</span> };
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="lsm__mgmt_8cpp.html#a1239f12da06d81bbd11026d3c736fbc3">00048</a> <span class="preprocessor">#define FS_SEARCH_KEYS_COUNT COUNT_OF(FS_SEARCH_KEYS)</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span>
<a name="l00050"></a>00050 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> NFS_EXPORT_SEARCH_KEYS[] = { <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;fs_id&quot;</span> };
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="lsm__mgmt_8cpp.html#a6c2ac858134dde16d3ac27a2508424c7">00052</a> <span class="preprocessor">#define NFS_EXPORT_SEARCH_KEYS_COUNT COUNT_OF(NFS_EXPORT_SEARCH_KEYS)</span>
<a name="l00053"></a>00053 <span class="preprocessor"></span>
<a name="l00054"></a>00054 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> ACCESS_GROUP_SEARCH_KEYS[] = { <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;system_id&quot;</span> };
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="lsm__mgmt_8cpp.html#aaa4d7091b23daad190781266535c3d42">00056</a> <span class="preprocessor">#define ACCESS_GROUP_SEARCH_KEYS_COUNT COUNT_OF(ACCESS_GROUP_SEARCH_KEYS)</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>
<a name="l00058"></a>00058 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> TARGET_PORT_SEARCH_KEYS[] = { <span class="stringliteral">&quot;id&quot;</span>, <span class="stringliteral">&quot;system_id&quot;</span> };
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="lsm__mgmt_8cpp.html#a76f0ef8229743e1baa51778be9b072de">00060</a> <span class="preprocessor">#define TARGET_PORT_SEARCH_KEYS_COUNT COUNT_OF(TARGET_PORT_SEARCH_KEYS)</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span>
<a name="l00065"></a><a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">00065</a> <span class="preprocessor">#define CONN_SETUP(c)   do {            \</span>
<a name="l00066"></a>00066 <span class="preprocessor">    if(!LSM_IS_CONNECT(c)) {            \</span>
<a name="l00067"></a>00067 <span class="preprocessor">        return LSM_ERR_INVALID_ARGUMENT;\</span>
<a name="l00068"></a>00068 <span class="preprocessor">    }                                   \</span>
<a name="l00069"></a>00069 <span class="preprocessor">    lsm_error_free(c-&gt;error);           \</span>
<a name="l00070"></a>00070 <span class="preprocessor">    c-&gt;error = NULL;                    \</span>
<a name="l00071"></a>00071 <span class="preprocessor">    } while (0)</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>
<a name="l00073"></a>00073 <span class="keyword">static</span> <span class="keywordtype">int</span> check_search_key(<span class="keyword">const</span> <span class="keywordtype">char</span> *search_key,
<a name="l00074"></a>00074                             <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> supported_keys[],
<a name="l00075"></a>00075                             <span class="keywordtype">size_t</span> supported_keys_count)
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077     <span class="keywordtype">size_t</span> i = 0;
<a name="l00078"></a>00078     <span class="keywordflow">for</span> (i = 0; i &lt; supported_keys_count; ++i) {
<a name="l00079"></a>00079         <span class="keywordflow">if</span> (0 == strcmp(search_key, supported_keys[i])) {
<a name="l00080"></a>00080             <span class="keywordflow">return</span> 1;
<a name="l00081"></a>00081         }
<a name="l00082"></a>00082     }
<a name="l00083"></a>00083     <span class="keywordflow">return</span> 0;
<a name="l00084"></a>00084 }
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="lsm__mgmt_8cpp.html#a172aa664dcebf481ab8079d73bac91fc">00086</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt__common_8h.html#a489fe1ca24aea416075cca9401570741">lsm_initiator_id_verify</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *init_id,
<a name="l00087"></a>00087                             <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842db">lsm_access_group_init_type</a> * init_type)
<a name="l00088"></a>00088 {
<a name="l00089"></a>00089     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091     <span class="keywordflow">if</span> (init_id != NULL &amp;&amp; strlen(init_id) &gt; 3) {
<a name="l00092"></a>00092 
<a name="l00093"></a>00093         <span class="keywordflow">switch</span> (*init_type) {
<a name="l00094"></a>00094         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842dba7843114bdbe637e5009a67425b8b9ec9">LSM_ACCESS_GROUP_INIT_TYPE_UNKNOWN</a>):
<a name="l00095"></a>00095             <span class="keywordflow">if</span> (0 == <a class="code" href="lsm__datatypes_8hpp.html#aa975622dfbea4e976e37ed02fb5a655d">iqn_validate</a>(init_id)) {
<a name="l00096"></a>00096                 *init_type = <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842dba386288f3ad9df819273549dfe6fecddf">LSM_ACCESS_GROUP_INIT_TYPE_ISCSI_IQN</a>;
<a name="l00097"></a>00097                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00098"></a>00098             }
<a name="l00099"></a>00099             <span class="keywordflow">if</span> (0 == <a class="code" href="lsm__datatypes_8hpp.html#a23c2ca7f9ce135582d736d39ead8e15b">wwpn_validate</a>(init_id)) {
<a name="l00100"></a>00100                 *init_type = <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842dbae2ec93c0d3eb9d49dfd8d0671a684c8e">LSM_ACCESS_GROUP_INIT_TYPE_WWPN</a>;
<a name="l00101"></a>00101                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00102"></a>00102             }
<a name="l00103"></a>00103             <span class="keywordflow">break</span>;
<a name="l00104"></a>00104         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842dba386288f3ad9df819273549dfe6fecddf">LSM_ACCESS_GROUP_INIT_TYPE_ISCSI_IQN</a>):
<a name="l00105"></a>00105             <span class="keywordflow">if</span> (0 == <a class="code" href="lsm__datatypes_8hpp.html#aa975622dfbea4e976e37ed02fb5a655d">iqn_validate</a>(init_id)) {
<a name="l00106"></a>00106                 *init_type = <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842dba386288f3ad9df819273549dfe6fecddf">LSM_ACCESS_GROUP_INIT_TYPE_ISCSI_IQN</a>;
<a name="l00107"></a>00107                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00108"></a>00108             }
<a name="l00109"></a>00109             <span class="keywordflow">break</span>;
<a name="l00110"></a>00110         <span class="keywordflow">case</span> (<a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842dbae2ec93c0d3eb9d49dfd8d0671a684c8e">LSM_ACCESS_GROUP_INIT_TYPE_WWPN</a>):
<a name="l00111"></a>00111             <span class="keywordflow">if</span> (0 == <a class="code" href="lsm__datatypes_8hpp.html#a23c2ca7f9ce135582d736d39ead8e15b">wwpn_validate</a>(init_id)) {
<a name="l00112"></a>00112                 *init_type = <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842dbae2ec93c0d3eb9d49dfd8d0671a684c8e">LSM_ACCESS_GROUP_INIT_TYPE_WWPN</a>;
<a name="l00113"></a>00113                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00114"></a>00114             }
<a name="l00115"></a>00115             <span class="keywordflow">break</span>;
<a name="l00116"></a>00116         <span class="keywordflow">default</span>:
<a name="l00117"></a>00117             <span class="keywordflow">break</span>;
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120     <span class="keywordflow">return</span> rc;
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a><a class="code" href="lsm__mgmt_8cpp.html#ab629cdd043ad9c98ee7ea9be5f955863">00123</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt__common_8h.html#a3e3b5eb2c796b61e8da8b97af4e81bdd">lsm_volume_vpd83_verify</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__datatypes_8cpp.html#a446aaa84571d3e3d0e3102bca29f7df2">vpd83</a>)
<a name="l00124"></a>00124 {
<a name="l00125"></a>00125     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00126"></a>00126     <span class="keywordtype">size_t</span> i;
<a name="l00127"></a>00127     <span class="keywordtype">size_t</span> vpd83_len;
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (vpd83) {
<a name="l00130"></a>00130         vpd83_len = strlen(vpd83);
<a name="l00131"></a>00131         <span class="keywordflow">if</span> ((vpd83_len == 32 &amp;&amp; vpd83[0] == <span class="charliteral">&apos;6&apos;</span>) ||
<a name="l00132"></a>00132             (vpd83_len == 16 &amp;&amp; vpd83[0] == <span class="charliteral">&apos;2&apos;</span>) ||
<a name="l00133"></a>00133             (vpd83_len == 16 &amp;&amp; vpd83[0] == <span class="charliteral">&apos;3&apos;</span>) ||
<a name="l00134"></a>00134             (vpd83_len == 16 &amp;&amp; vpd83[0] == <span class="charliteral">&apos;5&apos;</span>)) {
<a name="l00135"></a>00135             <span class="keywordflow">for</span> (i = 0; i &lt; vpd83_len; ++i) {
<a name="l00136"></a>00136                 <span class="keywordtype">char</span> v = vpd83[i];
<a name="l00137"></a>00137                 <span class="comment">//  0-9 || a-f is OK</span>
<a name="l00138"></a>00138                 <span class="keywordflow">if</span> (!((v &gt;= 48 &amp;&amp; v &lt;= 57) || (v &gt;= 97 &amp;&amp; v &lt;= 102))) {
<a name="l00139"></a>00139                     <span class="keywordflow">return</span> rc;
<a name="l00140"></a>00140                 }
<a name="l00141"></a>00141             }
<a name="l00142"></a>00142             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00143"></a>00143         }
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145     <span class="keywordflow">return</span> rc;
<a name="l00146"></a>00146 }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 <span class="keyword">static</span> <span class="keywordtype">int</span> verify_initiator_id(<span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keywordtype">id</span>,
<a name="l00149"></a>00149                                <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842db">lsm_access_group_init_type</a> t, <a class="code" href="class_value.html">Value</a> &amp; initiator)
<a name="l00150"></a>00150 {
<a name="l00151"></a>00151     initiator = <a class="code" href="class_value.html">Value</a>(<span class="keywordtype">id</span>);
<a name="l00152"></a>00152 
<a name="l00153"></a>00153     <span class="keywordflow">if</span> (t == <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842dbae2ec93c0d3eb9d49dfd8d0671a684c8e">LSM_ACCESS_GROUP_INIT_TYPE_WWPN</a>) {
<a name="l00154"></a>00154         <span class="keywordtype">char</span> *wwpn = <a class="code" href="lsm__datatypes_8hpp.html#ad5ce87479bb0cd0bb6d7ec09d539f910">wwpn_convert</a>(<span class="keywordtype">id</span>);
<a name="l00155"></a>00155         <span class="keywordflow">if</span> (wwpn) {
<a name="l00156"></a>00156             initiator = <a class="code" href="class_value.html">Value</a>(wwpn);
<a name="l00157"></a>00157             free(wwpn);
<a name="l00158"></a>00158             wwpn = NULL;
<a name="l00159"></a>00159         } <span class="keywordflow">else</span> {
<a name="l00160"></a>00160             <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00161"></a>00161         }
<a name="l00162"></a>00162     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (t == <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842dba386288f3ad9df819273549dfe6fecddf">LSM_ACCESS_GROUP_INIT_TYPE_ISCSI_IQN</a>) {
<a name="l00163"></a>00163         <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa975622dfbea4e976e37ed02fb5a655d">iqn_validate</a>(<span class="keywordtype">id</span>)) {
<a name="l00164"></a>00164             <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166     }
<a name="l00167"></a>00167     <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00168"></a>00168 }
<a name="l00169"></a>00169 
<a name="l00173"></a><a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">00173</a> <span class="preprocessor">#define CHECK_STR(x) ( !(x) || !strlen(x) )</span>
<a name="l00174"></a>00174 <span class="preprocessor"></span>
<a name="l00180"></a><a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">00180</a> <span class="preprocessor">#define CHECK_RP(x)  (!(x) || *(x) != NULL)</span>
<a name="l00181"></a>00181 <span class="preprocessor"></span>
<a name="l00182"></a><a class="code" href="lsm__mgmt_8cpp.html#a67d84ebbfef8532b9ef2eb6ee1666dd1">00182</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ae2459b4bc940c47d0046d82be210065f">lsm_connect_password</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *uri, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacenetapp.html#acef45431d77c887a9243c5481d0918c8">password</a>,
<a name="l00183"></a>00183                          <a class="code" href="struct__lsm__connect.html">lsm_connect</a> ** conn, uint32_t timeout,
<a name="l00184"></a>00184                          <a class="code" href="struct__lsm__error.html">lsm_error_ptr</a> * e, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00185"></a>00185 {
<a name="l00186"></a>00186     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00187"></a>00187     <a class="code" href="struct__lsm__connect.html">lsm_connect</a> *c = NULL;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <span class="comment">/* Password is optional */</span>
<a name="l00190"></a>00190     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(uri) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(conn) || !timeout || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(e) ||
<a name="l00191"></a>00191         <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00192"></a>00192         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     c = <a class="code" href="lsm__datatypes_8cpp.html#a569fa39ff356013a91e292fc8beb0b26">connection_get</a>();
<a name="l00196"></a>00196     <span class="keywordflow">if</span> (c) {
<a name="l00197"></a>00197         c-&gt;<a class="code" href="struct__lsm__connect.html#a2ca632598b829d8e2d068b483a95dd9e">uri</a> = xmlParseURI(uri);
<a name="l00198"></a>00198         <span class="keywordflow">if</span> (c-&gt;<a class="code" href="struct__lsm__connect.html#a2ca632598b829d8e2d068b483a95dd9e">uri</a> &amp;&amp; c-&gt;<a class="code" href="struct__lsm__connect.html#a2ca632598b829d8e2d068b483a95dd9e">uri</a>-&gt;scheme) {
<a name="l00199"></a>00199             c-&gt;<a class="code" href="struct__lsm__connect.html#ad291ce98141f84720f05930f0d886514">raw_uri</a> = strdup(uri);
<a name="l00200"></a>00200             <span class="keywordflow">if</span> (c-&gt;<a class="code" href="struct__lsm__connect.html#ad291ce98141f84720f05930f0d886514">raw_uri</a>) {
<a name="l00201"></a>00201                 rc = <a class="code" href="lsm__datatypes_8cpp.html#a33b20fbfeaaf1e9d23c35f31a1088a0c">driver_load</a>(c, c-&gt;<a class="code" href="struct__lsm__connect.html#a2ca632598b829d8e2d068b483a95dd9e">uri</a>-&gt;scheme, password, timeout, e,
<a name="l00202"></a>00202                                  1, flags);
<a name="l00203"></a>00203                 <span class="keywordflow">if</span> (rc == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l00204"></a>00204                     *conn = (<a class="code" href="struct__lsm__connect.html">lsm_connect</a> *) c;
<a name="l00205"></a>00205                 }
<a name="l00206"></a>00206             } <span class="keywordflow">else</span> {
<a name="l00207"></a>00207                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00208"></a>00208             }
<a name="l00209"></a>00209         } <span class="keywordflow">else</span> {
<a name="l00210"></a>00210             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00211"></a>00211         }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213         <span class="comment">/*If we fail for any reason free resources associated with connection */</span>
<a name="l00214"></a>00214         <span class="keywordflow">if</span> (rc != <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l00215"></a>00215             <a class="code" href="lsm__datatypes_8cpp.html#a963ad6a93ef7c088a12a73df702d90ba">connection_free</a>(c);
<a name="l00216"></a>00216         }
<a name="l00217"></a>00217     } <span class="keywordflow">else</span> {
<a name="l00218"></a>00218         rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00219"></a>00219     }
<a name="l00220"></a>00220     <span class="keywordflow">return</span> rc;
<a name="l00221"></a>00221 }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223 <span class="keyword">static</span> <span class="keywordtype">int</span> lsm_error_log(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__error.html">lsm_error_ptr</a> <a class="code" href="client__example_8c.html#a02a815e32ecbf068b8dc5ecefd89e296">error</a>)
<a name="l00224"></a>00224 {
<a name="l00225"></a>00225     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a92d44c0f1b6c89d75baa04c9e86ee6af">LSM_IS_CONNECT</a>(c) || !<a class="code" href="lsm__datatypes_8hpp.html#a1b3fcc46128c7eb654e18d3f70cf9af5">LSM_IS_ERROR</a>(error)) {
<a name="l00226"></a>00226         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <span class="keywordflow">if</span> (c-&gt;<a class="code" href="struct__lsm__connect.html#a6b19330eec78c8072153b6d65c75e918">error</a>) {
<a name="l00230"></a>00230         <a class="code" href="libstoragemgmt__error_8h.html#a3d6c3302c51402dd037e182fe4c35500">lsm_error_free</a>(c-&gt;<a class="code" href="struct__lsm__connect.html#a6b19330eec78c8072153b6d65c75e918">error</a>);
<a name="l00231"></a>00231         c-&gt;<a class="code" href="struct__lsm__connect.html#a6b19330eec78c8072153b6d65c75e918">error</a> = NULL;
<a name="l00232"></a>00232     }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     c-&gt;<a class="code" href="struct__lsm__connect.html#a6b19330eec78c8072153b6d65c75e918">error</a> = error;
<a name="l00235"></a>00235     <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="keyword">static</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2">lsm_error_number</a> log_exception(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l00239"></a>00239                                       <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2">lsm_error_number</a> error,
<a name="l00240"></a>00240                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *message,
<a name="l00241"></a>00241                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *exception_msg)
<a name="l00242"></a>00242 {
<a name="l00243"></a>00243     <a class="code" href="struct__lsm__error.html">lsm_error_ptr</a> err = <a class="code" href="libstoragemgmt__plug__interface_8h.html#ab6e52a12c1e0e624aa659c6905433be9">lsm_error_create</a>(error, message,
<a name="l00244"></a>00244                                          exception_msg, NULL,
<a name="l00245"></a>00245                                          NULL, 0);
<a name="l00246"></a>00246     <span class="keywordflow">if</span> (err) {
<a name="l00247"></a>00247         lsm_error_log(c, err);
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249     <span class="keywordflow">return</span> error;
<a name="l00250"></a>00250 }
<a name="l00251"></a>00251 
<a name="l00252"></a>00252 <span class="keyword">static</span> <span class="keywordtype">int</span> rpc(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *method,
<a name="l00253"></a>00253                <span class="keyword">const</span> <a class="code" href="class_value.html">Value</a> &amp; parameters, <a class="code" href="class_value.html">Value</a> &amp; response) <span class="keywordflow">throw</span>()
<a name="l00254"></a>00254 {
<a name="l00255"></a>00255     <span class="keywordflow">try</span> {
<a name="l00256"></a>00256         response = c-&gt;<a class="code" href="struct__lsm__connect.html#a41f28900c0b010ae5d9c57f175d325fd">tp</a>-&gt;<a class="code" href="class_ipc.html#a87b09d1b7ddd1e720fd9809b80bf01c5">rpc</a>(method, parameters);
<a name="l00257"></a>00257     } <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00258"></a>00258         <span class="keywordflow">return</span> log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a900fbf71307c3ad0229d70b6f085989d">LSM_ERR_TRANSPORT_SERIALIZATION</a>,
<a name="l00259"></a>00259                              <span class="stringliteral">&quot;Serialization error&quot;</span>, ve.what());
<a name="l00260"></a>00260     }
<a name="l00261"></a>00261     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_lsm_exception.html">LsmException</a> &amp; le) {
<a name="l00262"></a>00262         <span class="keywordflow">return</span> log_exception(c, (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2">lsm_error_number</a>) le.<a class="code" href="class_lsm_exception.html#a7d16b1c68c87cec009d972e79abfba78">error_code</a>,
<a name="l00263"></a>00263                              le.what(), NULL);
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_e_o_f_exception.html">EOFException</a> &amp; eof) {
<a name="l00266"></a>00266         <span class="keywordflow">return</span> log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aecb93a3217b9e3634f998061a92fbad2">LSM_ERR_TRANSPORT_COMMUNICATION</a>,
<a name="l00267"></a>00267                              <span class="stringliteral">&quot;Plug-in died&quot;</span>, <span class="stringliteral">&quot;Check syslog&quot;</span>);
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269     <span class="keywordflow">catch</span>( ...) {
<a name="l00270"></a>00270         <span class="keywordflow">return</span> log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ac64627333f5366a9782886af7ec8ab28">LSM_ERR_LIB_BUG</a>, <span class="stringliteral">&quot;Unexpected exception&quot;</span>,
<a name="l00271"></a>00271                              <span class="stringliteral">&quot;Unknown exception&quot;</span>);
<a name="l00272"></a>00272     }
<a name="l00273"></a>00273     <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00276"></a>00276 <span class="keyword">static</span> <span class="keywordtype">int</span> job_check(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keywordtype">int</span> rc, <a class="code" href="class_value.html">Value</a> &amp; response, <span class="keywordtype">char</span> **job)
<a name="l00277"></a>00277 {
<a name="l00278"></a>00278     <span class="keywordflow">try</span> {
<a name="l00279"></a>00279         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00280"></a>00280             <span class="comment">//We get a value back, either null or job id.</span>
<a name="l00281"></a>00281             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00282"></a>00282                 *job = strdup(response.<a class="code" href="class_value.html#a680be1c3db1144149b5177a48dd76bdb">asString</a>().c_str());
<a name="l00283"></a>00283 
<a name="l00284"></a>00284                 <span class="keywordflow">if</span> (*job) {
<a name="l00285"></a>00285                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a>;
<a name="l00286"></a>00286                 } <span class="keywordflow">else</span> {
<a name="l00287"></a>00287                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00288"></a>00288                 }
<a name="l00289"></a>00289             } <span class="keywordflow">else</span> {
<a name="l00290"></a>00290                 *job = NULL;
<a name="l00291"></a>00291             }
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293     }
<a name="l00294"></a>00294     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00295"></a>00295         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Wrong type&quot;</span>, ve.what());
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297     <span class="keywordflow">return</span> rc;
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300 <span class="keyword">static</span> <span class="keywordtype">int</span> get_access_groups(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keywordtype">int</span> rc, <a class="code" href="class_value.html">Value</a> &amp; response,
<a name="l00301"></a>00301                              <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> ** groups[], uint32_t * count)
<a name="l00302"></a>00302 {
<a name="l00303"></a>00303     <span class="keywordflow">try</span> {
<a name="l00304"></a>00304         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00305"></a>00305             rc = <a class="code" href="lsm__convert_8cpp.html#a60ea0be43225cc70251253200a2ed818">value_array_to_access_groups</a>(response, groups, count);
<a name="l00306"></a>00306         }
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00309"></a>00309         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311     <span class="keywordflow">return</span> rc;
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 <span class="keyword">static</span> <span class="keywordtype">int</span> add_search_params(std::map &lt; std::string, Value &gt; &amp;<a class="code" href="lsm__datatypes_8cpp.html#a839528ec4ac9ec17126e8e2e1d46e9fe">p</a>,
<a name="l00315"></a>00315                              <span class="keyword">const</span> <span class="keywordtype">char</span> *k, <span class="keyword">const</span> <span class="keywordtype">char</span> *v,
<a name="l00316"></a>00316                              <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> supported_keys[],
<a name="l00317"></a>00317                              <span class="keywordtype">size_t</span> supported_keys_count)
<a name="l00318"></a>00318 {
<a name="l00319"></a>00319     <span class="keywordflow">if</span> (k) {
<a name="l00320"></a>00320         <span class="keywordflow">if</span> (v) {
<a name="l00321"></a>00321             <span class="keywordflow">if</span> (!check_search_key(k, supported_keys, supported_keys_count)) {
<a name="l00322"></a>00322                 <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a115edba49f48f078600705156fbe8b62">LSM_ERR_UNSUPPORTED_SEARCH_KEY</a>;
<a name="l00323"></a>00323             }
<a name="l00324"></a>00324         } <span class="keywordflow">else</span> {
<a name="l00325"></a>00325             <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00326"></a>00326         }
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328     p[<span class="stringliteral">&quot;search_key&quot;</span>] = <a class="code" href="class_value.html">Value</a>(k);
<a name="l00329"></a>00329     p[<span class="stringliteral">&quot;search_value&quot;</span>] = <a class="code" href="class_value.html">Value</a>(v);
<a name="l00330"></a>00330     <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00333"></a><a class="code" href="lsm__mgmt_8cpp.html#a033b0eeda2d46c7025949a64c312a8f5">00333</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a432fb468e7a6ba9749f6beb60134b41f">lsm_connect_close</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00334"></a>00334 {
<a name="l00335"></a>00335     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00338"></a>00338         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     std::map &lt; std::string, Value &gt; p;
<a name="l00342"></a>00342     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l00343"></a>00343     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l00344"></a>00344     <a class="code" href="class_value.html">Value</a> response;
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     <span class="comment">//No response data needed on plugin_unregister</span>
<a name="l00347"></a>00347     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;plugin_unregister&quot;</span>, parameters, response);
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="comment">//Free the connection.</span>
<a name="l00350"></a>00350     <a class="code" href="lsm__datatypes_8cpp.html#a963ad6a93ef7c088a12a73df702d90ba">connection_free</a>(c);
<a name="l00351"></a>00351     <span class="keywordflow">return</span> rc;
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 <span class="keyword">static</span> <a class="code" href="class_value.html">Value</a> _create_flag_param(<a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00355"></a>00355 {
<a name="l00356"></a>00356     std::map &lt; std::string, Value &gt; p;
<a name="l00357"></a>00357     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l00358"></a>00358     <span class="keywordflow">return</span> <a class="code" href="class_value.html">Value</a>(p);
<a name="l00359"></a>00359 }
<a name="l00360"></a>00360 
<a name="l00361"></a><a class="code" href="lsm__mgmt_8cpp.html#a4da8d68950271a183c91580d91b4013a">00361</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a03f001ebaf543e39e6975f9dce1b09fa">lsm_plugin_info_get</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keywordtype">char</span> **desc,
<a name="l00362"></a>00362                         <span class="keywordtype">char</span> **version, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00363"></a>00363 {
<a name="l00364"></a>00364     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00365"></a>00365     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00368"></a>00368         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00369"></a>00369     }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(desc) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(version)) {
<a name="l00372"></a>00372         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00373"></a>00373     }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="keywordflow">try</span> {
<a name="l00376"></a>00376 
<a name="l00377"></a>00377         <a class="code" href="class_value.html">Value</a> parameters = _create_flag_param(flags);
<a name="l00378"></a>00378         <a class="code" href="class_value.html">Value</a> response;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         rc = rpc(c, <span class="stringliteral">&quot;plugin_info&quot;</span>, parameters, response);
<a name="l00381"></a>00381 
<a name="l00382"></a>00382         <span class="keywordflow">if</span> (rc == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l00383"></a>00383             std::vector &lt; Value &gt; j = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l00384"></a>00384             *desc = strdup(j[0].asC_str());
<a name="l00385"></a>00385             *version = strdup(j[1].asC_str());
<a name="l00386"></a>00386 
<a name="l00387"></a>00387             <span class="keywordflow">if</span> (!*desc || !*version) {
<a name="l00388"></a>00388                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00389"></a>00389                 free(*desc);
<a name="l00390"></a>00390                 free(*version);
<a name="l00391"></a>00391             }
<a name="l00392"></a>00392         }
<a name="l00393"></a>00393     }
<a name="l00394"></a>00394     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00395"></a>00395         free(*desc);
<a name="l00396"></a>00396         *desc = NULL;
<a name="l00397"></a>00397         free(*version);
<a name="l00398"></a>00398         *version = NULL;
<a name="l00399"></a>00399         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     <span class="keywordflow">return</span> rc;
<a name="l00403"></a>00403 }
<a name="l00404"></a>00404 
<a name="l00405"></a><a class="code" href="lsm__mgmt_8cpp.html#a678ae5eeee7f7987a3b0be5c47a95787">00405</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a2141ee94cb12b0b84eb6ed7c8cf922c6">lsm_available_plugins_list</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *sep,
<a name="l00406"></a>00406                                <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> ** plugins, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00407"></a>00407 {
<a name="l00408"></a>00408     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00409"></a>00409     DIR *dirp = NULL;
<a name="l00410"></a>00410     <span class="keyword">struct </span>dirent *dp = NULL;
<a name="l00411"></a>00411     <a class="code" href="struct__lsm__connect.html">lsm_connect</a> *c = NULL;
<a name="l00412"></a>00412     <a class="code" href="struct__lsm__error.html">lsm_error_ptr</a> e = NULL;
<a name="l00413"></a>00413     <span class="keywordtype">char</span> *desc = NULL;
<a name="l00414"></a>00414     <span class="keywordtype">char</span> *version = NULL;
<a name="l00415"></a>00415     <span class="keywordtype">char</span> *s = NULL;
<a name="l00416"></a>00416     <span class="keyword">const</span> <span class="keywordtype">char</span> *uds_dir = <a class="code" href="lsm__datatypes_8cpp.html#ab513bbe85fbce1ba026ac1d105a40394">uds_path</a>();
<a name="l00417"></a>00417     <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> *plugin_list = NULL;
<a name="l00418"></a>00418 
<a name="l00419"></a>00419     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(sep) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(plugins)
<a name="l00420"></a>00420         || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00421"></a>00421         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     plugin_list = <a class="code" href="libstoragemgmt__common_8h.html#ae74bb6480d8bf5d8f7611cb1b5538943">lsm_string_list_alloc</a>(0);
<a name="l00425"></a>00425     <span class="keywordflow">if</span> (!plugin_list) {
<a name="l00426"></a>00426         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     dirp = opendir(uds_dir);
<a name="l00430"></a>00430     <span class="keywordflow">if</span> (dirp) {
<a name="l00431"></a>00431         <span class="keywordflow">for</span> (;;) {
<a name="l00432"></a>00432             dp = readdir(dirp);
<a name="l00433"></a>00433             <span class="keywordflow">if</span> (NULL == dp) {
<a name="l00434"></a>00434                 <span class="keywordflow">break</span>;
<a name="l00435"></a>00435             }
<a name="l00436"></a>00436             <span class="comment">// Check to see if we have a socket</span>
<a name="l00437"></a>00437             <span class="keywordflow">if</span> (DT_SOCK == dp-&gt;d_type) {
<a name="l00438"></a>00438                 c = <a class="code" href="lsm__datatypes_8cpp.html#a569fa39ff356013a91e292fc8beb0b26">connection_get</a>();
<a name="l00439"></a>00439                 <span class="keywordflow">if</span> (c) {
<a name="l00440"></a>00440                     rc = <a class="code" href="lsm__datatypes_8cpp.html#a33b20fbfeaaf1e9d23c35f31a1088a0c">driver_load</a>(c, dp-&gt;d_name, NULL, 30000, &amp;e, 0, 0);
<a name="l00441"></a>00441                     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00442"></a>00442                         <span class="comment">// Get the plugin information</span>
<a name="l00443"></a>00443                         rc = <a class="code" href="libstoragemgmt_8h.html#a03f001ebaf543e39e6975f9dce1b09fa">lsm_plugin_info_get</a>(c, &amp;desc, &amp;version, 0);
<a name="l00444"></a>00444                         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00445"></a>00445                             <span class="keywordtype">int</span> format =
<a name="l00446"></a>00446                                 asprintf(&amp;s, <span class="stringliteral">&quot;%s%s%s&quot;</span>, desc, sep, version);
<a name="l00447"></a>00447                             free(desc);
<a name="l00448"></a>00448                             desc = NULL;
<a name="l00449"></a>00449                             free(version);
<a name="l00450"></a>00450                             version = NULL;
<a name="l00451"></a>00451 
<a name="l00452"></a>00452                             <span class="keywordflow">if</span> (-1 == format) {
<a name="l00453"></a>00453                                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00454"></a>00454                                 <span class="keywordflow">break</span>;
<a name="l00455"></a>00455                             }
<a name="l00456"></a>00456 
<a name="l00457"></a>00457                             rc = <a class="code" href="libstoragemgmt__common_8h.html#a352f432aa4b919dd767df139d4765300">lsm_string_list_append</a>(plugin_list, s);
<a name="l00458"></a>00458                             free(s);
<a name="l00459"></a>00459                             s = NULL;
<a name="l00460"></a>00460                             <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l00461"></a>00461                                 <span class="keywordflow">break</span>;
<a name="l00462"></a>00462                             }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464                         }
<a name="l00465"></a>00465                     } <span class="keywordflow">else</span> {
<a name="l00466"></a>00466                         <span class="keywordflow">break</span>;
<a name="l00467"></a>00467                     }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469                     <a class="code" href="lsm__datatypes_8cpp.html#a963ad6a93ef7c088a12a73df702d90ba">connection_free</a>(c);
<a name="l00470"></a>00470                     c = NULL;
<a name="l00471"></a>00471                 }
<a name="l00472"></a>00472             }
<a name="l00473"></a>00473         }                       <span class="comment">/* for(;;) */</span>
<a name="l00474"></a>00474 
<a name="l00475"></a>00475         <span class="keywordflow">if</span> (e) {
<a name="l00476"></a>00476             <a class="code" href="libstoragemgmt__error_8h.html#a3d6c3302c51402dd037e182fe4c35500">lsm_error_free</a>(e);
<a name="l00477"></a>00477             e = NULL;
<a name="l00478"></a>00478         }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480         <span class="keywordflow">if</span> (c) {
<a name="l00481"></a>00481             <a class="code" href="lsm__datatypes_8cpp.html#a963ad6a93ef7c088a12a73df702d90ba">connection_free</a>(c);
<a name="l00482"></a>00482             c = NULL;
<a name="l00483"></a>00483         }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 
<a name="l00486"></a>00486         <span class="keywordflow">if</span> (-1 == closedir(dirp)) {
<a name="l00487"></a>00487             <span class="comment">//log the error</span>
<a name="l00488"></a>00488             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ac64627333f5366a9782886af7ec8ab28">LSM_ERR_LIB_BUG</a>;
<a name="l00489"></a>00489         }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491     } <span class="keywordflow">else</span> {                    <span class="comment">/* If dirp == NULL */</span>
<a name="l00492"></a>00492         <span class="comment">//Log the error</span>
<a name="l00493"></a>00493         rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2ac64627333f5366a9782886af7ec8ab28">LSM_ERR_LIB_BUG</a>;
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00497"></a>00497         *plugins = plugin_list;
<a name="l00498"></a>00498     } <span class="keywordflow">else</span> {
<a name="l00499"></a>00499         <a class="code" href="libstoragemgmt__common_8h.html#a0042977fcc59a5907892dcd5e907b891">lsm_string_list_free</a>(plugin_list);
<a name="l00500"></a>00500         plugin_list = NULL;
<a name="l00501"></a>00501     }
<a name="l00502"></a>00502 
<a name="l00503"></a>00503     <span class="keywordflow">return</span> rc;
<a name="l00504"></a>00504 }
<a name="l00505"></a>00505 
<a name="l00506"></a><a class="code" href="lsm__mgmt_8cpp.html#ab21f00373553eee363e8e8094652b9ba">00506</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a56400e26fc92acb2175b0f6c3e341876">lsm_connect_timeout_set</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, uint32_t timeout, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00507"></a>00507 {
<a name="l00508"></a>00508     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00511"></a>00511         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00512"></a>00512     }
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     std::map &lt; std::string, Value &gt; p;
<a name="l00515"></a>00515     p[<span class="stringliteral">&quot;ms&quot;</span>] = <a class="code" href="class_value.html">Value</a>(timeout);
<a name="l00516"></a>00516     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l00517"></a>00517     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l00518"></a>00518     <a class="code" href="class_value.html">Value</a> response;
<a name="l00519"></a>00519 
<a name="l00520"></a>00520     <span class="comment">//No response data needed on set time out.</span>
<a name="l00521"></a>00521     <span class="keywordflow">return</span> rpc(c, <span class="stringliteral">&quot;time_out_set&quot;</span>, parameters, response);
<a name="l00522"></a>00522 }
<a name="l00523"></a>00523 
<a name="l00524"></a><a class="code" href="lsm__mgmt_8cpp.html#a2eba55c6a599ec9ebd31f495627cf036">00524</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#acc530dd1dbed40c2e6b61d77f335884c">lsm_connect_timeout_get</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, uint32_t * timeout, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00525"></a>00525 {
<a name="l00526"></a>00526     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00527"></a>00527     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00530"></a>00530         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00531"></a>00531     }
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     <span class="keywordflow">try</span> {
<a name="l00534"></a>00534 
<a name="l00535"></a>00535         <a class="code" href="class_value.html">Value</a> parameters = _create_flag_param(flags);
<a name="l00536"></a>00536         <a class="code" href="class_value.html">Value</a> response;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538         rc = rpc(c, <span class="stringliteral">&quot;time_out_get&quot;</span>, parameters, response);
<a name="l00539"></a>00539         <span class="keywordflow">if</span> (rc == <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l00540"></a>00540             *timeout = response.<a class="code" href="class_value.html#a0da01b4c189ff90cfd35a78ddca99e40">asUint32_t</a>();
<a name="l00541"></a>00541         }
<a name="l00542"></a>00542     }
<a name="l00543"></a>00543     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00544"></a>00544         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546     <span class="keywordflow">return</span> rc;
<a name="l00547"></a>00547 }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 <span class="keyword">static</span> <span class="keywordtype">int</span> job_status(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *job,
<a name="l00550"></a>00550                       <a class="code" href="libstoragemgmt__types_8h.html#aaf3b5727fec5929181c7bd87214c0b53">lsm_job_status</a> * <a class="code" href="lsm__datatypes_8cpp.html#acbb41412818e89e6981dd22fbe4126ea">status</a>, uint8_t * percentComplete,
<a name="l00551"></a>00551                       <a class="code" href="class_value.html">Value</a> &amp; returned_value, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00552"></a>00552 {
<a name="l00553"></a>00553     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00554"></a>00554     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00555"></a>00555 
<a name="l00556"></a>00556     <span class="keywordflow">if</span> (!job || !status || !percentComplete) {
<a name="l00557"></a>00557         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00558"></a>00558     }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560     <span class="keywordflow">try</span> {
<a name="l00561"></a>00561         std::map &lt; std::string, Value &gt; p;
<a name="l00562"></a>00562         p[<span class="stringliteral">&quot;job_id&quot;</span>] = <a class="code" href="class_value.html">Value</a>(job);
<a name="l00563"></a>00563         p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l00564"></a>00564         <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l00565"></a>00565         <a class="code" href="class_value.html">Value</a> response;
<a name="l00566"></a>00566 
<a name="l00567"></a>00567         rc = rpc(c, <span class="stringliteral">&quot;job_status&quot;</span>, parameters, response);
<a name="l00568"></a>00568         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00569"></a>00569             <span class="comment">//We get back an array [status, percent, volume]</span>
<a name="l00570"></a>00570             std::vector &lt; Value &gt; j = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l00571"></a>00571             *status = (<a class="code" href="libstoragemgmt__types_8h.html#aaf3b5727fec5929181c7bd87214c0b53">lsm_job_status</a>) j[0].asInt32_t();
<a name="l00572"></a>00572             *percentComplete = (uint8_t) j[1].asUint32_t();
<a name="l00573"></a>00573 
<a name="l00574"></a>00574             returned_value = j[2];
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576     }
<a name="l00577"></a>00577     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00578"></a>00578         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00579"></a>00579     }
<a name="l00580"></a>00580     <span class="keywordflow">return</span> rc;
<a name="l00581"></a>00581 }
<a name="l00582"></a>00582 
<a name="l00583"></a><a class="code" href="lsm__mgmt_8cpp.html#a953c22ff6a9f89839820dfa3abf72130">00583</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a8e0862520b1427488573d43140c5edef">lsm_job_status_get</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *job_id,
<a name="l00584"></a>00584                        <a class="code" href="libstoragemgmt__types_8h.html#aaf3b5727fec5929181c7bd87214c0b53">lsm_job_status</a> * status, uint8_t * percentComplete,
<a name="l00585"></a>00585                        <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00590"></a>00590         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592 
<a name="l00593"></a>00593     <a class="code" href="class_value.html">Value</a> rv;
<a name="l00594"></a>00594     <span class="keywordflow">return</span> job_status(c, job_id, status, percentComplete, rv, flags);
<a name="l00595"></a>00595 }
<a name="l00596"></a>00596 
<a name="l00597"></a><a class="code" href="lsm__mgmt_8cpp.html#ae5dc05df9afa664556462446ffde43c3">00597</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ad0063a2bb83ebce86f8f35d92a7ddfe3">lsm_job_status_pool_get</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l00598"></a>00598                             <span class="keyword">const</span> <span class="keywordtype">char</span> *job, <a class="code" href="libstoragemgmt__types_8h.html#aaf3b5727fec5929181c7bd87214c0b53">lsm_job_status</a> * status,
<a name="l00599"></a>00599                             uint8_t * percentComplete, <a class="code" href="struct__lsm__pool.html">lsm_pool</a> ** pool,
<a name="l00600"></a>00600                             <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00601"></a>00601 {
<a name="l00602"></a>00602     <a class="code" href="class_value.html">Value</a> rv;
<a name="l00603"></a>00603     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00604"></a>00604 
<a name="l00605"></a>00605     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(pool) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00608"></a>00608         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611     <span class="keywordflow">try</span> {
<a name="l00612"></a>00612 
<a name="l00613"></a>00613         rc = job_status(c, job, status, percentComplete, rv, flags);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00616"></a>00616             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == rv.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00617"></a>00617                 *pool = <a class="code" href="lsm__convert_8cpp.html#a23825482fa20087834eed9d5e737fd2c">value_to_pool</a>(rv);
<a name="l00618"></a>00618                 <span class="keywordflow">if</span> (!(*pool)) {
<a name="l00619"></a>00619                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00620"></a>00620                 }
<a name="l00621"></a>00621             } <span class="keywordflow">else</span> {
<a name="l00622"></a>00622                 *pool = NULL;
<a name="l00623"></a>00623             }
<a name="l00624"></a>00624         }
<a name="l00625"></a>00625     }
<a name="l00626"></a>00626     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00627"></a>00627         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629     <span class="keywordflow">return</span> rc;
<a name="l00630"></a>00630 }
<a name="l00631"></a>00631 
<a name="l00632"></a><a class="code" href="lsm__mgmt_8cpp.html#a8b4bb1fa06447f6bcef55bdd4c6cbbc8">00632</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ad5b33e96462695dfbc134237a0de8c61">lsm_job_status_volume_get</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *job,
<a name="l00633"></a>00633                               <a class="code" href="libstoragemgmt__types_8h.html#aaf3b5727fec5929181c7bd87214c0b53">lsm_job_status</a> * status,
<a name="l00634"></a>00634                               uint8_t * percentComplete, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> ** vol,
<a name="l00635"></a>00635                               <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00636"></a>00636 {
<a name="l00637"></a>00637     <a class="code" href="class_value.html">Value</a> rv;
<a name="l00638"></a>00638     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00641"></a>00641 
<a name="l00642"></a>00642     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(vol) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00643"></a>00643         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00644"></a>00644     }
<a name="l00645"></a>00645 
<a name="l00646"></a>00646     <span class="keywordflow">try</span> {
<a name="l00647"></a>00647 
<a name="l00648"></a>00648         rc = job_status(c, job, status, percentComplete, rv, flags);
<a name="l00649"></a>00649 
<a name="l00650"></a>00650         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00651"></a>00651             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == rv.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00652"></a>00652                 *vol = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(rv);
<a name="l00653"></a>00653                 <span class="keywordflow">if</span> (!(*vol)) {
<a name="l00654"></a>00654                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00655"></a>00655                 }
<a name="l00656"></a>00656             } <span class="keywordflow">else</span> {
<a name="l00657"></a>00657                 *vol = NULL;
<a name="l00658"></a>00658             }
<a name="l00659"></a>00659         }
<a name="l00660"></a>00660     }
<a name="l00661"></a>00661     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00662"></a>00662         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00663"></a>00663     }
<a name="l00664"></a>00664     <span class="keywordflow">return</span> rc;
<a name="l00665"></a>00665 }
<a name="l00666"></a>00666 
<a name="l00667"></a><a class="code" href="lsm__mgmt_8cpp.html#a677c455c23416daff2c2283b82081692">00667</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ad521136fc72d984ab1d0c109155a13a2">lsm_job_status_fs_get</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *job,
<a name="l00668"></a>00668                           <a class="code" href="libstoragemgmt__types_8h.html#aaf3b5727fec5929181c7bd87214c0b53">lsm_job_status</a> * status,
<a name="l00669"></a>00669                           uint8_t * percentComplete, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> ** fs,
<a name="l00670"></a>00670                           <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00671"></a>00671 {
<a name="l00672"></a>00672     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00673"></a>00673     <a class="code" href="class_value.html">Value</a> rv;
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(fs) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00676"></a>00676         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00677"></a>00677     }
<a name="l00678"></a>00678 
<a name="l00679"></a>00679     <span class="keywordflow">try</span> {
<a name="l00680"></a>00680 
<a name="l00681"></a>00681         rc = job_status(c, job, status, percentComplete, rv, flags);
<a name="l00682"></a>00682 
<a name="l00683"></a>00683         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00684"></a>00684             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == rv.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00685"></a>00685                 *fs = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(rv);
<a name="l00686"></a>00686                 <span class="keywordflow">if</span> (!(*fs)) {
<a name="l00687"></a>00687                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00688"></a>00688                 }
<a name="l00689"></a>00689             } <span class="keywordflow">else</span> {
<a name="l00690"></a>00690                 *fs = NULL;
<a name="l00691"></a>00691             }
<a name="l00692"></a>00692         }
<a name="l00693"></a>00693     }
<a name="l00694"></a>00694     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00695"></a>00695         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00696"></a>00696     }
<a name="l00697"></a>00697     <span class="keywordflow">return</span> rc;
<a name="l00698"></a>00698 }
<a name="l00699"></a>00699 
<a name="l00700"></a><a class="code" href="lsm__mgmt_8cpp.html#a5e2f7ded9a74f4e495e6c42ed971ccff">00700</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ad59c0522b6f3095b837c6fae83cf9e94">lsm_job_status_ss_get</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *job,
<a name="l00701"></a>00701                           <a class="code" href="libstoragemgmt__types_8h.html#aaf3b5727fec5929181c7bd87214c0b53">lsm_job_status</a> * status,
<a name="l00702"></a>00702                           uint8_t * percentComplete, <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> ** ss,
<a name="l00703"></a>00703                           <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00704"></a>00704 {
<a name="l00705"></a>00705     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00706"></a>00706     <a class="code" href="class_value.html">Value</a> rv;
<a name="l00707"></a>00707 
<a name="l00708"></a>00708     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(ss) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00709"></a>00709         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00710"></a>00710     }
<a name="l00711"></a>00711 
<a name="l00712"></a>00712     <span class="keywordflow">try</span> {
<a name="l00713"></a>00713 
<a name="l00714"></a>00714         rc = job_status(c, job, status, percentComplete, rv, flags);
<a name="l00715"></a>00715 
<a name="l00716"></a>00716         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00717"></a>00717             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == rv.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00718"></a>00718                 *ss = <a class="code" href="lsm__convert_8cpp.html#a6018acc6f5e2ae46dfa37a94f17b347b">value_to_ss</a>(rv);
<a name="l00719"></a>00719                 <span class="keywordflow">if</span> (!(*ss)) {
<a name="l00720"></a>00720                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00721"></a>00721                 }
<a name="l00722"></a>00722             } <span class="keywordflow">else</span> {
<a name="l00723"></a>00723                 *ss = NULL;
<a name="l00724"></a>00724             }
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726     }
<a name="l00727"></a>00727     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00728"></a>00728         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730     <span class="keywordflow">return</span> rc;
<a name="l00731"></a>00731 }
<a name="l00732"></a>00732 
<a name="l00733"></a><a class="code" href="lsm__mgmt_8cpp.html#aca5e3622074f9f8b017356965b52d6b2">00733</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#af38fe0ea461e4517598d9907bf8d799f">lsm_job_free</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00734"></a>00734 {
<a name="l00735"></a>00735     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00736"></a>00736 
<a name="l00737"></a>00737     <span class="keywordflow">if</span> (job == NULL || strlen(*job) &lt; 1 || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00738"></a>00738         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00739"></a>00739     }
<a name="l00740"></a>00740 
<a name="l00741"></a>00741     std::map &lt; std::string, Value &gt; p;
<a name="l00742"></a>00742     p[<span class="stringliteral">&quot;job_id&quot;</span>] = <a class="code" href="class_value.html">Value</a>(*job);
<a name="l00743"></a>00743     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l00744"></a>00744     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l00745"></a>00745     <a class="code" href="class_value.html">Value</a> response;
<a name="l00746"></a>00746 
<a name="l00747"></a>00747     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;job_free&quot;</span>, parameters, response);
<a name="l00748"></a>00748 
<a name="l00749"></a>00749     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00750"></a>00750         <span class="comment">/* Free the memory for the job id */</span>
<a name="l00751"></a>00751         free(*job);
<a name="l00752"></a>00752         *job = NULL;
<a name="l00753"></a>00753     }
<a name="l00754"></a>00754     <span class="keywordflow">return</span> rc;
<a name="l00755"></a>00755 }
<a name="l00756"></a>00756 
<a name="l00757"></a><a class="code" href="lsm__mgmt_8cpp.html#a28277b8f2cd68f325882c65477d19895">00757</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a9c4fb10300466dbde45d61c6786407c6">lsm_capabilities</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__system.html">lsm_system</a> * system,
<a name="l00758"></a>00758                      <a class="code" href="struct__lsm__storage__capabilities.html">lsm_storage_capabilities</a> ** cap, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00759"></a>00759 {
<a name="l00760"></a>00760     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00761"></a>00761     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00762"></a>00762 
<a name="l00763"></a>00763     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a690e5decf5a95b077d112fd2723fde7d">LSM_IS_SYSTEM</a>(system) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(cap) ||
<a name="l00764"></a>00764         <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00765"></a>00765         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00766"></a>00766     }
<a name="l00767"></a>00767 
<a name="l00768"></a>00768     std::map &lt; std::string, Value &gt; p;
<a name="l00769"></a>00769 
<a name="l00770"></a>00770     p[<span class="stringliteral">&quot;system&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a64192028f7e1cd9ba79969062d17d3ea">system_to_value</a>(system);
<a name="l00771"></a>00771     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l00772"></a>00772 
<a name="l00773"></a>00773     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l00774"></a>00774     <a class="code" href="class_value.html">Value</a> response;
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="keywordflow">try</span> {
<a name="l00777"></a>00777         rc = rpc(c, <span class="stringliteral">&quot;capabilities&quot;</span>, parameters, response);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00780"></a>00780             *cap = <a class="code" href="lsm__convert_8cpp.html#af939e3d9e018e658a393fff22cf95256">value_to_capabilities</a>(response);
<a name="l00781"></a>00781             <span class="keywordflow">if</span> (!(*cap)) {
<a name="l00782"></a>00782                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00783"></a>00783             }
<a name="l00784"></a>00784         }
<a name="l00785"></a>00785     }
<a name="l00786"></a>00786     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00787"></a>00787         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00788"></a>00788     }
<a name="l00789"></a>00789 
<a name="l00790"></a>00790     <span class="keywordflow">return</span> rc;
<a name="l00791"></a>00791 }
<a name="l00792"></a>00792 
<a name="l00793"></a><a class="code" href="lsm__mgmt_8cpp.html#ade69ae22b0faeaa2ef923d4d1b2f646c">00793</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#aa61c2c3acf8bcb9e10b611e679000407">lsm_pool_list</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keywordtype">char</span> *search_key, <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>,
<a name="l00794"></a>00794                   <a class="code" href="struct__lsm__pool.html">lsm_pool</a> ** poolArray[], uint32_t * count, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00795"></a>00795 {
<a name="l00796"></a>00796     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00797"></a>00797     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00798"></a>00798 
<a name="l00799"></a>00799     <span class="keywordflow">if</span> (!poolArray || !count || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(poolArray)) {
<a name="l00800"></a>00800         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00801"></a>00801     }
<a name="l00802"></a>00802 
<a name="l00803"></a>00803     *count = 0;
<a name="l00804"></a>00804     *poolArray = NULL;
<a name="l00805"></a>00805 
<a name="l00806"></a>00806     <span class="keywordflow">try</span> {
<a name="l00807"></a>00807         std::map &lt; std::string, Value &gt; p;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809         rc = add_search_params(p, search_key, search_value,
<a name="l00810"></a>00810                                POOL_SEARCH_KEYS, <a class="code" href="lsm__mgmt_8cpp.html#a0155a3043c0fc858c25b542a22844540">POOL_SEARCH_KEYS_COUNT</a>);
<a name="l00811"></a>00811         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l00812"></a>00812             <span class="keywordflow">return</span> rc;
<a name="l00813"></a>00813         }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815         p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l00816"></a>00816         <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l00817"></a>00817         <a class="code" href="class_value.html">Value</a> response;
<a name="l00818"></a>00818 
<a name="l00819"></a>00819         rc = rpc(c, <span class="stringliteral">&quot;pools&quot;</span>, parameters, response);
<a name="l00820"></a>00820         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00821"></a>00821             std::vector &lt; Value &gt; pools = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l00822"></a>00822 
<a name="l00823"></a>00823             *count = pools.size();
<a name="l00824"></a>00824 
<a name="l00825"></a>00825             <span class="keywordflow">if</span> (pools.size()) {
<a name="l00826"></a>00826                 *poolArray = <a class="code" href="libstoragemgmt__plug__interface_8h.html#a6885151254294dcf5c405620ae767845">lsm_pool_record_array_alloc</a>(pools.size());
<a name="l00827"></a>00827 
<a name="l00828"></a>00828                 <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; pools.size(); ++i) {
<a name="l00829"></a>00829                     (*poolArray)[i] = <a class="code" href="lsm__convert_8cpp.html#a23825482fa20087834eed9d5e737fd2c">value_to_pool</a>(pools[i]);
<a name="l00830"></a>00830                     <span class="keywordflow">if</span> (!(*poolArray)[i]) {
<a name="l00831"></a>00831                         rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00832"></a>00832                         <span class="keywordflow">goto</span> error;
<a name="l00833"></a>00833                     }
<a name="l00834"></a>00834                 }
<a name="l00835"></a>00835             }
<a name="l00836"></a>00836         }
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00839"></a>00839         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00840"></a>00840         <span class="keywordflow">goto</span> error;
<a name="l00841"></a>00841     }
<a name="l00842"></a>00842 
<a name="l00843"></a>00843   <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>:
<a name="l00844"></a>00844     <span class="keywordflow">return</span> rc;
<a name="l00845"></a>00845 
<a name="l00846"></a>00846   error:
<a name="l00847"></a>00847     <span class="keywordflow">if</span> (*poolArray &amp;&amp; *count) {
<a name="l00848"></a>00848         <a class="code" href="libstoragemgmt__pool_8h.html#a62fb44ace12507bcff9786d4bf94ea6d">lsm_pool_record_array_free</a>(*poolArray, *count);
<a name="l00849"></a>00849         *poolArray = NULL;
<a name="l00850"></a>00850         *count = 0;
<a name="l00851"></a>00851     }
<a name="l00852"></a>00852     <span class="keywordflow">goto</span> <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l00853"></a>00853 }
<a name="l00854"></a>00854 
<a name="l00855"></a><a class="code" href="lsm__mgmt_8cpp.html#a2fe3ffb3710db0a8c948e83ccb2c0df3">00855</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#aa2fd9575b38c0651d8e16b590175069d">lsm_pool_member_info</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__pool.html">lsm_pool</a> * pool,
<a name="l00856"></a>00856                          <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545">lsm_volume_raid_type</a> * raid_type,
<a name="l00857"></a>00857                          <a class="code" href="libstoragemgmt__types_8h.html#a0c8a15a19746091962bf98c1c6d85f5c">lsm_pool_member_type</a> * member_type,
<a name="l00858"></a>00858                          <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> ** member_ids, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00859"></a>00859 {
<a name="l00860"></a>00860     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l00861"></a>00861         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00862"></a>00862     }
<a name="l00863"></a>00863 
<a name="l00864"></a>00864     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00865"></a>00865     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00866"></a>00866 
<a name="l00867"></a>00867     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a6c1a7b0350eee43615b3a0c58cac3c77">LSM_IS_POOL</a>(pool)) {
<a name="l00868"></a>00868         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00869"></a>00869     }
<a name="l00870"></a>00870 
<a name="l00871"></a>00871     <span class="keywordflow">if</span> (!raid_type || !member_type || !member_ids) {
<a name="l00872"></a>00872         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00873"></a>00873     }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875     std::map &lt; std::string, Value &gt; p;
<a name="l00876"></a>00876     p[<span class="stringliteral">&quot;pool&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#af80b3591fe77244b1ed101e3d01af195">pool_to_value</a>(pool);
<a name="l00877"></a>00877     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l00878"></a>00878     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l00879"></a>00879     <span class="keywordflow">try</span> {
<a name="l00880"></a>00880 
<a name="l00881"></a>00881         <a class="code" href="class_value.html">Value</a> response;
<a name="l00882"></a>00882 
<a name="l00883"></a>00883         rc = rpc(c, <span class="stringliteral">&quot;pool_member_info&quot;</span>, parameters, response);
<a name="l00884"></a>00884         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l00885"></a>00885             std::vector &lt; Value &gt; j = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l00886"></a>00886             *raid_type = (<a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545">lsm_volume_raid_type</a>) j[0].asInt32_t();
<a name="l00887"></a>00887             *member_type = (<a class="code" href="libstoragemgmt__types_8h.html#a0c8a15a19746091962bf98c1c6d85f5c">lsm_pool_member_type</a>) j[1].asInt32_t();
<a name="l00888"></a>00888             *member_ids = NULL;
<a name="l00889"></a>00889             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == j[2].valueType()) {
<a name="l00890"></a>00890                 <span class="keywordflow">if</span> (j[2].asArray().size()) {
<a name="l00891"></a>00891                     *member_ids = <a class="code" href="lsm__convert_8cpp.html#ab5eeee745fbaa40daddfa60c77567d18">value_to_string_list</a>(j[2]);
<a name="l00892"></a>00892                     <span class="keywordflow">if</span> (*member_ids == NULL) {
<a name="l00893"></a>00893                         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00894"></a>00894                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__common_8h.html#ad34a6ddb243ad500bda1ed9221d1555f">lsm_string_list_size</a>(*member_ids) !=
<a name="l00895"></a>00895                                j[2].asArray().size()) {
<a name="l00896"></a>00896 
<a name="l00897"></a>00897                         <a class="code" href="libstoragemgmt__common_8h.html#a0042977fcc59a5907892dcd5e907b891">lsm_string_list_free</a>(*member_ids);
<a name="l00898"></a>00898                         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00899"></a>00899                     }
<a name="l00900"></a>00900                 }
<a name="l00901"></a>00901             } <span class="keywordflow">else</span> {
<a name="l00902"></a>00902                 rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>,
<a name="l00903"></a>00903                                    <span class="stringliteral">&quot;member_ids data is not an array&quot;</span>,
<a name="l00904"></a>00904                                    <span class="stringliteral">&quot;member_ids data is not an array&quot;</span>);
<a name="l00905"></a>00905             }
<a name="l00906"></a>00906         }
<a name="l00907"></a>00907     }
<a name="l00908"></a>00908     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00909"></a>00909         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00910"></a>00910     }
<a name="l00911"></a>00911     <span class="keywordflow">return</span> rc;
<a name="l00912"></a>00912 
<a name="l00913"></a>00913 }
<a name="l00914"></a>00914 
<a name="l00915"></a><a class="code" href="lsm__mgmt_8cpp.html#a96dafa5589e886f2a30c1d32aae89dfb">00915</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a46eeb74cadfddc89574870b26d7e1fef">lsm_target_port_list</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *search_key,
<a name="l00916"></a>00916                          <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>,
<a name="l00917"></a>00917                          lsm_target_port ** target_ports[],
<a name="l00918"></a>00918                          uint32_t * count, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00919"></a>00919 {
<a name="l00920"></a>00920     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l00921"></a>00921     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <span class="keywordflow">if</span> (!target_ports || !count || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(target_ports)) {
<a name="l00924"></a>00924         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00925"></a>00925     }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927     <span class="keywordflow">try</span> {
<a name="l00928"></a>00928         std::map &lt; std::string, Value &gt; p;
<a name="l00929"></a>00929 
<a name="l00930"></a>00930         rc = add_search_params(p, search_key, search_value,
<a name="l00931"></a>00931                                TARGET_PORT_SEARCH_KEYS,
<a name="l00932"></a>00932                                <a class="code" href="lsm__mgmt_8cpp.html#a76f0ef8229743e1baa51778be9b072de">TARGET_PORT_SEARCH_KEYS_COUNT</a>);
<a name="l00933"></a>00933         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l00934"></a>00934             <span class="keywordflow">return</span> rc;
<a name="l00935"></a>00935         }
<a name="l00936"></a>00936 
<a name="l00937"></a>00937         p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l00938"></a>00938         <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l00939"></a>00939         <a class="code" href="class_value.html">Value</a> response;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941         rc = rpc(c, <span class="stringliteral">&quot;target_ports&quot;</span>, parameters, response);
<a name="l00942"></a>00942         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00943"></a>00943             std::vector &lt; Value &gt; <a class="code" href="lsm__plugin__ipc_8cpp.html#a70a32bd2be98dd0919402d512789b467">tp</a> = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l00944"></a>00944 
<a name="l00945"></a>00945             *count = tp.size();
<a name="l00946"></a>00946 
<a name="l00947"></a>00947             <span class="keywordflow">if</span> (tp.size()) {
<a name="l00948"></a>00948                 *target_ports = <a class="code" href="libstoragemgmt__plug__interface_8h.html#a16ddd7534229e2eac033f641c004c52c">lsm_target_port_record_array_alloc</a>(tp.size());
<a name="l00949"></a>00949 
<a name="l00950"></a>00950                 <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; tp.size(); ++i) {
<a name="l00951"></a>00951                     (*target_ports)[i] = <a class="code" href="lsm__convert_8cpp.html#a8147ed8ed6311fdac25bcaa1010ce3db">value_to_target_port</a>(tp[i]);
<a name="l00952"></a>00952                     <span class="keywordflow">if</span> (!((*target_ports)[i])) {
<a name="l00953"></a>00953                         rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l00954"></a>00954                         <span class="keywordflow">goto</span> error;
<a name="l00955"></a>00955                     }
<a name="l00956"></a>00956                 }
<a name="l00957"></a>00957             }
<a name="l00958"></a>00958         }
<a name="l00959"></a>00959     }
<a name="l00960"></a>00960     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00961"></a>00961         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l00962"></a>00962         <span class="keywordflow">goto</span> error;
<a name="l00963"></a>00963     }
<a name="l00964"></a>00964   <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>:
<a name="l00965"></a>00965     <span class="keywordflow">return</span> rc;
<a name="l00966"></a>00966 
<a name="l00967"></a>00967   error:
<a name="l00968"></a>00968     <span class="keywordflow">if</span> (*target_ports &amp;&amp; *count) {
<a name="l00969"></a>00969         <a class="code" href="libstoragemgmt__targetport_8h.html#a01ae45fe7fa4a104af8278daf36b605a">lsm_target_port_record_array_free</a>(*target_ports, *count);
<a name="l00970"></a>00970         *target_ports = NULL;
<a name="l00971"></a>00971         *count = 0;
<a name="l00972"></a>00972     }
<a name="l00973"></a>00973     <span class="keywordflow">goto</span> <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l00974"></a>00974 }
<a name="l00975"></a>00975 
<a name="l00976"></a>00976 <span class="keyword">static</span> <span class="keywordtype">int</span> get_volume_array(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keywordtype">int</span> rc, <a class="code" href="class_value.html">Value</a> &amp; response,
<a name="l00977"></a>00977                             <a class="code" href="struct__lsm__volume.html">lsm_volume</a> ** volumes[], uint32_t * count)
<a name="l00978"></a>00978 {
<a name="l00979"></a>00979     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l00980"></a>00980         <span class="keywordflow">try</span> {
<a name="l00981"></a>00981             rc = <a class="code" href="lsm__convert_8cpp.html#a08d9a32fcb85aa3ea652f2eee2551a97">value_array_to_volumes</a>(response, volumes, count);
<a name="l00982"></a>00982         }
<a name="l00983"></a>00983         <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l00984"></a>00984             rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Wrong type&quot;</span>, ve.what());
<a name="l00985"></a>00985         }
<a name="l00986"></a>00986     }
<a name="l00987"></a>00987     <span class="keywordflow">return</span> rc;
<a name="l00988"></a>00988 }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990 
<a name="l00991"></a><a class="code" href="lsm__mgmt_8cpp.html#aeca0df4df107a07f79576371680dcb75">00991</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#aee1e26041fd5c9ed22bd4769bca55b72">lsm_volume_list</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *search_key,
<a name="l00992"></a>00992                     <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> ** volumes[],
<a name="l00993"></a>00993                     uint32_t * count, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l00994"></a>00994 {
<a name="l00995"></a>00995     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l00996"></a>00996 
<a name="l00997"></a>00997     <span class="keywordflow">if</span> (!volumes || !count || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(volumes)) {
<a name="l00998"></a>00998         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000 
<a name="l01001"></a>01001     std::map &lt; std::string, Value &gt; p;
<a name="l01002"></a>01002     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01003"></a>01003 
<a name="l01004"></a>01004     <span class="keywordtype">int</span> rc = add_search_params(p, search_key, search_value, VOLUME_SEARCH_KEYS,
<a name="l01005"></a>01005                                <a class="code" href="lsm__mgmt_8cpp.html#a964dd8ecdb1014f89ea3342fc868935d">VOLUME_SEARCH_KEYS_COUNT</a>);
<a name="l01006"></a>01006     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l01007"></a>01007         <span class="keywordflow">return</span> rc;
<a name="l01008"></a>01008     }
<a name="l01009"></a>01009 
<a name="l01010"></a>01010     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01011"></a>01011     <a class="code" href="class_value.html">Value</a> response;
<a name="l01012"></a>01012 
<a name="l01013"></a>01013     rc = rpc(c, <span class="stringliteral">&quot;volumes&quot;</span>, parameters, response);
<a name="l01014"></a>01014     <span class="keywordflow">return</span> get_volume_array(c, rc, response, volumes, count);
<a name="l01015"></a>01015 }
<a name="l01016"></a>01016 
<a name="l01017"></a>01017 <span class="keyword">static</span> <span class="keywordtype">int</span> get_disk_array(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keywordtype">int</span> rc, <a class="code" href="class_value.html">Value</a> &amp; response,
<a name="l01018"></a>01018                           <a class="code" href="struct__lsm__disk.html">lsm_disk</a> ** disks[], uint32_t * count)
<a name="l01019"></a>01019 {
<a name="l01020"></a>01020     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l01021"></a>01021         rc = <a class="code" href="lsm__convert_8cpp.html#a6d7cb1ca7482f3ff52ed1ff6dcd335b4">value_array_to_disks</a>(response, disks, count);
<a name="l01022"></a>01022 
<a name="l01023"></a>01023         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l01024"></a>01024             rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, NULL);
<a name="l01025"></a>01025         }
<a name="l01026"></a>01026     }
<a name="l01027"></a>01027 
<a name="l01028"></a>01028     <span class="keywordflow">return</span> rc;
<a name="l01029"></a>01029 }
<a name="l01030"></a>01030 
<a name="l01031"></a><a class="code" href="lsm__mgmt_8cpp.html#a244e97ba9471ad712b47cae7099f03ed">01031</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a9b10dd8cf922071f1fc6c9fb960a3936">lsm_disk_list</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *search_key,
<a name="l01032"></a>01032                   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>,
<a name="l01033"></a>01033                   <a class="code" href="struct__lsm__disk.html">lsm_disk</a> ** disks[], uint32_t * count, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01034"></a>01034 {
<a name="l01035"></a>01035     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01036"></a>01036 
<a name="l01037"></a>01037     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(disks) || !count) {
<a name="l01038"></a>01038         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01039"></a>01039     }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041     std::map &lt; std::string, Value &gt; p;
<a name="l01042"></a>01042     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01043"></a>01043 
<a name="l01044"></a>01044     <span class="keywordtype">int</span> rc = add_search_params(p, search_key, search_value, DISK_SEARCH_KEYS,
<a name="l01045"></a>01045                                <a class="code" href="lsm__mgmt_8cpp.html#a32a3f09012bc592dfacf549049876712">DISK_SEARCH_KEYS_COUNT</a>);
<a name="l01046"></a>01046     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l01047"></a>01047         <span class="keywordflow">return</span> rc;
<a name="l01048"></a>01048     }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01051"></a>01051     <a class="code" href="class_value.html">Value</a> response;
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     rc = rpc(c, <span class="stringliteral">&quot;disks&quot;</span>, parameters, response);
<a name="l01054"></a>01054     <span class="keywordflow">return</span> get_disk_array(c, rc, response, disks, count);
<a name="l01055"></a>01055 }
<a name="l01056"></a>01056 
<a name="l01057"></a><a class="code" href="lsm__mgmt_8cpp.html#a7a13ea19682cf43e08f2abec1127a37d">01057</a> <span class="keyword">typedef</span> <span class="keywordtype">void</span> *(*convert) (<a class="code" href="class_value.html">Value</a> &amp; v);
<a name="l01058"></a>01058 
<a name="l01059"></a>01059 <span class="keyword">static</span> <span class="keywordtype">void</span> *parse_job_response(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="class_value.html">Value</a> response, <span class="keywordtype">int</span> &amp;rc,
<a name="l01060"></a>01060                                 <span class="keywordtype">char</span> **job, <a class="code" href="lsm__mgmt_8cpp.html#a7a13ea19682cf43e08f2abec1127a37d">convert</a> conv)
<a name="l01061"></a>01061 {
<a name="l01062"></a>01062     <span class="keywordtype">void</span> *val = NULL;
<a name="l01063"></a>01063     *job = NULL;
<a name="l01064"></a>01064 
<a name="l01065"></a>01065     <span class="keywordflow">try</span> {
<a name="l01066"></a>01066         <span class="comment">//We get an array back. first value is job, second is data of interest.</span>
<a name="l01067"></a>01067         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l01068"></a>01068             std::vector &lt; Value &gt; r = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l01069"></a>01069             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6e3ee991a13c4e7cb187b4fd7ced0c23">Value::string_t</a> == r[0].valueType()) {
<a name="l01070"></a>01070                 *job = strdup((r[0].asString()).c_str());
<a name="l01071"></a>01071                 <span class="keywordflow">if</span> (!(*job)) {
<a name="l01072"></a>01072                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01073"></a>01073                     <span class="keywordflow">goto</span> error;
<a name="l01074"></a>01074                 }
<a name="l01075"></a>01075 
<a name="l01076"></a>01076                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a70ae1ea59a761b3972599d26d6b6f9b9">LSM_ERR_JOB_STARTED</a>;
<a name="l01077"></a>01077             }
<a name="l01078"></a>01078             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == r[1].valueType()) {
<a name="l01079"></a>01079                 val = conv(r[1]);
<a name="l01080"></a>01080                 <span class="keywordflow">if</span> (!val) {
<a name="l01081"></a>01081                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01082"></a>01082                     <span class="keywordflow">goto</span> error;
<a name="l01083"></a>01083                 }
<a name="l01084"></a>01084             }
<a name="l01085"></a>01085         }
<a name="l01086"></a>01086     }
<a name="l01087"></a>01087     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l01088"></a>01088         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l01089"></a>01089         <span class="keywordflow">goto</span> error;
<a name="l01090"></a>01090     }
<a name="l01091"></a>01091 
<a name="l01092"></a>01092   <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>:
<a name="l01093"></a>01093     <span class="keywordflow">return</span> val;
<a name="l01094"></a>01094 
<a name="l01095"></a>01095   error:
<a name="l01096"></a>01096     free(*job);
<a name="l01097"></a>01097     *job = NULL;
<a name="l01098"></a>01098     <span class="keywordflow">goto</span> <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l01099"></a>01099 }
<a name="l01100"></a>01100 
<a name="l01101"></a><a class="code" href="lsm__mgmt_8cpp.html#aada710ab90dfc716d7c4f41085522aa0">01101</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a962ada9665531bf9ab5f7dded9e096af">lsm_volume_create</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__pool.html">lsm_pool</a> * pool,
<a name="l01102"></a>01102                       <span class="keyword">const</span> <span class="keywordtype">char</span> *volumeName, uint64_t size,
<a name="l01103"></a>01103                       <a class="code" href="libstoragemgmt__types_8h.html#a7df5745e43868cc250c3e2046ffb7ff4">lsm_volume_provision_type</a> provisioning,
<a name="l01104"></a>01104                       <a class="code" href="struct__lsm__volume.html">lsm_volume</a> ** newVolume, <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01105"></a>01105 {
<a name="l01106"></a>01106     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01107"></a>01107 
<a name="l01108"></a>01108     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a6c1a7b0350eee43615b3a0c58cac3c77">LSM_IS_POOL</a>(pool)) {
<a name="l01109"></a>01109         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01110"></a>01110     }
<a name="l01111"></a>01111 
<a name="l01112"></a>01112     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(volumeName) || !size || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(newVolume) ||
<a name="l01113"></a>01113         <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01114"></a>01114         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01115"></a>01115     }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117     std::map &lt; std::string, Value &gt; p;
<a name="l01118"></a>01118     p[<span class="stringliteral">&quot;pool&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#af80b3591fe77244b1ed101e3d01af195">pool_to_value</a>(pool);
<a name="l01119"></a>01119     p[<span class="stringliteral">&quot;volume_name&quot;</span>] = <a class="code" href="class_value.html">Value</a>(volumeName);
<a name="l01120"></a>01120     p[<span class="stringliteral">&quot;size_bytes&quot;</span>] = <a class="code" href="class_value.html">Value</a>(size);
<a name="l01121"></a>01121     p[<span class="stringliteral">&quot;provisioning&quot;</span>] = <a class="code" href="class_value.html">Value</a>((int32_t) provisioning);
<a name="l01122"></a>01122     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01123"></a>01123 
<a name="l01124"></a>01124     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01125"></a>01125     <a class="code" href="class_value.html">Value</a> response;
<a name="l01126"></a>01126 
<a name="l01127"></a>01127     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;volume_create&quot;</span>, parameters, response);
<a name="l01128"></a>01128     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01129"></a>01129         *newVolume =
<a name="l01130"></a>01130             (<a class="code" href="struct__lsm__volume.html">lsm_volume</a> *) parse_job_response(c, response, rc, job,
<a name="l01131"></a>01131                                               (<a class="code" href="lsm__mgmt_8cpp.html#a7a13ea19682cf43e08f2abec1127a37d">convert</a>) <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>);
<a name="l01132"></a>01132     }
<a name="l01133"></a>01133     <span class="keywordflow">return</span> rc;
<a name="l01134"></a>01134 }
<a name="l01135"></a>01135 
<a name="l01136"></a><a class="code" href="lsm__mgmt_8cpp.html#a0cb40bb591c6a1124d0557adf2d02ea2">01136</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a607d886692442ae54095098419d24a56">lsm_volume_resize</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volume,
<a name="l01137"></a>01137                       uint64_t newSize, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> ** resizedVolume,
<a name="l01138"></a>01138                       <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01139"></a>01139 {
<a name="l01140"></a>01140     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01141"></a>01141 
<a name="l01142"></a>01142     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(volume) || !newSize || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(resizedVolume) ||
<a name="l01143"></a>01143         <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job) || newSize == 0 || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01144"></a>01144         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01145"></a>01145     }
<a name="l01146"></a>01146     <span class="comment">//If you try to resize to same size, we will return error.</span>
<a name="l01147"></a>01147     <span class="keywordflow">if</span> ((newSize / volume-&gt;<a class="code" href="struct__lsm__volume.html#a06e04cd37a309e4f7d66014f0d9aa2be">block_size</a>) == volume-&gt;<a class="code" href="struct__lsm__volume.html#ab6c1fa974f68e82355986b9c728221da">number_of_blocks</a>) {
<a name="l01148"></a>01148         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a4780813ab36aacc0d2143adf9ee5ee6c">LSM_ERR_NO_STATE_CHANGE</a>;
<a name="l01149"></a>01149     }
<a name="l01150"></a>01150 
<a name="l01151"></a>01151     std::map &lt; std::string, Value &gt; p;
<a name="l01152"></a>01152     p[<span class="stringliteral">&quot;volume&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(volume);
<a name="l01153"></a>01153     p[<span class="stringliteral">&quot;new_size_bytes&quot;</span>] = <a class="code" href="class_value.html">Value</a>(newSize);
<a name="l01154"></a>01154     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01155"></a>01155 
<a name="l01156"></a>01156     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01157"></a>01157     <a class="code" href="class_value.html">Value</a> response;
<a name="l01158"></a>01158 
<a name="l01159"></a>01159     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;volume_resize&quot;</span>, parameters, response);
<a name="l01160"></a>01160     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01161"></a>01161         *resizedVolume =
<a name="l01162"></a>01162             (<a class="code" href="struct__lsm__volume.html">lsm_volume</a> *) parse_job_response(c, response, rc, job,
<a name="l01163"></a>01163                                               (<a class="code" href="lsm__mgmt_8cpp.html#a7a13ea19682cf43e08f2abec1127a37d">convert</a>) <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>);
<a name="l01164"></a>01164     }
<a name="l01165"></a>01165     <span class="keywordflow">return</span> rc;
<a name="l01166"></a>01166 }
<a name="l01167"></a>01167 
<a name="l01168"></a><a class="code" href="lsm__mgmt_8cpp.html#adf7c883b3d78e4e18f824897f67e8192">01168</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a12048db494c1ba1c046a4a09875078ae">lsm_volume_replicate</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__pool.html">lsm_pool</a> * pool,
<a name="l01169"></a>01169                          <a class="code" href="libstoragemgmt__types_8h.html#a18ffef5fae2ce2f8fee7b2444b3119fd">lsm_replication_type</a> repType,
<a name="l01170"></a>01170                          <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volumeSrc, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__datatypes_8cpp.html#a2cc1fcbe95db9f01f0bc16e608508a1d">name</a>,
<a name="l01171"></a>01171                          <a class="code" href="struct__lsm__volume.html">lsm_volume</a> ** newReplicant, <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01172"></a>01172 {
<a name="l01173"></a>01173     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01174"></a>01174 
<a name="l01175"></a>01175     <span class="keywordflow">if</span> ((pool &amp;&amp; !<a class="code" href="lsm__datatypes_8hpp.html#a6c1a7b0350eee43615b3a0c58cac3c77">LSM_IS_POOL</a>(pool)) || !<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(volumeSrc)) {
<a name="l01176"></a>01176         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01177"></a>01177     }
<a name="l01178"></a>01178 
<a name="l01179"></a>01179     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(name) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(newReplicant) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job) ||
<a name="l01180"></a>01180         <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01181"></a>01181         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01182"></a>01182     }
<a name="l01183"></a>01183 
<a name="l01184"></a>01184     std::map &lt; std::string, Value &gt; p;
<a name="l01185"></a>01185     p[<span class="stringliteral">&quot;pool&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#af80b3591fe77244b1ed101e3d01af195">pool_to_value</a>(pool);
<a name="l01186"></a>01186     p[<span class="stringliteral">&quot;rep_type&quot;</span>] = <a class="code" href="class_value.html">Value</a>((int32_t) repType);
<a name="l01187"></a>01187     p[<span class="stringliteral">&quot;volume_src&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(volumeSrc);
<a name="l01188"></a>01188     p[<span class="stringliteral">&quot;name&quot;</span>] = <a class="code" href="class_value.html">Value</a>(name);
<a name="l01189"></a>01189     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01190"></a>01190 
<a name="l01191"></a>01191     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01192"></a>01192     <a class="code" href="class_value.html">Value</a> response;
<a name="l01193"></a>01193 
<a name="l01194"></a>01194     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;volume_replicate&quot;</span>, parameters, response);
<a name="l01195"></a>01195     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01196"></a>01196         *newReplicant =
<a name="l01197"></a>01197             (<a class="code" href="struct__lsm__volume.html">lsm_volume</a> *) parse_job_response(c, response, rc, job,
<a name="l01198"></a>01198                                               (<a class="code" href="lsm__mgmt_8cpp.html#a7a13ea19682cf43e08f2abec1127a37d">convert</a>) <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>);
<a name="l01199"></a>01199     }
<a name="l01200"></a>01200     <span class="keywordflow">return</span> rc;
<a name="l01201"></a>01201 
<a name="l01202"></a>01202 }
<a name="l01203"></a>01203 
<a name="l01204"></a><a class="code" href="lsm__mgmt_8cpp.html#a5b8bbef537d7ffec775eace7e5db9296">01204</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a65234e32651907d254e288d4cbcad098">lsm_volume_replicate_range_block_size</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l01205"></a>01205                                           <a class="code" href="struct__lsm__system.html">lsm_system</a> * system,
<a name="l01206"></a>01206                                           uint32_t * bs, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01207"></a>01207 {
<a name="l01208"></a>01208     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l01209"></a>01209     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01210"></a>01210 
<a name="l01211"></a>01211     <span class="keywordflow">if</span> (!bs || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags) || !<a class="code" href="lsm__datatypes_8hpp.html#a690e5decf5a95b077d112fd2723fde7d">LSM_IS_SYSTEM</a>(system)) {
<a name="l01212"></a>01212         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01213"></a>01213     }
<a name="l01214"></a>01214 
<a name="l01215"></a>01215     <span class="keywordflow">try</span> {
<a name="l01216"></a>01216         std::map &lt; std::string, Value &gt; p;
<a name="l01217"></a>01217         p[<span class="stringliteral">&quot;system&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a64192028f7e1cd9ba79969062d17d3ea">system_to_value</a>(system);
<a name="l01218"></a>01218         p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01219"></a>01219         <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01220"></a>01220         <a class="code" href="class_value.html">Value</a> response;
<a name="l01221"></a>01221 
<a name="l01222"></a>01222         rc = rpc(c, <span class="stringliteral">&quot;volume_replicate_range_block_size&quot;</span>, parameters, response);
<a name="l01223"></a>01223         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01224"></a>01224             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a6a05614ea9262f3514667f0fc31f66b9">Value::numeric_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l01225"></a>01225                 *bs = response.<a class="code" href="class_value.html#a0da01b4c189ff90cfd35a78ddca99e40">asUint32_t</a>();
<a name="l01226"></a>01226             }
<a name="l01227"></a>01227         }
<a name="l01228"></a>01228     }
<a name="l01229"></a>01229     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l01230"></a>01230         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l01231"></a>01231     }
<a name="l01232"></a>01232     <span class="keywordflow">return</span> rc;
<a name="l01233"></a>01233 }
<a name="l01234"></a>01234 
<a name="l01235"></a>01235 
<a name="l01236"></a><a class="code" href="lsm__mgmt_8cpp.html#af55a74fafde39b5a27db4a04d24b4c56">01236</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a6b56dc3347b7b8627f7d10773514b8de">lsm_volume_replicate_range</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l01237"></a>01237                                <a class="code" href="libstoragemgmt__types_8h.html#a18ffef5fae2ce2f8fee7b2444b3119fd">lsm_replication_type</a> repType,
<a name="l01238"></a>01238                                <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * source,
<a name="l01239"></a>01239                                <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * <a class="code" href="namespacenetapp.html#a66d4da94e0e4f717ff3e7f23c53f7c2d">dest</a>,
<a name="l01240"></a>01240                                <a class="code" href="struct__lsm__block__range.html">lsm_block_range</a> ** ranges,
<a name="l01241"></a>01241                                uint32_t num_ranges, <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01242"></a>01242 {
<a name="l01243"></a>01243     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01244"></a>01244 
<a name="l01245"></a>01245     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(source) || !<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(dest)) {
<a name="l01246"></a>01246         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01247"></a>01247     }
<a name="l01248"></a>01248 
<a name="l01249"></a>01249     <span class="keywordflow">if</span> (!ranges || !num_ranges || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job) ||
<a name="l01250"></a>01250         <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01251"></a>01251         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01252"></a>01252     }
<a name="l01253"></a>01253 
<a name="l01254"></a>01254     std::map &lt; std::string, Value &gt; p;
<a name="l01255"></a>01255     p[<span class="stringliteral">&quot;rep_type&quot;</span>] = <a class="code" href="class_value.html">Value</a>((int32_t) repType);
<a name="l01256"></a>01256     p[<span class="stringliteral">&quot;volume_src&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(source);
<a name="l01257"></a>01257     p[<span class="stringliteral">&quot;volume_dest&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(dest);
<a name="l01258"></a>01258     p[<span class="stringliteral">&quot;ranges&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#af18efaa31b0a3e0c1c9fe28b044b6912">block_range_list_to_value</a>(ranges, num_ranges);
<a name="l01259"></a>01259     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01260"></a>01260 
<a name="l01261"></a>01261     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01262"></a>01262     <a class="code" href="class_value.html">Value</a> response;
<a name="l01263"></a>01263 
<a name="l01264"></a>01264     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;volume_replicate_range&quot;</span>, parameters, response);
<a name="l01265"></a>01265     <span class="keywordflow">return</span> job_check(c, rc, response, job);
<a name="l01266"></a>01266 }
<a name="l01267"></a>01267 
<a name="l01268"></a>01268 <span class="keyword">static</span> <a class="code" href="class_value.html">Value</a> _create_volume_flag_param(<a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volume, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01269"></a>01269 {
<a name="l01270"></a>01270     std::map &lt; std::string, Value &gt; p;
<a name="l01271"></a>01271     p[<span class="stringliteral">&quot;volume&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(volume);
<a name="l01272"></a>01272     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01273"></a>01273 
<a name="l01274"></a>01274     <span class="keywordflow">return</span> <a class="code" href="class_value.html">Value</a>(p);
<a name="l01275"></a>01275 }
<a name="l01276"></a>01276 
<a name="l01277"></a><a class="code" href="lsm__mgmt_8cpp.html#ab1561897a3373e54deba76d03a6aba97">01277</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#af916130849789387fcaf11c882217dd5">lsm_volume_delete</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volume, <span class="keywordtype">char</span> **job,
<a name="l01278"></a>01278                       <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01279"></a>01279 {
<a name="l01280"></a>01280     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l01281"></a>01281     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01282"></a>01282 
<a name="l01283"></a>01283     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(volume)) {
<a name="l01284"></a>01284         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01285"></a>01285     }
<a name="l01286"></a>01286 
<a name="l01287"></a>01287     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01288"></a>01288         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01289"></a>01289     }
<a name="l01290"></a>01290 
<a name="l01291"></a>01291     <span class="keywordflow">try</span> {
<a name="l01292"></a>01292 
<a name="l01293"></a>01293         <a class="code" href="class_value.html">Value</a> parameters = _create_volume_flag_param(volume, flags);
<a name="l01294"></a>01294         <a class="code" href="class_value.html">Value</a> response;
<a name="l01295"></a>01295 
<a name="l01296"></a>01296         rc = rpc(c, <span class="stringliteral">&quot;volume_delete&quot;</span>, parameters, response);
<a name="l01297"></a>01297         rc = job_check(c, rc, response, job);
<a name="l01298"></a>01298     }
<a name="l01299"></a>01299     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l01300"></a>01300         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l01301"></a>01301     }
<a name="l01302"></a>01302     <span class="keywordflow">return</span> rc;
<a name="l01303"></a>01303 
<a name="l01304"></a>01304 }
<a name="l01305"></a>01305 
<a name="l01306"></a><a class="code" href="lsm__mgmt_8cpp.html#a5048fba8042c6552a8692f11bb677bcb">01306</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#afcb3f2fdfa279cad557725bc1efe05cf">lsm_volume_raid_info</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volume,
<a name="l01307"></a>01307                          <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545">lsm_volume_raid_type</a> * raid_type,
<a name="l01308"></a>01308                          uint32_t * strip_size, uint32_t * disk_count,
<a name="l01309"></a>01309                          uint32_t * min_io_size, uint32_t * opt_io_size,
<a name="l01310"></a>01310                          <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01311"></a>01311 {
<a name="l01312"></a>01312     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01313"></a>01313         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01314"></a>01314     }
<a name="l01315"></a>01315 
<a name="l01316"></a>01316     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l01317"></a>01317     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01318"></a>01318 
<a name="l01319"></a>01319     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(volume)) {
<a name="l01320"></a>01320         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01321"></a>01321     }
<a name="l01322"></a>01322 
<a name="l01323"></a>01323     <span class="keywordflow">if</span> (!raid_type || !strip_size || !disk_count || !min_io_size ||
<a name="l01324"></a>01324         !opt_io_size) {
<a name="l01325"></a>01325         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01326"></a>01326     }
<a name="l01327"></a>01327 
<a name="l01328"></a>01328     <span class="keywordflow">try</span> {
<a name="l01329"></a>01329 
<a name="l01330"></a>01330         <a class="code" href="class_value.html">Value</a> parameters = _create_volume_flag_param(volume, flags);
<a name="l01331"></a>01331         <a class="code" href="class_value.html">Value</a> response;
<a name="l01332"></a>01332 
<a name="l01333"></a>01333         rc = rpc(c, <span class="stringliteral">&quot;volume_raid_info&quot;</span>, parameters, response);
<a name="l01334"></a>01334         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01335"></a>01335             <span class="comment">//We get a value back, either null or job id.</span>
<a name="l01336"></a>01336             std::vector &lt; Value &gt; j = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l01337"></a>01337             *raid_type = (<a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545">lsm_volume_raid_type</a>) j[0].asInt32_t();
<a name="l01338"></a>01338             *strip_size = j[1].asUint32_t();
<a name="l01339"></a>01339             *disk_count = j[2].asUint32_t();
<a name="l01340"></a>01340             *min_io_size = j[3].asUint32_t();
<a name="l01341"></a>01341             *opt_io_size = j[4].asUint32_t();
<a name="l01342"></a>01342         }
<a name="l01343"></a>01343     }
<a name="l01344"></a>01344     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l01345"></a>01345         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l01346"></a>01346     }
<a name="l01347"></a>01347     <span class="keywordflow">return</span> rc;
<a name="l01348"></a>01348 
<a name="l01349"></a>01349 }
<a name="l01350"></a>01350 
<a name="l01351"></a><a class="code" href="lsm__mgmt_8cpp.html#ace28979cc5878bf54658c8a774551f9f">01351</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#abb318cc17fd7dcf1282a3f95802b4f31">lsm_iscsi_chap_auth</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *init_id,
<a name="l01352"></a>01352                         <span class="keyword">const</span> <span class="keywordtype">char</span> *username, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="namespacenetapp.html#acef45431d77c887a9243c5481d0918c8">password</a>,
<a name="l01353"></a>01353                         <span class="keyword">const</span> <span class="keywordtype">char</span> *out_user, <span class="keyword">const</span> <span class="keywordtype">char</span> *out_password,
<a name="l01354"></a>01354                         <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01355"></a>01355 {
<a name="l01356"></a>01356     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01357"></a>01357 
<a name="l01358"></a>01358     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#aa975622dfbea4e976e37ed02fb5a655d">iqn_validate</a>(init_id) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01359"></a>01359         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01360"></a>01360     }
<a name="l01361"></a>01361 
<a name="l01362"></a>01362     std::map &lt; std::string, Value &gt; p;
<a name="l01363"></a>01363     p[<span class="stringliteral">&quot;init_id&quot;</span>] = <a class="code" href="class_value.html">Value</a>(init_id);
<a name="l01364"></a>01364     p[<span class="stringliteral">&quot;in_user&quot;</span>] = <a class="code" href="class_value.html">Value</a>(username);
<a name="l01365"></a>01365     p[<span class="stringliteral">&quot;in_password&quot;</span>] = <a class="code" href="class_value.html">Value</a>(password);
<a name="l01366"></a>01366     p[<span class="stringliteral">&quot;out_user&quot;</span>] = <a class="code" href="class_value.html">Value</a>(out_user);
<a name="l01367"></a>01367     p[<span class="stringliteral">&quot;out_password&quot;</span>] = <a class="code" href="class_value.html">Value</a>(out_password);
<a name="l01368"></a>01368     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01369"></a>01369 
<a name="l01370"></a>01370 
<a name="l01371"></a>01371     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01372"></a>01372     <a class="code" href="class_value.html">Value</a> response;
<a name="l01373"></a>01373 
<a name="l01374"></a>01374     <span class="keywordflow">return</span> rpc(c, <span class="stringliteral">&quot;iscsi_chap_auth&quot;</span>, parameters, response);
<a name="l01375"></a>01375 }
<a name="l01376"></a>01376 
<a name="l01377"></a>01377 <span class="keyword">static</span> <span class="keywordtype">int</span> online_offline(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * v,
<a name="l01378"></a>01378                           <span class="keyword">const</span> <span class="keywordtype">char</span> *operation, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01379"></a>01379 {
<a name="l01380"></a>01380     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01381"></a>01381 
<a name="l01382"></a>01382     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(v)) {
<a name="l01383"></a>01383         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01384"></a>01384     }
<a name="l01385"></a>01385 
<a name="l01386"></a>01386     <span class="keywordflow">if</span> (<a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01387"></a>01387         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01388"></a>01388     }
<a name="l01389"></a>01389 
<a name="l01390"></a>01390     std::map &lt; std::string, Value &gt; p;
<a name="l01391"></a>01391     p[<span class="stringliteral">&quot;volume&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(v);
<a name="l01392"></a>01392     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01393"></a>01393 
<a name="l01394"></a>01394     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01395"></a>01395     <a class="code" href="class_value.html">Value</a> response;
<a name="l01396"></a>01396     <span class="keywordflow">return</span> rpc(c, operation, parameters, response);
<a name="l01397"></a>01397 }
<a name="l01398"></a>01398 
<a name="l01399"></a><a class="code" href="lsm__mgmt_8cpp.html#a2bf5976cf0379609d5c09cb66a90ae0d">01399</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#aab1d450c01203fe5b4da7eaef1a91365">lsm_volume_enable</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volume, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01400"></a>01400 {
<a name="l01401"></a>01401     <span class="keywordflow">return</span> online_offline(c, volume, <span class="stringliteral">&quot;volume_enable&quot;</span>, flags);
<a name="l01402"></a>01402 }
<a name="l01403"></a>01403 
<a name="l01404"></a><a class="code" href="lsm__mgmt_8cpp.html#a4bf9ff420fcd9cd2830950baedcff8e6">01404</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a992cc96ca6d1ff0da997595095b4eb78">lsm_volume_disable</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volume, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01405"></a>01405 {
<a name="l01406"></a>01406     <span class="keywordflow">return</span> online_offline(c, volume, <span class="stringliteral">&quot;volume_disable&quot;</span>, flags);
<a name="l01407"></a>01407 }
<a name="l01408"></a>01408 
<a name="l01409"></a><a class="code" href="lsm__mgmt_8cpp.html#a8e333a391c2054b5ca8d0c1bcffaac2e">01409</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#adf6fd7bdbe185ebe7d7c2eba4040f941">lsm_access_group_list</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *search_key,
<a name="l01410"></a>01410                           <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>,
<a name="l01411"></a>01411                           <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> ** groups[],
<a name="l01412"></a>01412                           uint32_t * groupCount, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01413"></a>01413 {
<a name="l01414"></a>01414     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01415"></a>01415 
<a name="l01416"></a>01416     <span class="keywordflow">if</span> (!groups || !groupCount) {
<a name="l01417"></a>01417         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01418"></a>01418     }
<a name="l01419"></a>01419 
<a name="l01420"></a>01420     std::map &lt; std::string, Value &gt; p;
<a name="l01421"></a>01421 
<a name="l01422"></a>01422     <span class="keywordtype">int</span> rc = add_search_params(p, search_key, search_value,
<a name="l01423"></a>01423                                ACCESS_GROUP_SEARCH_KEYS,
<a name="l01424"></a>01424                                <a class="code" href="lsm__mgmt_8cpp.html#aaa4d7091b23daad190781266535c3d42">ACCESS_GROUP_SEARCH_KEYS_COUNT</a>);
<a name="l01425"></a>01425     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l01426"></a>01426         <span class="keywordflow">return</span> rc;
<a name="l01427"></a>01427     }
<a name="l01428"></a>01428 
<a name="l01429"></a>01429     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01430"></a>01430     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01431"></a>01431     <a class="code" href="class_value.html">Value</a> response;
<a name="l01432"></a>01432 
<a name="l01433"></a>01433     rc = rpc(c, <span class="stringliteral">&quot;access_groups&quot;</span>, parameters, response);
<a name="l01434"></a>01434     <span class="keywordflow">return</span> get_access_groups(c, rc, response, groups, groupCount);
<a name="l01435"></a>01435 }
<a name="l01436"></a>01436 
<a name="l01437"></a><a class="code" href="lsm__mgmt_8cpp.html#a501ce580cbad00d817792fa7d3df2e9a">01437</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ac7d8012518e9f09a2cc15f716da81d2f">lsm_access_group_create</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__datatypes_8cpp.html#a2cc1fcbe95db9f01f0bc16e608508a1d">name</a>,
<a name="l01438"></a>01438                             <span class="keyword">const</span> <span class="keywordtype">char</span> *init_id,
<a name="l01439"></a>01439                             <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842db">lsm_access_group_init_type</a> init_type,
<a name="l01440"></a>01440                             <a class="code" href="struct__lsm__system.html">lsm_system</a> * system,
<a name="l01441"></a>01441                             <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> ** access_group, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01442"></a>01442 {
<a name="l01443"></a>01443     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01444"></a>01444 
<a name="l01445"></a>01445     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a690e5decf5a95b077d112fd2723fde7d">LSM_IS_SYSTEM</a>(system) || <a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(name) || <a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(init_id) ||
<a name="l01446"></a>01446         <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(access_group) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01447"></a>01447         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01448"></a>01448     }
<a name="l01449"></a>01449 
<a name="l01450"></a>01450     <a class="code" href="class_value.html">Value</a> id;
<a name="l01451"></a>01451 
<a name="l01452"></a>01452     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != verify_initiator_id(init_id, init_type, <span class="keywordtype">id</span>)) {
<a name="l01453"></a>01453         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01454"></a>01454     }
<a name="l01455"></a>01455 
<a name="l01456"></a>01456     std::map &lt; std::string, Value &gt; p;
<a name="l01457"></a>01457     p[<span class="stringliteral">&quot;name&quot;</span>] = <a class="code" href="class_value.html">Value</a>(name);
<a name="l01458"></a>01458     p[<span class="stringliteral">&quot;init_id&quot;</span>] = id;
<a name="l01459"></a>01459     p[<span class="stringliteral">&quot;init_type&quot;</span>] = <a class="code" href="class_value.html">Value</a>((int32_t) init_type);
<a name="l01460"></a>01460     p[<span class="stringliteral">&quot;system&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a64192028f7e1cd9ba79969062d17d3ea">system_to_value</a>(system);
<a name="l01461"></a>01461     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01462"></a>01462 
<a name="l01463"></a>01463     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01464"></a>01464     <a class="code" href="class_value.html">Value</a> response;
<a name="l01465"></a>01465 
<a name="l01466"></a>01466     *access_group = NULL;
<a name="l01467"></a>01467 
<a name="l01468"></a>01468     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;access_group_create&quot;</span>, parameters, response);
<a name="l01469"></a>01469     <span class="keywordflow">try</span> {
<a name="l01470"></a>01470         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01471"></a>01471             <span class="comment">//We should be getting a value back.</span>
<a name="l01472"></a>01472             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l01473"></a>01473                 *access_group = <a class="code" href="lsm__convert_8cpp.html#a7977d143a5d88f560ff2b14f37819bb2">value_to_access_group</a>(response);
<a name="l01474"></a>01474                 <span class="keywordflow">if</span> (!(*access_group)) {
<a name="l01475"></a>01475                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01476"></a>01476                 }
<a name="l01477"></a>01477             }
<a name="l01478"></a>01478         }
<a name="l01479"></a>01479     }
<a name="l01480"></a>01480     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l01481"></a>01481         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l01482"></a>01482     }
<a name="l01483"></a>01483     <span class="keywordflow">return</span> rc;
<a name="l01484"></a>01484 }
<a name="l01485"></a>01485 
<a name="l01486"></a><a class="code" href="lsm__mgmt_8cpp.html#a268fbeefc3e56c0c0e8a5c0d873d2982">01486</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ac7a189e2f21e3a001f479e5f568804f3">lsm_access_group_delete</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l01487"></a>01487                             <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> * access_group, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01488"></a>01488 {
<a name="l01489"></a>01489     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01490"></a>01490 
<a name="l01491"></a>01491     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#af31bb51b0df70c84f9766bd6eb7cde06">LSM_IS_ACCESS_GROUP</a>(access_group) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01492"></a>01492         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01493"></a>01493     }
<a name="l01494"></a>01494 
<a name="l01495"></a>01495     std::map &lt; std::string, Value &gt; p;
<a name="l01496"></a>01496     p[<span class="stringliteral">&quot;access_group&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#afa1785eed2f2c143e36f29c212a0857e">access_group_to_value</a>(access_group);
<a name="l01497"></a>01497     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01498"></a>01498 
<a name="l01499"></a>01499     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01500"></a>01500     <a class="code" href="class_value.html">Value</a> response;
<a name="l01501"></a>01501 
<a name="l01502"></a>01502     <span class="keywordflow">return</span> rpc(c, <span class="stringliteral">&quot;access_group_delete&quot;</span>, parameters, response);
<a name="l01503"></a>01503 }
<a name="l01504"></a>01504 
<a name="l01505"></a>01505 <span class="keyword">static</span> <span class="keywordtype">int</span> _lsm_ag_add_delete(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l01506"></a>01506                               <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> * access_group,
<a name="l01507"></a>01507                               <span class="keyword">const</span> <span class="keywordtype">char</span> *init_id,
<a name="l01508"></a>01508                               <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842db">lsm_access_group_init_type</a> init_type,
<a name="l01509"></a>01509                               <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> ** updated_access_group,
<a name="l01510"></a>01510                               <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags, <span class="keyword">const</span> <span class="keywordtype">char</span> *message)
<a name="l01511"></a>01511 {
<a name="l01512"></a>01512     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01513"></a>01513 
<a name="l01514"></a>01514     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#af31bb51b0df70c84f9766bd6eb7cde06">LSM_IS_ACCESS_GROUP</a>(access_group) || <a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(init_id) ||
<a name="l01515"></a>01515         <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(updated_access_group)) {
<a name="l01516"></a>01516         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01517"></a>01517     }
<a name="l01518"></a>01518 
<a name="l01519"></a>01519     <a class="code" href="class_value.html">Value</a> id;
<a name="l01520"></a>01520 
<a name="l01521"></a>01521     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != verify_initiator_id(init_id, init_type, <span class="keywordtype">id</span>)) {
<a name="l01522"></a>01522         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01523"></a>01523     }
<a name="l01524"></a>01524 
<a name="l01525"></a>01525     std::map &lt; std::string, Value &gt; p;
<a name="l01526"></a>01526     p[<span class="stringliteral">&quot;access_group&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#afa1785eed2f2c143e36f29c212a0857e">access_group_to_value</a>(access_group);
<a name="l01527"></a>01527     p[<span class="stringliteral">&quot;init_id&quot;</span>] = id;
<a name="l01528"></a>01528     p[<span class="stringliteral">&quot;init_type&quot;</span>] = <a class="code" href="class_value.html">Value</a>((int32_t) init_type);
<a name="l01529"></a>01529     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01530"></a>01530 
<a name="l01531"></a>01531     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01532"></a>01532     <a class="code" href="class_value.html">Value</a> response;
<a name="l01533"></a>01533 
<a name="l01534"></a>01534     <span class="keywordtype">int</span> rc = rpc(c, message, parameters, response);
<a name="l01535"></a>01535     <span class="keywordflow">try</span> {
<a name="l01536"></a>01536         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01537"></a>01537             <span class="comment">//We should be getting a value back.</span>
<a name="l01538"></a>01538             <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l01539"></a>01539                 *updated_access_group = <a class="code" href="lsm__convert_8cpp.html#a7977d143a5d88f560ff2b14f37819bb2">value_to_access_group</a>(response);
<a name="l01540"></a>01540                 <span class="keywordflow">if</span> (!(*updated_access_group)) {
<a name="l01541"></a>01541                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01542"></a>01542                 }
<a name="l01543"></a>01543             }
<a name="l01544"></a>01544         }
<a name="l01545"></a>01545     }
<a name="l01546"></a>01546     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l01547"></a>01547         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l01548"></a>01548     }
<a name="l01549"></a>01549 
<a name="l01550"></a>01550     <span class="keywordflow">return</span> rc;
<a name="l01551"></a>01551 }
<a name="l01552"></a>01552 
<a name="l01553"></a><a class="code" href="lsm__mgmt_8cpp.html#a27aa4e55c526ebf095185be42e502f98">01553</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#aa319935939ae244e320abd8efde9ad36">lsm_access_group_initiator_add</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l01554"></a>01554                                    <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> * access_group,
<a name="l01555"></a>01555                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *init_id,
<a name="l01556"></a>01556                                    <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842db">lsm_access_group_init_type</a> init_type,
<a name="l01557"></a>01557                                    <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> **
<a name="l01558"></a>01558                                    updated_access_group, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01559"></a>01559 {
<a name="l01560"></a>01560     <span class="keywordflow">return</span> _lsm_ag_add_delete(c, access_group, init_id, init_type,
<a name="l01561"></a>01561                               updated_access_group, flags,
<a name="l01562"></a>01562                               <span class="stringliteral">&quot;access_group_initiator_add&quot;</span>);
<a name="l01563"></a>01563 }
<a name="l01564"></a>01564 
<a name="l01565"></a><a class="code" href="lsm__mgmt_8cpp.html#a81e294ebd58237e40b4b9ec855e60821">01565</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a9ce3597a5a2d5f8e1b8200a193f3af8c">lsm_access_group_initiator_delete</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l01566"></a>01566                                       <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> * access_group,
<a name="l01567"></a>01567                                       <span class="keyword">const</span> <span class="keywordtype">char</span> *init_id,
<a name="l01568"></a>01568                                       <a class="code" href="libstoragemgmt__types_8h.html#a31858ec26b8f30ad09400b567bd842db">lsm_access_group_init_type</a> init_type,
<a name="l01569"></a>01569                                       <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> **
<a name="l01570"></a>01570                                       updated_access_group, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01571"></a>01571 {
<a name="l01572"></a>01572     <span class="keywordflow">return</span> _lsm_ag_add_delete(c, access_group, init_id, init_type,
<a name="l01573"></a>01573                               updated_access_group, flags,
<a name="l01574"></a>01574                               <span class="stringliteral">&quot;access_group_initiator_delete&quot;</span>);
<a name="l01575"></a>01575 }
<a name="l01576"></a>01576 
<a name="l01577"></a><a class="code" href="lsm__mgmt_8cpp.html#a769608888c0df609237b20bef2876792">01577</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a0c01652e19e82843b9fe834bce87fa96">lsm_volume_mask</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> * access_group,
<a name="l01578"></a>01578                     <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volume, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01579"></a>01579 {
<a name="l01580"></a>01580     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01581"></a>01581 
<a name="l01582"></a>01582     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#af31bb51b0df70c84f9766bd6eb7cde06">LSM_IS_ACCESS_GROUP</a>(access_group) || !<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(volume) ||
<a name="l01583"></a>01583         <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01584"></a>01584         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01585"></a>01585     }
<a name="l01586"></a>01586 
<a name="l01587"></a>01587     std::map &lt; std::string, Value &gt; p;
<a name="l01588"></a>01588     p[<span class="stringliteral">&quot;access_group&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#afa1785eed2f2c143e36f29c212a0857e">access_group_to_value</a>(access_group);
<a name="l01589"></a>01589     p[<span class="stringliteral">&quot;volume&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(volume);
<a name="l01590"></a>01590     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01591"></a>01591 
<a name="l01592"></a>01592     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01593"></a>01593     <a class="code" href="class_value.html">Value</a> response;
<a name="l01594"></a>01594 
<a name="l01595"></a>01595     <span class="keywordflow">return</span> rpc(c, <span class="stringliteral">&quot;volume_mask&quot;</span>, parameters, response);
<a name="l01596"></a>01596 }
<a name="l01597"></a>01597 
<a name="l01598"></a>01598 
<a name="l01599"></a><a class="code" href="lsm__mgmt_8cpp.html#a994a16d4bee1aadcbf5037cf0446751f">01599</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a391466ebab504bd90c376a35cbe43155">lsm_volume_unmask</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> * group,
<a name="l01600"></a>01600                       <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volume, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01601"></a>01601 {
<a name="l01602"></a>01602     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01603"></a>01603 
<a name="l01604"></a>01604     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#af31bb51b0df70c84f9766bd6eb7cde06">LSM_IS_ACCESS_GROUP</a>(group) || !<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(volume) ||
<a name="l01605"></a>01605         <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01606"></a>01606         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01607"></a>01607     }
<a name="l01608"></a>01608 
<a name="l01609"></a>01609     std::map &lt; std::string, Value &gt; p;
<a name="l01610"></a>01610     p[<span class="stringliteral">&quot;access_group&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#afa1785eed2f2c143e36f29c212a0857e">access_group_to_value</a>(group);
<a name="l01611"></a>01611     p[<span class="stringliteral">&quot;volume&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(volume);
<a name="l01612"></a>01612     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01613"></a>01613 
<a name="l01614"></a>01614     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01615"></a>01615     <a class="code" href="class_value.html">Value</a> response;
<a name="l01616"></a>01616 
<a name="l01617"></a>01617     <span class="keywordflow">return</span> rpc(c, <span class="stringliteral">&quot;volume_unmask&quot;</span>, parameters, response);
<a name="l01618"></a>01618 }
<a name="l01619"></a>01619 
<a name="l01620"></a><a class="code" href="lsm__mgmt_8cpp.html#a6c97f0873b651669d089730c29dbd5d4">01620</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a96c639e4fa32086294022156e593b370">lsm_volumes_accessible_by_access_group</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l01621"></a>01621                                            <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> * group,
<a name="l01622"></a>01622                                            <a class="code" href="struct__lsm__volume.html">lsm_volume</a> ** volumes[],
<a name="l01623"></a>01623                                            uint32_t * count, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01624"></a>01624 {
<a name="l01625"></a>01625     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l01626"></a>01626     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01627"></a>01627 
<a name="l01628"></a>01628     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#af31bb51b0df70c84f9766bd6eb7cde06">LSM_IS_ACCESS_GROUP</a>(group) ||
<a name="l01629"></a>01629         !volumes || !count || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01630"></a>01630         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01631"></a>01631     }
<a name="l01632"></a>01632 
<a name="l01633"></a>01633     <span class="keywordflow">try</span> {
<a name="l01634"></a>01634         std::map &lt; std::string, Value &gt; p;
<a name="l01635"></a>01635         p[<span class="stringliteral">&quot;access_group&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#afa1785eed2f2c143e36f29c212a0857e">access_group_to_value</a>(group);
<a name="l01636"></a>01636         p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01637"></a>01637 
<a name="l01638"></a>01638         <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01639"></a>01639         <a class="code" href="class_value.html">Value</a> response;
<a name="l01640"></a>01640 
<a name="l01641"></a>01641         rc = rpc(c, <span class="stringliteral">&quot;volumes_accessible_by_access_group&quot;</span>, parameters, response);
<a name="l01642"></a>01642         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l01643"></a>01643             std::vector &lt; Value &gt; vol = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l01644"></a>01644 
<a name="l01645"></a>01645             *count = vol.size();
<a name="l01646"></a>01646 
<a name="l01647"></a>01647             <span class="keywordflow">if</span> (vol.size()) {
<a name="l01648"></a>01648                 *volumes = <a class="code" href="libstoragemgmt__plug__interface_8h.html#a284b580a47bfae1b6d02e8bae97efa28">lsm_volume_record_array_alloc</a>(vol.size());
<a name="l01649"></a>01649 
<a name="l01650"></a>01650                 <span class="keywordflow">if</span> (*volumes) {
<a name="l01651"></a>01651                     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; vol.size(); ++i) {
<a name="l01652"></a>01652                         (*volumes)[i] = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(vol[i]);
<a name="l01653"></a>01653                         <span class="keywordflow">if</span> (!((*volumes)[i])) {
<a name="l01654"></a>01654                             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01655"></a>01655                             <span class="keywordflow">goto</span> error;
<a name="l01656"></a>01656                         }
<a name="l01657"></a>01657                     }
<a name="l01658"></a>01658                 } <span class="keywordflow">else</span> {
<a name="l01659"></a>01659                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01660"></a>01660                 }
<a name="l01661"></a>01661             }
<a name="l01662"></a>01662         }
<a name="l01663"></a>01663     }
<a name="l01664"></a>01664     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l01665"></a>01665         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l01666"></a>01666         <span class="keywordflow">goto</span> error;
<a name="l01667"></a>01667 
<a name="l01668"></a>01668     }
<a name="l01669"></a>01669 
<a name="l01670"></a>01670   <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>:
<a name="l01671"></a>01671     <span class="keywordflow">return</span> rc;
<a name="l01672"></a>01672 
<a name="l01673"></a>01673   error:
<a name="l01674"></a>01674     <span class="keywordflow">if</span> (*volumes &amp;&amp; *count) {
<a name="l01675"></a>01675         <a class="code" href="libstoragemgmt__volumes_8h.html#a5e6b658933de208b14ba9a8121ba7e0c">lsm_volume_record_array_free</a>(*volumes, *count);
<a name="l01676"></a>01676         *volumes = NULL;
<a name="l01677"></a>01677         *count = 0;
<a name="l01678"></a>01678     }
<a name="l01679"></a>01679     <span class="keywordflow">goto</span> <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l01680"></a>01680 }
<a name="l01681"></a>01681 
<a name="l01682"></a><a class="code" href="lsm__mgmt_8cpp.html#af4350a67209c865b888fe58121e356d6">01682</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a6a0d09887c3667abf6d0e36438f45733">lsm_access_groups_granted_to_volume</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l01683"></a>01683                                         <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volume,
<a name="l01684"></a>01684                                         <a class="code" href="struct__lsm__access__group.html">lsm_access_group</a> ** groups[],
<a name="l01685"></a>01685                                         uint32_t * groupCount, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01686"></a>01686 {
<a name="l01687"></a>01687     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01688"></a>01688 
<a name="l01689"></a>01689     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(volume)) {
<a name="l01690"></a>01690         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01691"></a>01691     }
<a name="l01692"></a>01692 
<a name="l01693"></a>01693     <span class="keywordflow">if</span> (!groups || !groupCount || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01694"></a>01694         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01695"></a>01695     }
<a name="l01696"></a>01696 
<a name="l01697"></a>01697     std::map &lt; std::string, Value &gt; p;
<a name="l01698"></a>01698     p[<span class="stringliteral">&quot;volume&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a3a2bb9effc45e97434a4f5cf83cea612">volume_to_value</a>(volume);
<a name="l01699"></a>01699     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01700"></a>01700 
<a name="l01701"></a>01701     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01702"></a>01702     <a class="code" href="class_value.html">Value</a> response;
<a name="l01703"></a>01703 
<a name="l01704"></a>01704     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;access_groups_granted_to_volume&quot;</span>, parameters, response);
<a name="l01705"></a>01705     <span class="keywordflow">return</span> get_access_groups(c, rc, response, groups, groupCount);
<a name="l01706"></a>01706 }
<a name="l01707"></a>01707 
<a name="l01708"></a>01708 <span class="keyword">static</span> <span class="keywordtype">int</span> _retrieve_bool(<span class="keywordtype">int</span> rc, <a class="code" href="class_value.html">Value</a> &amp; response, uint8_t * yes)
<a name="l01709"></a>01709 {
<a name="l01710"></a>01710     <span class="keywordtype">int</span> rc_out = rc;
<a name="l01711"></a>01711 
<a name="l01712"></a>01712     *yes = 0;
<a name="l01713"></a>01713 
<a name="l01714"></a>01714     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01715"></a>01715         <span class="comment">//We should be getting a boolean value back.</span>
<a name="l01716"></a>01716         <span class="keywordflow">if</span> (<a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a051aecdee02004abf05cfbe6f6b4780c">Value::boolean_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l01717"></a>01717             <span class="keywordflow">if</span> (response.<a class="code" href="class_value.html#ac7d0a554ac8a2056d07ece69c01520f3">asBool</a>()) {
<a name="l01718"></a>01718                 *yes = 1;
<a name="l01719"></a>01719             }
<a name="l01720"></a>01720         } <span class="keywordflow">else</span> {
<a name="l01721"></a>01721             rc_out = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>;
<a name="l01722"></a>01722         }
<a name="l01723"></a>01723     }
<a name="l01724"></a>01724     <span class="keywordflow">return</span> rc_out;
<a name="l01725"></a>01725 }
<a name="l01726"></a>01726 
<a name="l01727"></a><a class="code" href="lsm__mgmt_8cpp.html#add4ef5648f09b2cff792ffd134459e9f">01727</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ab8d3e106dfbeda4c67b5d479e03ca6bc">lsm_volume_child_dependency</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volume,
<a name="l01728"></a>01728                                 uint8_t * yes, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01729"></a>01729 {
<a name="l01730"></a>01730     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l01731"></a>01731     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01732"></a>01732 
<a name="l01733"></a>01733     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(volume)) {
<a name="l01734"></a>01734         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01735"></a>01735     }
<a name="l01736"></a>01736 
<a name="l01737"></a>01737     <span class="keywordflow">if</span> (!yes || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01738"></a>01738         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01739"></a>01739     }
<a name="l01740"></a>01740 
<a name="l01741"></a>01741     <span class="keywordflow">try</span> {
<a name="l01742"></a>01742 
<a name="l01743"></a>01743         <a class="code" href="class_value.html">Value</a> parameters = _create_volume_flag_param(volume, flags);
<a name="l01744"></a>01744         <a class="code" href="class_value.html">Value</a> response;
<a name="l01745"></a>01745 
<a name="l01746"></a>01746         rc = rpc(c, <span class="stringliteral">&quot;volume_child_dependency&quot;</span>, parameters, response);
<a name="l01747"></a>01747         rc = _retrieve_bool(rc, response, yes);
<a name="l01748"></a>01748     }
<a name="l01749"></a>01749     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l01750"></a>01750         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l01751"></a>01751     }
<a name="l01752"></a>01752     <span class="keywordflow">return</span> rc;
<a name="l01753"></a>01753 }
<a name="l01754"></a>01754 
<a name="l01755"></a><a class="code" href="lsm__mgmt_8cpp.html#a1a5764983d376dfbb154c7e9adf807bb">01755</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a18436954e1bf2cf26e3f6f0344c7237b">lsm_volume_child_dependency_delete</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l01756"></a>01756                                        <a class="code" href="struct__lsm__volume.html">lsm_volume</a> * volume, <span class="keywordtype">char</span> **job,
<a name="l01757"></a>01757                                        <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01758"></a>01758 {
<a name="l01759"></a>01759     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01760"></a>01760 
<a name="l01761"></a>01761     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a8ea36938782c95c81b22ede3d4ceb5d7">LSM_IS_VOL</a>(volume) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job)
<a name="l01762"></a>01762         || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01763"></a>01763         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01764"></a>01764     }
<a name="l01765"></a>01765 
<a name="l01766"></a>01766     <a class="code" href="class_value.html">Value</a> parameters = _create_volume_flag_param(volume, flags);
<a name="l01767"></a>01767     <a class="code" href="class_value.html">Value</a> response;
<a name="l01768"></a>01768 
<a name="l01769"></a>01769     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;volume_child_dependency_rm&quot;</span>, parameters, response);
<a name="l01770"></a>01770     <span class="keywordflow">return</span> job_check(c, rc, response, job);
<a name="l01771"></a>01771 }
<a name="l01772"></a>01772 
<a name="l01773"></a><a class="code" href="lsm__mgmt_8cpp.html#a80283b7e95e108faef1187ca3e691521">01773</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a0d48964557223c084dab9b6af8740f0a">lsm_system_list</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__system.html">lsm_system</a> ** systems[],
<a name="l01774"></a>01774                     uint32_t * systemCount, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01775"></a>01775 {
<a name="l01776"></a>01776     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l01777"></a>01777     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01778"></a>01778 
<a name="l01779"></a>01779     <span class="keywordflow">if</span> (!systems || !systemCount) {
<a name="l01780"></a>01780         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01781"></a>01781     }
<a name="l01782"></a>01782 
<a name="l01783"></a>01783     <span class="keywordflow">try</span> {
<a name="l01784"></a>01784         std::map &lt; std::string, Value &gt; p;
<a name="l01785"></a>01785         p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01786"></a>01786         <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01787"></a>01787         <a class="code" href="class_value.html">Value</a> response;
<a name="l01788"></a>01788 
<a name="l01789"></a>01789         rc = rpc(c, <span class="stringliteral">&quot;systems&quot;</span>, parameters, response);
<a name="l01790"></a>01790         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l01791"></a>01791             std::vector &lt; Value &gt; sys = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l01792"></a>01792 
<a name="l01793"></a>01793             *systemCount = sys.size();
<a name="l01794"></a>01794 
<a name="l01795"></a>01795             <span class="keywordflow">if</span> (sys.size()) {
<a name="l01796"></a>01796                 *systems = <a class="code" href="libstoragemgmt__plug__interface_8h.html#aeb13eaad6dcf794c94f3abf97d3a047d">lsm_system_record_array_alloc</a>(sys.size());
<a name="l01797"></a>01797 
<a name="l01798"></a>01798                 <span class="keywordflow">if</span> (*systems) {
<a name="l01799"></a>01799                     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; sys.size(); ++i) {
<a name="l01800"></a>01800                         (*systems)[i] = <a class="code" href="lsm__convert_8cpp.html#a49198461198770e8dbd90cf6b950c121">value_to_system</a>(sys[i]);
<a name="l01801"></a>01801                         <span class="keywordflow">if</span> (!(*systems)[i]) {
<a name="l01802"></a>01802                             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01803"></a>01803                             <span class="keywordflow">goto</span> error;
<a name="l01804"></a>01804                         }
<a name="l01805"></a>01805                     }
<a name="l01806"></a>01806                 } <span class="keywordflow">else</span> {
<a name="l01807"></a>01807                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01808"></a>01808                 }
<a name="l01809"></a>01809             }
<a name="l01810"></a>01810         }
<a name="l01811"></a>01811     }
<a name="l01812"></a>01812     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l01813"></a>01813         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l01814"></a>01814         <span class="keywordflow">goto</span> error;
<a name="l01815"></a>01815 
<a name="l01816"></a>01816     }
<a name="l01817"></a>01817   <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>:
<a name="l01818"></a>01818     <span class="keywordflow">return</span> rc;
<a name="l01819"></a>01819 
<a name="l01820"></a>01820   error:
<a name="l01821"></a>01821     <span class="keywordflow">if</span> (*systems) {
<a name="l01822"></a>01822         <a class="code" href="libstoragemgmt__systems_8h.html#a2786ad1aed30783303c15003c18f3c89">lsm_system_record_array_free</a>(*systems, *systemCount);
<a name="l01823"></a>01823         *systems = NULL;
<a name="l01824"></a>01824         *systemCount = 0;
<a name="l01825"></a>01825     }
<a name="l01826"></a>01826     <span class="keywordflow">goto</span> <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l01827"></a>01827 }
<a name="l01828"></a>01828 
<a name="l01829"></a><a class="code" href="lsm__mgmt_8cpp.html#a509852520fe04b665a1694161e5ed149">01829</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a88b9a71f703f39a50cd5d5006b3e0f74">lsm_fs_list</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *search_key,
<a name="l01830"></a>01830                 <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> ** fs[],
<a name="l01831"></a>01831                 uint32_t * fsCount, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01832"></a>01832 {
<a name="l01833"></a>01833     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l01834"></a>01834     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01835"></a>01835 
<a name="l01836"></a>01836     <span class="keywordflow">if</span> (!fs || !fsCount) {
<a name="l01837"></a>01837         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01838"></a>01838     }
<a name="l01839"></a>01839 
<a name="l01840"></a>01840     <span class="keywordflow">try</span> {
<a name="l01841"></a>01841         std::map &lt; std::string, Value &gt; p;
<a name="l01842"></a>01842 
<a name="l01843"></a>01843         <span class="keywordtype">int</span> rc = add_search_params(p, search_key, search_value, FS_SEARCH_KEYS,
<a name="l01844"></a>01844                                    <a class="code" href="lsm__mgmt_8cpp.html#a1239f12da06d81bbd11026d3c736fbc3">FS_SEARCH_KEYS_COUNT</a>);
<a name="l01845"></a>01845         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l01846"></a>01846             <span class="keywordflow">return</span> rc;
<a name="l01847"></a>01847         }
<a name="l01848"></a>01848 
<a name="l01849"></a>01849         p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01850"></a>01850         <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01851"></a>01851         <a class="code" href="class_value.html">Value</a> response;
<a name="l01852"></a>01852 
<a name="l01853"></a>01853         rc = rpc(c, <span class="stringliteral">&quot;fs&quot;</span>, parameters, response);
<a name="l01854"></a>01854         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l01855"></a>01855             std::vector &lt; Value &gt; sys = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l01856"></a>01856 
<a name="l01857"></a>01857             *fsCount = sys.size();
<a name="l01858"></a>01858 
<a name="l01859"></a>01859             <span class="keywordflow">if</span> (sys.size()) {
<a name="l01860"></a>01860                 *fs = <a class="code" href="libstoragemgmt__plug__interface_8h.html#a909488d1fc2f4c0836a62f44924da6b3">lsm_fs_record_array_alloc</a>(sys.size());
<a name="l01861"></a>01861 
<a name="l01862"></a>01862                 <span class="keywordflow">if</span> (*fs) {
<a name="l01863"></a>01863                     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; sys.size(); ++i) {
<a name="l01864"></a>01864                         (*fs)[i] = <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>(sys[i]);
<a name="l01865"></a>01865                         <span class="keywordflow">if</span> (!((*fs)[i])) {
<a name="l01866"></a>01866                             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01867"></a>01867                             <span class="keywordflow">goto</span> error;
<a name="l01868"></a>01868                         }
<a name="l01869"></a>01869                     }
<a name="l01870"></a>01870                 } <span class="keywordflow">else</span> {
<a name="l01871"></a>01871                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l01872"></a>01872                 }
<a name="l01873"></a>01873             }
<a name="l01874"></a>01874         }
<a name="l01875"></a>01875     }
<a name="l01876"></a>01876     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l01877"></a>01877         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l01878"></a>01878         <span class="keywordflow">goto</span> error;
<a name="l01879"></a>01879 
<a name="l01880"></a>01880     }
<a name="l01881"></a>01881   <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>:
<a name="l01882"></a>01882     <span class="keywordflow">return</span> rc;
<a name="l01883"></a>01883 
<a name="l01884"></a>01884   error:
<a name="l01885"></a>01885     <span class="keywordflow">if</span> (*fs &amp;&amp; *fsCount) {
<a name="l01886"></a>01886         <a class="code" href="libstoragemgmt__fs_8h.html#a19848dbe7cffdacbcb837c4309650ce4">lsm_fs_record_array_free</a>(*fs, *fsCount);
<a name="l01887"></a>01887         *fs = NULL;
<a name="l01888"></a>01888         *fsCount = 0;
<a name="l01889"></a>01889     }
<a name="l01890"></a>01890     <span class="keywordflow">goto</span> <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l01891"></a>01891 }
<a name="l01892"></a>01892 
<a name="l01893"></a><a class="code" href="lsm__mgmt_8cpp.html#a3f10e928c03f6b02498d27e8432f5ca4">01893</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a59001e486590f074a5086a4b78cd595d">lsm_fs_create</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__pool.html">lsm_pool</a> * pool, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__datatypes_8cpp.html#a2cc1fcbe95db9f01f0bc16e608508a1d">name</a>,
<a name="l01894"></a>01894                   uint64_t size_bytes, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> ** fs, <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01895"></a>01895 {
<a name="l01896"></a>01896     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01897"></a>01897 
<a name="l01898"></a>01898     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a6c1a7b0350eee43615b3a0c58cac3c77">LSM_IS_POOL</a>(pool)) {
<a name="l01899"></a>01899         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01900"></a>01900     }
<a name="l01901"></a>01901 
<a name="l01902"></a>01902     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(name) || !size_bytes || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(fs) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job)
<a name="l01903"></a>01903         || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01904"></a>01904         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01905"></a>01905     }
<a name="l01906"></a>01906 
<a name="l01907"></a>01907     std::map &lt; std::string, Value &gt; p;
<a name="l01908"></a>01908     p[<span class="stringliteral">&quot;pool&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#af80b3591fe77244b1ed101e3d01af195">pool_to_value</a>(pool);
<a name="l01909"></a>01909     p[<span class="stringliteral">&quot;name&quot;</span>] = <a class="code" href="class_value.html">Value</a>(name);
<a name="l01910"></a>01910     p[<span class="stringliteral">&quot;size_bytes&quot;</span>] = <a class="code" href="class_value.html">Value</a>(size_bytes);
<a name="l01911"></a>01911     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01912"></a>01912 
<a name="l01913"></a>01913     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01914"></a>01914     <a class="code" href="class_value.html">Value</a> response;
<a name="l01915"></a>01915 
<a name="l01916"></a>01916     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;fs_create&quot;</span>, parameters, response);
<a name="l01917"></a>01917     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01918"></a>01918         *fs = (<a class="code" href="struct__lsm__fs.html">lsm_fs</a> *) parse_job_response(c, response, rc, job,
<a name="l01919"></a>01919                                             (<a class="code" href="lsm__mgmt_8cpp.html#a7a13ea19682cf43e08f2abec1127a37d">convert</a>) <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>);
<a name="l01920"></a>01920     }
<a name="l01921"></a>01921     <span class="keywordflow">return</span> rc;
<a name="l01922"></a>01922 }
<a name="l01923"></a>01923 
<a name="l01924"></a>01924 <span class="keyword">static</span> <a class="code" href="class_value.html">Value</a> _create_fs_flag_param(<a class="code" href="struct__lsm__fs.html">lsm_fs</a> * fs, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01925"></a>01925 {
<a name="l01926"></a>01926     std::map &lt; std::string, Value &gt; p;
<a name="l01927"></a>01927     p[<span class="stringliteral">&quot;fs&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(fs);
<a name="l01928"></a>01928     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01929"></a>01929     <span class="keywordflow">return</span> <a class="code" href="class_value.html">Value</a>(p);
<a name="l01930"></a>01930 }
<a name="l01931"></a>01931 
<a name="l01932"></a><a class="code" href="lsm__mgmt_8cpp.html#a708d333adb5442f1e19f822c9902f540">01932</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#af8d0ee7c8a073e497e28e97b9227b63e">lsm_fs_delete</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> * fs, <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01933"></a>01933 {
<a name="l01934"></a>01934     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01935"></a>01935 
<a name="l01936"></a>01936     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#ac6c84aca55b5121f0771751d73195d34">LSM_IS_FS</a>(fs) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01937"></a>01937         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01938"></a>01938     }
<a name="l01939"></a>01939 
<a name="l01940"></a>01940     <a class="code" href="class_value.html">Value</a> parameters = _create_fs_flag_param(fs, flags);
<a name="l01941"></a>01941     <a class="code" href="class_value.html">Value</a> response;
<a name="l01942"></a>01942 
<a name="l01943"></a>01943     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;fs_delete&quot;</span>, parameters, response);
<a name="l01944"></a>01944     <span class="keywordflow">return</span> job_check(c, rc, response, job);
<a name="l01945"></a>01945 }
<a name="l01946"></a>01946 
<a name="l01947"></a>01947 
<a name="l01948"></a><a class="code" href="lsm__mgmt_8cpp.html#af08021999ffadf37231b3c3afb498567">01948</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a64b2001a8192b6f1d80761088a5a30f0">lsm_fs_resize</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> * fs,
<a name="l01949"></a>01949                   uint64_t new_size_bytes, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> ** rfs,
<a name="l01950"></a>01950                   <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01951"></a>01951 {
<a name="l01952"></a>01952     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01953"></a>01953 
<a name="l01954"></a>01954     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#ac6c84aca55b5121f0771751d73195d34">LSM_IS_FS</a>(fs) || !new_size_bytes || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(rfs) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job)
<a name="l01955"></a>01955         || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01956"></a>01956         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01957"></a>01957     }
<a name="l01958"></a>01958 
<a name="l01959"></a>01959     std::map &lt; std::string, Value &gt; p;
<a name="l01960"></a>01960     p[<span class="stringliteral">&quot;fs&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(fs);
<a name="l01961"></a>01961     p[<span class="stringliteral">&quot;new_size_bytes&quot;</span>] = <a class="code" href="class_value.html">Value</a>(new_size_bytes);
<a name="l01962"></a>01962     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01963"></a>01963 
<a name="l01964"></a>01964     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01965"></a>01965     <a class="code" href="class_value.html">Value</a> response;
<a name="l01966"></a>01966 
<a name="l01967"></a>01967     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;fs_resize&quot;</span>, parameters, response);
<a name="l01968"></a>01968     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01969"></a>01969         *rfs = (<a class="code" href="struct__lsm__fs.html">lsm_fs</a> *) parse_job_response(c, response, rc, job,
<a name="l01970"></a>01970                                              (<a class="code" href="lsm__mgmt_8cpp.html#a7a13ea19682cf43e08f2abec1127a37d">convert</a>) <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>);
<a name="l01971"></a>01971     }
<a name="l01972"></a>01972     <span class="keywordflow">return</span> rc;
<a name="l01973"></a>01973 }
<a name="l01974"></a>01974 
<a name="l01975"></a><a class="code" href="lsm__mgmt_8cpp.html#a8de789cdad64fd7145283c81930418eb">01975</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a8b322bdf57d8cc8b3b553008767a4aaf">lsm_fs_clone</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> * src_fs,
<a name="l01976"></a>01976                  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__datatypes_8cpp.html#a2cc1fcbe95db9f01f0bc16e608508a1d">name</a>, <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> * optional_ss,
<a name="l01977"></a>01977                  <a class="code" href="struct__lsm__fs.html">lsm_fs</a> ** cloned_fs, <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l01978"></a>01978 {
<a name="l01979"></a>01979     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l01980"></a>01980 
<a name="l01981"></a>01981     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#ac6c84aca55b5121f0771751d73195d34">LSM_IS_FS</a>(src_fs) || <a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(name) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(cloned_fs) ||
<a name="l01982"></a>01982         <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l01983"></a>01983         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l01984"></a>01984     }
<a name="l01985"></a>01985 
<a name="l01986"></a>01986     std::map &lt; std::string, Value &gt; p;
<a name="l01987"></a>01987     p[<span class="stringliteral">&quot;src_fs&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(src_fs);
<a name="l01988"></a>01988     p[<span class="stringliteral">&quot;dest_fs_name&quot;</span>] = <a class="code" href="class_value.html">Value</a>(name);
<a name="l01989"></a>01989     p[<span class="stringliteral">&quot;snapshot&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#ac8379996cc9809a020beb41156e400e0">ss_to_value</a>(optional_ss);
<a name="l01990"></a>01990     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l01991"></a>01991 
<a name="l01992"></a>01992     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l01993"></a>01993     <a class="code" href="class_value.html">Value</a> response;
<a name="l01994"></a>01994 
<a name="l01995"></a>01995     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;fs_clone&quot;</span>, parameters, response);
<a name="l01996"></a>01996     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l01997"></a>01997         *cloned_fs = (<a class="code" href="struct__lsm__fs.html">lsm_fs</a> *) parse_job_response(c, response, rc, job,
<a name="l01998"></a>01998                                                    (<a class="code" href="lsm__mgmt_8cpp.html#a7a13ea19682cf43e08f2abec1127a37d">convert</a>) <a class="code" href="lsm__convert_8cpp.html#a4524b752397b802dd48ff9ba2ec9db49">value_to_fs</a>);
<a name="l01999"></a>01999     }
<a name="l02000"></a>02000     <span class="keywordflow">return</span> rc;
<a name="l02001"></a>02001 }
<a name="l02002"></a>02002 
<a name="l02003"></a><a class="code" href="lsm__mgmt_8cpp.html#abd018319aa89fb682277634a8bdbe61b">02003</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a61a532373540a0026f7024f2793615b0">lsm_fs_file_clone</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> * fs,
<a name="l02004"></a>02004                       <span class="keyword">const</span> <span class="keywordtype">char</span> *src_file_name,
<a name="l02005"></a>02005                       <span class="keyword">const</span> <span class="keywordtype">char</span> *dest_file_name, <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> * snapshot,
<a name="l02006"></a>02006                       <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02007"></a>02007 {
<a name="l02008"></a>02008     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02009"></a>02009 
<a name="l02010"></a>02010     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#ac6c84aca55b5121f0771751d73195d34">LSM_IS_FS</a>(fs) || <a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(src_file_name)
<a name="l02011"></a>02011         || <a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(dest_file_name)
<a name="l02012"></a>02012         || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l02013"></a>02013         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02014"></a>02014     }
<a name="l02015"></a>02015 
<a name="l02016"></a>02016     std::map &lt; std::string, Value &gt; p;
<a name="l02017"></a>02017     p[<span class="stringliteral">&quot;fs&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(fs);
<a name="l02018"></a>02018     p[<span class="stringliteral">&quot;src_file_name&quot;</span>] = <a class="code" href="class_value.html">Value</a>(src_file_name);
<a name="l02019"></a>02019     p[<span class="stringliteral">&quot;dest_file_name&quot;</span>] = <a class="code" href="class_value.html">Value</a>(dest_file_name);
<a name="l02020"></a>02020     p[<span class="stringliteral">&quot;snapshot&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#ac8379996cc9809a020beb41156e400e0">ss_to_value</a>(snapshot);
<a name="l02021"></a>02021     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l02022"></a>02022 
<a name="l02023"></a>02023     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l02024"></a>02024     <a class="code" href="class_value.html">Value</a> response;
<a name="l02025"></a>02025 
<a name="l02026"></a>02026     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;fs_file_clone&quot;</span>, parameters, response);
<a name="l02027"></a>02027     <span class="keywordflow">return</span> job_check(c, rc, response, job);
<a name="l02028"></a>02028 }
<a name="l02029"></a>02029 
<a name="l02030"></a>02030 <span class="keyword">static</span> <a class="code" href="class_value.html">Value</a> _create_fs_file_flag_params(<a class="code" href="struct__lsm__fs.html">lsm_fs</a> * fs,
<a name="l02031"></a>02031                                          <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> * files,
<a name="l02032"></a>02032                                          <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02033"></a>02033 {
<a name="l02034"></a>02034     std::map &lt; std::string, Value &gt; p;
<a name="l02035"></a>02035     p[<span class="stringliteral">&quot;fs&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(fs);
<a name="l02036"></a>02036     p[<span class="stringliteral">&quot;files&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#ab12e4a58efa188d9b9ccbad5bf4a60a9">string_list_to_value</a>(files);
<a name="l02037"></a>02037     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l02038"></a>02038     <span class="keywordflow">return</span> <a class="code" href="class_value.html">Value</a>(p);
<a name="l02039"></a>02039 }
<a name="l02040"></a>02040 
<a name="l02041"></a><a class="code" href="lsm__mgmt_8cpp.html#ac4e68cde0353bde6c0e0efa3a6e34df9">02041</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a2d6f50a0f3f41e80a22698878dbc7706">lsm_fs_child_dependency</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> * fs,
<a name="l02042"></a>02042                             <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> * files, uint8_t * yes,
<a name="l02043"></a>02043                             <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02044"></a>02044 {
<a name="l02045"></a>02045     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l02046"></a>02046     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02047"></a>02047 
<a name="l02048"></a>02048     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#ac6c84aca55b5121f0771751d73195d34">LSM_IS_FS</a>(fs)) {
<a name="l02049"></a>02049         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02050"></a>02050     }
<a name="l02051"></a>02051 
<a name="l02052"></a>02052     <span class="keywordflow">if</span> (files) {
<a name="l02053"></a>02053         <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a81a878122d8c9b89f14360e9808cf0dd">LSM_IS_STRING_LIST</a>(files)) {
<a name="l02054"></a>02054             <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02055"></a>02055         }
<a name="l02056"></a>02056     }
<a name="l02057"></a>02057 
<a name="l02058"></a>02058     <span class="keywordflow">if</span> (!yes || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l02059"></a>02059         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02060"></a>02060     }
<a name="l02061"></a>02061 
<a name="l02062"></a>02062     <span class="keywordflow">try</span> {
<a name="l02063"></a>02063 
<a name="l02064"></a>02064         <a class="code" href="class_value.html">Value</a> parameters = _create_fs_file_flag_params(fs, files, flags);
<a name="l02065"></a>02065         <a class="code" href="class_value.html">Value</a> response;
<a name="l02066"></a>02066 
<a name="l02067"></a>02067         rc = rpc(c, <span class="stringliteral">&quot;fs_child_dependency&quot;</span>, parameters, response);
<a name="l02068"></a>02068         rc = _retrieve_bool(rc, response, yes);
<a name="l02069"></a>02069     }
<a name="l02070"></a>02070     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l02071"></a>02071         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l02072"></a>02072     }
<a name="l02073"></a>02073     <span class="keywordflow">return</span> rc;
<a name="l02074"></a>02074 }
<a name="l02075"></a>02075 
<a name="l02076"></a><a class="code" href="lsm__mgmt_8cpp.html#ac991a29579187a36d7c10e50bfe8c797">02076</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ab40bdfe9c1fc7a5d090bceb210c7d2a6">lsm_fs_child_dependency_delete</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> * fs,
<a name="l02077"></a>02077                                    <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> * files, <span class="keywordtype">char</span> **job,
<a name="l02078"></a>02078                                    <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02079"></a>02079 {
<a name="l02080"></a>02080     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02081"></a>02081 
<a name="l02082"></a>02082     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#ac6c84aca55b5121f0771751d73195d34">LSM_IS_FS</a>(fs)) {
<a name="l02083"></a>02083         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02084"></a>02084     }
<a name="l02085"></a>02085 
<a name="l02086"></a>02086     <span class="keywordflow">if</span> (files) {
<a name="l02087"></a>02087         <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a81a878122d8c9b89f14360e9808cf0dd">LSM_IS_STRING_LIST</a>(files)) {
<a name="l02088"></a>02088             <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02089"></a>02089         }
<a name="l02090"></a>02090     }
<a name="l02091"></a>02091 
<a name="l02092"></a>02092     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l02093"></a>02093         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02094"></a>02094     }
<a name="l02095"></a>02095 
<a name="l02096"></a>02096     <a class="code" href="class_value.html">Value</a> parameters = _create_fs_file_flag_params(fs, files, flags);
<a name="l02097"></a>02097     <a class="code" href="class_value.html">Value</a> response;
<a name="l02098"></a>02098 
<a name="l02099"></a>02099     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;fs_child_dependency_rm&quot;</span>, parameters, response);
<a name="l02100"></a>02100     <span class="keywordflow">return</span> job_check(c, rc, response, job);
<a name="l02101"></a>02101 }
<a name="l02102"></a>02102 
<a name="l02103"></a><a class="code" href="lsm__mgmt_8cpp.html#a16ee3a7e5d55064909162e84f338bf55">02103</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ac42c992bf133d394379560a14cac83ba">lsm_fs_ss_list</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> * fs, <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> ** ss[],
<a name="l02104"></a>02104                    uint32_t * ssCount, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02105"></a>02105 {
<a name="l02106"></a>02106     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l02107"></a>02107     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02108"></a>02108 
<a name="l02109"></a>02109     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#ac6c84aca55b5121f0771751d73195d34">LSM_IS_FS</a>(fs)) {
<a name="l02110"></a>02110         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02111"></a>02111     }
<a name="l02112"></a>02112 
<a name="l02113"></a>02113     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(ss) || !ssCount) {
<a name="l02114"></a>02114         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02115"></a>02115     }
<a name="l02116"></a>02116 
<a name="l02117"></a>02117     <a class="code" href="class_value.html">Value</a> parameters = _create_fs_flag_param(fs, flags);
<a name="l02118"></a>02118     <a class="code" href="class_value.html">Value</a> response;
<a name="l02119"></a>02119 
<a name="l02120"></a>02120     <span class="keywordflow">try</span> {
<a name="l02121"></a>02121         rc = rpc(c, <span class="stringliteral">&quot;fs_snapshots&quot;</span>, parameters, response);
<a name="l02122"></a>02122         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l02123"></a>02123             std::vector &lt; Value &gt; sys = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l02124"></a>02124 
<a name="l02125"></a>02125             *ssCount = sys.size();
<a name="l02126"></a>02126 
<a name="l02127"></a>02127             <span class="keywordflow">if</span> (sys.size()) {
<a name="l02128"></a>02128                 *ss = <a class="code" href="libstoragemgmt__plug__interface_8h.html#ace9f3422d07f394f3ad8d7159bd51eb8">lsm_fs_ss_record_array_alloc</a>(sys.size());
<a name="l02129"></a>02129 
<a name="l02130"></a>02130                 <span class="keywordflow">if</span> (*ss) {
<a name="l02131"></a>02131                     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; sys.size(); ++i) {
<a name="l02132"></a>02132                         (*ss)[i] = <a class="code" href="lsm__convert_8cpp.html#a6018acc6f5e2ae46dfa37a94f17b347b">value_to_ss</a>(sys[i]);
<a name="l02133"></a>02133                         <span class="keywordflow">if</span> (!((*ss)[i])) {
<a name="l02134"></a>02134                             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l02135"></a>02135                             <span class="keywordflow">goto</span> error;
<a name="l02136"></a>02136                         }
<a name="l02137"></a>02137                     }
<a name="l02138"></a>02138                 } <span class="keywordflow">else</span> {
<a name="l02139"></a>02139                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l02140"></a>02140                 }
<a name="l02141"></a>02141             }
<a name="l02142"></a>02142         }
<a name="l02143"></a>02143     }
<a name="l02144"></a>02144     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l02145"></a>02145         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l02146"></a>02146         <span class="keywordflow">goto</span> error;
<a name="l02147"></a>02147     }
<a name="l02148"></a>02148   <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>:
<a name="l02149"></a>02149     <span class="keywordflow">return</span> rc;
<a name="l02150"></a>02150 
<a name="l02151"></a>02151   error:
<a name="l02152"></a>02152     <span class="keywordflow">if</span> (*ss &amp;&amp; *ssCount) {
<a name="l02153"></a>02153         <a class="code" href="libstoragemgmt__snapshot_8h.html#acf3fd024c11e28186c1843aaf8f1b49e">lsm_fs_ss_record_array_free</a>(*ss, *ssCount);
<a name="l02154"></a>02154         *ss = NULL;
<a name="l02155"></a>02155         *ssCount = 0;
<a name="l02156"></a>02156     }
<a name="l02157"></a>02157 
<a name="l02158"></a>02158     <span class="keywordflow">goto</span> <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l02159"></a>02159 }
<a name="l02160"></a>02160 
<a name="l02161"></a><a class="code" href="lsm__mgmt_8cpp.html#a14c3f8291301745071e21ba6a171bf00">02161</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a4dc5cec6844d44177b44bfe374d03fb4">lsm_fs_ss_create</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> * fs, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__datatypes_8cpp.html#a2cc1fcbe95db9f01f0bc16e608508a1d">name</a>,
<a name="l02162"></a>02162                      <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> ** snapshot, <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02163"></a>02163 {
<a name="l02164"></a>02164     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02165"></a>02165 
<a name="l02166"></a>02166     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#ac6c84aca55b5121f0771751d73195d34">LSM_IS_FS</a>(fs)) {
<a name="l02167"></a>02167         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02168"></a>02168     }
<a name="l02169"></a>02169 
<a name="l02170"></a>02170     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(name) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(snapshot) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job)
<a name="l02171"></a>02171         || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l02172"></a>02172         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02173"></a>02173     }
<a name="l02174"></a>02174 
<a name="l02175"></a>02175     std::map &lt; std::string, Value &gt; p;
<a name="l02176"></a>02176     p[<span class="stringliteral">&quot;fs&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(fs);
<a name="l02177"></a>02177     p[<span class="stringliteral">&quot;snapshot_name&quot;</span>] = <a class="code" href="class_value.html">Value</a>(name);
<a name="l02178"></a>02178     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l02179"></a>02179 
<a name="l02180"></a>02180     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l02181"></a>02181     <a class="code" href="class_value.html">Value</a> response;
<a name="l02182"></a>02182 
<a name="l02183"></a>02183     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;fs_snapshot_create&quot;</span>, parameters, response);
<a name="l02184"></a>02184     <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l02185"></a>02185         *snapshot = (<a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> *) parse_job_response(c, response, rc, job,
<a name="l02186"></a>02186                                                      (<a class="code" href="lsm__mgmt_8cpp.html#a7a13ea19682cf43e08f2abec1127a37d">convert</a>)
<a name="l02187"></a>02187                                                      <a class="code" href="lsm__convert_8cpp.html#a6018acc6f5e2ae46dfa37a94f17b347b">value_to_ss</a>);
<a name="l02188"></a>02188     }
<a name="l02189"></a>02189     <span class="keywordflow">return</span> rc;
<a name="l02190"></a>02190 }
<a name="l02191"></a>02191 
<a name="l02192"></a><a class="code" href="lsm__mgmt_8cpp.html#a3146bfd034812a4edcfedc43eb6d8b05">02192</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a739681a8f0a1c9c5657ca47e51f7bf87">lsm_fs_ss_delete</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> * fs, <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> * ss,
<a name="l02193"></a>02193                      <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02194"></a>02194 {
<a name="l02195"></a>02195     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02196"></a>02196 
<a name="l02197"></a>02197     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#ac6c84aca55b5121f0771751d73195d34">LSM_IS_FS</a>(fs)) {
<a name="l02198"></a>02198         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02199"></a>02199     }
<a name="l02200"></a>02200 
<a name="l02201"></a>02201     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a37dae4d4d2db3247d87103986edcff3c">LSM_IS_SS</a>(ss)) {
<a name="l02202"></a>02202         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02203"></a>02203     }
<a name="l02204"></a>02204 
<a name="l02205"></a>02205     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l02206"></a>02206         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02207"></a>02207     }
<a name="l02208"></a>02208 
<a name="l02209"></a>02209     std::map &lt; std::string, Value &gt; p;
<a name="l02210"></a>02210     p[<span class="stringliteral">&quot;fs&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(fs);
<a name="l02211"></a>02211     p[<span class="stringliteral">&quot;snapshot&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#ac8379996cc9809a020beb41156e400e0">ss_to_value</a>(ss);
<a name="l02212"></a>02212     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l02213"></a>02213 
<a name="l02214"></a>02214     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l02215"></a>02215     <a class="code" href="class_value.html">Value</a> response;
<a name="l02216"></a>02216 
<a name="l02217"></a>02217     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;fs_snapshot_delete&quot;</span>, parameters, response);
<a name="l02218"></a>02218     <span class="keywordflow">return</span> job_check(c, rc, response, job);
<a name="l02219"></a>02219 }
<a name="l02220"></a>02220 
<a name="l02221"></a><a class="code" href="lsm__mgmt_8cpp.html#a430c7c43e99c5e82a5f76b167d0cacac">02221</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ab01d450853e8056062097fba90edfb6a">lsm_fs_ss_restore</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__fs.html">lsm_fs</a> * fs, <a class="code" href="struct__lsm__fs__ss.html">lsm_fs_ss</a> * ss,
<a name="l02222"></a>02222                       <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> * files,
<a name="l02223"></a>02223                       <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> * restore_files,
<a name="l02224"></a>02224                       <span class="keywordtype">int</span> all_files, <span class="keywordtype">char</span> **job, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02225"></a>02225 {
<a name="l02226"></a>02226     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02227"></a>02227 
<a name="l02228"></a>02228     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#ac6c84aca55b5121f0771751d73195d34">LSM_IS_FS</a>(fs)) {
<a name="l02229"></a>02229         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02230"></a>02230     }
<a name="l02231"></a>02231 
<a name="l02232"></a>02232     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a37dae4d4d2db3247d87103986edcff3c">LSM_IS_SS</a>(ss)) {
<a name="l02233"></a>02233         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02234"></a>02234     }
<a name="l02235"></a>02235 
<a name="l02236"></a>02236     <span class="keywordflow">if</span> (files) {
<a name="l02237"></a>02237         <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a81a878122d8c9b89f14360e9808cf0dd">LSM_IS_STRING_LIST</a>(files)) {
<a name="l02238"></a>02238             <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02239"></a>02239         }
<a name="l02240"></a>02240     }
<a name="l02241"></a>02241 
<a name="l02242"></a>02242     <span class="keywordflow">if</span> (restore_files) {
<a name="l02243"></a>02243         <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a81a878122d8c9b89f14360e9808cf0dd">LSM_IS_STRING_LIST</a>(restore_files)) {
<a name="l02244"></a>02244             <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02245"></a>02245         }
<a name="l02246"></a>02246     }
<a name="l02247"></a>02247 
<a name="l02248"></a>02248     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(job) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l02249"></a>02249         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02250"></a>02250     }
<a name="l02251"></a>02251 
<a name="l02252"></a>02252     std::map &lt; std::string, Value &gt; p;
<a name="l02253"></a>02253     p[<span class="stringliteral">&quot;fs&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a78748fff4e31bd57c1c899024677dbaf">fs_to_value</a>(fs);
<a name="l02254"></a>02254     p[<span class="stringliteral">&quot;snapshot&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#ac8379996cc9809a020beb41156e400e0">ss_to_value</a>(ss);
<a name="l02255"></a>02255     p[<span class="stringliteral">&quot;files&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#ab12e4a58efa188d9b9ccbad5bf4a60a9">string_list_to_value</a>(files);
<a name="l02256"></a>02256     p[<span class="stringliteral">&quot;restore_files&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#ab12e4a58efa188d9b9ccbad5bf4a60a9">string_list_to_value</a>(restore_files);
<a name="l02257"></a>02257     p[<span class="stringliteral">&quot;all_files&quot;</span>] = <a class="code" href="class_value.html">Value</a>((all_files) ? <span class="keyword">true</span> : <span class="keyword">false</span>);
<a name="l02258"></a>02258     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l02259"></a>02259 
<a name="l02260"></a>02260     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l02261"></a>02261     <a class="code" href="class_value.html">Value</a> response;
<a name="l02262"></a>02262 
<a name="l02263"></a>02263     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;fs_snapshot_restore&quot;</span>, parameters, response);
<a name="l02264"></a>02264     <span class="keywordflow">return</span> job_check(c, rc, response, job);
<a name="l02265"></a>02265 
<a name="l02266"></a>02266 }
<a name="l02267"></a>02267 
<a name="l02268"></a><a class="code" href="lsm__mgmt_8cpp.html#a079b3be05abc515419f9c4a2bad4b7ee">02268</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a677e43e3a3569a69aabf1bf24e633bc0">lsm_nfs_list</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *search_key,
<a name="l02269"></a>02269                  <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__plugin__ipc_8cpp.html#a72c64aba1f17f6cf39d1ad7cbe41d0f5">search_value</a>, <a class="code" href="struct__lsm__nfs__export.html">lsm_nfs_export</a> ** exports[],
<a name="l02270"></a>02270                  uint32_t * count, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02271"></a>02271 {
<a name="l02272"></a>02272     <span class="keywordtype">int</span> rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>;
<a name="l02273"></a>02273     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02274"></a>02274 
<a name="l02275"></a>02275     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(exports) || !count) {
<a name="l02276"></a>02276         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02277"></a>02277     }
<a name="l02278"></a>02278 
<a name="l02279"></a>02279     *count = 0;
<a name="l02280"></a>02280     *exports = NULL;
<a name="l02281"></a>02281 
<a name="l02282"></a>02282     <span class="keywordflow">try</span> {
<a name="l02283"></a>02283         std::map &lt; std::string, Value &gt; p;
<a name="l02284"></a>02284 
<a name="l02285"></a>02285         rc = add_search_params(p, search_key, search_value,
<a name="l02286"></a>02286                                NFS_EXPORT_SEARCH_KEYS,
<a name="l02287"></a>02287                                <a class="code" href="lsm__mgmt_8cpp.html#a6c2ac858134dde16d3ac27a2508424c7">NFS_EXPORT_SEARCH_KEYS_COUNT</a>);
<a name="l02288"></a>02288         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> != rc) {
<a name="l02289"></a>02289             <span class="keywordflow">return</span> rc;
<a name="l02290"></a>02290         }
<a name="l02291"></a>02291 
<a name="l02292"></a>02292         p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l02293"></a>02293         <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l02294"></a>02294         <a class="code" href="class_value.html">Value</a> response;
<a name="l02295"></a>02295 
<a name="l02296"></a>02296         rc = rpc(c, <span class="stringliteral">&quot;exports&quot;</span>, parameters, response);
<a name="l02297"></a>02297         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1a7a92eae62ffc31f1234613d7d752c84d">Value::array_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l02298"></a>02298             std::vector &lt; Value &gt; exps = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l02299"></a>02299 
<a name="l02300"></a>02300             *count = exps.size();
<a name="l02301"></a>02301 
<a name="l02302"></a>02302             <span class="keywordflow">if</span> (*count) {
<a name="l02303"></a>02303                 *exports = <a class="code" href="libstoragemgmt__nfsexport_8h.html#a1b8368c7456fe1f9d8c8e8de448ed925">lsm_nfs_export_record_array_alloc</a>(*count);
<a name="l02304"></a>02304 
<a name="l02305"></a>02305                 <span class="keywordflow">if</span> (*exports) {
<a name="l02306"></a>02306                     <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; *count; ++i) {
<a name="l02307"></a>02307                         (*exports)[i] = <a class="code" href="lsm__convert_8cpp.html#aa230aa3280cfdd3ddb65372710954a3f">value_to_nfs_export</a>(exps[i]);
<a name="l02308"></a>02308                         <span class="keywordflow">if</span> (!((*exports)[i])) {
<a name="l02309"></a>02309                             rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l02310"></a>02310                             <span class="keywordflow">goto</span> error;
<a name="l02311"></a>02311                         }
<a name="l02312"></a>02312                     }
<a name="l02313"></a>02313                 } <span class="keywordflow">else</span> {
<a name="l02314"></a>02314                     rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l02315"></a>02315                 }
<a name="l02316"></a>02316             }
<a name="l02317"></a>02317         }
<a name="l02318"></a>02318     }
<a name="l02319"></a>02319     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l02320"></a>02320         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l02321"></a>02321         <span class="keywordflow">goto</span> error;
<a name="l02322"></a>02322     }
<a name="l02323"></a>02323   <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>:
<a name="l02324"></a>02324     <span class="keywordflow">return</span> rc;
<a name="l02325"></a>02325 
<a name="l02326"></a>02326   error:
<a name="l02327"></a>02327     <span class="keywordflow">if</span> (*exports &amp;&amp; *count) {
<a name="l02328"></a>02328         <a class="code" href="libstoragemgmt__nfsexport_8h.html#aa63b403191b76a3abc42f11383551c29">lsm_nfs_export_record_array_free</a>(*exports, *count);
<a name="l02329"></a>02329         *exports = NULL;
<a name="l02330"></a>02330         *count = 0;
<a name="l02331"></a>02331     }
<a name="l02332"></a>02332     <span class="keywordflow">goto</span> <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l02333"></a>02333 }
<a name="l02334"></a>02334 
<a name="l02335"></a><a class="code" href="lsm__mgmt_8cpp.html#a3b625a7b01f7fea5ed9378e188bb65c5">02335</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a1f90bf435f305aac5915f52b8a8b847a">lsm_nfs_export_fs</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c,
<a name="l02336"></a>02336                       <span class="keyword">const</span> <span class="keywordtype">char</span> *fs_id,
<a name="l02337"></a>02337                       <span class="keyword">const</span> <span class="keywordtype">char</span> *export_path,
<a name="l02338"></a>02338                       <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> * root_list,
<a name="l02339"></a>02339                       <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> * rw_list,
<a name="l02340"></a>02340                       <a class="code" href="struct__lsm__string__list.html">lsm_string_list</a> * ro_list,
<a name="l02341"></a>02341                       uint64_t anon_uid,
<a name="l02342"></a>02342                       uint64_t anon_gid,
<a name="l02343"></a>02343                       <span class="keyword">const</span> <span class="keywordtype">char</span> *auth_type,
<a name="l02344"></a>02344                       <span class="keyword">const</span> <span class="keywordtype">char</span> *options,
<a name="l02345"></a>02345                       <a class="code" href="struct__lsm__nfs__export.html">lsm_nfs_export</a> ** exported, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02346"></a>02346 {
<a name="l02347"></a>02347     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02348"></a>02348 
<a name="l02349"></a>02349     <span class="keywordflow">if</span> (root_list) {
<a name="l02350"></a>02350         <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a81a878122d8c9b89f14360e9808cf0dd">LSM_IS_STRING_LIST</a>(root_list)) {
<a name="l02351"></a>02351             <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02352"></a>02352         }
<a name="l02353"></a>02353     }
<a name="l02354"></a>02354 
<a name="l02355"></a>02355     <span class="keywordflow">if</span> (rw_list) {
<a name="l02356"></a>02356         <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a81a878122d8c9b89f14360e9808cf0dd">LSM_IS_STRING_LIST</a>(rw_list)) {
<a name="l02357"></a>02357             <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02358"></a>02358         }
<a name="l02359"></a>02359     }
<a name="l02360"></a>02360 
<a name="l02361"></a>02361     <span class="keywordflow">if</span> (ro_list) {
<a name="l02362"></a>02362         <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a81a878122d8c9b89f14360e9808cf0dd">LSM_IS_STRING_LIST</a>(ro_list)) {
<a name="l02363"></a>02363             <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02364"></a>02364         }
<a name="l02365"></a>02365     }
<a name="l02366"></a>02366 
<a name="l02367"></a>02367     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#ad8cb5913be5f698568b3d0c71f07b142">CHECK_STR</a>(fs_id) || <a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(exported)
<a name="l02368"></a>02368         || !(root_list || rw_list || ro_list)
<a name="l02369"></a>02369         || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l02370"></a>02370         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02371"></a>02371     }
<a name="l02372"></a>02372 
<a name="l02373"></a>02373     std::map &lt; std::string, Value &gt; p;
<a name="l02374"></a>02374 
<a name="l02375"></a>02375     p[<span class="stringliteral">&quot;fs_id&quot;</span>] = <a class="code" href="class_value.html">Value</a>(fs_id);
<a name="l02376"></a>02376     p[<span class="stringliteral">&quot;export_path&quot;</span>] = <a class="code" href="class_value.html">Value</a>(export_path);
<a name="l02377"></a>02377     p[<span class="stringliteral">&quot;root_list&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#ab12e4a58efa188d9b9ccbad5bf4a60a9">string_list_to_value</a>(root_list);
<a name="l02378"></a>02378     p[<span class="stringliteral">&quot;rw_list&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#ab12e4a58efa188d9b9ccbad5bf4a60a9">string_list_to_value</a>(rw_list);
<a name="l02379"></a>02379     p[<span class="stringliteral">&quot;ro_list&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#ab12e4a58efa188d9b9ccbad5bf4a60a9">string_list_to_value</a>(ro_list);
<a name="l02380"></a>02380     p[<span class="stringliteral">&quot;anon_uid&quot;</span>] = <a class="code" href="class_value.html">Value</a>(anon_uid);
<a name="l02381"></a>02381     p[<span class="stringliteral">&quot;anon_gid&quot;</span>] = <a class="code" href="class_value.html">Value</a>(anon_gid);
<a name="l02382"></a>02382     p[<span class="stringliteral">&quot;auth_type&quot;</span>] = <a class="code" href="class_value.html">Value</a>(auth_type);
<a name="l02383"></a>02383     p[<span class="stringliteral">&quot;options&quot;</span>] = <a class="code" href="class_value.html">Value</a>(options);
<a name="l02384"></a>02384     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l02385"></a>02385 
<a name="l02386"></a>02386     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l02387"></a>02387     <a class="code" href="class_value.html">Value</a> response;
<a name="l02388"></a>02388 
<a name="l02389"></a>02389     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;export_fs&quot;</span>, parameters, response);
<a name="l02390"></a>02390     <span class="keywordflow">try</span> {
<a name="l02391"></a>02391         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc &amp;&amp; <a class="code" href="class_value.html#a5b7c2b5c96c13d5b5d2842e91794f6c1aa3027a4e58556409de7c28c0eb17bafc">Value::object_t</a> == response.<a class="code" href="class_value.html#af8d0ac77ee63564b3ae101a62e38922f">valueType</a>()) {
<a name="l02392"></a>02392             *exported = <a class="code" href="lsm__convert_8cpp.html#aa230aa3280cfdd3ddb65372710954a3f">value_to_nfs_export</a>(response);
<a name="l02393"></a>02393             <span class="keywordflow">if</span> (!(*exported)) {
<a name="l02394"></a>02394                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l02395"></a>02395             }
<a name="l02396"></a>02396         }
<a name="l02397"></a>02397     }
<a name="l02398"></a>02398     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l02399"></a>02399         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l02400"></a>02400     }
<a name="l02401"></a>02401     <span class="keywordflow">return</span> rc;
<a name="l02402"></a>02402 }
<a name="l02403"></a>02403 
<a name="l02404"></a><a class="code" href="lsm__mgmt_8cpp.html#ae7b1279f13bff48ff0b1b04ab19b499f">02404</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a0327f4f1120c31b8ecd4d76dd5080351">lsm_nfs_export_delete</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__nfs__export.html">lsm_nfs_export</a> * e, <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02405"></a>02405 {
<a name="l02406"></a>02406     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02407"></a>02407 
<a name="l02408"></a>02408     <span class="keywordflow">if</span> (!<a class="code" href="lsm__datatypes_8hpp.html#a12393f4cf6c858d933aff5a72f71b8d7">LSM_IS_NFS_EXPORT</a>(e) || <a class="code" href="lsm__datatypes_8hpp.html#a3b30d5e41b6134d3c9f8c097ddf37941">LSM_FLAG_UNUSED_CHECK</a>(flags)) {
<a name="l02409"></a>02409         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02410"></a>02410     }
<a name="l02411"></a>02411 
<a name="l02412"></a>02412     std::map &lt; std::string, Value &gt; p;
<a name="l02413"></a>02413     p[<span class="stringliteral">&quot;export&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#aecf21606b00030de94f75103d312cba0">nfs_export_to_value</a>(e);
<a name="l02414"></a>02414     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l02415"></a>02415 
<a name="l02416"></a>02416     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l02417"></a>02417     <a class="code" href="class_value.html">Value</a> response;
<a name="l02418"></a>02418 
<a name="l02419"></a>02419     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;export_remove&quot;</span>, parameters, response);
<a name="l02420"></a>02420     <span class="keywordflow">return</span> rc;
<a name="l02421"></a>02421 }
<a name="l02422"></a>02422 
<a name="l02423"></a><a class="code" href="lsm__mgmt_8cpp.html#a028b960c89e50b947372c07361016a5e">02423</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#a8871512df7e7a7447d1030ec3af9427d">lsm_volume_raid_create_cap_get</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <a class="code" href="struct__lsm__system.html">lsm_system</a> * system,
<a name="l02424"></a>02424                                    uint32_t ** supported_raid_types,
<a name="l02425"></a>02425                                    uint32_t * supported_raid_type_count,
<a name="l02426"></a>02426                                    uint32_t ** supported_strip_sizes,
<a name="l02427"></a>02427                                    uint32_t * supported_strip_size_count,
<a name="l02428"></a>02428                                    <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02429"></a>02429 {
<a name="l02430"></a>02430     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02431"></a>02431 
<a name="l02432"></a>02432     <span class="keywordflow">if</span> (!supported_raid_types || !supported_raid_type_count ||
<a name="l02433"></a>02433         !supported_strip_sizes || !supported_strip_size_count) {
<a name="l02434"></a>02434         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02435"></a>02435     }
<a name="l02436"></a>02436 
<a name="l02437"></a>02437     *supported_raid_types = NULL;
<a name="l02438"></a>02438 
<a name="l02439"></a>02439     std::map &lt; std::string, Value &gt; p;
<a name="l02440"></a>02440     p[<span class="stringliteral">&quot;system&quot;</span>] = <a class="code" href="lsm__convert_8cpp.html#a64192028f7e1cd9ba79969062d17d3ea">system_to_value</a>(system);
<a name="l02441"></a>02441     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l02442"></a>02442 
<a name="l02443"></a>02443     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l02444"></a>02444     <a class="code" href="class_value.html">Value</a> response;
<a name="l02445"></a>02445 
<a name="l02446"></a>02446     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;volume_raid_create_cap_get&quot;</span>, parameters, response);
<a name="l02447"></a>02447     <span class="keywordflow">try</span> {
<a name="l02448"></a>02448         std::vector &lt; Value &gt; j = response.<a class="code" href="class_value.html#aa71bbb95edbd20e16fa01374cccb6268">asArray</a>();
<a name="l02449"></a>02449 
<a name="l02450"></a>02450         rc = <a class="code" href="lsm__convert_8cpp.html#a258000126e651dcaf2a019cd3a012dc4">values_to_uint32_array</a>(j[0], supported_raid_types,
<a name="l02451"></a>02451                                     supported_raid_type_count);
<a name="l02452"></a>02452 
<a name="l02453"></a>02453         <span class="keywordflow">if</span> (rc != <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l02454"></a>02454             <span class="keywordflow">goto</span> error;
<a name="l02455"></a>02455         }
<a name="l02456"></a>02456 
<a name="l02457"></a>02457         rc = <a class="code" href="lsm__convert_8cpp.html#a258000126e651dcaf2a019cd3a012dc4">values_to_uint32_array</a>(j[1], supported_strip_sizes,
<a name="l02458"></a>02458                                     supported_strip_size_count);
<a name="l02459"></a>02459         <span class="keywordflow">if</span> (rc != <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a>) {
<a name="l02460"></a>02460             <span class="keywordflow">goto</span> error;
<a name="l02461"></a>02461         }
<a name="l02462"></a>02462     }
<a name="l02463"></a>02463     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l02464"></a>02464         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l02465"></a>02465     }
<a name="l02466"></a>02466 
<a name="l02467"></a>02467   <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>:
<a name="l02468"></a>02468     <span class="keywordflow">return</span> rc;
<a name="l02469"></a>02469 
<a name="l02470"></a>02470   error:
<a name="l02471"></a>02471     free(*supported_raid_types);
<a name="l02472"></a>02472     *supported_raid_types = NULL;
<a name="l02473"></a>02473     *supported_raid_type_count = 0;
<a name="l02474"></a>02474     *supported_strip_sizes = NULL;
<a name="l02475"></a>02475     *supported_strip_size_count = 0;
<a name="l02476"></a>02476     <span class="keywordflow">goto</span> <a class="code" href="namespacelsmcli_1_1data__display.html#aeadc08e78abd46b3b8c29953b699f91c" title="Users are reporting errors with broken pipe when piping output to another program...">out</a>;
<a name="l02477"></a>02477 }
<a name="l02478"></a>02478 
<a name="l02479"></a><a class="code" href="lsm__mgmt_8cpp.html#a6d9a680a1d2efa3b5726cb70913cb0c9">02479</a> <span class="keywordtype">int</span> <a class="code" href="libstoragemgmt_8h.html#ab356327de2ab698fc70ddaeeac4b1341">lsm_volume_raid_create</a>(<a class="code" href="struct__lsm__connect.html">lsm_connect</a> * c, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="lsm__datatypes_8cpp.html#a2cc1fcbe95db9f01f0bc16e608508a1d">name</a>,
<a name="l02480"></a>02480                            <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545">lsm_volume_raid_type</a> raid_type,
<a name="l02481"></a>02481                            <a class="code" href="struct__lsm__disk.html">lsm_disk</a> * disks[], uint32_t disk_count,
<a name="l02482"></a>02482                            uint32_t strip_size, <a class="code" href="struct__lsm__volume.html">lsm_volume</a> ** new_volume,
<a name="l02483"></a>02483                            <a class="code" href="libstoragemgmt__types_8h.html#a4ba4992cd67ff1f9effd1a276c14cdca">lsm_flag</a> flags)
<a name="l02484"></a>02484 {
<a name="l02485"></a>02485     <a class="code" href="lsm__mgmt_8cpp.html#a8e0f6c44e655726edd5c1128aae4c0e9">CONN_SETUP</a>(c);
<a name="l02486"></a>02486 
<a name="l02487"></a>02487     <span class="keywordflow">if</span> (disk_count == 0) {
<a name="l02488"></a>02488         <span class="keywordflow">return</span> log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>,
<a name="l02489"></a>02489                              <span class="stringliteral">&quot;Require at least one disks&quot;</span>, NULL);
<a name="l02490"></a>02490     }
<a name="l02491"></a>02491 
<a name="l02492"></a>02492     <span class="keywordflow">if</span> (raid_type == <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545a091e35388968199f743b8957908bb8ee">LSM_VOLUME_RAID_TYPE_RAID1</a> &amp;&amp; disk_count != 2) {
<a name="l02493"></a>02493         <span class="keywordflow">return</span> log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>,
<a name="l02494"></a>02494                              <span class="stringliteral">&quot;RAID 1 only allows two disks&quot;</span>, NULL);
<a name="l02495"></a>02495     }
<a name="l02496"></a>02496 
<a name="l02497"></a>02497     <span class="keywordflow">if</span> (raid_type == <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545a09270a6bec25476072bfd1773deeac1f">LSM_VOLUME_RAID_TYPE_RAID5</a> &amp;&amp; disk_count &lt; 3) {
<a name="l02498"></a>02498         <span class="keywordflow">return</span> log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>,
<a name="l02499"></a>02499                              <span class="stringliteral">&quot;RAID 5 require 3 or more disks&quot;</span>, NULL);
<a name="l02500"></a>02500     }
<a name="l02501"></a>02501 
<a name="l02502"></a>02502     <span class="keywordflow">if</span> (raid_type == <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545ac97a49231ad0370b4c6dbf9f37006443">LSM_VOLUME_RAID_TYPE_RAID6</a> &amp;&amp; disk_count &lt; 4) {
<a name="l02503"></a>02503         <span class="keywordflow">return</span> log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>,
<a name="l02504"></a>02504                              <span class="stringliteral">&quot;RAID 5 require 4 or more disks&quot;</span>, NULL);
<a name="l02505"></a>02505     }
<a name="l02506"></a>02506 
<a name="l02507"></a>02507     <span class="keywordflow">if</span> (disk_count % 2) {
<a name="l02508"></a>02508         <span class="keywordflow">if</span> (raid_type == <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545afd82a653ebf393d5b4bfc5a2fcc9d25c">LSM_VOLUME_RAID_TYPE_RAID10</a> &amp;&amp; disk_count &lt; 4) {
<a name="l02509"></a>02509             <span class="keywordflow">return</span> log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>,
<a name="l02510"></a>02510                                  <span class="stringliteral">&quot;RAID 10 require even disks count and 4 &quot;</span>
<a name="l02511"></a>02511                                  <span class="stringliteral">&quot;or more disks&quot;</span>,
<a name="l02512"></a>02512                                  NULL);
<a name="l02513"></a>02513         }
<a name="l02514"></a>02514         <span class="keywordflow">if</span> (raid_type == <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545a31085869b62683a41c895da950552e6c">LSM_VOLUME_RAID_TYPE_RAID50</a> &amp;&amp; disk_count &lt; 6) {
<a name="l02515"></a>02515             <span class="keywordflow">return</span> log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>,
<a name="l02516"></a>02516                                  <span class="stringliteral">&quot;RAID 50 require even disks count and 6 or &quot;</span>
<a name="l02517"></a>02517                                  <span class="stringliteral">&quot;more disks&quot;</span>,
<a name="l02518"></a>02518                                  NULL);
<a name="l02519"></a>02519         }
<a name="l02520"></a>02520         <span class="keywordflow">if</span> (raid_type == <a class="code" href="libstoragemgmt__types_8h.html#a5a8568c721e851d3c4664d67cdad5545a45042c96cf3be60543910d262610e5bc">LSM_VOLUME_RAID_TYPE_RAID60</a> &amp;&amp; disk_count &lt; 8) {
<a name="l02521"></a>02521             <span class="keywordflow">return</span> log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>,
<a name="l02522"></a>02522                                  <span class="stringliteral">&quot;RAID 60 require even disks count and 8 or &quot;</span>
<a name="l02523"></a>02523                                  <span class="stringliteral">&quot;more disks&quot;</span>,
<a name="l02524"></a>02524                                  NULL);
<a name="l02525"></a>02525         }
<a name="l02526"></a>02526     }
<a name="l02527"></a>02527 
<a name="l02528"></a>02528     <span class="keywordflow">if</span> (<a class="code" href="lsm__mgmt_8cpp.html#aa2fbda18531c81144064629b39a7024c">CHECK_RP</a>(new_volume)) {
<a name="l02529"></a>02529         <span class="keywordflow">return</span> <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a0d1f804e01ff934f2413ffe3c2ba4ed3">LSM_ERR_INVALID_ARGUMENT</a>;
<a name="l02530"></a>02530     }
<a name="l02531"></a>02531 
<a name="l02532"></a>02532     std::map &lt; std::string, Value &gt; p;
<a name="l02533"></a>02533     p[<span class="stringliteral">&quot;name&quot;</span>] = <a class="code" href="class_value.html">Value</a>(name);
<a name="l02534"></a>02534     p[<span class="stringliteral">&quot;raid_type&quot;</span>] = <a class="code" href="class_value.html">Value</a>((int32_t) raid_type);
<a name="l02535"></a>02535     p[<span class="stringliteral">&quot;strip_size&quot;</span>] = <a class="code" href="class_value.html">Value</a>((int32_t) strip_size);
<a name="l02536"></a>02536     p[<span class="stringliteral">&quot;flags&quot;</span>] = <a class="code" href="class_value.html">Value</a>(flags);
<a name="l02537"></a>02537     std::vector &lt; Value &gt; disks_value;
<a name="l02538"></a>02538     disks_value.reserve(disk_count);
<a name="l02539"></a>02539     <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; disk_count; i++) {
<a name="l02540"></a>02540         disks_value.push_back(<a class="code" href="lsm__convert_8cpp.html#a1e5e136b7a224a1be8f10e31ab8d9656">disk_to_value</a>(disks[i]));
<a name="l02541"></a>02541     }
<a name="l02542"></a>02542     p[<span class="stringliteral">&quot;disks&quot;</span>] = disks_value;
<a name="l02543"></a>02543 
<a name="l02544"></a>02544     <a class="code" href="class_value.html">Value</a> parameters(p);
<a name="l02545"></a>02545     <a class="code" href="class_value.html">Value</a> response;
<a name="l02546"></a>02546 
<a name="l02547"></a>02547     <span class="keywordtype">int</span> rc = rpc(c, <span class="stringliteral">&quot;volume_raid_create&quot;</span>, parameters, response);
<a name="l02548"></a>02548     <span class="keywordflow">try</span> {
<a name="l02549"></a>02549         <span class="keywordflow">if</span> (<a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2aa6e5b7f4231db2232f0d778e40a2cfb9">LSM_ERR_OK</a> == rc) {
<a name="l02550"></a>02550             *new_volume = <a class="code" href="lsm__convert_8cpp.html#a0efb6c840e42fc3a8fc010b928a22ff1">value_to_volume</a>(response);
<a name="l02551"></a>02551             <span class="keywordflow">if</span> (!(*new_volume)) {
<a name="l02552"></a>02552                 rc = <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a8ee2028c76795f31458b96762c86ac44">LSM_ERR_NO_MEMORY</a>;
<a name="l02553"></a>02553             }
<a name="l02554"></a>02554         }
<a name="l02555"></a>02555     }
<a name="l02556"></a>02556     <span class="keywordflow">catch</span>(<span class="keyword">const</span> <a class="code" href="class_value_exception.html">ValueException</a> &amp; ve) {
<a name="l02557"></a>02557         rc = log_exception(c, <a class="code" href="libstoragemgmt__error_8h.html#ab4e2804e401f62fc5e0b73b88929cff2a338625ded145f705ed1c3d01e34bdb32">LSM_ERR_PLUGIN_BUG</a>, <span class="stringliteral">&quot;Unexpected type&quot;</span>, ve.what());
<a name="l02558"></a>02558     }
<a name="l02559"></a>02559     <span class="keywordflow">return</span> rc;
<a name="l02560"></a>02560 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 9 Jul 2015 for libStorageMgmt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
