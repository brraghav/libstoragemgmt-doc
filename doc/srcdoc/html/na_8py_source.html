<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>libStorageMgmt: na.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>na.py</h1><a href="na_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespaceplugin_1_1ontap_1_1na.html">00001</a> <span class="comment"># Copyright (C) 2012-2014 Red Hat, Inc.</span>
<a name="l00002"></a>00002 <span class="comment"># This library is free software; you can redistribute it and/or</span>
<a name="l00003"></a>00003 <span class="comment"># modify it under the terms of the GNU Lesser General Public</span>
<a name="l00004"></a>00004 <span class="comment"># License as published by the Free Software Foundation; either</span>
<a name="l00005"></a>00005 <span class="comment"># version 2.1 of the License, or any later version.</span>
<a name="l00006"></a>00006 <span class="comment">#</span>
<a name="l00007"></a>00007 <span class="comment"># This library is distributed in the hope that it will be useful,</span>
<a name="l00008"></a>00008 <span class="comment"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00009"></a>00009 <span class="comment"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="l00010"></a>00010 <span class="comment"># Lesser General Public License for more details.</span>
<a name="l00011"></a>00011 <span class="comment">#</span>
<a name="l00012"></a>00012 <span class="comment"># You should have received a copy of the GNU Lesser General Public</span>
<a name="l00013"></a>00013 <span class="comment"># License along with this library; If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00014"></a>00014 <span class="comment">#</span>
<a name="l00015"></a>00015 <span class="comment"># Author: tasleson</span>
<a name="l00016"></a>00016 
<a name="l00017"></a>00017 <span class="keyword">import</span> urllib2
<a name="l00018"></a>00018 <span class="keyword">import</span> socket
<a name="l00019"></a>00019 <span class="keyword">import</span> sys
<a name="l00020"></a>00020 <span class="keyword">from</span> xml.etree <span class="keyword">import</span> ElementTree
<a name="l00021"></a>00021 <span class="keyword">import</span> time
<a name="l00022"></a>00022 <span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify
<a name="l00023"></a>00023 <span class="keyword">from</span> _ssl <span class="keyword">import</span> SSLError
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="keyword">from</span> M2Crypto <span class="keyword">import</span> RC4
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="keyword">from</span> lsm.external.xmltodict <span class="keyword">import</span> convert_xml_to_dict
<a name="l00028"></a>00028 <span class="keyword">from</span> lsm <span class="keyword">import</span> (ErrorNumber)
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">#Set to an appropriate directory and file to dump the raw response.</span>
<a name="l00032"></a><a class="code" href="namespaceplugin_1_1ontap_1_1na.html#ad580e907c6459d8d79aad7935272c50f">00032</a> xml_debug = <span class="keywordtype">None</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="namespaceplugin_1_1ontap_1_1na.html#a69e224a88a998938488925abb79495a3">00035</a> <span class="keyword">def </span><a class="code" href="namespaceplugin_1_1ontap_1_1na.html#a69e224a88a998938488925abb79495a3">netapp_filer_parse_response</a>(resp):
<a name="l00036"></a>00036     <span class="keywordflow">if</span> xml_debug:
<a name="l00037"></a>00037         out = open(xml_debug, <span class="stringliteral">&quot;wb&quot;</span>)
<a name="l00038"></a>00038         out.write(resp)
<a name="l00039"></a>00039         out.close()
<a name="l00040"></a>00040 
<a name="l00041"></a>00041     <span class="keywordflow">return</span> convert_xml_to_dict(ElementTree.fromstring(resp))
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 
<a name="l00044"></a><a class="code" href="namespaceplugin_1_1ontap_1_1na.html#a8a0b302f7b5097b40c45cc22fd5451b0">00044</a> <span class="keyword">def </span><a class="code" href="namespaceplugin_1_1ontap_1_1na.html#a8a0b302f7b5097b40c45cc22fd5451b0">param_value</a>(val):
<a name="l00045"></a>00045     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00046"></a>00046 <span class="stringliteral">    Given a parameter to pass to filer, convert to XML</span>
<a name="l00047"></a>00047 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00048"></a>00048     rc = <span class="stringliteral">&quot;&quot;</span>
<a name="l00049"></a>00049     <span class="keywordflow">if</span> type(val) <span class="keywordflow">is</span> dict <span class="keywordflow">or</span> isinstance(val, dict):
<a name="l00050"></a>00050         <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> val.items():
<a name="l00051"></a>00051             rc += <span class="stringliteral">&quot;&lt;%s&gt;%s&lt;/%s&gt;&quot;</span> % (k, param_value(v), k)
<a name="l00052"></a>00052     <span class="keywordflow">elif</span> type(val) <span class="keywordflow">is</span> list <span class="keywordflow">or</span> isinstance(val, list):
<a name="l00053"></a>00053         <span class="keywordflow">for</span> i <span class="keywordflow">in</span> val:
<a name="l00054"></a>00054             rc += param_value(i)
<a name="l00055"></a>00055     <span class="keywordflow">else</span>:
<a name="l00056"></a>00056         rc = val
<a name="l00057"></a>00057     <span class="keywordflow">return</span> rc
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 
<a name="l00060"></a><a class="code" href="namespaceplugin_1_1ontap_1_1na.html#a6fe665363440f99cf40c5629c00fd4bb">00060</a> <span class="keyword">def </span><a class="code" href="namespaceplugin_1_1ontap_1_1na.html#a6fe665363440f99cf40c5629c00fd4bb">netapp_filer</a>(host, username, password, timeout, command, parameters=None,
<a name="l00061"></a>00061                  ssl=<span class="keyword">False</span>):
<a name="l00062"></a>00062     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00063"></a>00063 <span class="stringliteral">    Issue a command to the NetApp filer.</span>
<a name="l00064"></a>00064 <span class="stringliteral">    Note: Change to default ssl on before we ship a release version.</span>
<a name="l00065"></a>00065 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00066"></a>00066     proto = <span class="stringliteral">&apos;http&apos;</span>
<a name="l00067"></a>00067     <span class="keywordflow">if</span> ssl:
<a name="l00068"></a>00068         proto = <span class="stringliteral">&apos;https&apos;</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070     url = <span class="stringliteral">&quot;%s://%s/servlets/netapp.servlets.admin.XMLrequest_filer&quot;</span> % \
<a name="l00071"></a>00071           (proto, host)
<a name="l00072"></a>00072 
<a name="l00073"></a>00073     req = urllib2.Request(url)
<a name="l00074"></a>00074     req.add_header(<span class="stringliteral">&apos;Content-Type&apos;</span>, <span class="stringliteral">&apos;text/xml&apos;</span>)
<a name="l00075"></a>00075 
<a name="l00076"></a>00076     password_manager = urllib2.HTTPPasswordMgrWithDefaultRealm()
<a name="l00077"></a>00077     password_manager.add_password(<span class="keywordtype">None</span>, url, username, password)
<a name="l00078"></a>00078     auth_manager = urllib2.HTTPBasicAuthHandler(password_manager)
<a name="l00079"></a>00079 
<a name="l00080"></a>00080     opener = urllib2.build_opener(auth_manager)
<a name="l00081"></a>00081     urllib2.install_opener(opener)
<a name="l00082"></a>00082 
<a name="l00083"></a>00083     <span class="comment">#build the command and the arguments for it</span>
<a name="l00084"></a>00084     p = <span class="stringliteral">&quot;&quot;</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <span class="keywordflow">if</span> parameters:
<a name="l00087"></a>00087         <span class="keywordflow">for</span> k, v <span class="keywordflow">in</span> parameters.items():
<a name="l00088"></a>00088             p += <span class="stringliteral">&quot;&lt;%s&gt;%s&lt;/%s&gt;&quot;</span> % (k, param_value(v), k)
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     payload = <span class="stringliteral">&quot;&lt;%s&gt;\n%s\n&lt;/%s&gt;&quot;</span> % (command, p, command)
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     data = <span class="stringliteral">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<a name="l00093"></a>00093 <span class="stringliteral">&lt;!DOCTYPE netapp SYSTEM &quot;file:/etc/netapp_filer.dtd&quot;&gt;</span>
<a name="l00094"></a>00094 <span class="stringliteral">&lt;netapp xmlns=&quot;http://www.netapp.com/filer/admin&quot; version=&quot;1.1&quot;&gt;</span>
<a name="l00095"></a>00095 <span class="stringliteral">%s</span>
<a name="l00096"></a>00096 <span class="stringliteral">&lt;/netapp&gt;</span>
<a name="l00097"></a>00097 <span class="stringliteral">&quot;&quot;&quot;</span> % payload
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     handler = <span class="keywordtype">None</span>
<a name="l00100"></a>00100     rc = <span class="keywordtype">None</span>
<a name="l00101"></a>00101     <span class="keywordflow">try</span>:
<a name="l00102"></a>00102         handler = urllib2.urlopen(req, data, float(timeout))
<a name="l00103"></a>00103 
<a name="l00104"></a>00104         <span class="keywordflow">if</span> handler.getcode() == 200:
<a name="l00105"></a>00105             rc = netapp_filer_parse_response(handler.read())
<a name="l00106"></a>00106     <span class="keywordflow">except</span> urllib2.HTTPError <span class="keyword">as</span> he:
<a name="l00107"></a>00107         <span class="keywordflow">raise</span>
<a name="l00108"></a>00108     <span class="keywordflow">except</span> urllib2.URLError <span class="keyword">as</span> ue:
<a name="l00109"></a>00109         <span class="keywordflow">if</span> isinstance(ue.reason, socket.timeout):
<a name="l00110"></a>00110             <span class="keywordflow">raise</span> FilerError(Filer.ETIMEOUT, <span class="stringliteral">&quot;Connection timeout&quot;</span>)
<a name="l00111"></a>00111         <span class="keywordflow">else</span>:
<a name="l00112"></a>00112             <span class="keywordflow">raise</span>
<a name="l00113"></a>00113     <span class="keywordflow">except</span> socket.timeout:
<a name="l00114"></a>00114         <span class="keywordflow">raise</span> FilerError(Filer.ETIMEOUT, <span class="stringliteral">&quot;Connection timeout&quot;</span>)
<a name="l00115"></a>00115     <span class="keywordflow">except</span> SSLError <span class="keyword">as</span> sse:
<a name="l00116"></a>00116         <span class="comment"># The ssl library doesn&apos;t give a good way to find specific reason.</span>
<a name="l00117"></a>00117         <span class="comment"># We are doing a string contains which is not ideal, but other than</span>
<a name="l00118"></a>00118         <span class="comment"># throwing a generic error in this case there isn&apos;t much we can do</span>
<a name="l00119"></a>00119         <span class="comment"># to be more specific.</span>
<a name="l00120"></a>00120         <span class="keywordflow">if</span> <span class="stringliteral">&quot;timed out&quot;</span> <span class="keywordflow">in</span> str(sse).lower():
<a name="l00121"></a>00121             <span class="keywordflow">raise</span> FilerError(Filer.ETIMEOUT, <span class="stringliteral">&quot;Connection timeout (SSL)&quot;</span>)
<a name="l00122"></a>00122         <span class="keywordflow">else</span>:
<a name="l00123"></a>00123             <span class="keywordflow">raise</span> FilerError(Filer.EUNKNOWN,
<a name="l00124"></a>00124                              <span class="stringliteral">&quot;SSL error occurred (%s)&quot;</span>, str(sse))
<a name="l00125"></a>00125     <span class="keywordflow">finally</span>:
<a name="l00126"></a>00126         <span class="keywordflow">if</span> handler:
<a name="l00127"></a>00127             handler.close()
<a name="l00128"></a>00128 
<a name="l00129"></a>00129     <span class="keywordflow">return</span> rc
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 
<a name="l00132"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html">00132</a> <span class="keyword">class </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html">FilerError</a>(Exception):
<a name="l00133"></a>00133     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00134"></a>00134 <span class="stringliteral">    Class represents a NetApp bad return code</span>
<a name="l00135"></a>00135 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00136"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#aa6db91ca08a67784de6ff034dbbed569">00136</a>     IGROUP_NOT_CONTAIN_GIVEN_INIT = 9007
<a name="l00137"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#a7c2932532ff36e15388f957f92405e81">00137</a>     IGROUP_ALREADY_HAS_INIT = 9008
<a name="l00138"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#a409841abb251d30e1a1a5089bf55175a">00138</a>     NO_SUCH_IGROUP = 9003
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <span class="comment"># Using the name from NetApp SDK netapp_errno.h</span>
<a name="l00141"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#a309c3394170f89644172370c508cffde">00141</a>     EVDISK_ERROR_VDISK_EXISTS = 9012        <span class="comment"># LUN name already in use</span>
<a name="l00142"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#a9bf44ab2bc43f9caca3f7fb32fc6c04f">00142</a>     EVDISK_ERROR_VDISK_EXPORTED = 9013  <span class="comment"># LUN is currently mapped</span>
<a name="l00143"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#a6b14135cdbe6c6905efde7bda7563af6">00143</a>     EVDISK_ERROR_VDISK_NOT_ENABLED = 9014   <span class="comment"># LUN is not online</span>
<a name="l00144"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#a43729d211326b66fe684b2f346a15c6a">00144</a>     EVDISK_ERROR_VDISK_NOT_DISABLED = 9015  <span class="comment"># LUN is not offline</span>
<a name="l00145"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#acd9950ab4d50853fa8184da1e8c39d28">00145</a>     EVDISK_ERROR_NO_SUCH_LUNMAP = 9016      <span class="comment"># LUN is already unmapped</span>
<a name="l00146"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#a1285b6f108e9e16538a94f6f3e1e25d3">00146</a>     EVDISK_ERROR_INITGROUP_MAPS_EXIST = 9029    <span class="comment"># LUN maps for this initiator</span>
<a name="l00147"></a>00147                                                 <span class="comment"># group exist</span>
<a name="l00148"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#af81e0fa9f387d9af7c09e0c406481506">00148</a>     EVDISK_ERROR_SIZE_TOO_LARGE = 9034      <span class="comment"># LUN size too large.</span>
<a name="l00149"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#ac0402f6c5a99217e257730130d687bbb">00149</a>     EVDISK_ERROR_NO_SUCH_VOLUME = 9036      <span class="comment"># NetApp Volume not exists.</span>
<a name="l00150"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#abd0d83574f67ba3a60a10e20340ab3c0">00150</a>     EVDISK_ERROR_SIZE_TOO_SMALL = 9041      <span class="comment"># Specified too small a size</span>
<a name="l00151"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#aea00f007f2a6f92d3fe3aa317246df57">00151</a>     EVDISK_ERROR_SIZE_UNCHANGED = 9042      <span class="comment"># requested size is the same.</span>
<a name="l00152"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#aa941d84f1557ddb6fc60a7f22e8c39df">00152</a>     EVDISK_ERROR_INITGROUP_HAS_VDISK = 9023     <span class="comment"># Already masked</span>
<a name="l00153"></a>00153 
<a name="l00154"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#ac775ee34451fdfa742b318538164070e">00154</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, errno, reason, *args, **kwargs):
<a name="l00155"></a>00155         Exception.__init__(self, *args, **kwargs)
<a name="l00156"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#a0a4ccfdbe1cf7b37afc60d34e748b066">00156</a>         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#a0a4ccfdbe1cf7b37afc60d34e748b066">errno</a> = int(errno)
<a name="l00157"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#a144a3f0ab0553569e546510e66e93766">00157</a>         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer_error.html#a144a3f0ab0553569e546510e66e93766">reason</a> = reason
<a name="l00158"></a>00158 
<a name="l00159"></a>00159 
<a name="l00160"></a><a class="code" href="namespaceplugin_1_1ontap_1_1na.html#a8d41fe467bafab850163328824390a73">00160</a> <span class="keyword">def </span><a class="code" href="namespaceplugin_1_1ontap_1_1na.html#a8d41fe467bafab850163328824390a73">to_list</a>(v):
<a name="l00161"></a>00161     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00162"></a>00162 <span class="stringliteral">    The return values in hash form can either be a single hash item or a list</span>
<a name="l00163"></a>00163 <span class="stringliteral">    of hash items, this code handles both to make callers always get a list.</span>
<a name="l00164"></a>00164 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00165"></a>00165     rc = []
<a name="l00166"></a>00166     <span class="keywordflow">if</span> v <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00167"></a>00167         <span class="keywordflow">if</span> isinstance(v, list):
<a name="l00168"></a>00168             rc = v
<a name="l00169"></a>00169         <span class="keywordflow">else</span>:
<a name="l00170"></a>00170             rc.append(v)
<a name="l00171"></a>00171     <span class="keywordflow">return</span> rc
<a name="l00172"></a>00172 
<a name="l00173"></a>00173 
<a name="l00174"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html">00174</a> <span class="keyword">class </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html">Filer</a>(object):
<a name="l00175"></a>00175     <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00176"></a>00176 <span class="stringliteral">    Class to handle NetApp API calls.</span>
<a name="l00177"></a>00177 <span class="stringliteral">    Note: These are using lsm terminology.</span>
<a name="l00178"></a>00178 <span class="stringliteral">    &quot;&quot;&quot;</span>
<a name="l00179"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8aca79043af953f57bb60df0e804cec1">00179</a>     EUNKNOWN = 10                   <span class="comment"># Non-specific error</span>
<a name="l00180"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ad797b22be31866beae6f376dbd06bcce">00180</a>     ENAVOL_NAME_DUPE = 17           <span class="comment"># Volume name collision</span>
<a name="l00181"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a265bf18b545cd45a08e892d0891ff8cb">00181</a>     ENOSPC = 28                     <span class="comment"># Out of space</span>
<a name="l00182"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#acbf76121c6aef6ae382aa0a0874f4847">00182</a>     ETIMEOUT = 60                   <span class="comment"># Time-out</span>
<a name="l00183"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ac50d2089b379744f3e4d4c3e656e11ed">00183</a>     EINVALID_ISCSI_NAME = 9006      <span class="comment"># Invalid ISCSI IQN</span>
<a name="l00184"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a44f897957c513c085a3cb201f5fae4aa">00184</a>     EDUPE_VOLUME_PATH = 9012        <span class="comment"># Duplicate volume name</span>
<a name="l00185"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a1207d6aa3face326094116cf522a1978">00185</a>     ENO_SUCH_VOLUME = 9017          <span class="comment"># lun not found</span>
<a name="l00186"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#abf19c133764f260de13c13507f997045">00186</a>     ESIZE_TOO_LARGE = 9034          <span class="comment"># Specified too large a size</span>
<a name="l00187"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a5e2954048668752e79d67572d7c55845">00187</a>     ENO_SUCH_FS = 9036              <span class="comment"># FS not found</span>
<a name="l00188"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a39ad5502cd157f003872afbcc86c8c8e">00188</a>     EVOLUME_TOO_SMALL = 9041        <span class="comment"># Specified too small a size</span>
<a name="l00189"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aa82e649909ee6c64676b384da6d40e72">00189</a>     EAPILICENSE = 13008             <span class="comment"># Unlicensed API</span>
<a name="l00190"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#adc3d4b736adaac9e8d6314350bf148ab">00190</a>     EFSDOESNOTEXIST = 13040         <span class="comment"># FS does not exist</span>
<a name="l00191"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#abba8494f45f7ed17f3cbbeb4f192f8ea">00191</a>     EFSOFFLINE = 13042              <span class="comment"># FS is offline.</span>
<a name="l00192"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a737f3c948585e388e8beb2f8b9464be5">00192</a>     EFSNAMEINVALID = 13044          <span class="comment"># FS Name invalid</span>
<a name="l00193"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a17ea5da06d70b5a022322dff2aba554a">00193</a>     ENOSPACE = 13062                <span class="comment"># Not enough space</span>
<a name="l00194"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a67228a4b6ae264375882dca58cfa5cba">00194</a>     ESERVICENOTLICENSED = 13902     <span class="comment"># Not licensed</span>
<a name="l00195"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#acfd854d0c67c5588c7d116b6da4eed48">00195</a>     ECLONE_NAME_EXISTS = 14952      <span class="comment"># Clone with same name exists</span>
<a name="l00196"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ade5760328061c0702c7324fabb84deea">00196</a>     ECLONE_LICENSE_EXPIRED = 14955  <span class="comment"># Not licensed</span>
<a name="l00197"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a214ec3d5c40b30ab6994a2c415d66343">00197</a>     ECLONE_NOT_LICENSED = 14956     <span class="comment"># Not licensed</span>
<a name="l00198"></a>00198 
<a name="l00199"></a>00199     (LSM_VOL_PREFIX, LSM_INIT_PREFIX) = (<span class="stringliteral">&apos;lsm_lun_container&apos;</span>, <span class="stringliteral">&apos;lsm_init_&apos;</span>)
<a name="l00200"></a>00200 
<a name="l00201"></a>00201     <span class="keyword">def </span>_invoke(self, command, parameters=None):
<a name="l00202"></a>00202 
<a name="l00203"></a>00203         rc = netapp_filer(self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a832ddc04754e8a43d4f3c6165b1294a7">host</a>, self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a0adcbe0e0e6f64a29b1d205ede9632c1">username</a>, self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a9dbb300e28bc21c8dab41b01883918eb">password</a>,
<a name="l00204"></a>00204                           self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aee145bfca8e9b2eaf3cd3c47157be9a3">timeout</a>, command, parameters, self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#abb1c2a54408d504d582d683faa4cb0ce">ssl</a>)
<a name="l00205"></a>00205 
<a name="l00206"></a>00206         t = rc[<span class="stringliteral">&apos;netapp&apos;</span>][<span class="stringliteral">&apos;results&apos;</span>][<span class="stringliteral">&apos;attrib&apos;</span>]
<a name="l00207"></a>00207 
<a name="l00208"></a>00208         <span class="keywordflow">if</span> t[<span class="stringliteral">&apos;status&apos;</span>] != <span class="stringliteral">&apos;passed&apos;</span>:
<a name="l00209"></a>00209             <span class="keywordflow">raise</span> FilerError(t[<span class="stringliteral">&apos;errno&apos;</span>], t[<span class="stringliteral">&apos;reason&apos;</span>])
<a name="l00210"></a>00210 
<a name="l00211"></a>00211         <span class="keywordflow">return</span> rc[<span class="stringliteral">&apos;netapp&apos;</span>][<span class="stringliteral">&apos;results&apos;</span>]
<a name="l00212"></a>00212 
<a name="l00213"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ac775ee34451fdfa742b318538164070e">00213</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ac775ee34451fdfa742b318538164070e">__init__</a>(self, host, username, password, timeout, ssl=True):
<a name="l00214"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a832ddc04754e8a43d4f3c6165b1294a7">00214</a>         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a832ddc04754e8a43d4f3c6165b1294a7">host</a> = host
<a name="l00215"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a0adcbe0e0e6f64a29b1d205ede9632c1">00215</a>         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a0adcbe0e0e6f64a29b1d205ede9632c1">username</a> = username
<a name="l00216"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a9dbb300e28bc21c8dab41b01883918eb">00216</a>         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a9dbb300e28bc21c8dab41b01883918eb">password</a> = password
<a name="l00217"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aee145bfca8e9b2eaf3cd3c47157be9a3">00217</a>         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aee145bfca8e9b2eaf3cd3c47157be9a3">timeout</a> = timeout
<a name="l00218"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#abb1c2a54408d504d582d683faa4cb0ce">00218</a>         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#abb1c2a54408d504d582d683faa4cb0ce">ssl</a> = ssl
<a name="l00219"></a>00219 
<a name="l00220"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a6cdc335aa240016f82b07a44172350c9">00220</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a6cdc335aa240016f82b07a44172350c9">system_info</a>(self):
<a name="l00221"></a>00221         rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;system-get-info&apos;</span>)
<a name="l00222"></a>00222         <span class="keywordflow">return</span> rc[<span class="stringliteral">&apos;system-info&apos;</span>]
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8f3dc5c8aaf85c281c2f52cda259aa56">00224</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8f3dc5c8aaf85c281c2f52cda259aa56">validate</a>(self):
<a name="l00225"></a>00225         <span class="comment">#TODO: Validate that everything we need to function is available?</span>
<a name="l00226"></a>00226         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;system-api-list&apos;</span>)
<a name="l00227"></a>00227         <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00228"></a>00228 
<a name="l00229"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aa3388294e18ca07771eaa36dee3fd5d7">00229</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aa3388294e18ca07771eaa36dee3fd5d7">disks</a>(self):
<a name="l00230"></a>00230         disks = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;disk-list-info&apos;</span>)
<a name="l00231"></a>00231         <span class="keywordflow">return</span> disks[<span class="stringliteral">&apos;disk-details&apos;</span>][<span class="stringliteral">&apos;disk-detail-info&apos;</span>]
<a name="l00232"></a>00232 
<a name="l00233"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a9d74b68d0543215e045348fb221d404f">00233</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a9d74b68d0543215e045348fb221d404f">aggregates</a>(self, aggr_name=None):
<a name="l00234"></a>00234         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00235"></a>00235 <span class="stringliteral">        Return a list of aggregates</span>
<a name="l00236"></a>00236 <span class="stringliteral">        If aggr_name provided, return [na_aggr]</span>
<a name="l00237"></a>00237 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00238"></a>00238         <span class="keywordflow">if</span> aggr_name:
<a name="l00239"></a>00239             pools = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;aggr-list-info&apos;</span>, {<span class="stringliteral">&apos;aggregate&apos;</span>: aggr_name})
<a name="l00240"></a>00240         <span class="keywordflow">else</span>:
<a name="l00241"></a>00241             pools = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;aggr-list-info&apos;</span>)
<a name="l00242"></a>00242         tmp = pools[<span class="stringliteral">&apos;aggregates&apos;</span>][<span class="stringliteral">&apos;aggr-info&apos;</span>]
<a name="l00243"></a>00243         <span class="keywordflow">return</span> to_list(tmp)
<a name="l00244"></a>00244 
<a name="l00245"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a0e382c02faaede94a02bca92447b4077">00245</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a0e382c02faaede94a02bca92447b4077">aggregate_volume_names</a>(self, aggr_name):
<a name="l00246"></a>00246         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00247"></a>00247 <span class="stringliteral">        Return a list of volume names that are on an aggregate</span>
<a name="l00248"></a>00248 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00249"></a>00249         vol_names = []
<a name="l00250"></a>00250         rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;aggr-list-info&apos;</span>, {<span class="stringliteral">&apos;aggregate&apos;</span>: aggr_name})
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         aggr = rc[<span class="stringliteral">&apos;aggregates&apos;</span>][<span class="stringliteral">&apos;aggr-info&apos;</span>]
<a name="l00253"></a>00253 
<a name="l00254"></a>00254         <span class="keywordflow">if</span> aggr <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> aggr[<span class="stringliteral">&apos;volumes&apos;</span>] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00255"></a>00255             vols = aggr[<span class="stringliteral">&apos;volumes&apos;</span>][<span class="stringliteral">&apos;contained-volume-info&apos;</span>]
<a name="l00256"></a>00256             vol_names = [e[<span class="stringliteral">&apos;name&apos;</span>] <span class="keywordflow">for</span> e <span class="keywordflow">in</span> to_list(vols)]
<a name="l00257"></a>00257         <span class="keywordflow">return</span> vol_names
<a name="l00258"></a>00258 
<a name="l00259"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a4884856b8827b309b09fc080fe6153aa">00259</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a4884856b8827b309b09fc080fe6153aa">lun_build_name</a>(self, volume_name, file_name):
<a name="l00260"></a>00260         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00261"></a>00261 <span class="stringliteral">        Given a volume name and file return full path&quot;</span>
<a name="l00262"></a>00262 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00263"></a>00263         <span class="keywordflow">return</span> <span class="stringliteral">&apos;/vol/%s/%s&apos;</span> % (volume_name, file_name)
<a name="l00264"></a>00264 
<a name="l00265"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a4e58247b8e67a3654b90c8fc71efa28b">00265</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a4e58247b8e67a3654b90c8fc71efa28b">luns_get_specific</a>(self, aggr, na_lun_name=None, na_volume_name=None):
<a name="l00266"></a>00266         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00267"></a>00267 <span class="stringliteral">        Return all logical units, or information about one or for all those</span>
<a name="l00268"></a>00268 <span class="stringliteral">        on a volume name.</span>
<a name="l00269"></a>00269 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00270"></a>00270         rc = []
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         <span class="keywordflow">if</span> na_lun_name <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00273"></a>00273             luns = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-list-info&apos;</span>, {<span class="stringliteral">&apos;path&apos;</span>: na_lun_name})
<a name="l00274"></a>00274         <span class="keywordflow">elif</span> na_volume_name <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00275"></a>00275             luns = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-list-info&apos;</span>,
<a name="l00276"></a>00276                                 {<span class="stringliteral">&apos;volume-name&apos;</span>: na_volume_name})
<a name="l00277"></a>00277         <span class="keywordflow">else</span>:
<a name="l00278"></a>00278             luns = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-list-info&apos;</span>)
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <span class="keywordflow">return</span> to_list(luns[<span class="stringliteral">&apos;luns&apos;</span>][<span class="stringliteral">&apos;lun-info&apos;</span>])
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <span class="keyword">def </span>_get_aggr_info(self):
<a name="l00283"></a>00283         aggrs = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;aggr-list-info&apos;</span>)
<a name="l00284"></a>00284         tmp = to_list(aggrs[<span class="stringliteral">&apos;aggregates&apos;</span>][<span class="stringliteral">&apos;aggr-info&apos;</span>])
<a name="l00285"></a>00285         <span class="keywordflow">return</span> [x <span class="keywordflow">for</span> x <span class="keywordflow">in</span> tmp <span class="keywordflow">if</span> x[<span class="stringliteral">&apos;volumes&apos;</span>] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>]
<a name="l00286"></a>00286 
<a name="l00287"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a38e8ad61d788326a59824b42889a94bc">00287</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a38e8ad61d788326a59824b42889a94bc">luns_get_all</a>(self):
<a name="l00288"></a>00288         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00289"></a>00289 <span class="stringliteral">        Return all lun-info</span>
<a name="l00290"></a>00290 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00291"></a>00291         <span class="keywordflow">try</span>:
<a name="l00292"></a>00292             <span class="keywordflow">return</span> to_list(self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-list-info&apos;</span>)[<span class="stringliteral">&apos;luns&apos;</span>][<span class="stringliteral">&apos;lun-info&apos;</span>])
<a name="l00293"></a>00293         <span class="keywordflow">except</span> TypeError:
<a name="l00294"></a>00294             <span class="comment"># No LUN found.</span>
<a name="l00295"></a>00295             <span class="keywordflow">return</span> []
<a name="l00296"></a>00296 
<a name="l00297"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aacbf139a82dfdb78c9986ddd8a223f83">00297</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aacbf139a82dfdb78c9986ddd8a223f83">lun_min_size</a>(self):
<a name="l00298"></a>00298         <span class="keywordflow">return</span> self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-get-minsize&apos;</span>, {<span class="stringliteral">&apos;type&apos;</span>: <span class="stringliteral">&apos;image&apos;</span>})[<span class="stringliteral">&apos;min-size&apos;</span>]
<a name="l00299"></a>00299 
<a name="l00300"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a942209ea49300ff200b757680610b72b">00300</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a942209ea49300ff200b757680610b72b">lun_create</a>(self, full_path_name, size_bytes, flag_thin=False):
<a name="l00301"></a>00301         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00302"></a>00302 <span class="stringliteral">        Creates a lun</span>
<a name="l00303"></a>00303 <span class="stringliteral">        If flag_thin set to True, will set &apos;space-reservation-enabled&apos; as</span>
<a name="l00304"></a>00304 <span class="stringliteral">        &apos;false&apos; which means &quot;create a LUN without any space being reserved&quot;.</span>
<a name="l00305"></a>00305 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00306"></a>00306         params = {<span class="stringliteral">&apos;path&apos;</span>: full_path_name,
<a name="l00307"></a>00307                   <span class="stringliteral">&apos;size&apos;</span>: size_bytes}
<a name="l00308"></a>00308         <span class="keywordflow">if</span> flag_thin <span class="keywordflow">is</span> <span class="keyword">True</span>:
<a name="l00309"></a>00309             params[<span class="stringliteral">&apos;space-reservation-enabled&apos;</span>] = <span class="stringliteral">&apos;false&apos;</span>
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-create-by-size&apos;</span>, params)
<a name="l00312"></a>00312 
<a name="l00313"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ac118b59ca318f88385aa3954c2ea9b9f">00313</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ac118b59ca318f88385aa3954c2ea9b9f">lun_delete</a>(self, lun_path):
<a name="l00314"></a>00314         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00315"></a>00315 <span class="stringliteral">        Deletes a lun given a lun path</span>
<a name="l00316"></a>00316 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00317"></a>00317         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-destroy&apos;</span>, {<span class="stringliteral">&apos;path&apos;</span>: lun_path})
<a name="l00318"></a>00318 
<a name="l00319"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a91de8610bf6a0632a3e5db05d25e30d4">00319</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a91de8610bf6a0632a3e5db05d25e30d4">lun_resize</a>(self, lun_path, size_bytes):
<a name="l00320"></a>00320         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00321"></a>00321 <span class="stringliteral">        Re-sizes a lun</span>
<a name="l00322"></a>00322 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00323"></a>00323         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-resize&apos;</span>, {<span class="stringliteral">&apos;path&apos;</span>: lun_path, <span class="stringliteral">&apos;size&apos;</span>: size_bytes,
<a name="l00324"></a>00324                                     <span class="stringliteral">&apos;force&apos;</span>: <span class="stringliteral">&apos;true&apos;</span>})
<a name="l00325"></a>00325 
<a name="l00326"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aaafb0e081a5a7bd012d35f53b14e1e1a">00326</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aaafb0e081a5a7bd012d35f53b14e1e1a">volume_resize</a>(self, na_vol_name, size_diff_kb):
<a name="l00327"></a>00327         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00328"></a>00328 <span class="stringliteral">        Given a NetApp volume name and a size change in kb, re-size the</span>
<a name="l00329"></a>00329 <span class="stringliteral">        NetApp volume.</span>
<a name="l00330"></a>00330 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00331"></a>00331         params = {<span class="stringliteral">&apos;volume&apos;</span>: na_vol_name}
<a name="l00332"></a>00332 
<a name="l00333"></a>00333         <span class="keywordflow">if</span> size_diff_kb &gt; 0:
<a name="l00334"></a>00334             params[<span class="stringliteral">&apos;new-size&apos;</span>] = <span class="stringliteral">&apos;+&apos;</span> + str(size_diff_kb) + <span class="stringliteral">&apos;k&apos;</span>
<a name="l00335"></a>00335         <span class="keywordflow">else</span>:
<a name="l00336"></a>00336             params[<span class="stringliteral">&apos;new-size&apos;</span>] = str(size_diff_kb) + <span class="stringliteral">&apos;k&apos;</span>
<a name="l00337"></a>00337 
<a name="l00338"></a>00338         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-size&apos;</span>, params)
<a name="l00339"></a>00339         <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a4b0cedfa2577c2d650f97a8827b10733">00341</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a4b0cedfa2577c2d650f97a8827b10733">volumes</a>(self, volume_name=None):
<a name="l00342"></a>00342         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00343"></a>00343 <span class="stringliteral">        Return a list of NetApp volumes</span>
<a name="l00344"></a>00344 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00345"></a>00345         <span class="keywordflow">if</span> <span class="keywordflow">not</span> volume_name:
<a name="l00346"></a>00346             v = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-list-info&apos;</span>)
<a name="l00347"></a>00347         <span class="keywordflow">else</span>:
<a name="l00348"></a>00348             v = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-list-info&apos;</span>, {<span class="stringliteral">&apos;volume&apos;</span>: volume_name})
<a name="l00349"></a>00349 
<a name="l00350"></a>00350         t = v[<span class="stringliteral">&apos;volumes&apos;</span>][<span class="stringliteral">&apos;volume-info&apos;</span>]
<a name="l00351"></a>00351         rc = to_list(t)
<a name="l00352"></a>00352         <span class="keywordflow">return</span> rc
<a name="l00353"></a>00353 
<a name="l00354"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a720c825bce313b878e3d1839bbee6984">00354</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a720c825bce313b878e3d1839bbee6984">volume_create</a>(self, aggr_name, vol_name, size_in_bytes):
<a name="l00355"></a>00355         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00356"></a>00356 <span class="stringliteral">        Creates a volume given an aggr_name, volume name and size in bytes.</span>
<a name="l00357"></a>00357 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00358"></a>00358         params = {<span class="stringliteral">&apos;containing-aggr-name&apos;</span>: aggr_name,
<a name="l00359"></a>00359                   <span class="stringliteral">&apos;size&apos;</span>: int(size_in_bytes * 1.30),
<a name="l00360"></a>00360                   <span class="comment">#There must be a better way to account for this</span>
<a name="l00361"></a>00361                   <span class="stringliteral">&apos;volume&apos;</span>: vol_name}
<a name="l00362"></a>00362 
<a name="l00363"></a>00363         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-create&apos;</span>, params)
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         <span class="comment">#Turn off scheduled snapshots</span>
<a name="l00366"></a>00366         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-set-option&apos;</span>, {<span class="stringliteral">&apos;volume&apos;</span>: vol_name,
<a name="l00367"></a>00367                                            <span class="stringliteral">&apos;option-name&apos;</span>: <span class="stringliteral">&apos;nosnap&apos;</span>,
<a name="l00368"></a>00368                                            <span class="stringliteral">&apos;option-value&apos;</span>: <span class="stringliteral">&apos;on&apos;</span>, })
<a name="l00369"></a>00369 
<a name="l00370"></a>00370         <span class="comment">#Turn off auto export!</span>
<a name="l00371"></a>00371         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a7ef8d0ba7767a07bc9c84d8c056651d9">nfs_export_remove</a>([<span class="stringliteral">&apos;/vol/&apos;</span> + vol_name])
<a name="l00372"></a>00372 
<a name="l00373"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#abc9c4632b4f5eabe3015c0acd71860fe">00373</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#abc9c4632b4f5eabe3015c0acd71860fe">volume_clone</a>(self, src_volume, dest_volume, snapshot=None):
<a name="l00374"></a>00374         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00375"></a>00375 <span class="stringliteral">        Clones a volume given a source volume name, destination volume name</span>
<a name="l00376"></a>00376 <span class="stringliteral">        and optional backing snapshot.</span>
<a name="l00377"></a>00377 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00378"></a>00378         params = {<span class="stringliteral">&apos;parent-volume&apos;</span>: src_volume, <span class="stringliteral">&apos;volume&apos;</span>: dest_volume}
<a name="l00379"></a>00379         <span class="keywordflow">if</span> snapshot:
<a name="l00380"></a>00380             params[<span class="stringliteral">&apos;parent-snapshot&apos;</span>] = snapshot.name
<a name="l00381"></a>00381         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-clone-create&apos;</span>, params)
<a name="l00382"></a>00382 
<a name="l00383"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ae3cdf39f9436c7f2bd0dfc6d372d17fb">00383</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ae3cdf39f9436c7f2bd0dfc6d372d17fb">volume_delete</a>(self, vol_name):
<a name="l00384"></a>00384         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00385"></a>00385 <span class="stringliteral">        Deletes a volume and everything on it.</span>
<a name="l00386"></a>00386 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00387"></a>00387         online = <span class="keyword">False</span>
<a name="l00388"></a>00388 
<a name="l00389"></a>00389         <span class="keywordflow">try</span>:
<a name="l00390"></a>00390             self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-offline&apos;</span>, {<span class="stringliteral">&apos;name&apos;</span>: vol_name})
<a name="l00391"></a>00391             online = <span class="keyword">True</span>
<a name="l00392"></a>00392         <span class="keywordflow">except</span> FilerError <span class="keyword">as</span> f_error:
<a name="l00393"></a>00393             <span class="keywordflow">if</span> f_error.errno != Filer.EFSDOESNOTEXIST:
<a name="l00394"></a>00394                 <span class="keywordflow">raise</span>
<a name="l00395"></a>00395 
<a name="l00396"></a>00396         <span class="keywordflow">try</span>:
<a name="l00397"></a>00397             self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-destroy&apos;</span>, {<span class="stringliteral">&apos;name&apos;</span>: vol_name})
<a name="l00398"></a>00398         <span class="keywordflow">except</span> FilerError <span class="keyword">as</span> f_error:
<a name="l00399"></a>00399             <span class="comment">#If the volume was online, we will return it to same status</span>
<a name="l00400"></a>00400             <span class="comment"># Store the original exception information</span>
<a name="l00401"></a>00401             exception_info = sys.exc_info()
<a name="l00402"></a>00402 
<a name="l00403"></a>00403             <span class="keywordflow">if</span> online:
<a name="l00404"></a>00404                 <span class="keywordflow">try</span>:
<a name="l00405"></a>00405                     self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-online&apos;</span>, {<span class="stringliteral">&apos;name&apos;</span>: vol_name})
<a name="l00406"></a>00406                 <span class="keywordflow">except</span> FilerError:
<a name="l00407"></a>00407                     <span class="keywordflow">pass</span>
<a name="l00408"></a>00408             <span class="keywordflow">raise</span> exception_info[1], <span class="keywordtype">None</span>, exception_info[2]
<a name="l00409"></a>00409 
<a name="l00410"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a3f2dc73c5f6c949a07e8285d40078d43">00410</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a3f2dc73c5f6c949a07e8285d40078d43">volume_names</a>(self):
<a name="l00411"></a>00411         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00412"></a>00412 <span class="stringliteral">        Return a list of volume names</span>
<a name="l00413"></a>00413 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00414"></a>00414         vols = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a4b0cedfa2577c2d650f97a8827b10733">volumes</a>()
<a name="l00415"></a>00415         <span class="keywordflow">return</span> [v[<span class="stringliteral">&apos;name&apos;</span>] <span class="keywordflow">for</span> v <span class="keywordflow">in</span> vols]
<a name="l00416"></a>00416 
<a name="l00417"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a4110248fff184e40b53c1cfa2bc3c649">00417</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a4110248fff184e40b53c1cfa2bc3c649">clone</a>(self, source_path, dest_path, backing_snapshot=None,
<a name="l00418"></a>00418               ranges=<span class="keywordtype">None</span>):
<a name="l00419"></a>00419         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00420"></a>00420 <span class="stringliteral">        Creates a file clone</span>
<a name="l00421"></a>00421 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00422"></a>00422         params = {<span class="stringliteral">&apos;source-path&apos;</span>: source_path}
<a name="l00423"></a>00423 
<a name="l00424"></a>00424         <span class="comment">#You can have source == dest, but if you do you can only specify source</span>
<a name="l00425"></a>00425         <span class="keywordflow">if</span> source_path != dest_path:
<a name="l00426"></a>00426             params[<span class="stringliteral">&apos;destination-path&apos;</span>] = dest_path
<a name="l00427"></a>00427 
<a name="l00428"></a>00428         <span class="keywordflow">if</span> backing_snapshot:
<a name="l00429"></a>00429             <span class="keywordflow">raise</span> FilerError(ErrorNumber.NO_SUPPORT,
<a name="l00430"></a>00430                              <span class="stringliteral">&quot;Support for backing luns not implemented &quot;</span>
<a name="l00431"></a>00431                              <span class="stringliteral">&quot;for this API version&quot;</span>)
<a name="l00432"></a>00432             <span class="comment">#params[&apos;snapshot-name&apos;]= backing_snapshot</span>
<a name="l00433"></a>00433 
<a name="l00434"></a>00434         <span class="keywordflow">if</span> ranges:
<a name="l00435"></a>00435             block_ranges = []
<a name="l00436"></a>00436             <span class="keywordflow">for</span> r <span class="keywordflow">in</span> ranges:
<a name="l00437"></a>00437                 values = {<span class="stringliteral">&apos;block-count&apos;</span>: r.block_count,
<a name="l00438"></a>00438                           <span class="stringliteral">&apos;destination-block-number&apos;</span>: r.dest_block,
<a name="l00439"></a>00439                           <span class="stringliteral">&apos;source-block-number&apos;</span>: r.src_block}
<a name="l00440"></a>00440 
<a name="l00441"></a>00441                 block_ranges.append({<span class="stringliteral">&apos;block-range&apos;</span>: values})
<a name="l00442"></a>00442 
<a name="l00443"></a>00443             params[<span class="stringliteral">&apos;block-ranges&apos;</span>] = block_ranges
<a name="l00444"></a>00444 
<a name="l00445"></a>00445         rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;clone-start&apos;</span>, params)
<a name="l00446"></a>00446 
<a name="l00447"></a>00447         c_id = rc[<span class="stringliteral">&apos;clone-id&apos;</span>]
<a name="l00448"></a>00448 
<a name="l00449"></a>00449         <span class="keywordflow">while</span> <span class="keyword">True</span>:
<a name="l00450"></a>00450             progress = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;clone-list-status&apos;</span>,
<a name="l00451"></a>00451                                     {<span class="stringliteral">&apos;clone-id&apos;</span>: c_id})
<a name="l00452"></a>00452 
<a name="l00453"></a>00453             <span class="comment"># According to the spec the output is optional, if not present</span>
<a name="l00454"></a>00454             <span class="comment"># then we are done and good</span>
<a name="l00455"></a>00455             <span class="keywordflow">if</span> <span class="stringliteral">&apos;status&apos;</span> <span class="keywordflow">in</span> progress:
<a name="l00456"></a>00456                 progress = progress[<span class="stringliteral">&apos;status&apos;</span>][<span class="stringliteral">&apos;ops-info&apos;</span>]
<a name="l00457"></a>00457 
<a name="l00458"></a>00458                 <span class="keywordflow">if</span> progress[<span class="stringliteral">&apos;clone-state&apos;</span>] == <span class="stringliteral">&apos;failed&apos;</span>:
<a name="l00459"></a>00459                     self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;clone-clear&apos;</span>, {<span class="stringliteral">&apos;clone-id&apos;</span>: c_id})
<a name="l00460"></a>00460                     <span class="keywordflow">raise</span> FilerError(progress[<span class="stringliteral">&apos;error&apos;</span>], progress[<span class="stringliteral">&apos;reason&apos;</span>])
<a name="l00461"></a>00461                 <span class="keywordflow">elif</span> progress[<span class="stringliteral">&apos;clone-state&apos;</span>] == <span class="stringliteral">&apos;running&apos;</span> \
<a name="l00462"></a>00462                         <span class="keywordflow">or</span> progress[<span class="stringliteral">&apos;clone-state&apos;</span>] == <span class="stringliteral">&apos;fail exit&apos;</span>:
<a name="l00463"></a>00463                     <span class="comment"># State needs to transition to failed before we can</span>
<a name="l00464"></a>00464                     <span class="comment"># clear it!</span>
<a name="l00465"></a>00465                     time.sleep(0.2)     <span class="comment"># Don&apos;t hog cpu</span>
<a name="l00466"></a>00466                 <span class="keywordflow">elif</span> progress[<span class="stringliteral">&apos;clone-state&apos;</span>] == <span class="stringliteral">&apos;completed&apos;</span>:
<a name="l00467"></a>00467                     <span class="keywordflow">return</span>
<a name="l00468"></a>00468                 <span class="keywordflow">else</span>:
<a name="l00469"></a>00469                     <span class="keywordflow">raise</span> FilerError(ErrorNumber.NO_SUPPORT,
<a name="l00470"></a>00470                                      <span class="stringliteral">&apos;Unexpected state=&apos;</span> +
<a name="l00471"></a>00471                                      progress[<span class="stringliteral">&apos;clone-state&apos;</span>])
<a name="l00472"></a>00472             <span class="keywordflow">else</span>:
<a name="l00473"></a>00473                 <span class="keywordflow">return</span>
<a name="l00474"></a>00474 
<a name="l00475"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aa13b19b7ff6c9530c4a69d08cee7d2bc">00475</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aa13b19b7ff6c9530c4a69d08cee7d2bc">lun_online</a>(self, lun_path):
<a name="l00476"></a>00476         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-online&apos;</span>, {<span class="stringliteral">&apos;path&apos;</span>: lun_path})
<a name="l00477"></a>00477 
<a name="l00478"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a18b4479a9533db43cd2c6cd0d76f4621">00478</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a18b4479a9533db43cd2c6cd0d76f4621">lun_offline</a>(self, lun_path):
<a name="l00479"></a>00479         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-offline&apos;</span>, {<span class="stringliteral">&apos;path&apos;</span>: lun_path})
<a name="l00480"></a>00480 
<a name="l00481"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ad2dca7baec1b17c1c89822caed21d610">00481</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ad2dca7baec1b17c1c89822caed21d610">igroups</a>(self, group_name=None):
<a name="l00482"></a>00482         rc = []
<a name="l00483"></a>00483 
<a name="l00484"></a>00484         <span class="keywordflow">if</span> group_name:
<a name="l00485"></a>00485             g = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;igroup-list-info&apos;</span>,
<a name="l00486"></a>00486                              {<span class="stringliteral">&apos;initiator-group-name&apos;</span>: group_name})
<a name="l00487"></a>00487         <span class="keywordflow">else</span>:
<a name="l00488"></a>00488             g = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;igroup-list-info&apos;</span>)
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="keywordflow">if</span> g[<span class="stringliteral">&apos;initiator-groups&apos;</span>]:
<a name="l00491"></a>00491             rc = to_list(g[<span class="stringliteral">&apos;initiator-groups&apos;</span>][<span class="stringliteral">&apos;initiator-group-info&apos;</span>])
<a name="l00492"></a>00492         <span class="keywordflow">return</span> rc
<a name="l00493"></a>00493 
<a name="l00494"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#af12f027baf26de794f87be4de9c30767">00494</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#af12f027baf26de794f87be4de9c30767">igroup_create</a>(self, name, igroup_type):
<a name="l00495"></a>00495         params = {<span class="stringliteral">&apos;initiator-group-name&apos;</span>: name,
<a name="l00496"></a>00496                   <span class="stringliteral">&apos;initiator-group-type&apos;</span>: igroup_type}
<a name="l00497"></a>00497         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;igroup-create&apos;</span>, params)
<a name="l00498"></a>00498 
<a name="l00499"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ad2f14b7f96c61a8f9cb6b0fc64917842">00499</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ad2f14b7f96c61a8f9cb6b0fc64917842">igroup_delete</a>(self, name):
<a name="l00500"></a>00500         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;igroup-destroy&apos;</span>, {<span class="stringliteral">&apos;initiator-group-name&apos;</span>: name})
<a name="l00501"></a>00501 
<a name="l00502"></a>00502     @staticmethod
<a name="l00503"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a079d592aa5360c10d39d8e7b98b9b0de">00503</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a079d592aa5360c10d39d8e7b98b9b0de">encode</a>(password):
<a name="l00504"></a>00504         rc4 = RC4.RC4()
<a name="l00505"></a>00505         rc4.set_key(<span class="stringliteral">&quot;#u82fyi8S5\017pPemw&quot;</span>)
<a name="l00506"></a>00506         <span class="keywordflow">return</span> hexlify(rc4.update(password))
<a name="l00507"></a>00507 
<a name="l00508"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a2066bd2398b06df9ccf3736a869947a6">00508</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a2066bd2398b06df9ccf3736a869947a6">iscsi_initiator_add_auth</a>(self, initiator, user_name, password,
<a name="l00509"></a>00509                                  out_user, out_password):
<a name="l00510"></a>00510         pw = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a079d592aa5360c10d39d8e7b98b9b0de">encode</a>(password)
<a name="l00511"></a>00511 
<a name="l00512"></a>00512         args = {<span class="stringliteral">&apos;initiator&apos;</span>: initiator}
<a name="l00513"></a>00513 
<a name="l00514"></a>00514         <span class="keywordflow">if</span> user_name <span class="keywordflow">and</span> len(user_name) <span class="keywordflow">and</span> password <span class="keywordflow">and</span> len(password):
<a name="l00515"></a>00515             args.update({<span class="stringliteral">&apos;user-name&apos;</span>: user_name,
<a name="l00516"></a>00516                          <span class="stringliteral">&apos;password&apos;</span>: pw, <span class="stringliteral">&apos;auth-type&apos;</span>: <span class="stringliteral">&quot;CHAP&quot;</span>})
<a name="l00517"></a>00517 
<a name="l00518"></a>00518             <span class="keywordflow">if</span> out_user <span class="keywordflow">and</span> len(out_user) <span class="keywordflow">and</span> \
<a name="l00519"></a>00519                     out_password <span class="keywordflow">and</span> len(out_password):
<a name="l00520"></a>00520                 args.update({<span class="stringliteral">&apos;outbound-user-name&apos;</span>: out_user,
<a name="l00521"></a>00521                              <span class="stringliteral">&apos;outbound-password&apos;</span>: out_password})
<a name="l00522"></a>00522         <span class="keywordflow">else</span>:
<a name="l00523"></a>00523             args.update({<span class="stringliteral">&apos;initiator&apos;</span>: initiator, <span class="stringliteral">&apos;auth-type&apos;</span>: <span class="stringliteral">&quot;none&quot;</span>})
<a name="l00524"></a>00524 
<a name="l00525"></a>00525         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;iscsi-initiator-add-auth&apos;</span>, args)
<a name="l00526"></a>00526 
<a name="l00527"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a3f733e511d2a6e152f20806a5d86895f">00527</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a3f733e511d2a6e152f20806a5d86895f">igroup_add_initiator</a>(self, ig, initiator):
<a name="l00528"></a>00528         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;igroup-add&apos;</span>,
<a name="l00529"></a>00529                      {<span class="stringliteral">&apos;initiator-group-name&apos;</span>: ig, <span class="stringliteral">&apos;initiator&apos;</span>: initiator})
<a name="l00530"></a>00530 
<a name="l00531"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a1f6dfbcf2e44607b39aff5e18cfbff2a">00531</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a1f6dfbcf2e44607b39aff5e18cfbff2a">igroup_del_initiator</a>(self, ig, initiator):
<a name="l00532"></a>00532         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;igroup-remove&apos;</span>,
<a name="l00533"></a>00533                      {<span class="stringliteral">&apos;initiator-group-name&apos;</span>: ig,
<a name="l00534"></a>00534                       <span class="stringliteral">&apos;initiator&apos;</span>: initiator,
<a name="l00535"></a>00535                       <span class="stringliteral">&apos;force&apos;</span>: <span class="stringliteral">&apos;true&apos;</span>})
<a name="l00536"></a>00536 
<a name="l00537"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a9a276363685cc68894abb4442366180c">00537</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a9a276363685cc68894abb4442366180c">lun_map</a>(self, igroup, lun_path):
<a name="l00538"></a>00538         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-map&apos;</span>, {<span class="stringliteral">&apos;initiator-group&apos;</span>: igroup, <span class="stringliteral">&apos;path&apos;</span>: lun_path})
<a name="l00539"></a>00539 
<a name="l00540"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a6b241b8dae6f44a77d2f82344506078a">00540</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a6b241b8dae6f44a77d2f82344506078a">lun_unmap</a>(self, igroup, lun_path):
<a name="l00541"></a>00541         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(
<a name="l00542"></a>00542             <span class="stringliteral">&apos;lun-unmap&apos;</span>, {<span class="stringliteral">&apos;initiator-group&apos;</span>: igroup, <span class="stringliteral">&apos;path&apos;</span>: lun_path})
<a name="l00543"></a>00543 
<a name="l00544"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a6128204193194607e6c028a413236823">00544</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a6128204193194607e6c028a413236823">lun_map_list_info</a>(self, lun_path):
<a name="l00545"></a>00545         initiator_groups = []
<a name="l00546"></a>00546         rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-map-list-info&apos;</span>, {<span class="stringliteral">&apos;path&apos;</span>: lun_path})
<a name="l00547"></a>00547         <span class="keywordflow">if</span> rc[<span class="stringliteral">&apos;initiator-groups&apos;</span>] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00548"></a>00548             igi = to_list(rc[<span class="stringliteral">&apos;initiator-groups&apos;</span>])
<a name="l00549"></a>00549             <span class="keywordflow">for</span> i <span class="keywordflow">in</span> igi:
<a name="l00550"></a>00550                 group_name = i[<span class="stringliteral">&apos;initiator-group-info&apos;</span>][<span class="stringliteral">&apos;initiator-group-name&apos;</span>]
<a name="l00551"></a>00551                 initiator_groups.append(self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ad2dca7baec1b17c1c89822caed21d610">igroups</a>(group_name)[0])
<a name="l00552"></a>00552 
<a name="l00553"></a>00553         <span class="keywordflow">return</span> initiator_groups
<a name="l00554"></a>00554 
<a name="l00555"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a98e5a103963d2c20a02c1e7b3c9697a6">00555</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a98e5a103963d2c20a02c1e7b3c9697a6">lun_initiator_list_map_info</a>(self, initiator_id, initiator_group_name):
<a name="l00556"></a>00556         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00557"></a>00557 <span class="stringliteral">        Given an initiator_id and initiator group name, return a list of</span>
<a name="l00558"></a>00558 <span class="stringliteral">        lun-info</span>
<a name="l00559"></a>00559 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00560"></a>00560         luns = []
<a name="l00561"></a>00561 
<a name="l00562"></a>00562         rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;lun-initiator-list-map-info&apos;</span>,
<a name="l00563"></a>00563                           {<span class="stringliteral">&apos;initiator&apos;</span>: initiator_id})
<a name="l00564"></a>00564 
<a name="l00565"></a>00565         <span class="keywordflow">if</span> rc[<span class="stringliteral">&apos;lun-maps&apos;</span>]:
<a name="l00566"></a>00566 
<a name="l00567"></a>00567             lun_name_list = to_list(rc[<span class="stringliteral">&apos;lun-maps&apos;</span>][<span class="stringliteral">&apos;lun-map-info&apos;</span>])
<a name="l00568"></a>00568 
<a name="l00569"></a>00569             <span class="comment">#Get all the lun with information about aggr</span>
<a name="l00570"></a>00570             all_luns = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a38e8ad61d788326a59824b42889a94bc">luns_get_all</a>()
<a name="l00571"></a>00571 
<a name="l00572"></a>00572             <span class="keywordflow">for</span> l <span class="keywordflow">in</span> lun_name_list:
<a name="l00573"></a>00573                 <span class="keywordflow">if</span> l[<span class="stringliteral">&apos;initiator-group&apos;</span>] == initiator_group_name:
<a name="l00574"></a>00574                     <span class="keywordflow">for</span> al <span class="keywordflow">in</span> all_luns:
<a name="l00575"></a>00575                         <span class="keywordflow">if</span> al[<span class="stringliteral">&apos;path&apos;</span>] == l[<span class="stringliteral">&apos;path&apos;</span>]:
<a name="l00576"></a>00576                             luns.append(al)
<a name="l00577"></a>00577         <span class="keywordflow">return</span> luns
<a name="l00578"></a>00578 
<a name="l00579"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a9b1d32735b969b933451fe08fa38028e">00579</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a9b1d32735b969b933451fe08fa38028e">snapshots</a>(self, volume_name):
<a name="l00580"></a>00580         rc = []
<a name="l00581"></a>00581         args = {<span class="stringliteral">&apos;target-type&apos;</span>: <span class="stringliteral">&apos;volume&apos;</span>, <span class="stringliteral">&apos;target-name&apos;</span>: volume_name}
<a name="l00582"></a>00582         ss = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;snapshot-list-info&apos;</span>, args)
<a name="l00583"></a>00583         <span class="keywordflow">if</span> ss[<span class="stringliteral">&apos;snapshots&apos;</span>]:
<a name="l00584"></a>00584             rc = to_list(ss[<span class="stringliteral">&apos;snapshots&apos;</span>][<span class="stringliteral">&apos;snapshot-info&apos;</span>])
<a name="l00585"></a>00585         <span class="keywordflow">return</span> rc
<a name="l00586"></a>00586 
<a name="l00587"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a454be09cf3612cc39dc72a5a43355a4c">00587</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a454be09cf3612cc39dc72a5a43355a4c">snapshot_create</a>(self, volume_name, snapshot_name):
<a name="l00588"></a>00588         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;snapshot-create&apos;</span>, {<span class="stringliteral">&apos;volume&apos;</span>: volume_name,
<a name="l00589"></a>00589                                          <span class="stringliteral">&apos;snapshot&apos;</span>: snapshot_name})
<a name="l00590"></a>00590         <span class="keywordflow">return</span> [v <span class="keywordflow">for</span> v <span class="keywordflow">in</span> self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a9b1d32735b969b933451fe08fa38028e">snapshots</a>(volume_name)
<a name="l00591"></a>00591                 <span class="keywordflow">if</span> v[<span class="stringliteral">&apos;name&apos;</span>] == snapshot_name][0]
<a name="l00592"></a>00592 
<a name="l00593"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a4baf6aaddfe6f5dcead6aea028b7c463">00593</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a4baf6aaddfe6f5dcead6aea028b7c463">snapshot_file_restore_num</a>(self):
<a name="l00594"></a>00594         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00595"></a>00595 <span class="stringliteral">        Returns the number of executing file restore snapshots.</span>
<a name="l00596"></a>00596 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00597"></a>00597         rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;snapshot-restore-file-info&apos;</span>)
<a name="l00598"></a>00598         <span class="keywordflow">if</span> <span class="stringliteral">&apos;sfsr-in-progress&apos;</span> <span class="keywordflow">in</span> rc:
<a name="l00599"></a>00599             <span class="keywordflow">return</span> int(rc[<span class="stringliteral">&apos;sfsr-in-progress&apos;</span>])
<a name="l00600"></a>00600 
<a name="l00601"></a>00601         <span class="keywordflow">return</span> 0
<a name="l00602"></a>00602 
<a name="l00603"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ac2fe8ae1cc5f3ae01d34409ef5a52aff">00603</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ac2fe8ae1cc5f3ae01d34409ef5a52aff">snapshot_restore_volume</a>(self, fs_name, snapshot_name):
<a name="l00604"></a>00604         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00605"></a>00605 <span class="stringliteral">        Restores all files on a volume</span>
<a name="l00606"></a>00606 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00607"></a>00607         params = {<span class="stringliteral">&apos;snapshot&apos;</span>: snapshot_name, <span class="stringliteral">&apos;volume&apos;</span>: fs_name}
<a name="l00608"></a>00608         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;snapshot-restore-volume&apos;</span>, params)
<a name="l00609"></a>00609 
<a name="l00610"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#af0ae95fe346a6747732a4e88f847075a">00610</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#af0ae95fe346a6747732a4e88f847075a">snapshot_restore_file</a>(self, snapshot_name, restore_path, restore_file):
<a name="l00611"></a>00611         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00612"></a>00612 <span class="stringliteral">        Restore a list of files</span>
<a name="l00613"></a>00613 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00614"></a>00614         params = {<span class="stringliteral">&apos;snapshot&apos;</span>: snapshot_name, <span class="stringliteral">&apos;path&apos;</span>: restore_path}
<a name="l00615"></a>00615 
<a name="l00616"></a>00616         <span class="keywordflow">if</span> restore_file:
<a name="l00617"></a>00617             params[<span class="stringliteral">&apos;restore-path&apos;</span>] = restore_file
<a name="l00618"></a>00618 
<a name="l00619"></a>00619         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;snapshot-restore-file&apos;</span>, params)
<a name="l00620"></a>00620 
<a name="l00621"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a0d44a109876319b037e6f5b3af89dc4d">00621</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a0d44a109876319b037e6f5b3af89dc4d">snapshot_delete</a>(self, volume_name, snapshot_name):
<a name="l00622"></a>00622         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;snapshot-delete&apos;</span>,
<a name="l00623"></a>00623                      {<span class="stringliteral">&apos;volume&apos;</span>: volume_name, <span class="stringliteral">&apos;snapshot&apos;</span>: snapshot_name})
<a name="l00624"></a>00624 
<a name="l00625"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ab8577e2400b9a038f34ddbd9bd9e83fe">00625</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ab8577e2400b9a038f34ddbd9bd9e83fe">export_auth_types</a>(self):
<a name="l00626"></a>00626         rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;nfs-get-supported-sec-flavors&apos;</span>)
<a name="l00627"></a>00627         <span class="keywordflow">return</span> [e[<span class="stringliteral">&apos;flavor&apos;</span>] <span class="keywordflow">for</span> e <span class="keywordflow">in</span>
<a name="l00628"></a>00628                 to_list(rc[<span class="stringliteral">&apos;sec-flavor&apos;</span>][<span class="stringliteral">&apos;sec-flavor-info&apos;</span>])]
<a name="l00629"></a>00629 
<a name="l00630"></a>00630     @staticmethod
<a name="l00631"></a>00631     <span class="keyword">def </span>_build_list(pylist, list_name, elem_name):
<a name="l00632"></a>00632         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00633"></a>00633 <span class="stringliteral">        Given a python list, build the appropriate dict that contains the</span>
<a name="l00634"></a>00634 <span class="stringliteral">        list items so that it can be converted to xml to be sent on the wire.</span>
<a name="l00635"></a>00635 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00636"></a>00636         <span class="keywordflow">return</span> [{list_name: {elem_name: l}} <span class="keywordflow">for</span> l <span class="keywordflow">in</span> pylist]
<a name="l00637"></a>00637 
<a name="l00638"></a>00638     @staticmethod
<a name="l00639"></a>00639     <span class="keyword">def </span>_build_export_fs_all():
<a name="l00640"></a>00640         <span class="keywordflow">return</span> Filer._build_list(
<a name="l00641"></a>00641             [<span class="stringliteral">&apos;true&apos;</span>], <span class="stringliteral">&apos;exports-hostname-info&apos;</span>, <span class="stringliteral">&apos;all-hosts&apos;</span>)
<a name="l00642"></a>00642 
<a name="l00643"></a>00643     @staticmethod
<a name="l00644"></a>00644     <span class="keyword">def </span>_build_export_fs_list(hosts):
<a name="l00645"></a>00645         <span class="keywordflow">if</span> hosts[0] == <span class="stringliteral">&apos;*&apos;</span>:
<a name="l00646"></a>00646             <span class="keywordflow">return</span> Filer._build_export_fs_all()
<a name="l00647"></a>00647         <span class="keywordflow">else</span>:
<a name="l00648"></a>00648             <span class="keywordflow">return</span> Filer._build_list(hosts, <span class="stringliteral">&apos;exports-hostname-info&apos;</span>, <span class="stringliteral">&apos;name&apos;</span>)
<a name="l00649"></a>00649 
<a name="l00650"></a>00650     <span class="keyword">def </span>_build_export_rules(self, volume_path, export_path, ro_list, rw_list,
<a name="l00651"></a>00651                             root_list, anonuid=<span class="keywordtype">None</span>, sec_flavor=<span class="keywordtype">None</span>):
<a name="l00652"></a>00652         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00653"></a>00653 <span class="stringliteral">        Common logic to build up the rules for nfs</span>
<a name="l00654"></a>00654 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00655"></a>00655 
<a name="l00656"></a>00656         <span class="comment">#One of the more complicated data structures to push down to the</span>
<a name="l00657"></a>00657         <span class="comment">#controller</span>
<a name="l00658"></a>00658         rule = {<span class="stringliteral">&apos;pathname&apos;</span>: volume_path}
<a name="l00659"></a>00659         <span class="keywordflow">if</span> volume_path != export_path:
<a name="l00660"></a>00660             rule[<span class="stringliteral">&apos;actual-pathname&apos;</span>] = volume_path
<a name="l00661"></a>00661             rule[<span class="stringliteral">&apos;pathname&apos;</span>] = export_path
<a name="l00662"></a>00662 
<a name="l00663"></a>00663         rule[<span class="stringliteral">&apos;security-rules&apos;</span>] = {}
<a name="l00664"></a>00664         rule[<span class="stringliteral">&apos;security-rules&apos;</span>][<span class="stringliteral">&apos;security-rule-info&apos;</span>] = {}
<a name="l00665"></a>00665 
<a name="l00666"></a>00666         r = rule[<span class="stringliteral">&apos;security-rules&apos;</span>][<span class="stringliteral">&apos;security-rule-info&apos;</span>]
<a name="l00667"></a>00667 
<a name="l00668"></a>00668         <span class="keywordflow">if</span> len(ro_list):
<a name="l00669"></a>00669             r[<span class="stringliteral">&apos;read-only&apos;</span>] = Filer._build_export_fs_list(ro_list)
<a name="l00670"></a>00670 
<a name="l00671"></a>00671         <span class="keywordflow">if</span> len(rw_list):
<a name="l00672"></a>00672             r[<span class="stringliteral">&apos;read-write&apos;</span>] = Filer._build_export_fs_list(rw_list)
<a name="l00673"></a>00673 
<a name="l00674"></a>00674         <span class="keywordflow">if</span> len(root_list):
<a name="l00675"></a>00675             r[<span class="stringliteral">&apos;root&apos;</span>] = Filer._build_export_fs_list(root_list)
<a name="l00676"></a>00676 
<a name="l00677"></a>00677         <span class="keywordflow">if</span> anonuid:
<a name="l00678"></a>00678             uid = long(anonuid)
<a name="l00679"></a>00679             <span class="keywordflow">if</span> uid != -1 <span class="keywordflow">and</span> uid != 0xFFFFFFFFFFFFFFFF:
<a name="l00680"></a>00680                 r[<span class="stringliteral">&apos;anon&apos;</span>] = str(uid)
<a name="l00681"></a>00681 
<a name="l00682"></a>00682         <span class="keywordflow">if</span> sec_flavor:
<a name="l00683"></a>00683             r[<span class="stringliteral">&apos;sec-flavor&apos;</span>] = Filer._build_list(
<a name="l00684"></a>00684                 [sec_flavor], <span class="stringliteral">&apos;sec-flavor-info&apos;</span>, <span class="stringliteral">&apos;flavor&apos;</span>)
<a name="l00685"></a>00685 
<a name="l00686"></a>00686         <span class="keywordflow">return</span> rule
<a name="l00687"></a>00687 
<a name="l00688"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a08b245db851fe9e7cb93d949a6130210">00688</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a08b245db851fe9e7cb93d949a6130210">nfs_export_fs2</a>(self, volume_path, export_path, ro_list, rw_list,
<a name="l00689"></a>00689                        root_list, anonuid=<span class="keywordtype">None</span>, sec_flavor=<span class="keywordtype">None</span>):
<a name="l00690"></a>00690         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00691"></a>00691 <span class="stringliteral">        NFS export a volume.</span>
<a name="l00692"></a>00692 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00693"></a>00693 
<a name="l00694"></a>00694         rule = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a3b9557142acbeca8367b54b715f5de53">_build_export_rules</a>(
<a name="l00695"></a>00695             volume_path, export_path, ro_list, rw_list, root_list, anonuid,
<a name="l00696"></a>00696             sec_flavor)
<a name="l00697"></a>00697 
<a name="l00698"></a>00698         params = {<span class="stringliteral">&apos;persistent&apos;</span>: <span class="stringliteral">&apos;true&apos;</span>,
<a name="l00699"></a>00699                   <span class="stringliteral">&apos;rules&apos;</span>: {<span class="stringliteral">&apos;exports-rule-info-2&apos;</span>: [rule]}, <span class="stringliteral">&apos;verbose&apos;</span>: <span class="stringliteral">&apos;true&apos;</span>}
<a name="l00700"></a>00700         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;nfs-exportfs-append-rules-2&apos;</span>, params)
<a name="l00701"></a>00701 
<a name="l00702"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ad96831502a00b452448bae6ca5a38179">00702</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ad96831502a00b452448bae6ca5a38179">nfs_export_fs_modify2</a>(self, volume_path, export_path, ro_list, rw_list,
<a name="l00703"></a>00703                               root_list, anonuid=<span class="keywordtype">None</span>, sec_flavor=<span class="keywordtype">None</span>):
<a name="l00704"></a>00704 
<a name="l00705"></a>00705         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00706"></a>00706 <span class="stringliteral">        Modifies an existing rule.</span>
<a name="l00707"></a>00707 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00708"></a>00708         rule = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a3b9557142acbeca8367b54b715f5de53">_build_export_rules</a>(
<a name="l00709"></a>00709             volume_path, export_path, ro_list, rw_list, root_list, anonuid,
<a name="l00710"></a>00710             sec_flavor)
<a name="l00711"></a>00711 
<a name="l00712"></a>00712         params = {
<a name="l00713"></a>00713             <span class="stringliteral">&apos;persistent&apos;</span>: <span class="stringliteral">&apos;true&apos;</span>, <span class="stringliteral">&apos;rule&apos;</span>: {<span class="stringliteral">&apos;exports-rule-info-2&apos;</span>: [rule]}}
<a name="l00714"></a>00714         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;nfs-exportfs-modify-rule-2&apos;</span>, params)
<a name="l00715"></a>00715 
<a name="l00716"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a7ef8d0ba7767a07bc9c84d8c056651d9">00716</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a7ef8d0ba7767a07bc9c84d8c056651d9">nfs_export_remove</a>(self, export_paths):
<a name="l00717"></a>00717         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00718"></a>00718 <span class="stringliteral">        Removes an existing export</span>
<a name="l00719"></a>00719 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00720"></a>00720         <span class="keyword">assert</span> (type(export_paths) <span class="keywordflow">is</span> list)
<a name="l00721"></a>00721         paths = Filer._build_list(export_paths, <span class="stringliteral">&apos;pathname-info&apos;</span>, <span class="stringliteral">&apos;name&apos;</span>)
<a name="l00722"></a>00722         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;nfs-exportfs-delete-rules&apos;</span>,
<a name="l00723"></a>00723                      {<span class="stringliteral">&apos;pathnames&apos;</span>: paths, <span class="stringliteral">&apos;persistent&apos;</span>: <span class="stringliteral">&apos;true&apos;</span>})
<a name="l00724"></a>00724 
<a name="l00725"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a59c50fff042289cbe278def047a50c1e">00725</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a59c50fff042289cbe278def047a50c1e">nfs_exports</a>(self):
<a name="l00726"></a>00726         <span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00727"></a>00727 <span class="stringliteral">        Returns a list of exports (in hash form)</span>
<a name="l00728"></a>00728 <span class="stringliteral">        &quot;&quot;&quot;</span>
<a name="l00729"></a>00729         rc = []
<a name="l00730"></a>00730         exports = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;nfs-exportfs-list-rules&apos;</span>)
<a name="l00731"></a>00731         <span class="keywordflow">if</span> <span class="stringliteral">&apos;rules&apos;</span> <span class="keywordflow">in</span> exports <span class="keywordflow">and</span> exports[<span class="stringliteral">&apos;rules&apos;</span>]:
<a name="l00732"></a>00732             rc = to_list(exports[<span class="stringliteral">&apos;rules&apos;</span>][<span class="stringliteral">&apos;exports-rule-info&apos;</span>])
<a name="l00733"></a>00733         <span class="keywordflow">return</span> rc
<a name="l00734"></a>00734 
<a name="l00735"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#add8ab0d445497d5cc111745067fa68c5">00735</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#add8ab0d445497d5cc111745067fa68c5">volume_children</a>(self, volume):
<a name="l00736"></a>00736         params = {<span class="stringliteral">&apos;volume&apos;</span>: volume}
<a name="l00737"></a>00737 
<a name="l00738"></a>00738         rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-list-info&apos;</span>, params)
<a name="l00739"></a>00739 
<a name="l00740"></a>00740         <span class="keywordflow">if</span> <span class="stringliteral">&apos;clone-children&apos;</span> <span class="keywordflow">in</span> rc[<span class="stringliteral">&apos;volumes&apos;</span>][<span class="stringliteral">&apos;volume-info&apos;</span>]:
<a name="l00741"></a>00741             tmp = rc[<span class="stringliteral">&apos;volumes&apos;</span>][<span class="stringliteral">&apos;volume-info&apos;</span>][<span class="stringliteral">&apos;clone-children&apos;</span>][
<a name="l00742"></a>00742                 <span class="stringliteral">&apos;clone-child-info&apos;</span>]
<a name="l00743"></a>00743             rc = [c[<span class="stringliteral">&apos;clone-child-name&apos;</span>] <span class="keywordflow">for</span> c <span class="keywordflow">in</span> to_list(tmp)]
<a name="l00744"></a>00744         <span class="keywordflow">else</span>:
<a name="l00745"></a>00745             rc = <span class="keywordtype">None</span>
<a name="l00746"></a>00746 
<a name="l00747"></a>00747         <span class="keywordflow">return</span> rc
<a name="l00748"></a>00748 
<a name="l00749"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a6602be46572f5fd3e8705ed230a68b56">00749</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a6602be46572f5fd3e8705ed230a68b56">volume_split_clone</a>(self, volume):
<a name="l00750"></a>00750         self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-clone-split-start&apos;</span>, {<span class="stringliteral">&apos;volume&apos;</span>: volume})
<a name="l00751"></a>00751 
<a name="l00752"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a411de7f71efc2cc46e342db6b119913a">00752</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a411de7f71efc2cc46e342db6b119913a">volume_split_status</a>(self):
<a name="l00753"></a>00753         result = []
<a name="l00754"></a>00754 
<a name="l00755"></a>00755         rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;volume-clone-split-status&apos;</span>)
<a name="l00756"></a>00756 
<a name="l00757"></a>00757         <span class="keywordflow">if</span> <span class="stringliteral">&apos;clone-split-details&apos;</span> <span class="keywordflow">in</span> rc:
<a name="l00758"></a>00758             tmp = rc[<span class="stringliteral">&apos;clone-split-details&apos;</span>][<span class="stringliteral">&apos;clone-split-detail-info&apos;</span>]
<a name="l00759"></a>00759             result = [r[<span class="stringliteral">&apos;name&apos;</span>] <span class="keywordflow">for</span> r <span class="keywordflow">in</span> to_list(tmp)]
<a name="l00760"></a>00760 
<a name="l00761"></a>00761         <span class="keywordflow">return</span> result
<a name="l00762"></a>00762 
<a name="l00763"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ac8edebf20086ae4dd71f7c04ac07fcf4">00763</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#ac8edebf20086ae4dd71f7c04ac07fcf4">fcp_list</a>(self):
<a name="l00764"></a>00764         fcp_list = []
<a name="l00765"></a>00765 
<a name="l00766"></a>00766         <span class="keywordflow">try</span>:
<a name="l00767"></a>00767 
<a name="l00768"></a>00768             rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;fcp-adapter-list-info&apos;</span>)
<a name="l00769"></a>00769 
<a name="l00770"></a>00770             <span class="keywordflow">if</span> <span class="stringliteral">&apos;fcp-config-adapters&apos;</span> <span class="keywordflow">in</span> rc:
<a name="l00771"></a>00771                 <span class="keywordflow">if</span> <span class="stringliteral">&apos;fcp-config-adapter-info&apos;</span> <span class="keywordflow">in</span> rc[<span class="stringliteral">&apos;fcp-config-adapters&apos;</span>]:
<a name="l00772"></a>00772                     fc_config = rc[<span class="stringliteral">&apos;fcp-config-adapters&apos;</span>]
<a name="l00773"></a>00773                     adapters = fc_config[<span class="stringliteral">&apos;fcp-config-adapter-info&apos;</span>]
<a name="l00774"></a>00774                     <span class="keywordflow">for</span> f <span class="keywordflow">in</span> adapters:
<a name="l00775"></a>00775                         fcp_list.append(dict(addr=f[<span class="stringliteral">&apos;port-name&apos;</span>],
<a name="l00776"></a>00776                                              adapter=f[<span class="stringliteral">&apos;adapter&apos;</span>]))
<a name="l00777"></a>00777         <span class="keywordflow">except</span> FilerError <span class="keyword">as</span> na:
<a name="l00778"></a>00778             <span class="keywordflow">if</span> na.errno != Filer.EAPILICENSE:
<a name="l00779"></a>00779                 <span class="keywordflow">raise</span>
<a name="l00780"></a>00780 
<a name="l00781"></a>00781         <span class="keywordflow">return</span> fcp_list
<a name="l00782"></a>00782 
<a name="l00783"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aa539fa2a0132dbd0fd5776a7521c0130">00783</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aa539fa2a0132dbd0fd5776a7521c0130">iscsi_node_name</a>(self):
<a name="l00784"></a>00784         <span class="keywordflow">try</span>:
<a name="l00785"></a>00785             rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;iscsi-node-get-name&apos;</span>)
<a name="l00786"></a>00786             <span class="keywordflow">if</span> <span class="stringliteral">&apos;node-name&apos;</span> <span class="keywordflow">in</span> rc:
<a name="l00787"></a>00787                 <span class="keywordflow">return</span> rc[<span class="stringliteral">&apos;node-name&apos;</span>]
<a name="l00788"></a>00788         <span class="keywordflow">except</span> FilerError <span class="keyword">as</span> na:
<a name="l00789"></a>00789             <span class="keywordflow">if</span> na.errno != Filer.EAPILICENSE:
<a name="l00790"></a>00790                 <span class="keywordflow">raise</span>
<a name="l00791"></a>00791         <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00792"></a>00792 
<a name="l00793"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a580a91ac88af7a3b5553886b1e580b26">00793</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a580a91ac88af7a3b5553886b1e580b26">interface_get_infos</a>(self):
<a name="l00794"></a>00794         i_info = {}
<a name="l00795"></a>00795 
<a name="l00796"></a>00796         rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;net-ifconfig-get&apos;</span>)
<a name="l00797"></a>00797 
<a name="l00798"></a>00798         <span class="keywordflow">if</span> <span class="stringliteral">&apos;interface-config-info&apos;</span> <span class="keywordflow">in</span> rc:
<a name="l00799"></a>00799             i_config = rc[<span class="stringliteral">&apos;interface-config-info&apos;</span>]
<a name="l00800"></a>00800             <span class="keywordflow">if</span> <span class="stringliteral">&apos;interface-config-info&apos;</span> <span class="keywordflow">in</span> i_config:
<a name="l00801"></a>00801                 tmp = to_list(i_config[<span class="stringliteral">&apos;interface-config-info&apos;</span>])
<a name="l00802"></a>00802                 <span class="keywordflow">for</span> i <span class="keywordflow">in</span> tmp:
<a name="l00803"></a>00803                     i_info[i[<span class="stringliteral">&apos;interface-name&apos;</span>]] = i
<a name="l00804"></a>00804 
<a name="l00805"></a>00805         <span class="keywordflow">return</span> i_info
<a name="l00806"></a>00806 
<a name="l00807"></a><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aba365d3f3d054de200658813dab3acb0">00807</a>     <span class="keyword">def </span><a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#aba365d3f3d054de200658813dab3acb0">iscsi_list</a>(self):
<a name="l00808"></a>00808         i_list = []
<a name="l00809"></a>00809 
<a name="l00810"></a>00810         <span class="comment"># Get interface information</span>
<a name="l00811"></a>00811         i_info = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a580a91ac88af7a3b5553886b1e580b26">interface_get_infos</a>()
<a name="l00812"></a>00812 
<a name="l00813"></a>00813         <span class="keywordflow">try</span>:
<a name="l00814"></a>00814             rc = self.<a class="code" href="classplugin_1_1ontap_1_1na_1_1_filer.html#a8b9095dab9a25c46231c91a27f5d223a">_invoke</a>(<span class="stringliteral">&apos;iscsi-portal-list-info&apos;</span>)
<a name="l00815"></a>00815 
<a name="l00816"></a>00816             <span class="keywordflow">if</span> <span class="stringliteral">&apos;iscsi-portal-list-entries&apos;</span> <span class="keywordflow">in</span> rc:
<a name="l00817"></a>00817                 portal_entries = rc[<span class="stringliteral">&apos;iscsi-portal-list-entries&apos;</span>]
<a name="l00818"></a>00818                 <span class="keywordflow">if</span> <span class="stringliteral">&apos;iscsi-portal-list-entry-info&apos;</span> <span class="keywordflow">in</span> portal_entries:
<a name="l00819"></a>00819                     tmp = portal_entries[<span class="stringliteral">&apos;iscsi-portal-list-entry-info&apos;</span>]
<a name="l00820"></a>00820                     portals = to_list(tmp)
<a name="l00821"></a>00821                     <span class="keywordflow">for</span> p <span class="keywordflow">in</span> portals:
<a name="l00822"></a>00822                         mac = i_info[p[<span class="stringliteral">&apos;interface-name&apos;</span>]][<span class="stringliteral">&apos;mac-address&apos;</span>]
<a name="l00823"></a>00823                         i_list.append(dict(interface=p[<span class="stringliteral">&apos;interface-name&apos;</span>],
<a name="l00824"></a>00824                                            ip=p[<span class="stringliteral">&apos;ip-address&apos;</span>],
<a name="l00825"></a>00825                                            port=p[<span class="stringliteral">&apos;ip-port&apos;</span>],
<a name="l00826"></a>00826                                            mac=mac))
<a name="l00827"></a>00827         <span class="keywordflow">except</span> FilerError <span class="keyword">as</span> na:
<a name="l00828"></a>00828             <span class="keywordflow">if</span> na.errno != Filer.EAPILICENSE:
<a name="l00829"></a>00829                 <span class="keywordflow">raise</span>
<a name="l00830"></a>00830 
<a name="l00831"></a>00831         <span class="keywordflow">return</span> i_list
<a name="l00832"></a>00832 
<a name="l00833"></a>00833 <span class="keywordflow">if</span> __name__ == <span class="stringliteral">&apos;__main__&apos;</span>:
<a name="l00834"></a>00834     <span class="keywordflow">try</span>:
<a name="l00835"></a>00835         <span class="comment">#TODO: Need some unit test code</span>
<a name="l00836"></a>00836         <span class="keywordflow">pass</span>
<a name="l00837"></a>00837 
<a name="l00838"></a>00838     <span class="keywordflow">except</span> FilerError <span class="keyword">as</span> fe:
<a name="l00839"></a>00839         <span class="keywordflow">print</span> <span class="stringliteral">&apos;Errno=&apos;</span>, fe.errno, <span class="stringliteral">&apos;reason=&apos;</span>, fe.reason
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 9 Jul 2015 for libStorageMgmt by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
